define("discourse/plugins/discourse-ai/discourse/admin-discourse-ai-plugin-route-map",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"admin.adminPlugins.show",path:"/plugins",map(){this.route("discourse-ai-personas",{path:"ai-personas"},function(){this.route("new"),this.route("edit",{path:"/:id/edit"})}),this.route("discourse-ai-llms",{path:"ai-llms"},function(){this.route("new"),this.route("edit",{path:"/:id/edit"})}),this.route("discourse-ai-tools",{path:"ai-tools"},function(){this.route("new"),this.route("edit",{path:"/:id/edit"})}),this.route("discourse-ai-spam",{path:"ai-spam"}),this.route("discourse-ai-translations",{path:"ai-translations"}),this.route("discourse-ai-usage",{path:"ai-usage"}),this.route("discourse-ai-embeddings",{path:"ai-embeddings"},function(){this.route("new"),this.route("edit",{path:"/:id/edit"})}),this.route("discourse-ai-features",{path:"ai-features"},function(){this.route("edit",{path:"/:id/edit"})})}}}),define("discourse/plugins/discourse-ai/discourse/admin-discourse-ai-route-map",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"admin.dashboard",path:"/dashboard",map(){this.route("admin.dashboardSentiment",{path:"/dashboard/sentiment",resetNamespace:!0})}}}),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-embedding",["exports","discourse/adapters/rest"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-embedding"}}e.default=s}),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-feature",["exports","discourse/adapters/rest"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-feature"}}e.default=s}),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-llm",["exports","discourse/adapters/rest"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-llm"}}e.default=s}),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-persona",["exports","discourse/adapters/rest"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-persona"}}e.default=s}),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-tool",["exports","discourse/adapters/rest"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-tool"}}e.default=s}),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-embedding",["exports","discourse/lib/ajax","discourse/models/rest"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{createProperties(){return this.getProperties("id","display_name","dimensions","provider","tokenizer_class","dimensions","url","api_key","max_sequence_length","provider_params","pg_function","embed_prompt","search_prompt","matryoshka_dimensions")}updateProperties(){const e=this.createProperties()
return e.id=this.id,e}async testConfig(){return await(0,t.ajax)("/admin/plugins/discourse-ai/ai-embeddings/test.json",{data:{ai_embedding:this.createProperties()}})}workingCopy(){const e=this.createProperties()
return this.store.createRecord("ai-embedding",e)}}e.default=i}),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-feature",["exports","discourse/models/rest"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{createProperties(){return this.getProperties("id","module","global_enabled","features")}}e.default=s}),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-llm",["exports","discourse/lib/ajax","discourse/models/rest"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{createProperties(){return this.getProperties("id","display_name","name","provider","tokenizer","max_prompt_tokens","max_output_tokens","url","api_key","enabled_chat_bot","provider_params","vision_enabled","input_cost","cached_input_cost","output_cost")}updateProperties(){const e=this.createProperties()
return e.id=this.id,e.llm_quotas=this.llm_quotas,e}async testConfig(e){return await(0,t.ajax)("/admin/plugins/discourse-ai/ai-llms/test.json",{data:{ai_llm:e??this.createProperties()}})}}e.default=i}),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-persona",["exports","discourse/lib/ajax","discourse/models/rest"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const i=["id","name","description","tools","system_prompt","allowed_group_ids","enabled","system","priority","top_p","temperature","user_id","default_llm_id","force_default_llm","user","max_context_posts","vision_enabled","vision_max_pixels","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens","rag_conversation_chunks","rag_llm_model_id","question_consolidator_llm_id","allow_chat","tool_details","forced_tool_count","allow_personal_messages","allow_topic_mentions","allow_chat_channel_mentions","allow_chat_direct_messages","response_format","examples"],o=["id","allowed_group_ids","enabled","system","priority","tools","user_id","default_llm_id","force_default_llm","user","max_context_posts","vision_enabled","vision_max_pixels","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens","rag_conversation_chunks","rag_llm_model_id","question_consolidator_llm_id","tool_details","allow_personal_messages","allow_topic_mentions","allow_chat_channel_mentions","allow_chat_direct_messages"]
class a extends s.default{async createUser(){const e=await(0,t.ajax)(`/admin/plugins/discourse-ai/ai-personas/${this.id}/create-user.json`,{type:"POST"})
return this.user=e.user,this.user_id=this.user.id,this.user}flattenedToolStructure(e){return(e.tools||[]).map(t=>[t,e.toolOptions[t]||{},e.forcedTools.includes(t)])}populateTools(e){const t=[],s={},i=e.tools?.map(e=>{if("string"==typeof e)return e
{let[i,o,a]=e
const n={}
for(const e in o)o.hasOwnProperty(e)&&(n[e]=o[e])
return Object.keys(n).length>0&&(s[i]=n),a&&t.push(i),i}})
e.tools=i,e.forcedTools=t,e.toolOptions=s}updateProperties(){const e=this.system?this.getProperties(o):this.getProperties(i)
return e.id=this.id,e}createProperties(){return this.getProperties(i)}fromPOJO(e){const t=JSON.parse(JSON.stringify(e)),s=a.create(t)
return s.tools=this.flattenedToolStructure(t),s}toPOJO(){const e=this.getProperties(i)
return this.populateTools(e),e.forced_tool_count=this.forced_tool_count||-1,e.response_format=e.response_format||[],e.examples=e.examples||[],e}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-tool",["exports","@ember-compat/tracked-built-ins","discourse/models/rest"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const i=["id","name","tool_name","description","parameters","script","summary","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens","rag_llm_model_id","enabled"]
class o extends s.default{createProperties(){return this.getProperties(i)}updateProperties(){return this.getProperties(i)}trackParameters(e){return new t.TrackedArray(e?.map(e=>{const s=new t.TrackedObject(e)
return s.enum&&s.enum.length?s.enum=new t.TrackedArray(s.enum):s.enum=null,s}))}workingCopy(){const e=this.getProperties(i)
return e.parameters=this.trackParameters(e.parameters),this.store.createRecord("ai-tool",e)}}e.default=o}),define("discourse/plugins/discourse-ai/discourse/components/admin-report-emotion",["exports","@ember/component","@ember-decorators/component","discourse/helpers/d-icon","discourse/helpers/number","discourse/lib/get-url","@ember/template-factory"],function(e,t,s,i,o,a,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const r=dt7948.c(class extends t.default{get todayLink(){let e=moment().format("YYYY-MM-DD")
return this._filterURL(e)}get yesterdayLink(){let e=moment().subtract(1,"day").format("YYYY-MM-DD")
return this._filterURL(e)}get lastSevenDaysLink(){let e=moment().subtract(1,"week").format("YYYY-MM-DD")
return this._filterURL(e)}get lastThirtyDaysLink(){let e=moment().subtract(1,"month").format("YYYY-MM-DD")
return this._filterURL(e)}_baseFilter(){return"/filter?q=activity-after%3A"}_model(){return"%20order%3A"+this.model.type}_filterURL(e){return(0,a.default)(`${this._baseFilter()}${e}${this._model()}`)}static{(0,t.setComponentTemplate)((0,n.createTemplateFactory)({id:"ybkbu1Ax",block:'[[[1,"\\n    "],[10,0],[14,0,"cell title"],[12],[1,"\\n"],[41,[30,0,["model","icon"]],[[[1,"        "],[1,[28,[32,0],[[30,0,["model","icon"]]],null]],[1,"\\n"]],[]],null],[1,"      "],[1,[30,0,["model","title"]]],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"cell value today-count"],[12],[1,"\\n      "],[10,3],[15,6,[30,0,["todayLink"]]],[12],[1,"\\n        "],[1,[28,[32,1],[[30,0,["model","todayCount"]]],null]],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[15,0,[29,["cell value yesterday-count ",[30,0,["model","yesterdayTrend"]]]]],[15,"title",[30,0,["model","yesterdayCountTitle"]]],[12],[1,"\\n      "],[10,3],[15,6,[30,0,["yesterdayLink"]]],[12],[1,"\\n        "],[1,[28,[32,1],[[30,0,["model","yesterdayCount"]]],null]],[1,"\\n      "],[13],[1,"\\n      "],[1,[28,[32,0],[[30,0,["model","yesterdayTrendIcon"]]],null]],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[15,0,[29,["cell value sevendays-count ",[30,0,["model","sevenDaysTrend"]]]]],[15,"title",[30,0,["model","sevenDaysCountTitle"]]],[12],[1,"\\n      "],[10,3],[15,6,[30,0,["lastSevenDaysLink"]]],[12],[1,"\\n        "],[1,[28,[32,1],[[30,0,["model","lastSevenDaysCount"]]],null]],[1,"\\n      "],[13],[1,"\\n      "],[1,[28,[32,0],[[30,0,["model","sevenDaysTrendIcon"]]],null]],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[15,0,[29,["cell value thirty-days-count ",[30,0,["model","thirtyDaysTrend"]]]]],[15,"title",[30,0,["model","thirtyDaysCountTitle"]]],[12],[1,"\\n\\n      "],[10,3],[15,6,[30,0,["lastThirtyDaysLink"]]],[12],[1,"\\n        "],[1,[28,[32,1],[[30,0,["model","lastThirtyDaysCount"]]],null]],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["model","canDisplayTrendIcon"]],[[[1,"        "],[1,[28,[32,0],[[30,0,["model","thirtyDaysTrendIcon"]]],null]],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/admin-report-emotion.js",scope:()=>[i.default,o.default],isStrictMode:!0}),this)}},[(0,s.attributeBindings)("model.description:title"),(0,s.classNames)("admin-report-counters")])
e.default=r}),define("discourse/plugins/discourse-ai/discourse/components/admin-report-sentiment-analysis",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","ember-modifier","truth-helpers","discourse/components/d-button","discourse/components/horizontal-overflow-nav","discourse/components/post-list","discourse/helpers/body-class","discourse/helpers/category-badge","discourse/helpers/d-icon","discourse/helpers/replace-emoji","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/get-url","discourse/lib/later","discourse/lib/utilities","discourse/models/category","discourse/models/post","discourse-i18n","float-kit/components/d-tooltip","discourse/plugins/discourse-ai/discourse/components/doughnut-chart","discourse/plugins/discourse-ai/discourse/components/ai-sentiment-horizontal-bar","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f,_,b,v,y,w,S,x,k,T,P,C,j,M){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class A extends t.default{static{dt7948.g(this.prototype,"router",[r.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"selectedChart",[s.tracked],function(){return null})}#t=void dt7948.i(this,"selectedChart")
static{dt7948.g(this.prototype,"posts",[s.tracked],function(){return[]})}#s=void dt7948.i(this,"posts")
static{dt7948.g(this.prototype,"hasMorePosts",[s.tracked],function(){return!1})}#i=void dt7948.i(this,"hasMorePosts")
static{dt7948.g(this.prototype,"nextOffset",[s.tracked],function(){return 0})}#o=void dt7948.i(this,"nextOffset")
static{dt7948.g(this.prototype,"showingSelectedChart",[s.tracked],function(){return!1})}#a=void dt7948.i(this,"showingSelectedChart")
static{dt7948.g(this.prototype,"activeFilter",[s.tracked],function(){return"all"})}#n=void dt7948.i(this,"activeFilter")
static{dt7948.g(this.prototype,"shareIcon",[s.tracked],function(){return"link"})}#r=void dt7948.i(this,"shareIcon")
setActiveFilter=(0,l.modifier)(e=>{this.clearActiveFilters(e),e.querySelector(`li[data-filter-type="${this.activeFilter}"] button`).classList.add("active")})
clearActiveFilters(e){const t=e.querySelectorAll("li button")
for(let s of t)s.classList.remove("active")}calculateNeutralScore(e){return e.total_count-(e.positive_count+e.negative_count)}sentimentMapping(e){switch(e){case"positive":return{id:"positive",text:(0,k.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.positive"),icon:"face-smile"}
case"neutral":return{id:"neutral",text:(0,k.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.neutral"),icon:"face-meh"}
case"negative":return{id:"negative",text:(0,k.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.negative"),icon:"face-angry"}}}get groupingType(){const e="discourse_ai.sentiments.sentiment_analysis.group_types"
return this.args.model.data[0].category_name?(0,k.i18n)(`${e}.category`):(0,k.i18n)(`${e}.tag`)}get colors(){return["#2ecc71","#95a5a6","#e74c3c"]}get currentGroupFilter(){return this.args.model.available_filters.find(e=>"group_by"===e.id).default}get currentSortFilter(){return this.args.model.available_filters.find(e=>"sort_by"===e.id).default}get transformedData(){return this.args.model.data.map(e=>({category:S.default.findById(e.category_id),title:e.category_name||e.tag_name,scores:[e.positive_count,this.calculateNeutralScore(e),e.negative_count],score_map:{positive:e.positive_count,neutral:this.calculateNeutralScore(e),negative:e.negative_count},total_score:e.total_count,widths:{positive:e.positive_count/e.total_count*100,neutral:this.calculateNeutralScore(e)/e.total_count*100,negative:e.negative_count/e.total_count*100}}))}get filteredPosts(){return this.posts&&this.posts.length?this.posts.filter(e=>(e.topic_title=(0,f.default)(e.topic_title),e.category=S.default.findById(e.category_id),"all"===this.activeFilter||e.sentiment===this.activeFilter)):[]}get postFilters(){return[{id:"all",text:`${(0,k.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.all")} (${this.selectedChart.total_score})`,icon:"bars-staggered",action:()=>{this.activeFilter="all"}},{id:"positive",text:`${(0,k.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.positive")} (${this.selectedChart.scores[0]})`,icon:"face-smile",action:()=>{this.activeFilter="positive"}},{id:"neutral",text:`${(0,k.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.neutral")} (${this.selectedChart.scores[1]})`,icon:"face-meh",action:()=>{this.activeFilter="neutral"}},{id:"negative",text:`${(0,k.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.negative")} (${this.selectedChart.scores[2]})`,icon:"face-angry",action:()=>{this.activeFilter="negative"}}]}async postRequest(){return await(0,_.ajax)("/discourse-ai/sentiment/posts",{data:{group_by:this.currentGroupFilter,group_value:this.selectedChart?.title,start_date:this.args.model.start_date,end_date:this.args.model.end_date,offset:this.nextOffset}})}async openToChart(){const e=this.router.currentRoute.queryParams
if(e.selectedChart){if(this.selectedChart=this.transformedData.find(t=>t.title===e.selectedChart),!this.selectedChart)return
this.showingSelectedChart=!0
try{const e=await this.postRequest()
this.posts=e.posts.map(e=>x.default.create(e)),this.hasMorePosts=e.has_more,this.nextOffset=e.next_offset}catch(t){(0,b.popupAjaxError)(t)}}}static{dt7948.n(this.prototype,"openToChart",[a.action])}async showDetails(e){if(this.selectedChart===e)return
const t=this.router.currentRoute.queryParams,s=t?.filters?JSON.parse(t.filters):{}
this.router.transitionTo(this.router.currentRoute.name,{queryParams:{...t,filters:s,selectedChart:e.title}}),this.selectedChart=e,this.showingSelectedChart=!0
try{const e=await this.postRequest()
this.posts=e.posts.map(e=>x.default.create(e)),this.hasMorePosts=e.has_more,this.nextOffset=e.next_offset}catch(i){(0,b.popupAjaxError)(i)}}static{dt7948.n(this.prototype,"showDetails",[a.action])}async fetchMorePosts(){if(!this.hasMorePosts||null===this.selectedChart)return[]
try{const e=await this.postRequest()
this.hasMorePosts=e.has_more,this.nextOffset=e.next_offset
const t=e.posts.map(e=>x.default.create(e))
return this.posts.pushObjects(t),t}catch(e){(0,b.popupAjaxError)(e)}}static{dt7948.n(this.prototype,"fetchMorePosts",[a.action])}backToAllCharts(){this.showingSelectedChart=!1,this.selectedChart=null,this.activeFilter="all",this.posts=[]
const e=this.router.currentRoute.queryParams,t=e?.filters?JSON.parse(e.filters):{}
this.router.transitionTo(this.router.currentRoute.name,{queryParams:{...e,filters:t,selectedChart:null}})}static{dt7948.n(this.prototype,"backToAllCharts",[a.action])}shareChart(){const e=this.router.currentURL
e&&((0,w.clipboardCopy)((0,v.getAbsoluteURL)(e)),this.shareIcon="check",(0,y.default)(()=>{this.shareIcon="link"},2e3))}static{dt7948.n(this.prototype,"shareChart",[a.action])}static{(0,j.setComponentTemplate)((0,M.createTemplateFactory)({id:"vaenlI3f",block:'[[[1,"\\n    "],[11,1],[4,[32,0],[[30,0,["openToChart"]]],null],[12],[13],[1,"\\n\\n"],[41,[51,[30,0,["showingSelectedChart"]]],[[[1,"      "],[10,0],[14,0,"admin-report-sentiment-analysis"],[12],[1,"\\n        "],[10,"table"],[14,0,"sentiment-analysis-table md-table"],[12],[1,"\\n          "],[10,"thead"],[12],[1,"\\n            "],[10,"th"],[12],[1,[30,0,["groupingType"]]],[13],[1,"\\n            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.sentiments.sentiment_analysis.table.total_count"],null]],[13],[1,"\\n            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.sentiments.sentiment_analysis.table.sentiment"],null]],[13],[1,"\\n          "],[13],[1,"\\n\\n          "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["transformedData"]]],null]],null],null,[[[1,"              "],[11,"tr"],[24,0,"sentiment-analysis-table__row"],[24,"role","button"],[4,[32,2],["click",[28,[32,3],[[30,0,["showDetails"]],[30,1]],null]],null],[12],[1,"\\n                "],[10,"td"],[14,0,"sentiment-analysis-table__title"],[12],[1,"\\n"],[41,[30,1,["category"]],[[[1,"                    "],[1,[28,[32,4],[[30,1,["category"]]],null]],[1,"\\n"]],[]],[[[1,"                    "],[1,[30,1,["title"]]],[1,"\\n"]],[]]],[1,"                "],[13],[1,"\\n                "],[10,"td"],[14,0,"sentiment-analysis-table__total-score"],[12],[1,[30,1,["total_score"]]],[13],[1,"\\n                "],[10,"td"],[14,0,"sentiment-horizontal-bar"],[12],[1,"\\n                  "],[8,[32,5],null,[["@type","@score","@width"],["positive",[30,1,["score_map","positive"]],[30,1,["widths","positive"]]]],null],[1,"\\n                  "],[8,[32,5],null,[["@type","@score","@width"],["negative",[30,1,["score_map","negative"]],[30,1,["widths","negative"]]]],null],[1,"\\n                  "],[8,[32,5],null,[["@type","@score","@width"],["neutral",[30,1,["score_map","neutral"]],[30,1,["widths","neutral"]]]],null],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n"]],[1]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,6],[[30,0,["selectedChart"]],[30,0,["showingSelectedChart"]]],null],[[[1,"      "],[1,[28,[32,7],["showing-sentiment-analysis-chart"],null]],[1,"\\n      "],[10,0],[14,0,"admin-report-sentiment-analysis__selected-chart"],[12],[1,"\\n        "],[10,0],[14,0,"admin-report-sentiment-analysis__selected-chart-actions"],[12],[1,"\\n          "],[8,[32,8],[[24,0,"btn-flat"]],[["@label","@icon","@action"],["back_button","chevron-left",[30,0,["backToAllCharts"]]]],null],[1,"\\n\\n          "],[8,[32,9],[[24,0,"share btn-flat"],[4,[32,2],["click",[30,0,["shareChart"]]],null]],[["@icon","@content"],[[30,0,["shareIcon"]],[28,[32,1],["discourse_ai.sentiments.sentiment_analysis.share_chart"],null]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[8,[32,10],null,[["@labels","@colors","@data","@totalScore","@doughnutTitle","@displayLegend"],[[30,2,["labels"]],[30,0,["colors"]],[30,0,["selectedChart","scores"]],[30,0,["selectedChart","total_score"]],[30,0,["selectedChart","title"]],true]],null],[1,"\\n\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"admin-report-sentiment-analysis-details"],[12],[1,"\\n        "],[8,[32,11],[[24,0,"admin-report-sentiment-analysis-details__filters"],[4,[30,0,["setActiveFilter"]],null,null]],null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["postFilters"]]],null]],null],null,[[[1,"            "],[10,"li"],[15,"data-filter-type",[30,3,["id"]]],[12],[1,"\\n              "],[8,[32,8],[[24,0,"btn-transparent"]],[["@icon","@translatedLabel","@action"],[[30,3,["icon"]],[30,3,["text"]],[30,3,["action"]]]],null],[1,"\\n            "],[13],[1,"\\n"]],[3]],null],[1,"        "]],[]]]]],[1,"\\n\\n        "],[8,[32,12],[[24,0,"admin-report-sentiment-analysis-details__post-list"]],[["@posts","@urlPath","@idPath","@titlePath","@usernamePath","@fetchMorePosts"],[[30,0,["filteredPosts"]],"url","post_id","topic_title","username",[30,0,["fetchMorePosts"]]]],[["abovePostItemExcerpt"],[[[[1,"\\n"],[44,[[28,[30,0,["sentimentMapping"]],[[30,4,["sentiment"]]],null]],[[[1,"              "],[10,1],[14,0,"admin-report-sentiment-analysis-details__post-score"],[15,"data-sentiment-score",[30,5,["id"]]],[12],[1,"\\n                "],[1,[28,[32,13],[[30,5,["icon"]]],null]],[1,"\\n                "],[1,[30,5,["text"]]],[1,"\\n              "],[13],[1,"\\n"]],[5]]],[1,"          "]],[4]]]]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["data","@model","filter","post","sentiment"],false,["unless","each","-track-array","if","let"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/admin-report-sentiment-analysis.js",scope:()=>[n.default,k.i18n,o.on,i.fn,h.default,C.default,d.and,m.default,u.default,T.default,P.default,c.default,p.default,g.default],isStrictMode:!0}),this)}}e.default=A}),define("discourse/plugins/discourse-ai/discourse/components/ai-artifact",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","@ember/template","discourse/components/d-button","discourse/helpers/html-class","discourse/lib/get-url","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class p extends t.default{static{dt7948.g(this.prototype,"siteSettings",[a.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"expanded",[s.tracked],function(){return!1})}#d=void dt7948.i(this,"expanded")
static{dt7948.g(this.prototype,"showingArtifact",[s.tracked],function(){return!1})}#u=void dt7948.i(this,"showingArtifact")
constructor(){super(...arguments),this.keydownHandler=this.handleKeydown.bind(this),this.popStateHandler=this.handlePopState.bind(this),window.addEventListener("popstate",this.popStateHandler)}willDestroy(){super.willDestroy(...arguments),window.removeEventListener("keydown",this.keydownHandler),window.removeEventListener("popstate",this.popStateHandler)}handleKeydown(e){"Escape"!==e.key&&"Esc"!==e.key||history.back()}static{dt7948.n(this.prototype,"handleKeydown",[i.action])}handlePopState(e){const t=e.state
this.expanded=t?.artifactId===this.args.artifactId,this.expanded||window.removeEventListener("keydown",this.keydownHandler)}static{dt7948.n(this.prototype,"handlePopState",[i.action])}get requireClickToRun(){if(this.showingArtifact)return!1
if("strict"===this.siteSettings.ai_artifact_security)return!0
if("hybrid"===this.siteSettings.ai_artifact_security){return!("true"===this.args.autorun||!0===this.args.autorun||"1"===this.args.autorun)}return"lax"!==this.siteSettings.ai_artifact_security}get artifactUrl(){let e=(0,d.default)(`/discourse-ai/ai-bot/artifacts/${this.args.artifactId}`)
return this.args.artifactVersion&&(e=`${e}/${this.args.artifactVersion}`),e}showArtifact(){this.showingArtifact=!0}static{dt7948.n(this.prototype,"showArtifact",[i.action])}toggleView(){this.expanded?history.back():(window.history.pushState({artifactId:this.args.artifactId},"",window.location.href+"#artifact-fullscreen"),window.addEventListener("keydown",this.keydownHandler)),this.expanded=!this.expanded}static{dt7948.n(this.prototype,"toggleView",[i.action])}get wrapperClasses(){return`ai-artifact__wrapper ${this.expanded?"ai-artifact__expanded":""} ${this.seamless?"ai-artifact__seamless":""}`}setDataAttributes(e){this.args.dataAttributes&&Object.entries(this.args.dataAttributes).forEach(([t,s])=>{e.setAttribute(t,s)})}static{dt7948.n(this.prototype,"setDataAttributes",[i.action])}get heightStyle(){if(this.args.artifactHeight){let e=parseInt(this.args.artifactHeight,10)
return(isNaN(e)||e<=0)&&(e=500),e>2e3&&(e=2e3),(0,n.htmlSafe)(`height: ${e}px;`)}}get seamless(){return"true"===this.args.seamless||!0===this.args.seamless||"1"===this.args.seamless}get showFooter(){return!this.seamless&&!this.requireClickToRun}static{(0,u.setComponentTemplate)((0,c.createTemplateFactory)({id:"QA/bSjnx",block:'[[[1,"\\n"],[41,[30,0,["expanded"]],[[[1,"      "],[1,[28,[32,0],["ai-artifact-expanded"],null]],[1,"\\n"]],[]],null],[1,"    "],[10,0],[15,0,[30,0,["wrapperClasses"]]],[15,5,[30,0,["heightStyle"]]],[12],[1,"\\n      "],[10,0],[14,0,"ai-artifact__panel--wrapper"],[12],[1,"\\n        "],[10,0],[14,0,"ai-artifact__panel"],[12],[1,"\\n          "],[8,[32,1],[[24,0,"btn-flat btn-icon-text"]],[["@icon","@label","@action"],["discourse-compress","discourse_ai.ai_artifact.collapse_view_label",[30,0,["toggleView"]]]],null],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["requireClickToRun"]],[[[1,"        "],[10,0],[14,0,"ai-artifact__click-to-run"],[12],[1,"\\n          "],[8,[32,1],[[24,0,"btn btn-primary"]],[["@icon","@label","@action"],["play","discourse_ai.ai_artifact.click_to_run_label",[30,0,["showArtifact"]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],[[[1,"        "],[11,"iframe"],[24,"title","AI Artifact"],[16,"src",[30,0,["artifactUrl"]]],[24,"width","100%"],[24,"frameborder","0"],[4,[32,2],[[30,0,["setDataAttributes"]]],null],[12],[13],[1,"\\n"]],[]]],[41,[30,0,["showFooter"]],[[[1,"        "],[10,0],[14,0,"ai-artifact__footer"],[12],[1,"\\n          "],[8,[32,1],[[24,0,"btn-transparent btn-icon-text ai-artifact__expand-button"]],[["@icon","@label","@action"],["discourse-expand","discourse_ai.ai_artifact.expand_view_label",[30,0,["toggleView"]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-artifact.js",scope:()=>[l.default,r.default,o.default],isStrictMode:!0}),this)}}e.default=p}),define("discourse/plugins/discourse-ai/discourse/components/ai-blinking-animation",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/runloop","discourse/helpers/concat-class","discourse/lib/later","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m{static{dt7948.g(this.prototype,"show",[s.tracked],function(){return!1})}#c=void dt7948.i(this,"show")
static{dt7948.g(this.prototype,"shown",[s.tracked],function(){return!1})}#p=void dt7948.i(this,"shown")
static{dt7948.g(this.prototype,"blinking",[s.tracked],function(){return!1})}#m=void dt7948.i(this,"blinking")
constructor(e={}){this.show=e.show??!1,this.shown=e.shown??!1}}class h extends t.default{blocks=[...Array.from({length:20},()=>new m)]
#h
#g
#f
setupAnimation(){this.blocks.firstObject.show=!0,this.blocks.firstObject.shown=!0}static{dt7948.n(this.prototype,"setupAnimation",[o.action])}onBlinking(e){e.blinking&&(e.show=!1,this.#h=(0,u.default)(this,()=>{this.#_(e).blinking=!0},250),this.#g=(0,u.default)(this,()=>{e.blinking=!1},500))}static{dt7948.n(this.prototype,"onBlinking",[o.action])}onShowing(e){e.show&&(this.#f=(0,u.default)(this,()=>{this.#_(e).show=!0,this.#_(e).shown=!0,this.blocks.lastObject===e&&(this.blocks.firstObject.blinking=!0)},250))}static{dt7948.n(this.prototype,"onShowing",[o.action])}teardownAnimation(){(0,l.cancel)(this.#f),(0,l.cancel)(this.#h),(0,l.cancel)(this.#g)}static{dt7948.n(this.prototype,"teardownAnimation",[o.action])}#_(e){return e===this.blocks.lastObject?this.blocks.firstObject:this.blocks.objectAt(this.blocks.indexOf(e)+1)}static{(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"cWbDH+g8",block:'[[[1,"\\n    "],[11,"ul"],[24,0,"ai-blinking-animation"],[4,[32,0],[[30,0,["setupAnimation"]]],null],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["blocks"]]],null]],null],null,[[[1,"        "],[11,"li"],[16,0,[28,[32,1],["ai-blinking-animation__list-item",[52,[30,1,["show"]],"show"],[52,[30,1,["shown"]],"is-shown"],[52,[30,1,["blinking"]],"blink"]],null]],[4,[32,2],[[28,[32,3],[[30,0,["onBlinking"]],[30,1]],null],[30,1,["blinking"]]],null],[4,[32,2],[[28,[32,3],[[30,0,["onShowing"]],[30,1]],null],[30,1,["show"]]],null],[4,[32,4],[[30,0,["teardownAnimation"]]],null],[12],[13],[1,"\\n"]],[1]],null],[1,"    "],[13],[1,"\\n  "]],["block"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-blinking-animation.js",scope:()=>[a.default,d.default,n.default,i.fn,r.default],isStrictMode:!0}),this)}}e.default=h}),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-conversations",["exports","@glimmer/tracking","@ember/component","@ember/helper","@ember/modifier","@ember/object","@ember/owner","@ember/render-modifiers/modifiers/did-insert","@ember/runloop","@ember/service","@ember-compat/tracked-built-ins","jquery","discourse/components/d-button","discourse/components/plugin-outlet","discourse/helpers/body-class","discourse/helpers/lazy-hash","discourse/lib/ajax-error","discourse/lib/autocomplete/user","discourse/lib/hashtag-autocomplete","discourse/lib/textarea-text-manipulation","discourse/lib/uppy/uppy-upload","discourse/lib/uppy-media-optimization-plugin","discourse/lib/user-search","discourse/lib/user-status-on-autocomplete","discourse/lib/utilities","discourse/modifiers/d-autocomplete","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-persona-llm-selector","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f,_,b,v,y,w,S,x,k,T,P,C,j){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class M extends s.default{static{dt7948.g(this.prototype,"aiBotConversationsHiddenSubmit",[d.service])}#b=void dt7948.i(this,"aiBotConversationsHiddenSubmit")
static{dt7948.g(this.prototype,"mediaOptimizationWorker",[d.service])}#v=void dt7948.i(this,"mediaOptimizationWorker")
static{dt7948.g(this.prototype,"site",[d.service])}#y=void dt7948.i(this,"site")
static{dt7948.g(this.prototype,"siteSettings",[d.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"uploads",[t.tracked],function(){return new u.TrackedArray})}#w=void dt7948.i(this,"uploads")
textarea=null
uppyUpload=null
fileInputEl=null
_handlePaste=e=>{if(document.activeElement!==this.textarea)return
const{canUpload:t,canPasteHtml:s,types:i}=(0,k.clipboardHelpers)(e,{siteSettings:this.siteSettings,canUpload:!0})
!t||s||i.includes("text/plain")||e&&e.clipboardData&&e.clipboardData.files&&this.uppyUpload.addFiles([...e.clipboardData.files],{pasted:!0})}
init(){super.init(...arguments),this.uppyUpload=new y.default((0,n.getOwner)(this),{id:"ai-bot-file-uploader",type:"ai-bot-conversation",useMultipartUploadsIfAvailable:!0,uppyReady:()=>{this.siteSettings.composer_media_optimization_image_enabled&&this.uppyUpload.uppyWrapper.useUploadPlugin(w.default,{optimizeFn:(e,t)=>this.mediaOptimizationWorker.optimizeImage(e,t),runParallel:!this.site.isMobileDevice}),this.uppyUpload.uppyWrapper.onPreProcessProgress(e=>{const t=this.inProgressUploads?.find(t=>t.id===e.id)
t&&!t.processing&&(t.processing=!0)}),this.uppyUpload.uppyWrapper.onPreProcessComplete(e=>{const t=this.inProgressUploads?.find(t=>t.id===e.id)
t&&(t.processing=!1)}),this.textarea?.addEventListener("paste",this._handlePaste)},uploadDone:e=>{this.uploads.push(e)},onProgressUploadsChanged:()=>{this.notifyPropertyChange("inProgressUploads")}})}willDestroy(){super.willDestroy(...arguments),this.textarea?.removeEventListener("paste",this._handlePaste),this.uppyUpload?.teardown(),this.textarea.autocomplete&&this.textarea.autocomplete("destroy")}get loading(){return this.aiBotConversationsHiddenSubmit?.loading}get inProgressUploads(){return this.uppyUpload?.inProgressUploads||[]}get showUploadsContainer(){return this.uploads?.length>0||this.inProgressUploads?.length>0}setPersonaId(e){this.aiBotConversationsHiddenSubmit.personaId=e}static{dt7948.n(this.prototype,"setPersonaId",[a.action])}setTargetRecipient(e){this.aiBotConversationsHiddenSubmit.targetUsername=e}static{dt7948.n(this.prototype,"setTargetRecipient",[a.action])}updateInputValue(e){this._autoExpandTextarea(),this.aiBotConversationsHiddenSubmit.inputValue=e.target?.value||e}static{dt7948.n(this.prototype,"updateInputValue",[a.action])}handleKeyDown(e){"TEXTAREA"===e.target.tagName&&("Enter"!==e.key||e.shiftKey||this.prepareAndSubmitToBot())}static{dt7948.n(this.prototype,"handleKeyDown",[a.action])}setTextArea(e){this.textarea=e,this.setupAutocomplete(e),(0,l.scheduleOnce)("afterRender",this,this.focusTextarea)}static{dt7948.n(this.prototype,"setTextArea",[a.action])}focusTextarea(){this.textarea?.focus()}static{dt7948.n(this.prototype,"focusTextarea",[a.action])}setupAutocomplete(e){this.applyUserAutocomplete(e),this.applyHashtagAutocomplete(e)}static{dt7948.n(this.prototype,"setupAutocomplete",[a.action])}applyUserAutocomplete(e){if(!this.siteSettings.enable_mentions)return
this.siteSettings.floatkit_autocomplete_chat_composer||(0,c.default)(e).autocomplete({template:_.default,dataSource:e=>((0,x.destroyUserStatuses)(),(0,S.default)({term:e,includeGroups:!0}).then(e=>((0,x.initUserStatusHtml)((0,n.getOwner)(this),e.users),e))),onRender:e=>(0,x.renderUserStatusHtml)(e),key:"@",width:"100%",treatAsTextarea:!0,autoSelectFirstSuggestion:!0,transformComplete:e=>((0,S.validateSearchResult)(e),e.username||e.name),afterComplete:e=>{this.textarea.value=e,this.focusTextarea(),this.updateInputValue({target:{value:e}})},onClose:x.destroyUserStatuses})
const t=new v.TextareaAutocompleteHandler(e)
T.default.setupAutocomplete((0,n.getOwner)(this),e,t,{template:_.default,dataSource:e=>((0,x.destroyUserStatuses)(),(0,S.default)({term:e,includeGroups:!0}).then(e=>((0,x.initUserStatusHtml)((0,n.getOwner)(this),e.users),e))),onRender:e=>(0,x.renderUserStatusHtml)(e),key:"@",fixedTextareaPosition:!0,autoSelectFirstSuggestion:!0,offset:2,transformComplete:e=>((0,S.validateSearchResult)(e),e.username||e.name),afterComplete:e=>{this.textarea.value=e,this.focusTextarea(),this.updateInputValue({target:{value:e}})},onClose:x.destroyUserStatuses})}static{dt7948.n(this.prototype,"applyUserAutocomplete",[a.action])}applyHashtagAutocomplete(e){const t=this.site.hashtag_configurations["topic-composer"]
this.siteSettings.floatkit_autocomplete_chat_composer||(0,b.setupHashtagAutocomplete)(t,(0,c.default)(e),{treatAsTextarea:!0,afterComplete:e=>{this.textarea.value=e,this.focusTextarea(),this.updateInputValue({target:{value:e}})}})
const s=new v.TextareaAutocompleteHandler(e)
T.default.setupAutocomplete((0,n.getOwner)(this),e,s,(0,b.hashtagAutocompleteOptions)(t,{offset:2,fixedTextareaPosition:!0,afterComplete:e=>{this.textarea.value=e,this.focusTextarea(),this.updateInputValue({target:{value:e}})}}))}static{dt7948.n(this.prototype,"applyHashtagAutocomplete",[a.action])}registerFileInput(e){e&&(this.fileInputEl=e,this.uppyUpload&&this.uppyUpload.setup(e))}static{dt7948.n(this.prototype,"registerFileInput",[a.action])}openFileUpload(){this.fileInputEl&&this.fileInputEl.click()}static{dt7948.n(this.prototype,"openFileUpload",[a.action])}removeUpload(e){this.uploads=new u.TrackedArray(this.uploads.filter(t=>t!==e))}static{dt7948.n(this.prototype,"removeUpload",[a.action])}cancelUpload(e){this.uppyUpload.cancelSingleUpload({fileId:e.id})}static{dt7948.n(this.prototype,"cancelUpload",[a.action])}async prepareAndSubmitToBot(){try{await this.aiBotConversationsHiddenSubmit.submitToBot({uploads:this.uploads,inProgressUploadsCount:this.inProgressUploads.length}),this.uploads=new u.TrackedArray}catch(e){(0,f.popupAjaxError)(e)}}static{dt7948.n(this.prototype,"prepareAndSubmitToBot",[a.action])}_autoExpandTextarea(){this.textarea.style.height="auto",this.textarea.style.height=this.textarea.scrollHeight+"px"
const e=parseInt(getComputedStyle(this.textarea).maxHeight,10)
this.textarea.scrollHeight>e?this.textarea.style.overflowY="auto":this.textarea.style.overflowY="hidden"}static{(0,s.setComponentTemplate)((0,j.createTemplateFactory)({id:"mtM0Tits",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-bot-conversations"],[12],[1,"\\n      "],[1,[28,[32,0],["ai-bot-conversations-page"],null]],[1,"\\n      "],[8,[32,1],null,[["@showLabels","@setPersonaId","@setTargetRecipient","@personaName","@llmName"],[true,[30,0,["setPersonaId"]],[30,0,["setTargetRecipient"]],[30,1,["persona"]],[30,1,["llm"]]]],null],[1,"\\n\\n      "],[10,0],[14,0,"ai-bot-conversations__content-wrapper"],[12],[1,"\\n        "],[10,0],[14,0,"ai-bot-conversations__title"],[12],[1,"\\n          "],[1,[28,[32,2],["discourse_ai.ai_bot.conversations.header"],null]],[1,"\\n        "],[13],[1,"\\n        "],[8,[32,3],null,[["@name","@outletArgs"],["ai-bot-conversations-above-input",[28,[32,4],null,[["updateInput","submit"],[[30,0,["updateInputValue"]],[30,0,["prepareAndSubmitToBot"]]]]]]],null],[1,"\\n\\n        "],[10,0],[14,0,"ai-bot-conversations__input-wrapper"],[12],[1,"\\n          "],[8,[32,5],[[24,0,"btn btn-transparent ai-bot-upload-btn"]],[["@icon","@action","@title"],["upload",[30,0,["openFileUpload"]],"discourse_ai.ai_bot.conversations.upload_files"]],null],[1,"\\n          "],[11,"textarea"],[24,1,"ai-bot-conversations-input"],[24,"autofocus","true"],[16,"placeholder",[28,[32,2],["discourse_ai.ai_bot.conversations.placeholder"],null]],[24,"minlength","10"],[16,"disabled",[30,0,["loading"]]],[24,"rows","1"],[4,[32,6],[[30,0,["setTextArea"]]],null],[4,[32,7],["input",[30,0,["updateInputValue"]]],null],[4,[32,7],["keydown",[30,0,["handleKeyDown"]]],null],[12],[13],[1,"          "],[8,[32,5],[[24,0,"ai-bot-button btn-transparent ai-conversation-submit"]],[["@action","@icon","@isLoading","@title"],[[30,0,["prepareAndSubmitToBot"]],"paper-plane",[30,0,["loading"]],"discourse_ai.ai_bot.conversations.header"]],null],[1,"\\n          "],[11,"input"],[24,1,"ai-bot-file-uploader"],[24,0,"hidden-upload-field"],[24,"multiple","multiple"],[24,4,"file"],[4,[32,6],[[30,0,["registerFileInput"]]],null],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,2],[14,0,"ai-disclaimer"],[12],[1,"\\n          "],[1,[28,[32,2],["discourse_ai.ai_bot.conversations.disclaimer"],null]],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[30,0,["showUploadsContainer"]],[[[1,"          "],[10,0],[14,0,"ai-bot-conversations__uploads-container"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["uploads"]]],null]],null],null,[[[1,"              "],[10,0],[14,0,"ai-bot-upload"],[12],[1,"\\n                "],[10,1],[14,0,"ai-bot-upload__filename"],[12],[1,"\\n                  "],[1,[30,2,["original_filename"]]],[1,"\\n                "],[13],[1,"\\n                "],[8,[32,5],[[24,0,"btn-transparent ai-bot-upload__remove"]],[["@icon","@action"],["xmark",[28,[32,8],[[30,0,["removeUpload"]],[30,2]],null]]],null],[1,"\\n              "],[13],[1,"\\n"]],[2]],null],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["inProgressUploads"]]],null]],null],null,[[[1,"              "],[10,0],[14,0,"ai-bot-upload ai-bot-upload--in-progress"],[12],[1,"\\n                "],[10,1],[14,0,"ai-bot-upload__filename"],[12],[1,[30,3,["fileName"]]],[13],[1,"\\n                "],[10,1],[14,0,"ai-bot-upload__progress"],[12],[1,"\\n                  "],[1,[30,3,["progress"]]],[1,"%\\n                "],[13],[1,"\\n                "],[8,[32,5],[[24,0,"btn-flat ai-bot-upload__cancel"]],[["@icon","@action"],["xmark",[28,[32,8],[[30,0,["cancelUpload"]],[30,3]],null]]],null],[1,"\\n              "],[13],[1,"\\n"]],[3]],null],[1,"          "],[13],[1,"\\n"]],[]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@controller","upload","upload"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-bot-conversations.js",scope:()=>[h.default,C.default,P.i18n,m.default,g.default,p.default,r.default,o.on,i.fn],isStrictMode:!0}),this)}}e.default=M}),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/components/plugin-outlet","discourse/helpers/lazy-hash","discourse/lib/get-url","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/services/ai-conversations-sidebar-manager","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends t.default{static{dt7948.g(this.prototype,"appEvents",[i.service])}#S=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"composer",[i.service])}#x=void dt7948.i(this,"composer")
static{dt7948.g(this.prototype,"currentUser",[i.service])}#k=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"navigationMenu",[i.service])}#T=void dt7948.i(this,"navigationMenu")
static{dt7948.g(this.prototype,"sidebarState",[i.service])}#P=void dt7948.i(this,"sidebarState")
static{dt7948.g(this.prototype,"siteSettings",[i.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"aiConversationsSidebarManager",[i.service])}#C=void dt7948.i(this,"aiConversationsSidebarManager")
get bots(){const e=this.currentUser.ai_enabled_chat_bots.filter(e=>!e.is_persona||e.has_default_llm).filter(Boolean)
return e?e.map(e=>e.model_name):[]}get showHeaderButton(){return this.bots.length>0&&this.siteSettings.ai_bot_add_to_header}get title(){return this.clickShouldRouteOutOfConversations?(0,l.i18n)("discourse_ai.ai_bot.exit"):(0,l.i18n)("discourse_ai.ai_bot.shortcut_title")}get icon(){return this.clickShouldRouteOutOfConversations?"shuffle":"robot"}get clickShouldRouteOutOfConversations(){return!this.navigationMenu.isHeaderDropdownMode&&this.siteSettings.ai_bot_enable_dedicated_ux&&this.sidebarState.currentPanel?.key===u.AI_CONVERSATIONS_PANEL}get href(){return this.clickShouldRouteOutOfConversations?(0,r.default)(this.aiConversationsSidebarManager.lastKnownAppURL||"/"):this.siteSettings.ai_bot_enable_dedicated_ux?(0,r.default)("/discourse-ai/ai-bot/conversations"):null}onClick(){this.siteSettings.ai_bot_enable_dedicated_ux||(0,d.composeAiBotMessage)(this.bots[0],this.composer),this.siteSettings.ai_bot_enable_dedicated_ux&&!this.clickShouldRouteOutOfConversations&&this.appEvents.trigger("discourse-ai:bot-header-icon-clicked")}static{dt7948.n(this.prototype,"onClick",[s.action])}static{(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"OEVI+RDb",block:'[[[1,"\\n"],[41,[30,0,["showHeaderButton"]],[[[1,"      "],[10,"li"],[12],[1,"\\n        "],[8,[32,0],null,[["@name","@outletArgs"],["ai-bot-header-icon",[28,[32,1],null,[["onClick","icon"],[[30,0,["onClick"]],[30,0,["icon"]]]]]]],[["default"],[[[[1,"\\n          "],[8,[32,2],[[16,"title",[30,0,["title"]]],[24,0,"ai-bot-button icon btn-flat"]],[["@href","@action","@icon"],[[30,0,["href"]],[52,[51,[30,0,["href"]]],[30,0,["onClick"]]],[30,0,["icon"]]]],null],[1,"\\n        "]],[]]]]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon.js",scope:()=>[a.default,n.default,o.default],isStrictMode:!0}),this)}}e.default=m}),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-empty-state",["exports","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,s.setComponentTemplate)((0,i.createTemplateFactory)({id:"m29KA1Bv",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-bot-sidebar-empty-state"],[12],[1,"\\n    "],[1,[28,[32,0],["discourse_ai.ai_bot.sidebar_empty"],null]],[1,"\\n  "],[13],[1,"\\n"]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-empty-state.js",scope:()=>[t.i18n],isStrictMode:!0}),(0,o.default)(void 0,"ai-bot-sidebar-empty-state"))}),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-new-conversation",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/plugins/discourse-ai/discourse/services/ai-conversations-sidebar-manager","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static{dt7948.g(this.prototype,"appEvents",[i.service])}#S=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"router",[i.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"sidebarState",[i.service])}#P=void dt7948.i(this,"sidebarState")
get shouldRender(){return this.sidebarState.isCurrentPanel(a.AI_CONVERSATIONS_PANEL)}focusTextarea(){document.getElementById("ai-bot-conversations-input")?.focus()}static{dt7948.n(this.prototype,"focusTextarea",[s.action])}routeTo(){this.appEvents.trigger("discourse-ai:new-conversation-btn-clicked"),"discourse-ai-bot-conversations"!==this.router.currentRouteName?this.router.transitionTo("/discourse-ai/ai-bot/conversations"):this.focusTextarea(),this.args.outletArgs?.toggleNavigationMenu?.()}static{dt7948.n(this.prototype,"routeTo",[s.action])}static{(0,n.setComponentTemplate)((0,r.createTemplateFactory)({id:"0JyS5UZF",block:'[[[1,"\\n"],[41,[30,0,["shouldRender"]],[[[1,"      "],[10,0],[14,0,"ai-new-question-button__wrapper"],[12],[1,"\\n        "],[8,[32,0],[[24,0,"ai-new-question-button btn-default"]],[["@label","@icon","@action"],["discourse_ai.ai_bot.conversations.new","plus",[30,0,["routeTo"]]]],null],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-new-conversation.js",scope:()=>[o.default],isStrictMode:!0}),this)}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/components/ai-composer-helper-menu",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/owner","@ember/service","discourse-i18n","float-kit/components/d-toast","float-kit/lib/d-toast-instance","discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list","discourse/plugins/discourse-ai/discourse/components/modal/diff-modal","discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static{dt7948.g(this.prototype,"modal",[a.service])}#j=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"siteSettings",[a.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"currentUser",[a.service])}#k=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"site",[a.service])}#y=void dt7948.i(this,"site")
static{dt7948.g(this.prototype,"newSelectedText",[s.tracked])}#M=void dt7948.i(this,"newSelectedText")
static{dt7948.g(this.prototype,"diff",[s.tracked])}#A=void dt7948.i(this,"diff")
static{dt7948.g(this.prototype,"customPromptValue",[s.tracked],function(){return""})}#O=void dt7948.i(this,"customPromptValue")
static{dt7948.g(this.prototype,"noContentError",[s.tracked],function(){return!1})}#E=void dt7948.i(this,"noContentError")
prompts=[]
promptTypes={}
constructor(){super(...arguments),0===this.args.data.toolbarEvent.getText().length&&(this.noContentError=!0)}get helperOptions(){let e=this.currentUser?.ai_helper_prompts
e=e.filter(e=>e.location.includes("composer")).filter(e=>"generate_titles"!==e.name).map(e=>{const t=this.siteSettings.default_locale,s=this.siteSettings.available_locales.find(e=>e.value===t),i=(0,n.i18n)("discourse_ai.ai_helper.context_menu.translate_prompt",{language:s.name})
return"translate"===e.name?{...e,translated_name:i}:e})
const t=e.findIndex(e=>"custom_prompt"===e.name)
if(-1!==t){const s=e.splice(t,1)[0]
e.unshift(s)}return this.currentUser?.can_use_custom_prompts||(e=e.filter(e=>"custom_prompt"!==e.name)),e.forEach(e=>{this.prompts[e.name]=e}),this.promptTypes=e.reduce((e,t)=>(e[t.name]=t.prompt_type,e),{}),e}get toast(){const e=(0,o.getOwner)(this),t={close:()=>this.args.close(),duration:"short",data:{theme:"error",icon:"triangle-exclamation",message:(0,n.i18n)("discourse_ai.ai_helper.no_content_error")}}
return new class extends l.default{constructor(){super(e,t)}close(){this.options.close()}static{dt7948.n(this.prototype,"close",[i.action])}}(e,t)}async suggestChanges(e){if(await this.args.close(),"illustrate_post"===e.name)return this.modal.show(c.default,{model:{mode:e.name,selectedText:this.args.data.selectedText,thumbnails:this.thumbnailSuggestions}})
const t="diff"===e.prompt_type&&"markdown_table"!==e.name
return this.modal.show(u.default,{model:{mode:e.name,selectedText:this.args.data.selectedText,revert:this.undoAiAction,toolbarEvent:this.args.data.toolbarEvent,customPromptValue:this.customPromptValue,showResultAsDiff:t}})}static{dt7948.n(this.prototype,"suggestChanges",[i.action])}closeMenu(){this.customPromptValue="",this.args.close()}static{dt7948.n(this.prototype,"closeMenu",[i.action])}static{(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"2ahoy4kS",block:'[[[1,"\\n"],[41,[30,0,["noContentError"]],[[[1,"      "],[8,[32,0],null,[["@toast"],[[30,0,["toast"]]]],null],[1,"\\n"]],[]],[[[1,"      "],[10,0],[14,0,"ai-composer-helper-menu"],[12],[1,"\\n"],[41,[30,0,["site","mobileView"]],[[[1,"          "],[10,0],[14,0,"ai-composer-helper-menu__selected-text"],[12],[1,"\\n            "],[1,[30,1,["selectedText"]]],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[32,1],null,[["@options","@customPromptValue","@performAction","@shortcutVisible"],[[30,0,["helperOptions"]],[30,0,["customPromptValue"]],[30,0,["suggestChanges"]],true]],null],[1,"\\n      "],[13],[1,"\\n"]],[]]],[1,"  "]],["@data"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-composer-helper-menu.js",scope:()=>[r.default,d.default],isStrictMode:!0}),this)}}e.default=h}),define("discourse/plugins/discourse-ai/discourse/components/ai-default-llm-selector",["exports","@glimmer/component","@glimmer/tracking","discourse/lib/ajax","discourse-i18n","admin/components/site-setting","admin/models/site-setting","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static{dt7948.g(this.prototype,"defaultLlmSetting",[s.tracked],function(){return null})}#I=void dt7948.i(this,"defaultLlmSetting")
constructor(){super(...arguments),this.#F()}async#F(){const{site_settings:e}=await(0,i.ajax)("/admin/config/site_settings.json",{data:{plugin:"discourse-ai",category:"discourse_ai"}}),t=e.find(e=>"ai_default_llm_model"===e.setting)
this.defaultLlmSetting=n.default.create(t)}static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"H9NPJOFZ",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-configure-default-llm"],[12],[1,"\\n      "],[10,0],[14,0,"ai-configure-default-llm__header"],[12],[1,"\\n        "],[10,"h3"],[12],[1,[28,[32,0],["discourse_ai.default_llm.title"],null]],[13],[1,"\\n        "],[10,2],[12],[1,[28,[32,0],["discourse_ai.default_llm.description"],null]],[13],[1,"\\n      "],[13],[1,"\\n\\n"],[41,[30,0,["defaultLlmSetting"]],[[[1,"        "],[8,[32,1],[[24,0,"ai-configure-default-llm__setting"]],[["@setting"],[[30,0,["defaultLlmSetting"]]]],null],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-default-llm-selector.js",scope:()=>[o.i18n,a.default],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/discourse-ai/discourse/components/ai-embedding-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/runloop","@ember/service","truth-helpers","discourse/components/back-button","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/form","discourse/helpers/d-icon","discourse/lib/ajax-error","discourse-i18n","admin/components/admin-section-landing-item","admin/components/admin-section-landing-wrapper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f,_,b){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class v extends t.default{static{dt7948.g(this.prototype,"toasts",[n.service])}#R=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"router",[n.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"dialog",[n.service])}#L=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"store",[n.service])}#D=void dt7948.i(this,"store")
static{dt7948.g(this.prototype,"isSaving",[s.tracked],function(){return!1})}#N=void dt7948.i(this,"isSaving")
static{dt7948.g(this.prototype,"selectedPreset",[s.tracked],function(){return null})}#U=void dt7948.i(this,"selectedPreset")
static{dt7948.g(this.prototype,"testRunning",[s.tracked],function(){return!1})}#q=void dt7948.i(this,"testRunning")
static{dt7948.g(this.prototype,"testResult",[s.tracked],function(){return null})}#B=void dt7948.i(this,"testResult")
static{dt7948.g(this.prototype,"testError",[s.tracked],function(){return null})}#z=void dt7948.i(this,"testError")
static{dt7948.g(this.prototype,"currentProvider",[s.tracked],function(){return null})}#H=void dt7948.i(this,"currentProvider")
constructor(){super(...arguments),this.args.model&&(this.currentProvider=this.args.model.provider)}get formData(){let e
e=this.selectedPreset?this.store.createRecord("ai-embedding",this.selectedPreset).workingCopy():this.args.model.workingCopy()
const t=JSON.parse(JSON.stringify(e))
return this._originalFormData=t,t}static{dt7948.n(this.prototype,"formData",[s.cached])}get selectedProviders(){return this.args.embeddings.resultSetMeta.providers.map(e=>{return{id:e,name:(t=e,(0,h.i18n)(`discourse_ai.embeddings.providers.${t}`))}
var t})}get distanceFunctions(){const e=e=>(0,h.i18n)(`discourse_ai.embeddings.distance_functions.${e}`)
return this.args.embeddings.resultSetMeta.distance_functions.map(t=>({id:t,name:e(t)}))}get presets(){const e=this.args.embeddings.resultSetMeta.presets.map(e=>({name:e.display_name,id:e.preset_id,provider:e.provider}))
return e.unshiftObject({name:(0,h.i18n)("discourse_ai.embeddings.configure_manually"),id:"manual",provider:"fake"}),e}get showPresets(){return!this.selectedPreset&&this.args.model.isNew}get metaProviderParams(){const e=this.currentProvider
if(!e)return{}
return(((this.args.embeddings||{}).resultSetMeta||{}).provider_params||{})[e]||{}}get testErrorMessage(){return(0,h.i18n)("discourse_ai.llms.tests.failure",{error:this.testError})}get displayTestResult(){return this.testRunning||null!==this.testResult}get seeded(){return this.args.model.id<0}configurePreset(e){this.selectedPreset=this.args.embeddings.resultSetMeta.presets.findBy("preset_id",e.id)||{},this.selectedPreset.provider&&(this.currentProvider=this.selectedPreset.provider)}static{dt7948.n(this.prototype,"configurePreset",[o.action])}setProvider(e,{set:t}){t("provider",e),this.currentProvider=e
const s=(this.args.embeddings?.resultSetMeta?.provider_params||{})[e]||{},i={}
if(s){Object.keys(s).forEach(e=>{i[e]=null})}t("provider_params",i)}static{dt7948.n(this.prototype,"setProvider",[o.action])}get providerParams(){return Object.entries(this.metaProviderParams).reduce((e,[t,s])=>(e[t]=(e=>e?"string"==typeof e?{type:e}:{type:e.type||"text",values:(e.values||[]).map(e=>({id:e,name:e})),default:e.default}:{type:"text"})(s),e),{})}resetForm(){this.selectedPreset=null,this.currentProvider=null}static{dt7948.n(this.prototype,"resetForm",[o.action])}async save(e){this.isSaving=!0
const t=this.args.model.isNew
try{const s={...e}
if(this.selectedPreset){const e=this.store.createRecord("ai-embedding",{...this.selectedPreset,...s})
await e.save(),this.args.embeddings.addObject(e)}else await this.args.model.save(s)
if(t)this.router.transitionTo("adminPlugins.show.discourse-ai-embeddings.index")
else{const e=this.currentProvider
this._originalFormData=JSON.parse(JSON.stringify(s)),this.currentProvider=e,this.toasts.success({data:{message:(0,h.i18n)("discourse_ai.embeddings.saved")},duration:"short"})}}catch(s){(0,m.popupAjaxError)(s)}finally{(0,a.later)(()=>{this.isSaving=!1},1e3)}}static{dt7948.n(this.prototype,"save",[o.action])}async test(e){this.testRunning=!0
try{let t
t=this.args.model.isNew||this.selectedPreset?this.store.createRecord("ai-embedding",{...this.selectedPreset,...e}):this.args.model
const s=await t.testConfig(e)
this.testResult=s.success,this.testResult?this.testError=null:this.testError=s.error}catch(t){(0,m.popupAjaxError)(t)}finally{(0,a.later)(()=>{this.testRunning=!1},1e3)}}static{dt7948.n(this.prototype,"test",[o.action])}delete(){return this.dialog.confirm({message:(0,h.i18n)("discourse_ai.embeddings.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then(()=>{this.args.embeddings.removeObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-embeddings.index")}).catch(m.popupAjaxError)})}static{dt7948.n(this.prototype,"delete",[o.action])}providerKeys(e){return e?Object.keys(e):[]}static{dt7948.n(this.prototype,"providerKeys",[o.action])}static{(0,_.setComponentTemplate)((0,b.createTemplateFactory)({id:"kJ5LIVvb",block:'[[[1,"\\n"],[41,[30,0,["showPresets"]],[[[1,"      "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-embeddings","discourse_ai.embeddings.back"]],null],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"h2"],[12],[1,[28,[32,1],["discourse_ai.embeddings.presets"],null]],[13],[1,"\\n        "],[8,[32,2],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["presets"]]],null]],null],null,[[[1,"            "],[8,[32,3],[[16,"data-preset-id",[30,1,["id"]]],[24,0,"ai-llms-list-editor__templates-list-item"]],[["@titleLabelTranslated","@taglineLabel"],[[30,1,["name"]],[28,[32,4],["discourse_ai.embeddings.providers.",[30,1,["provider"]]],null]]],[["buttons"],[[[[1,"\\n                "],[8,[30,2,["Default"]],null,[["@action","@icon","@label"],[[28,[32,5],[[30,0,["configurePreset"]],[30,1]],null],"gear","discourse_ai.llms.preconfigured.button"]],null],[1,"\\n              "]],[2]]]]],[1,"\\n"]],[1]],null],[1,"        "]],[]]]]],[1,"\\n      "],[13],[1,"\\n"]],[]],[[[1,"      "],[8,[32,6],[[16,0,[29,["form-horizontal ai-embedding-editor ",[52,[30,0,["seeded"]],"seeded"]]]]],[["@onSubmit","@data"],[[30,0,["save"]],[30,0,["formData"]]]],[["default"],[[[[1,"\\n"],[41,[30,5,["isNew"]],[[[1,"          "],[8,[32,7],[[24,0,"btn-flat back-button"]],[["@action","@label","@icon"],[[30,0,["resetForm"]],"back_button","chevron-left"]],null],[1,"\\n"]],[]],[[[1,"          "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-embeddings","discourse_ai.embeddings.back"]],null],[1,"\\n"]],[]]],[1,"\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__display-name"]],[["@name","@title","@validation","@format"],["display_name",[28,[32,1],["discourse_ai.embeddings.display_name"],null],"required|length:1,100","large"]],[["default"],[[[[1,"\\n          "],[8,[30,6,["Input"]],null,null,null],[1,"\\n        "]],[6]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__provider"]],[["@name","@title","@validation","@format","@onSet"],["provider",[28,[32,1],["discourse_ai.embeddings.provider"],null],"required","large",[30,0,["setProvider"]]]],[["default"],[[[[1,"\\n          "],[8,[30,7,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["selectedProviders"]]],null]],null],null,[[[1,"              "],[8,[30,8,["Option"]],null,[["@value"],[[30,9,["id"]]]],[["default"],[[[[1,[30,9,["name"]]]],[]]]]],[1,"\\n"]],[9]],null],[1,"          "]],[8]]]]],[1,"\\n        "]],[7]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__url"]],[["@name","@title","@validation","@format"],["url",[28,[32,1],["discourse_ai.embeddings.url"],null],"required","large"]],[["default"],[[[[1,"\\n          "],[8,[30,10,["Input"]],null,null,null],[1,"\\n        "]],[10]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__api-key"]],[["@name","@title","@validation","@format"],["api_key",[28,[32,1],["discourse_ai.embeddings.api_key"],null],"required","large"]],[["default"],[[[[1,"\\n          "],[8,[30,11,["Password"]],null,null,null],[1,"\\n        "]],[11]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__tokenizer"]],[["@name","@title","@validation","@format"],["tokenizer_class",[28,[32,1],["discourse_ai.embeddings.tokenizer"],null],"required","large"]],[["default"],[[[[1,"\\n          "],[8,[30,12,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,14,["resultSetMeta","tokenizers"]]],null]],null],null,[[[1,"              "],[8,[30,13,["Option"]],null,[["@value"],[[30,15,["id"]]]],[["default"],[[[[1,[30,15,["name"]]]],[]]]]],[1,"\\n"]],[15]],null],[1,"          "]],[13]]]]],[1,"\\n        "]],[12]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__dimensions"]],[["@name","@title","@validation","@format","@tooltip"],["dimensions",[28,[32,1],["discourse_ai.embeddings.dimensions"],null],"required","large",[52,[30,5,["isNew"]],[28,[32,1],["discourse_ai.embeddings.hints.dimensions_warning"],null]]]],[["default"],[[[[1,"\\n          "],[8,[30,16,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"],[16,"disabled",[28,[32,8],[[30,5,["isNew"]]],null]]],[["@type"],["number"]],null],[1,"\\n        "]],[16]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__matryoshka_dimensions"]],[["@name","@title","@tooltip","@format"],["matryoshka_dimensions",[28,[32,1],["discourse_ai.embeddings.matryoshka_dimensions"],null],[28,[32,1],["discourse_ai.embeddings.hints.matryoshka_dimensions"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,17,["Checkbox"]],null,null,null],[1,"\\n        "]],[17]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__embed_prompt"]],[["@name","@title","@tooltip","@format"],["embed_prompt",[28,[32,1],["discourse_ai.embeddings.embed_prompt"],null],[28,[32,1],["discourse_ai.embeddings.hints.embed_prompt"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,18,["Textarea"]],null,null,null],[1,"\\n        "]],[18]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__search_prompt"]],[["@name","@title","@tooltip","@format"],["search_prompt",[28,[32,1],["discourse_ai.embeddings.search_prompt"],null],[28,[32,1],["discourse_ai.embeddings.hints.search_prompt"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,19,["Textarea"]],null,null,null],[1,"\\n        "]],[19]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__max_sequence_length"]],[["@name","@title","@tooltip","@validation","@format"],["max_sequence_length",[28,[32,1],["discourse_ai.embeddings.max_sequence_length"],null],[28,[32,1],["discourse_ai.embeddings.hints.sequence_length"],null],"required","large"]],[["default"],[[[[1,"\\n          "],[8,[30,20,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n        "]],[20]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__distance_functions"]],[["@name","@title","@tooltip","@format","@validation"],["pg_function",[28,[32,1],["discourse_ai.embeddings.distance_function"],null],[28,[32,1],["discourse_ai.embeddings.hints.distance_function"],null],"large","required"]],[["default"],[[[[1,"\\n          "],[8,[30,21,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["distanceFunctions"]]],null]],null],null,[[[1,"              "],[8,[30,22,["Option"]],null,[["@value"],[[30,23,["id"]]]],[["default"],[[[[1,[30,23,["name"]]]],[]]]]],[1,"\\n"]],[23]],null],[1,"          "]],[22]]]]],[1,"\\n        "]],[21]]]]],[1,"\\n\\n"],[41,[30,0,["currentProvider"]],[[[1,"          "],[8,[30,3,["Object"]],null,[["@name"],["provider_params"]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[28,[30,0,["providerKeys"]],[[30,25]],null]],null]],null],null,[[[44,[[28,[32,9],[[30,0,["providerParams"]],[30,26]],null]],[[[41,[30,27],[[[1,"                  "],[8,[30,24,["Field"]],[[16,0,[29,["ai-embedding-editor-provider-param__",[30,27,["type"]]]]]],[["@name","@title","@format","@validation"],[[30,26],[28,[32,1],[[28,[32,4],["discourse_ai.embeddings.provider_fields.",[30,26]],null]],null],"large","required"]],[["default"],[[[[1,"\\n"],[41,[28,[32,10],[[30,27,["type"]],"enum"],null],[[[1,"                      "],[8,[30,28,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,27,["values"]]],null]],null],null,[[[1,"                          "],[8,[30,29,["Option"]],null,[["@value"],[[30,30,["id"]]]],[["default"],[[[[1,[30,30,["name"]]]],[]]]]],[1,"\\n"]],[30]],null],[1,"                      "]],[29]]]]],[1,"\\n"]],[]],[[[41,[28,[32,10],[[30,27,["type"]],"checkbox"],null],[[[1,"                      "],[8,[30,28,["Checkbox"]],null,null,null],[1,"\\n"]],[]],[[[1,"                      "],[8,[30,28,["Input"]],null,[["@type"],[[30,27,["type"]]]],null],[1,"\\n                    "]],[]]]],[]]],[1,"                  "]],[28]]]]],[1,"\\n"]],[]],null]],[27]]]],[26]],null],[1,"          "]],[24,25]]]]],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[30,3,["Actions"]],[[24,0,"ai-embedding-editor__action_panel"]],null,[["default"],[[[[1,"\\n          "],[8,[30,3,["Button"]],[[24,0,"ai-embedding-editor__test"]],[["@action","@disabled","@label"],[[28,[32,5],[[30,0,["test"]],[30,4]],null],[30,0,["testRunning"]],"discourse_ai.embeddings.tests.title"]],null],[1,"\\n\\n          "],[8,[30,3,["Submit"]],[[24,0,"btn-primary ai-embedding-editor__save"]],[["@label"],["discourse_ai.embeddings.save"]],null],[1,"\\n\\n"],[41,[51,[30,4,["isNew"]]],[[[1,"            "],[8,[30,3,["Button"]],[[24,0,"btn-danger ai-embedding-editor__delete"]],[["@action","@label"],[[30,0,["delete"]],"discourse_ai.embeddings.delete"]],null],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n\\n"],[41,[30,0,["displayTestResult"]],[[[1,"          "],[8,[30,3,["Container"]],[[24,0,"ai-embedding-editor-tests"]],[["@format"],["full"]],[["default"],[[[[1,"\\n            "],[8,[32,11],null,[["@size","@condition"],["small",[30,0,["testRunning"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["testResult"]],[[[1,"                "],[10,0],[14,0,"ai-embedding-editor-tests__success"],[12],[1,"\\n                  "],[1,[28,[32,12],["check"],null]],[1,"\\n                  "],[1,[28,[32,1],["discourse_ai.embeddings.tests.success"],null]],[1,"\\n                "],[13],[1,"\\n"]],[]],[[[1,"                "],[10,0],[14,0,"ai-embedding-editor-tests__failure"],[12],[1,"\\n                  "],[1,[28,[32,12],["xmark"],null]],[1,"\\n                  "],[1,[30,0,["testErrorMessage"]]],[1,"\\n                "],[13],[1,"\\n"]],[]]],[1,"            "]],[]]]]],[1,"\\n          "]],[]]]]],[1,"\\n"]],[]],null],[1,"      "]],[3,4]]]]],[1,"\\n"]],[]]],[1,"  "]],["preset","buttons","form","data","@model","field","field","select","provider","field","field","field","select","@embeddings","tokenizer","field","field","field","field","field","field","select","df","object","providerData","name","params","field","select","option"],false,["if","each","-track-array","let","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-embedding-editor.js",scope:()=>[l.default,h.i18n,f.default,g.default,i.concat,i.fn,c.default,u.default,r.not,i.get,r.eq,d.default,p.default],isStrictMode:!0}),this)}}e.default=v}),define("discourse/plugins/discourse-ai/discourse/components/ai-embeddings-list-editor",["exports","@glimmer/component","@ember/helper","@ember/service","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse-i18n","admin/components/admin-config-area-empty-list","float-kit/components/d-tooltip","discourse/plugins/discourse-ai/discourse/components/ai-embedding-editor","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends t.default{static{dt7948.g(this.prototype,"adminPluginNavManager",[i.service])}#V=void dt7948.i(this,"adminPluginNavManager")
get hasEmbeddingElements(){return 0!==this.args.embeddings.length}static{(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"MiS/W6iF",block:'[[[1,"\\n    "],[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-embeddings"]],[28,[32,1],["discourse_ai.embeddings.short_title"],null]]],null],[1,"\\n    "],[10,"section"],[14,0,"ai-embeddings-list-editor admin-detail"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[8,[32,2],null,[["@model","@embeddings"],[[30,1],[30,2]]],null],[1,"\\n"]],[]],[[[1,"        "],[8,[32,3],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[28,[32,1],["discourse_ai.embeddings.short_title"],null],[28,[32,1],["discourse_ai.embeddings.description"],null],"https://meta.discourse.org/t/discourse-ai-embeddings/259603"]],[["actions"],[[[[1,"\\n            "],[8,[30,3,["Primary"]],[[24,0,"ai-embeddings-list-editor__new-button"]],[["@label","@route","@icon"],["discourse_ai.embeddings.new","adminPlugins.show.discourse-ai-embeddings.new","plus"]],null],[1,"\\n          "]],[3]]]]],[1,"\\n\\n"],[41,[30,0,["hasEmbeddingElements"]],[[[1,"          "],[10,"table"],[14,0,"d-admin-table"],[12],[1,"\\n            "],[10,"thead"],[12],[1,"\\n              "],[10,"tr"],[12],[1,"\\n                "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.embeddings.display_name"],null]],[13],[1,"\\n                "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.embeddings.provider"],null]],[13],[1,"\\n                "],[10,"th"],[12],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n            "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2]],null]],null],null,[[[1,"                "],[10,"tr"],[14,0,"ai-embeddings-list__row d-admin-row__content"],[12],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n                    "],[10,0],[14,0,"ai-embeddings-list__name"],[12],[1,"\\n                      "],[10,"strong"],[12],[1,"\\n                        "],[1,[30,4,["display_name"]]],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__detail"],[12],[1,"\\n                    "],[10,0],[14,0,"d-admin-row__mobile-label"],[12],[1,"\\n                      "],[1,[28,[32,1],["discourse_ai.embeddings.provider"],null]],[1,"\\n                    "],[13],[1,"\\n                    "],[1,[28,[32,1],[[28,[32,4],["discourse_ai.embeddings.providers.",[30,4,["provider"]]],null]],null]],[1,"\\n                  "],[13],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n"],[41,[30,4,["seeded"]],[[[1,"                      "],[8,[32,5],[[24,0,"ai-embeddings-list__edit-disabled-tooltip"]],null,[["trigger","content"],[[[[1,"\\n                          "],[8,[32,6],[[24,0,"btn btn-default btn-small disabled"]],[["@label"],["discourse_ai.embeddings.edit"]],null],[1,"\\n                        "]],[]],[[[1,"\\n                          "],[1,[28,[32,1],["discourse_ai.embeddings.seeded_warning"],null]],[1,"\\n                        "]],[]]]]],[1,"\\n"]],[]],[[[1,"                      "],[8,[32,6],[[24,0,"btn btn-default btn-small ai-embeddings-list__edit-button"]],[["@label","@route","@routeModels"],["discourse_ai.embeddings.edit","adminPlugins.show.discourse-ai-embeddings.edit",[30,4,["id"]]]],null],[1,"\\n"]],[]]],[1,"                  "],[13],[1,"\\n                "],[13],[1,"\\n"]],[4]],null],[1,"            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[1,"          "],[8,[32,7],null,[["@ctaLabel","@ctaRoute","@ctaClass","@emptyLabel"],["discourse_ai.embeddings.new","adminPlugins.show.discourse-ai-embeddings.new","ai-embeddings-list-editor__empty-new-button","discourse_ai.embeddings.empty"]],null],[1,"\\n"]],[]]]],[]]],[1,"    "],[13],[1,"\\n  "]],["@currentEmbedding","@embeddings","actions","embedding"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-embeddings-list-editor.js",scope:()=>[o.default,r.i18n,u.default,n.default,s.concat,d.default,a.default,l.default],isStrictMode:!0}),this)}}e.default=m}),define("discourse/plugins/discourse-ai/discourse/components/ai-feature-card",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/routing","discourse/components/d-button","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static{dt7948.g(this.prototype,"isExpanded",[s.tracked],function(){return!1})}#$=void dt7948.i(this,"isExpanded")
get maxItemsToShow(){return this.args.maxItemsToShow??5}get hasMore(){return this.args.items?.length>this.maxItemsToShow}get visibleItems(){return this.args.items?this.isExpanded?this.args.items:this.args.items.slice(0,this.maxItemsToShow):[]}get remainingCount(){return this.args.items?.length-this.maxItemsToShow}get expandToggleLabel(){return this.isExpanded?(0,r.i18n)("discourse_ai.features.collapse_list"):(0,r.i18n)("discourse_ai.features.expand_list",{count:this.remainingCount})}toggleExpanded(){this.isExpanded=!this.isExpanded}static{dt7948.n(this.prototype,"toggleExpanded",[o.action])}isLastItem(e){return e===this.visibleItems.length-1}static{dt7948.n(this.prototype,"isLastItem",[o.action])}static{(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"6yrVrxxR",block:'[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["visibleItems"]]],null]],null],null,[[[1,"      "],[18,3,[[30,1],[30,2],[30,0,["isLastItem"]]]],[1,"\\n"]],[1,2]],null],[1,"\\n"],[41,[30,0,["hasMore"]],[[[1,"      "],[8,[32,0],[[24,0,"btn-flat ai-expanded-list__toggle-button"]],[["@translatedLabel","@action"],[[30,0,["expandToggleLabel"]],[30,0,["toggleExpanded"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["item","index","&default"],false,["each","-track-array","yield","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-feature-card.js",scope:()=>[n.default],isStrictMode:!0}),this)}}class c extends t.default{hasGroups(e){return this.groupList(e).length>0}static{dt7948.n(this.prototype,"hasGroups",[o.action])}groupList(e){const t=[],s=new Set
return e.personas&&e.personas.forEach(e=>{e.allowed_groups&&e.allowed_groups.forEach(e=>{s.has(e.id)||(s.add(e.id),t.push(e))})}),t}static{dt7948.n(this.prototype,"groupList",[o.action])}static{(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"uIPap7dM",block:'[[[1,"\\n    "],[10,0],[14,0,"admin-section-landing-item ai-feature-card"],[15,"data-feature-name",[30,1,["name"]]],[12],[1,"\\n      "],[10,0],[14,0,"admin-section-landing-item__content"],[12],[1,"\\n        "],[10,0],[14,0,"ai-feature-card__feature-name"],[12],[1,"\\n          "],[1,[30,2]],[1,"\\n"],[41,[51,[30,1,["enabled"]]],[[[1,"            "],[10,1],[12],[1,[28,[32,0],["discourse_ai.features.disabled"],null]],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n        "],[10,0],[14,0,"ai-feature-card__persona"],[12],[1,"\\n          "],[10,1],[14,0,"ai-feature-card__label"],[12],[1,"\\n            "],[1,[28,[32,0],["discourse_ai.features.persona"],[["count"],[[30,1,["personas","length"]]]]]],[1,"\\n          "],[13],[1,"\\n"],[41,[30,1,["personas"]],[[[1,"            "],[8,[32,1],null,[["@items","@maxItemsToShow"],[[30,1,["personas"]],5]],[["default"],[[[[1,"\\n              "],[8,[32,2],[[24,0,"ai-feature-card__persona-link"]],[["@route","@model"],["adminPlugins.show.discourse-ai-personas.edit",[30,3,["id"]]]],[["default"],[[[[1,"\\n                "],[1,[28,[32,3],[[30,3,["name"]],[52,[51,[28,[30,5],[[30,4]],null]],", "]],null]],[1,"\\n              "]],[]]]]],[1,"\\n            "]],[3,4,5]]]]],[1,"\\n"]],[]],[[[1,"            "],[10,1],[14,0,"ai-feature-card__label"],[12],[1,"\\n              "],[1,[28,[32,0],["discourse_ai.features.no_persona"],null]],[1,"\\n            "],[13],[1,"\\n"]],[]]],[1,"        "],[13],[1,"\\n        "],[10,0],[14,0,"ai-feature-card__llm"],[12],[1,"\\n"],[41,[30,1,["llm_models"]],[[[1,"            "],[10,1],[14,0,"ai-feature-card__label"],[12],[1,"\\n              "],[1,[28,[32,0],["discourse_ai.features.llm"],[["count"],[[30,1,["llm_models","length"]]]]]],[1,"\\n            "],[13],[1,"\\n            "],[8,[32,1],null,[["@items","@maxItemsToShow"],[[30,1,["llm_models"]],5]],[["default"],[[[[1,"\\n              "],[8,[32,2],[[24,0,"ai-feature-card__llm-link"]],[["@route","@model"],["adminPlugins.show.discourse-ai-llms.edit",[30,6,["id"]]]],[["default"],[[[[1,"\\n                "],[1,[28,[32,3],[[30,6,["name"]],[52,[51,[28,[30,8],[[30,7]],null]],", "]],null]],[1,"\\n              "]],[]]]]],[1,"\\n            "]],[6,7,8]]]]],[1,"\\n"]],[]],[[[1,"            "],[10,1],[14,0,"ai-feature-card__label"],[12],[1,"\\n              "],[1,[28,[32,0],["discourse_ai.features.no_llm"],null]],[1,"\\n            "],[13],[1,"\\n"]],[]]],[1,"        "],[13],[1,"\\n"],[41,[30,9],[[[41,[30,1,["personas"]],[[[1,"            "],[10,0],[14,0,"ai-feature-card__groups"],[12],[1,"\\n              "],[10,1],[14,0,"ai-feature-card__label"],[12],[1,"\\n                "],[1,[28,[32,0],["discourse_ai.features.groups"],null]],[1,"\\n              "],[13],[1,"\\n"],[41,[28,[30,0,["hasGroups"]],[[30,1]],null],[[[1,"                "],[10,"ul"],[14,0,"ai-feature-card__item-groups"],[12],[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[28,[30,0,["groupList"]],[[30,1]],null]],null]],null],null,[[[1,"                    "],[10,"li"],[12],[1,[30,10,["name"]]],[13],[1,"\\n"]],[10]],null],[1,"                "],[13],[1,"\\n"]],[]],[[[1,"                "],[10,1],[14,0,"ai-feature-card__label"],[12],[1,"\\n                  "],[1,[28,[32,0],["discourse_ai.features.no_groups"],null]],[1,"\\n                "],[13],[1,"\\n"]],[]]],[1,"            "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@feature","@localizedFeatureName","persona","index","isLastItem","llm","index","isLastItem","@showGroups","group"],false,["unless","if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-feature-card.js",scope:()=>[r.i18n,u,a.LinkTo,i.concat],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/ai-features-list",["exports","@glimmer/component","@ember/helper","@ember/object","@ember/service","truth-helpers","discourse/components/d-button","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-feature-card","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static{dt7948.g(this.prototype,"router",[o.service])}#e=void dt7948.i(this,"router")
get sortedModules(){return[...this.args.modules?.toArray()||this.args.modules||[]].toSorted((e,t)=>(e.module_name||"").localeCompare(t.module_name||""))}isSpamModule(e){return"spam"===e.module_name}static{dt7948.n(this.prototype,"isSpamModule",[i.action])}isAutomationModule(e){return"automation_reports"===e.module_name||"automation_triage"===e.module_name}static{dt7948.n(this.prototype,"isAutomationModule",[i.action])}featureName(e,t){return this.isAutomationModule(t)?e.name:(0,r.i18n)(`discourse_ai.features.${t.module_name}.${e.name}`)}static{dt7948.n(this.prototype,"featureName",[i.action])}transitionToAutomations(){this.router.transitionTo("/admin/plugins/automation/automation")}static{dt7948.n(this.prototype,"transitionToAutomations",[i.action])}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"cjQAGBSD",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-features-list"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["sortedModules"]]],null]],null],null,[[[1,"        "],[10,0],[14,0,"ai-module"],[15,"data-module-name",[30,1,["module_name"]]],[12],[1,"\\n          "],[10,0],[14,0,"ai-module__header"],[12],[1,"\\n            "],[10,0],[14,0,"ai-module__module-title"],[12],[1,"\\n              "],[10,"h3"],[12],[1,[28,[32,0],[[28,[32,1],["discourse_ai.features.",[30,1,["module_name"]],".name"],null]],null]],[13],[1,"\\n"],[41,[28,[30,0,["isSpamModule"]],[[30,1]],null],[[[1,"                "],[8,[32,2],[[24,0,"edit"]],[["@label","@route"],["discourse_ai.features.edit","adminPlugins.show.discourse-ai-spam"]],null],[1,"\\n"]],[]],[[[41,[28,[30,0,["isAutomationModule"]],[[30,1]],null],[[[1,"                "],[8,[32,2],[[24,0,"edit"]],[["@label","@action"],["discourse_ai.features.edit",[30,0,["transitionToAutomations"]]]],null],[1,"\\n"]],[]],[[[1,"                "],[8,[32,2],[[24,0,"edit"]],[["@label","@route","@routeModels"],["discourse_ai.features.edit","adminPlugins.show.discourse-ai-features.edit",[30,1,["id"]]]],null],[1,"\\n              "]],[]]]],[]]],[1,"            "],[13],[1,"\\n            "],[10,0],[12],[1,[28,[32,0],[[28,[32,1],["discourse_ai.features.",[30,1,["module_name"]],".description"],null]],null]],[13],[1,"\\n          "],[13],[1,"\\n\\n          "],[10,0],[14,0,"admin-section-landing-wrapper ai-feature-cards"],[12],[1,"\\n"],[41,[28,[32,3],[[28,[30,0,["isAutomationModule"]],[[30,1]],null],[28,[32,4],[[30,1,["features","length"]],0],null]],null],[[[1,"              "],[10,0],[12],[1,[28,[32,0],["discourse_ai.features.no_automations"],null]],[13],[1,"\\n"]],[]],[[[42,[28,[31,1],[[28,[31,1],[[30,1,["features"]]],null]],null],null,[[[1,"                "],[8,[32,5],null,[["@localizedFeatureName","@feature","@showGroups"],[[28,[30,0,["featureName"]],[[30,2],[30,1]],null],[30,2],[28,[32,6],[[28,[30,0,["isSpamModule"]],[[30,1]],null]],null]]],null],[1,"\\n"]],[2]],null]],[]]],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n"]],[1]],null],[1,"    "],[13],[1,"\\n  "]],["module","feature"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-features-list.js",scope:()=>[r.i18n,s.concat,n.default,a.and,a.eq,l.default,a.not],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/ai-features",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/service","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse/components/d-select","discourse/components/filter-input","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-default-llm-selector","discourse/plugins/discourse-ai/discourse/components/ai-features-list","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const f="configured",_="unconfigured"
class b extends t.default{static{dt7948.g(this.prototype,"adminPluginNavManager",[a.service])}#V=void dt7948.i(this,"adminPluginNavManager")
static{dt7948.g(this.prototype,"filterValue",[s.tracked],function(){return""})}#G=void dt7948.i(this,"filterValue")
static{dt7948.g(this.prototype,"selectedFeatureGroup",[s.tracked],function(){return f})}#Y=void dt7948.i(this,"selectedFeatureGroup")
constructor(){if(super(...arguments),this.args.features?.length>0){0===this.args.features.filter(e=>!0===e.module_enabled).length&&(this.selectedFeatureGroup=_)}}get featureGroupOptions(){return[{value:"all",label:(0,c.i18n)("discourse_ai.features.filters.all")},{value:f,label:(0,c.i18n)("discourse_ai.features.nav.configured")},{value:_,label:(0,c.i18n)("discourse_ai.features.nav.unconfigured")}]}get filteredFeatures(){if(!this.args.features||0===this.args.features.length)return[]
let e=this.args.features
if(this.selectedFeatureGroup===f?e=e.filter(e=>!0===e.module_enabled):this.selectedFeatureGroup===_&&(e=e.filter(e=>!1===e.module_enabled)),this.filterValue&&""!==this.filterValue.trim()){const t=this.filterValue.toLowerCase().trim(),s=(e,s)=>{try{if((0,c.i18n)(`discourse_ai.features.${e.module_name}.${s.name}`).toLowerCase().includes(t))return!0
const i=s.personas?.some(e=>e.name?.toLowerCase().includes(t)),o=s.llm_models?.some(e=>e.name?.toLowerCase().includes(t)),a=s.personas?.some(e=>e.allowed_groups?.some(e=>e.name?.toLowerCase().includes(t)))
return i||o||a}catch(i){return console.error("Error filtering features",i),!1}}
e=e.filter(e=>{try{return!!(0,c.i18n)(`discourse_ai.features.${e.module_name}.name`).toLowerCase().includes(t)||(e.features||[]).some(t=>s(e,t))}catch(i){return console.error("Error filtering features",i),!1}}),e=e.map(e=>{try{if((0,c.i18n)(`discourse_ai.features.${e.module_name}.name`).toLowerCase().includes(t))return e
const i=(e.features||[]).filter(t=>s(e,t))
return Object.assign({},e,{features:i})}catch(i){return console.error("Error filtering features",i),e}}).filter(e=>e.features&&e.features.length>0)}return e}onFilterChange(e){this.filterValue=e.target?.value||""}static{dt7948.n(this.prototype,"onFilterChange",[o.action])}onFeatureGroupChange(e){this.selectedFeatureGroup=e}static{dt7948.n(this.prototype,"onFeatureGroupChange",[o.action])}resetAndFocus(){this.filterValue="",this.selectedFeatureGroup=f,document.querySelector(".admin-filter__input").focus()}static{dt7948.n(this.prototype,"resetAndFocus",[o.action])}static{(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"EVQauSDQ",block:'[[[1,"\\n    "],[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-features"]],[28,[32,1],["discourse_ai.features.short_title"],null]]],null],[1,"\\n    "],[10,"section"],[14,0,"ai-features admin-detail"],[12],[1,"\\n      "],[8,[32,2],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[28,[32,1],["discourse_ai.features.short_title"],null],[28,[32,1],["discourse_ai.features.description"],null],"todo"]],null],[1,"\\n\\n      "],[10,0],[14,0,"ai-features__controls"],[12],[1,"\\n        "],[8,[32,3],null,[["@value","@includeNone","@onChange"],[[30,0,["selectedFeatureGroup"]],false,[30,0,["onFeatureGroupChange"]]]],[["default"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["featureGroupOptions"]]],null]],null],null,[[[1,"            "],[8,[30,1,["Option"]],null,[["@value"],[[30,2,["value"]]]],[["default"],[[[[1,"\\n              "],[1,[30,2,["label"]]],[1,"\\n            "]],[]]]]],[1,"\\n"]],[2]],null],[1,"        "]],[1]]]]],[1,"\\n\\n        "],[8,[32,4],[[16,"placeholder",[28,[32,1],["discourse_ai.features.filters.text"],null]],[24,0,"admin-filter__input"]],[["@filterAction","@value","@icons"],[[30,0,["onFilterChange"]],[30,0,["filterValue"]],[28,[32,5],null,[["left"],["magnifying-glass"]]]]],null],[1,"\\n      "],[13],[1,"\\n\\n      "],[8,[32,6],null,null,null],[1,"\\n\\n"],[41,[30,0,["filteredFeatures","length"]],[[[1,"        "],[8,[32,7],null,[["@modules"],[[30,0,["filteredFeatures"]]]],null],[1,"\\n"]],[]],[[[1,"        "],[10,0],[14,0,"ai-features__no-results"],[12],[1,"\\n          "],[10,"h3"],[12],[1,[28,[32,1],["discourse_ai.features.filters.no_results"],null]],[13],[1,"\\n          "],[8,[32,8],[[24,0,"btn-default"]],[["@icon","@label","@action"],["arrow-rotate-left","discourse_ai.features.filters.reset",[30,0,["resetAndFocus"]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],["select","option"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-features.js",scope:()=>[n.default,c.i18n,l.default,d.default,u.default,i.hash,p.default,m.default,r.default],isStrictMode:!0}),this)}}e.default=b}),define("discourse/plugins/discourse-ai/discourse/components/ai-full-page-search",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-update","@ember/service","discourse/components/d-toggle-switch","discourse/controllers/full-page-search","discourse/helpers/concat-class","discourse/helpers/d-icon","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/search","discourse-i18n","float-kit/components/d-tooltip","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f,_,b){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class v extends t.default{static{dt7948.g(this.prototype,"appEvents",[n.service])}#S=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"siteSettings",[n.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"searching",[s.tracked])}#W=void dt7948.i(this,"searching")
static{dt7948.g(this.prototype,"AiResults",[s.tracked],function(){return[]})}#K=void dt7948.i(this,"AiResults")
static{dt7948.g(this.prototype,"showingAiResults",[s.tracked],function(){return!1})}#J=void dt7948.i(this,"showingAiResults")
static{dt7948.g(this.prototype,"sortOrder",[s.tracked],function(){return this.args.sortOrder})}#Q=void dt7948.i(this,"sortOrder")
initialSearchTerm=this.args.searchTerm
constructor(){super(...arguments),this.appEvents.on("full-page-search:trigger-search",this,this.onSearch),this.onSearch()}willDestroy(){super.willDestroy(...arguments),this.appEvents.off("full-page-search:trigger-search",this,this.onSearch)}onSearch(){if(this.searchEnabled)return this.initialSearchTerm=this.args.searchTerm,this.searching=!0,this.resetAiResults(),this.performHyDESearch()}static{dt7948.n(this.prototype,"onSearch",[o.action])}get disableToggleSwitch(){if(this.searching||0===this.AiResults.length||!this.validSearchOrder)return!0}get validSearchOrder(){return 0===this.sortOrder}get searchStateText(){return this.validSearchOrder?this.searching?(0,h.i18n)("discourse_ai.embeddings.semantic_search_loading"):this.AiResults.length&&this.showingAiResults?(0,h.i18n)("discourse_ai.embeddings.semantic_search_results.toggle",{count:this.AiResults.length}):this.AiResults.length&&!this.showingAiResults?(0,h.i18n)("discourse_ai.embeddings.semantic_search_results.toggle_hidden",{count:this.AiResults.length}):0===this.AiResults.length&&this.searchTerm!==this.initialSearchTerm?(0,h.i18n)("discourse_ai.embeddings.semantic_search_results.new"):0===this.AiResults.length?(0,h.i18n)("discourse_ai.embeddings.semantic_search_results.none"):void 0:(0,h.i18n)("discourse_ai.embeddings.semantic_search_results.unavailable")}get settled(){return this.validSearchOrder&&!this.searching&&this.searchTerm===this.initialSearchTerm}get noResults(){return this.settled&&0===this.AiResults.length}get searchTerm(){return this.initialSearchTerm!==this.args.searchTerm&&(this.initialSearchTerm=void 0),this.args.searchTerm}get searchEnabled(){return this.args.searchType===l.SEARCH_TYPE_DEFAULT&&(0,m.isValidSearchTerm)(this.searchTerm,this.siteSettings)&&this.validSearchOrder}get searchClass(){return this.validSearchOrder?this.searching?"in-progress":this.noResults?"no-results":void 0:"unavailable"}get tooltipText(){return(0,h.i18n)("discourse_ai.embeddings.semantic_search_tooltips."+(this.validSearchOrder?"results_explanation":"invalid_sort"))}toggleAiResults(){this.appEvents.trigger("full-page-search:ai-results-toggled",{enabled:!this.showingAiResults}),this.showingAiResults?this.args.addSearchResults([],"topic_id"):this.args.addSearchResults(this.AiResults,"topic_id"),this.showingAiResults=!this.showingAiResults}static{dt7948.n(this.prototype,"toggleAiResults",[o.action])}resetAiResults(){this.AiResults=[],this.showingAiResults=!1,this.args.addSearchResults([],"topic_id")}static{dt7948.n(this.prototype,"resetAiResults",[o.action])}performHyDESearch(){this.resetAiResults(),(0,c.ajax)("/discourse-ai/embeddings/semantic-search",{data:{q:this.searchTerm}}).then(async e=>{const t=await(0,m.translateResults)(e)||{}
0!==t.posts?.length&&(t.posts.forEach(e=>{e.generatedByAi=!0}),this.AiResults=t.posts)}).catch(p.popupAjaxError).finally(()=>{this.searching=!1})}sortChanged(){this.sortOrder!==this.args.sortOrder&&(this.sortOrder=this.args.sortOrder,this.validSearchOrder?this.onSearch():(this.showingAiResults=!1,this.resetAiResults()))}static{dt7948.n(this.prototype,"sortChanged",[o.action])}static{(0,_.setComponentTemplate)((0,b.createTemplateFactory)({id:"XAcP21aU",block:'[[[1,"\\n    "],[11,0],[24,0,"semantic-search__container search-results"],[24,"role","region"],[4,[32,0],[[30,0,["sortChanged"]],[30,1]],null],[12],[1,"\\n      "],[10,0],[14,0,"semantic-search__results"],[12],[1,"\\n        "],[10,0],[15,0,[28,[32,1],["semantic-search__searching",[30,0,["searchClass"]]],null]],[12],[1,"\\n          "],[8,[32,2],[[16,"disabled",[30,0,["disableToggleSwitch"]]],[24,0,"semantic-search__results-toggle"],[4,[32,3],["click",[30,0,["toggleAiResults"]]],null]],[["@state"],[[30,0,["showingAiResults"]]]],null],[1,"\\n\\n          "],[10,0],[14,0,"semantic-search__searching-text"],[12],[1,"\\n            "],[1,[28,[32,4],["discourse-sparkles"],null]],[1,"\\n            "],[1,[30,0,["searchStateText"]]],[1,"\\n          "],[13],[1,"\\n\\n"],[41,[30,0,["validSearchOrder"]],[[[1,"            "],[8,[32,5],null,[["@loading"],[[30,0,["searching"]]]],null],[1,"\\n"]],[]],null],[1,"\\n          "],[8,[32,6],[[24,0,"semantic-search__tooltip"]],[["@identifier"],["semantic-search-tooltip"]],[["trigger","content"],[[[[1,"\\n              "],[1,[28,[32,4],["far-circle-question"],null]],[1,"\\n            "]],[]],[[[1,"\\n              "],[1,[30,0,["tooltipText"]]],[1,"\\n            "]],[]]]]],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@sortOrder"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-full-page-search.js",scope:()=>[a.default,d.default,r.default,i.on,u.default,f.default,g.default],isStrictMode:!0}),this)}}e.default=v}),define("discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle",["exports","@glimmer/component","@ember/helper","@ember/object","@ember/service","truth-helpers","discourse/components/d-button","discourse/components/dropdown-menu","discourse/helpers/body-class","discourse/helpers/d-icon","discourse-i18n","float-kit/components/d-menu","discourse/plugins/discourse-ai/discourse/services/gists","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static{dt7948.g(this.prototype,"gists",[o.service])}#X=void dt7948.i(this,"gists")
get buttons(){return[{id:p.TABLE_LAYOUT,label:"discourse_ai.summarization.topic_list_layout.button.compact",icon:"discourse-table"},{id:p.TABLE_AI_LAYOUT,label:"discourse_ai.summarization.topic_list_layout.button.expanded",icon:"discourse-table-sparkles",description:"discourse_ai.summarization.topic_list_layout.button.expanded_description"}]}get selectedOptionId(){return this.gists.currentPreference}get currentButton(){return this.buttons.find(e=>e.id===this.selectedOptionId)||this.buttons[0]}onRegisterApi(e){this.dMenu=e}static{dt7948.n(this.prototype,"onRegisterApi",[i.action])}onSelect(e){this.gists.setPreference(e,this.gists.isPm),this.dMenu.close()}static{dt7948.n(this.prototype,"onSelect",[i.action])}static{(0,m.setComponentTemplate)((0,h.createTemplateFactory)({id:"JTMrWFi1",block:'[[[1,"\\n"],[41,[30,0,["gists","showToggle"]],[[[1,"      "],[1,[28,[32,0],[[28,[32,1],["topic-list-layout-",[30,0,["gists","currentPreference"]]],null]],null]],[1,"\\n      "],[8,[32,2],null,[["@modalForMobile","@autofocus","@identifier","@onRegisterApi","@triggerClass"],[true,true,"topic-list-layout",[30,0,["onRegisterApi"]],"btn-default btn-icon"]],[["trigger","content"],[[[[1,"\\n          "],[1,[28,[32,3],[[30,0,["currentButton","icon"]]],null]],[1,"\\n        "]],[]],[[[1,"\\n          "],[8,[32,4],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["buttons"]]],null]],null],null,[[[1,"              "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                "],[8,[32,5],[[16,0,[29,["btn-transparent\\n                    ",[52,[30,2,["description"]],"--with-description"],"\\n                    ",[52,[28,[32,6],[[30,0,["currentButton","id"]],[30,2,["id"]]],null],"--active"]]]]],[["@label","@icon","@action"],[[30,2,["label"]],[30,2,["icon"]],[28,[32,7],[[30,0,["onSelect"]],[30,2,["id"]]],null]]],[["default"],[[[[1,"\\n"],[41,[30,2,["description"]],[[[1,"                    "],[10,0],[14,0,"btn__description"],[12],[1,"\\n                      "],[1,[28,[32,8],[[30,2,["description"]]],null]],[1,"\\n                    "],[13],[1,"\\n"]],[]],null],[1,"                "]],[]]]]],[1,"\\n              "]],[]]]]],[1,"\\n"]],[2]],null],[1,"          "]],[1]]]]],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],["dropdown","button"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle.js",scope:()=>[l.default,s.concat,c.default,d.default,r.default,n.default,a.eq,s.fn,u.i18n],isStrictMode:!0}),this)}}e.default=g}),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt",["exports","@glimmer/component","@ember/helper","@ember/modifier","@ember/object","truth-helpers","discourse/components/d-button","discourse/helpers/with-event-value","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{sendInput(e){if("Enter"===e.key)return this.args.submit(this.args.promptArgs)}static{dt7948.n(this.prototype,"sendInput",[o.action])}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"P6muo3ex",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-custom-prompt"],[12],[1,"\\n\\n      "],[11,"input"],[16,2,[30,1]],[16,"placeholder",[28,[32,0],["discourse_ai.ai_helper.context_menu.custom_prompt.placeholder"],null]],[24,0,"ai-custom-prompt__input"],[24,"autofocus","autofocus"],[24,4,"text"],[4,[32,1],["input",[28,[32,2],[[28,[32,3],[[28,[31,0],[[30,1]],null]],null]],null]],null],[4,[32,1],["keydown",[30,0,["sendInput"]]],null],[12],[13],[1,"\\n\\n      "],[8,[32,4],[[24,0,"ai-custom-prompt__submit btn-primary"]],[["@icon","@action","@disabled"],["discourse-sparkles",[28,[32,3],[[30,2],[30,3]],null],[28,[32,5],[[30,1,["length"]]],null]]],null],[1,"\\n    "],[13],[1,"\\n  "]],["@value","@submit","@promptArgs"],false,["mut"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt.js",scope:()=>[l.i18n,i.on,r.default,s.fn,n.default,a.not],isStrictMode:!0}),this)}}e.default=c})
define("discourse/plugins/discourse-ai/discourse/components/ai-helper-loading",["exports","discourse/components/d-button","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"qC8lok7p",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-helper-loading"],[12],[1,"\\n    "],[10,0],[14,0,"dot-falling"],[12],[13],[1,"\\n    "],[10,1],[12],[1,"\\n      "],[1,[28,[32,0],["discourse_ai.ai_helper.context_menu.loading"],null]],[1,"\\n    "],[13],[1,"\\n    "],[8,[32,1],[[24,0,"btn-flat cancel-request"]],[["@icon","@title","@action"],["xmark","discourse_ai.ai_helper.context_menu.cancel",[30,1]]],null],[1,"\\n  "],[13],[1,"\\n"]],["@cancel"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-loading.js",scope:()=>[s.i18n,t.default],isStrictMode:!0}),(0,a.default)(void 0,"ai-helper-loading:AiHelperLoading"))
e.default=n}),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list",["exports","@glimmer/component","@ember/helper","@ember/service","truth-helpers","discourse/components/d-button","discourse/lib/keyboard-shortcuts","discourse/lib/utilities","discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static{dt7948.g(this.prototype,"site",[i.service])}#y=void dt7948.i(this,"site")
get showShortcut(){return this.site.desktopView&&this.args.shortcutVisible}get shortcut(){return(0,r.translateModKey)(`${n.PLATFORM_KEY_MODIFIER} alt p`)}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"s635M6zL",block:'[[[1,"\\n    "],[10,"ul"],[14,0,"ai-helper-options"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,1]],null]],null],null,[[[41,[28,[32,0],[[30,2,["name"]],"custom_prompt"],null],[[[1,"          "],[8,[32,1],null,[["@value","@promptArgs","@submit"],[[30,3],[30,2],[30,4]]],null],[1,"\\n"]],[]],[[[1,"          "],[10,"li"],[15,"data-name",[30,2,["translated_name"]]],[15,"data-value",[30,2,["name"]]],[12],[1,"\\n            "],[8,[32,2],[[16,"data-name",[30,2,["name"]]],[24,0,"ai-helper-options__button"]],[["@icon","@translatedLabel","@action"],[[30,2,["icon"]],[30,2,["translated_name"]],[28,[32,3],[[30,4],[30,2]],null]]],[["default"],[[[[1,"\\n"],[41,[28,[32,4],[[28,[32,0],[[30,2,["name"]],"proofread"],null],[30,0,["showShortcut"]]],null],[[[1,"                "],[10,"kbd"],[14,0,"shortcut"],[12],[1,[30,0,["shortcut"]]],[13],[1,"\\n"]],[]],null],[1,"            "]],[]]]]],[1,"\\n          "],[13],[1,"\\n"]],[]]]],[2]],null],[1,"    "],[13],[1,"\\n  "]],["@options","option","@customPromptValue","@performAction"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list.js",scope:()=>[o.eq,l.default,a.default,s.fn,o.and],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave",["exports","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o=[".",".","."],a=(0,t.setComponentTemplate)((0,s.createTemplateFactory)({id:"2VboNjAG",block:'[[[1,"\\n"],[41,[30,1],[[[1,"    "],[10,1],[14,0,"ai-indicator-wave"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[32,0]],null]],null],null,[[[1,"        "],[10,1],[14,0,"ai-indicator-wave__dot"],[12],[1,[30,2]],[13],[1,"\\n"]],[2]],null],[1,"    "],[13],[1,"\\n"]],[]],null]],["@loading","dot"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave.js",scope:()=>[o],isStrictMode:!0}),(0,i.default)(void 0,"ai-indicator-wave:AiIndicatorWave"))
e.default=a}),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/routing","@ember/runloop","@ember/service","truth-helpers","discourse/components/conditional-loading-spinner","discourse/components/form","discourse/helpers/bound-avatar-template","discourse/helpers/d-icon","discourse/lib/ajax-error","discourse-i18n","admin/models/admin-user","discourse/plugins/discourse-ai/discourse/components/ai-quota-duration-selector","discourse/plugins/discourse-ai/discourse/components/modal/ai-llm-quota-modal","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f,_,b,v){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class y extends t.default{static{dt7948.g(this.prototype,"toasts",[r.service])}#R=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"router",[r.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"dialog",[r.service])}#L=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"modal",[r.service])}#j=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"isSaving",[s.tracked],function(){return!1})}#N=void dt7948.i(this,"isSaving")
static{dt7948.g(this.prototype,"testRunning",[s.tracked],function(){return!1})}#q=void dt7948.i(this,"testRunning")
static{dt7948.g(this.prototype,"testResult",[s.tracked],function(){return null})}#B=void dt7948.i(this,"testResult")
static{dt7948.g(this.prototype,"testError",[s.tracked],function(){return null})}#z=void dt7948.i(this,"testError")
get formData(){if(this.args.llmTemplate){let[e,t]=this.args.llmTemplate.split(/-(.*)/)
if("none"===e)return{provider_params:{}}
const s=this.args.llms.resultSetMeta.presets.findBy("id",e),i=s.models.findBy("name",t)
return{max_prompt_tokens:i.tokens,max_output_tokens:i.max_output_tokens,tokenizer:s.tokenizer,url:i.endpoint||s.endpoint,display_name:i.display_name,name:i.name,provider:s.provider,provider_params:this.computeProviderParams(s.provider),input_cost:i.input_cost,output_cost:i.output_cost,cached_input_cost:i.cached_input_cost}}const{model:e}=this.args
return{max_prompt_tokens:e.max_prompt_tokens,max_output_tokens:e.max_output_tokens,api_key:e.api_key,tokenizer:e.tokenizer,url:e.url,display_name:e.display_name,name:e.name,provider:e.provider,enabled_chat_bot:e.enabled_chat_bot,vision_enabled:e.vision_enabled,input_cost:e.input_cost,output_cost:e.output_cost,cached_input_cost:e.cached_input_cost,provider_params:this.computeProviderParams(e.provider,e.provider_params),llm_quotas:e.llm_quotas}}static{dt7948.n(this.prototype,"formData",[s.cached])}get selectedProviders(){return this.args.llms.resultSetMeta.providers.map(e=>{return{id:e,name:(t=e,(0,h.i18n)(`discourse_ai.llms.providers.${t}`))}
var t}).sort((e,t)=>e.name.localeCompare(t.name))}get tokenizers(){return this.args.llms.resultSetMeta.tokenizers.sort((e,t)=>e.name.localeCompare(t.name))}get adminUser(){return g.default.create(this.args.model?.user)}get testErrorMessage(){return(0,h.i18n)("discourse_ai.llms.tests.failure",{error:this.testError})}get displayTestResult(){return this.testRunning||null!==this.testResult}get modulesUsingModel(){const e=this.args.model.used_by?.filter(e=>"ai_bot"!==e.type)
if(!e||0===e.length)return null
return e.map(e=>(0,h.i18n)(`discourse_ai.llms.usage.${e.type}`,{persona:e.name})).join(", ")}get inUseWarning(){return(0,h.i18n)("discourse_ai.llms.in_use_warning",{settings:this.modulesUsingModel,count:this.args.model.used_by.length})}get showAddQuotaButton(){return!this.args.model.isNew}computeProviderParams(e,t={}){const s=this.args.llms.resultSetMeta.provider_params[e]??{}
return Object.fromEntries(Object.entries(s).map(([e,s])=>[e,t[e]??("enum"===s?.type?s.default:null)]))}canEditURL(e){return"aws_bedrock"!==e}static{dt7948.n(this.prototype,"canEditURL",[o.action])}openAddQuotaModal(e){this.modal.show(_.default,{model:{llm:this.args.model,addItemToCollection:e}})}static{dt7948.n(this.prototype,"openAddQuotaModal",[o.action])}metaProviderParams(e){const t=this.args.llms.resultSetMeta.provider_params[e]||{}
return Object.entries(t).reduce((e,[t,s])=>("string"==typeof s?e[t]={type:s}:"object"==typeof s?(s.values&&((s={...s}).values=s.values.map(e=>({id:e,name:e}))),e[t]={type:s.type||"text",values:s.values||[],default:s.default??void 0}):e[t]={type:"text"},e),{})}static{dt7948.n(this.prototype,"metaProviderParams",[o.action])}async save(e){this.isSaving=!0
const t=this.args.model.isNew,s={...e}
e.max_output_tokens||(s.max_output_tokens=null)
try{await this.args.model.save(s),t&&(this.args.llms.addObject(this.args.model),await this.router.replaceWith("adminPlugins.show.discourse-ai-llms.edit",this.args.model.id)),this.toasts.success({data:{message:(0,h.i18n)("discourse_ai.llms.saved")},duration:"short"})}catch(i){(0,m.popupAjaxError)(i)}finally{(0,n.later)(()=>{this.isSaving=!1},1e3)}}static{dt7948.n(this.prototype,"save",[o.action])}async test(e){this.testRunning=!0
try{const t=await this.args.model.testConfig(e)
this.testResult=t.success,this.testResult?this.testError=null:this.testError=t.error}catch(t){(0,m.popupAjaxError)(t)}finally{(0,n.later)(()=>{this.testRunning=!1},1e3)}}static{dt7948.n(this.prototype,"test",[o.action])}setProvider(e,{set:t}){t("provider_params",this.computeProviderParams(e)),t("provider",e)}static{dt7948.n(this.prototype,"setProvider",[o.action])}delete(){return this.dialog.confirm({message:(0,h.i18n)("discourse_ai.llms.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then(()=>{this.args.llms.removeObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-llms.index")}).catch(m.popupAjaxError)})}static{dt7948.n(this.prototype,"delete",[o.action])}providerParamsKeys(e){return e?Object.keys(e):[]}static{dt7948.n(this.prototype,"providerParamsKeys",[o.action])}static{(0,b.setComponentTemplate)((0,v.createTemplateFactory)({id:"q+K6kmsR",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-llm-editor"]],[["@onSubmit","@data"],[[30,0,["save"]],[30,0,["formData"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["modulesUsingModel"]],[[[1,"        "],[8,[30,1,["Alert"]],null,[["@icon"],["circle-info"]],[["default"],[[[[1,"\\n          "],[1,[30,0,["inUseWarning"]]],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip"],["display_name",[28,[32,1],["discourse_ai.llms.display_name"],null],"required|length:1,100","large",[28,[32,1],["discourse_ai.llms.hints.display_name"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,3,["Input"]],null,null,null],[1,"\\n      "]],[3]]]]],[1,"\\n\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@validation","@format"],["name",[28,[32,1],["discourse_ai.llms.name"],null],[28,[32,1],["discourse_ai.llms.hints.name"],null],"required","large"]],[["default"],[[[[1,"\\n        "],[8,[30,4,["Input"]],null,null,null],[1,"\\n      "]],[4]]]]],[1,"\\n\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@format","@validation","@onSet"],["provider",[28,[32,1],["discourse_ai.llms.provider"],null],"large","required",[30,0,["setProvider"]]]],[["default"],[[[[1,"\\n        "],[8,[30,5,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["selectedProviders"]]],null]],null],null,[[[1,"            "],[8,[30,6,["Option"]],null,[["@value"],[[30,7,["id"]]]],[["default"],[[[[1,[30,7,["name"]]]],[]]]]],[1,"\\n"]],[7]],null],[1,"        "]],[6]]]]],[1,"\\n      "]],[5]]]]],[1,"\\n\\n"],[41,[28,[30,0,["canEditURL"]],[[30,2,["provider"]]],null],[[[1,"        "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format"],["url",[28,[32,1],["discourse_ai.llms.url"],null],"required","large"]],[["default"],[[[[1,"\\n          "],[8,[30,8,["Input"]],null,null,null],[1,"\\n        "]],[8]]]]],[1,"\\n"]],[]],null],[1,"\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format"],["api_key",[28,[32,1],["discourse_ai.llms.api_key"],null],"required","large"]],[["default"],[[[[1,"\\n        "],[8,[30,9,["Password"]],[[24,"autocomplete","off"],[24,"data-1p-ignore",""]],null,null],[1,"\\n      "]],[9]]]]],[1,"\\n\\n      "],[8,[30,1,["Object"]],null,[["@name"],["provider_params"]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[28,[30,0,["providerParamsKeys"]],[[30,11]],null]],null]],null],null,[[[44,[[28,[32,2],[[28,[30,0,["metaProviderParams"]],[[30,2,["provider"]]],null],[30,12]],null]],[[[1,"            "],[8,[30,10,["Field"]],null,[["@name","@title","@format"],[[30,12],[28,[32,1],[[28,[32,3],["discourse_ai.llms.provider_fields.",[30,12]],null]],null],"large"]],[["default"],[[[[1,"\\n"],[41,[28,[32,4],[[30,13,["type"]],"enum"],null],[[[1,"                "],[8,[30,14,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,13,["values"]]],null]],null],null,[[[1,"                    "],[8,[30,15,["Option"]],null,[["@value"],[[30,16,["id"]]]],[["default"],[[[[1,[30,16,["name"]]]],[]]]]],[1,"\\n"]],[16]],null],[1,"                "]],[15]]]]],[1,"\\n"]],[]],[[[41,[28,[32,4],[[30,13,["type"]],"checkbox"],null],[[[1,"                "],[8,[30,14,["Checkbox"]],null,null,null],[1,"\\n"]],[]],[[[1,"                "],[8,[30,14,["Input"]],null,[["@type"],[[30,13,["type"]]]],null],[1,"\\n              "]],[]]]],[]]],[1,"            "]],[14]]]]],[1,"\\n"]],[13]]]],[12]],null],[1,"      "]],[10,11]]]]],[1,"\\n\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@format","@validation"],["tokenizer",[28,[32,1],["discourse_ai.llms.tokenizer"],null],"large","required"]],[["default"],[[[[1,"\\n        "],[8,[30,17,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["tokenizers"]]],null]],null],null,[[[1,"            "],[8,[30,18,["Option"]],null,[["@value"],[[30,19,["id"]]]],[["default"],[[[[1,[30,19,["name"]]]],[]]]]],[1,"\\n"]],[19]],null],[1,"        "]],[18]]]]],[1,"\\n      "]],[17]]]]],[1,"\\n\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@validation","@format"],["max_prompt_tokens",[28,[32,1],["discourse_ai.llms.max_prompt_tokens"],null],[28,[32,1],["discourse_ai.llms.hints.max_prompt_tokens"],null],"required","large"]],[["default"],[[[[1,"\\n        "],[8,[30,20,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n      "]],[20]]]]],[1,"\\n\\n      "],[8,[30,1,["InputGroup"]],null,null,[["default"],[[[[1,"\\n        "],[8,[30,21,["Field"]],null,[["@name","@title","@tooltip","@helpText"],["input_cost",[28,[32,1],["discourse_ai.llms.cost_input"],null],[28,[32,1],["discourse_ai.llms.hints.cost_input"],null],[28,[32,1],["discourse_ai.llms.hints.cost_measure"],null]]],[["default"],[[[[1,"\\n          "],[8,[30,22,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n        "]],[22]]]]],[1,"\\n\\n        "],[8,[30,21,["Field"]],null,[["@name","@title","@tooltip","@helpText"],["cached_input_cost",[28,[32,1],["discourse_ai.llms.cost_cached_input"],null],[28,[32,1],["discourse_ai.llms.hints.cost_cached_input"],null],[28,[32,1],["discourse_ai.llms.hints.cost_measure"],null]]],[["default"],[[[[1,"\\n          "],[8,[30,23,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n        "]],[23]]]]],[1,"\\n\\n        "],[8,[30,21,["Field"]],null,[["@name","@title","@tooltip","@helpText"],["output_cost",[28,[32,1],["discourse_ai.llms.cost_output"],null],[28,[32,1],["discourse_ai.llms.hints.cost_output"],null],[28,[32,1],["discourse_ai.llms.hints.cost_measure"],null]]],[["default"],[[[[1,"\\n          "],[8,[30,24,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n        "]],[24]]]]],[1,"\\n      "]],[21]]]]],[1,"\\n\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@format"],["max_output_tokens",[28,[32,1],["discourse_ai.llms.max_output_tokens"],null],[28,[32,1],["discourse_ai.llms.hints.max_output_tokens"],null],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,25,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n      "]],[25]]]]],[1,"\\n\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@format"],["vision_enabled",[28,[32,1],["discourse_ai.llms.vision_enabled"],null],[28,[32,1],["discourse_ai.llms.hints.vision_enabled"],null],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,26,["Checkbox"]],null,null,null],[1,"\\n      "]],[26]]]]],[1,"\\n\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@format"],["enabled_chat_bot",[28,[32,1],["discourse_ai.llms.enabled_chat_bot"],null],[28,[32,1],["discourse_ai.llms.hints.enabled_chat_bot"],null],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,27,["Checkbox"]],null,null,null],[1,"\\n      "]],[27]]]]],[1,"\\n\\n"],[41,[30,28,["user"]],[[[1,"        "],[8,[30,1,["Container"]],null,[["@title"],[[28,[32,1],["discourse_ai.llms.ai_bot_user"],null]]],[["default"],[[[[1,"\\n          "],[10,3],[14,0,"avatar"],[15,6,[30,28,["user","path"]]],[15,"data-user-card",[30,28,["user","username"]]],[12],[1,"\\n            "],[1,[28,[32,5],[[30,28,["user","avatar_template"]],"small"],null]],[1,"\\n          "],[13],[1,"\\n          "],[8,[32,6],null,[["@route","@model"],["adminUser",[30,0,["adminUser"]]]],[["default"],[[[[1,"\\n            "],[1,[30,28,["user","username"]]],[1,"\\n          "]],[]]]]],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,7],[[30,2,["llm_quotas","length"]],0],null],[[[1,"        "],[8,[30,1,["Container"]],null,[["@title"],[[28,[32,1],["discourse_ai.llms.quotas.title"],null]]],[["default"],[[[[1,"\\n          "],[10,"table"],[14,0,"ai-llm-quotas__table"],[12],[1,"\\n            "],[10,"thead"],[14,0,"ai-llm-quotas__table-head"],[12],[1,"\\n              "],[10,"tr"],[14,0,"ai-llm-quotas__header-row"],[12],[1,"\\n                "],[10,"th"],[14,0,"ai-llm-quotas__header"],[12],[1,[28,[32,1],["discourse_ai.llms.quotas.group"],null]],[13],[1,"\\n                "],[10,"th"],[14,0,"ai-llm-quotas__header"],[12],[1,[28,[32,1],["discourse_ai.llms.quotas.max_tokens"],null]],[13],[1,"\\n                "],[10,"th"],[14,0,"ai-llm-quotas__header"],[12],[1,[28,[32,1],["discourse_ai.llms.quotas.max_usages"],null]],[13],[1,"\\n                "],[10,"th"],[14,0,"ai-llm-quotas__header"],[12],[1,[28,[32,1],["discourse_ai.llms.quotas.duration"],null]],[13],[1,"\\n                "],[10,"th"],[14,0,"ai-llm-quotas__header ai-llm-quotas__header--actions"],[12],[13],[1,"\\n                "],[10,"th"],[12],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n            "],[10,"tbody"],[14,0,"ai-llm-quotas__table-body"],[12],[1,"\\n              "],[8,[30,1,["Collection"]],[[24,0,"ai-llm-quotas__row"]],[["@name","@tagName"],["llm_quotas","tr"]],[["default"],[[[[1,"\\n                "],[10,"td"],[14,0,"ai-llm-quotas__cell"],[12],[1,[30,31,["group_name"]]],[13],[1,"\\n                "],[10,"td"],[14,0,"ai-llm-quotas__cell"],[12],[1,"\\n                  "],[8,[30,29,["Field"]],null,[["@name","@title","@showTitle"],["max_tokens","max_tokens",false]],[["default"],[[[[1,"\\n                    "],[8,[30,32,["Input"]],[[24,0,"ai-llm-quotas__input"],[24,"min","1"]],[["@type"],["number"]],null],[1,"\\n                  "]],[32]]]]],[1,"\\n                "],[13],[1,"\\n                "],[10,"td"],[14,0,"ai-llm-quotas__cell"],[12],[1,"\\n                  "],[8,[30,29,["Field"]],null,[["@name","@title","@showTitle"],["max_usages","max_usages",false]],[["default"],[[[[1,"\\n                    "],[8,[30,33,["Input"]],[[24,0,"ai-llm-quotas__input"],[24,"min","1"]],[["@type"],["number"]],null],[1,"\\n                  "]],[33]]]]],[1,"\\n                "],[13],[1,"\\n                "],[10,"td"],[14,0,"ai-llm-quotas__cell"],[12],[1,"\\n                  "],[8,[30,29,["Field"]],null,[["@name","@title","@showTitle"],["duration_seconds","duration_seconds",false]],[["default"],[[[[1,"\\n                    "],[8,[30,34,["Custom"]],null,null,[["default"],[[[[1,"\\n                      "],[8,[32,8],null,[["@value","@onChange"],[[30,31,["duration_seconds"]],[30,34,["set"]]]],null],[1,"\\n                    "]],[]]]]],[1,"\\n                  "]],[34]]]]],[1,"\\n                "],[13],[1,"\\n                "],[10,"td"],[12],[1,"\\n                  "],[8,[30,1,["Button"]],[[24,0,"btn-danger ai-llm-quotas__delete-btn"]],[["@icon","@action"],["trash-can",[28,[32,9],[[30,29,["remove"]],[30,30]],null]]],null],[1,"\\n                "],[13],[1,"\\n              "]],[29,30,31]]]]],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n        "]],[]]]]],[1,"\\n\\n        "],[8,[30,1,["Button"]],[[24,0,"ai-llm-editor__add-quota-btn"]],[["@action","@icon","@label"],[[28,[32,9],[[30,0,["openAddQuotaModal"]],[28,[32,9],[[30,1,["addItemToCollection"]],"llm_quotas"],null]],null],"plus","discourse_ai.llms.quotas.add"]],null],[1,"\\n"]],[]],null],[1,"\\n      "],[8,[30,1,["Actions"]],null,null,[["default"],[[[[1,"\\n        "],[8,[30,1,["Button"]],null,[["@action","@disabled","@label"],[[28,[32,9],[[30,0,["test"]],[30,2]],null],[30,0,["testRunning"]],"discourse_ai.llms.tests.title"]],null],[1,"\\n\\n        "],[8,[30,1,["Submit"]],null,null,null],[1,"\\n\\n"],[41,[28,[32,4],[[30,2,["llm_quotas","length"]],0],null],[[[1,"          "],[8,[30,1,["Button"]],[[24,0,"ai-llm-editor__add-quota-btn"]],[["@action","@label"],[[28,[32,9],[[30,0,["openAddQuotaModal"]],[28,[32,9],[[30,1,["addItemToCollection"]],"llm_quotas"],null]],null],"discourse_ai.llms.quotas.add"]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[51,[30,28,["isNew"]]],[[[1,"          "],[8,[30,1,["Button"]],[[24,0,"btn-danger"]],[["@action","@label"],[[30,0,["delete"]],"discourse_ai.llms.delete"]],null],[1,"\\n"]],[]],null],[1,"      "]],[]]]]],[1,"\\n\\n"],[41,[30,0,["displayTestResult"]],[[[1,"        "],[8,[30,1,["Container"]],null,[["@format"],["full"]],[["default"],[[[[1,"\\n          "],[8,[32,10],null,[["@size","@condition"],["small",[30,0,["testRunning"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["testResult"]],[[[1,"              "],[10,0],[14,0,"ai-llm-editor-tests__success"],[12],[1,"\\n                "],[1,[28,[32,11],["check"],null]],[1,"\\n                "],[1,[28,[32,1],["discourse_ai.llms.tests.success"],null]],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[1,"              "],[10,0],[14,0,"ai-llm-editor-tests__failure"],[12],[1,"\\n                "],[1,[28,[32,11],["xmark"],null]],[1,"\\n                "],[1,[30,0,["testErrorMessage"]]],[1,"\\n              "],[13],[1,"\\n"]],[]]],[1,"          "]],[]]]]],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null],[1,"    "]],[1,2]]]]],[1,"\\n  "]],["form","data","field","field","field","select","provider","field","field","object","providerParamsData","name","params","field","select","option","field","select","tokenizer","field","inputGroup","field","field","field","field","field","field","@model","collection","index","collectionData","field","field","field"],false,["if","each","-track-array","let","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form.js",scope:()=>[u.default,h.i18n,i.get,i.concat,l.eq,c.default,a.LinkTo,l.gt,f.default,i.fn,d.default,p.default],isStrictMode:!0}),this)}}e.default=y}),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-editor",["exports","discourse/components/back-button","discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"Tv683ucY",block:'[[[1,"\\n  "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-llms","discourse_ai.llms.back"]],null],[1,"\\n  "],[8,[32,1],null,[["@model","@llmTemplate","@llms"],[[30,1],[30,2],[30,3]]],null],[1,"\\n"]],["@model","@llmTemplate","@llms"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llm-editor.js",scope:()=>[t.default,s.default],isStrictMode:!0}),(0,a.default)(void 0,"ai-llm-editor:AiLlmEditor"))
e.default=n}),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-selector",["exports","@ember/helper","select-kit/components/combo-box","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"nJvrK5ml",block:'[[[1,"\\n  "],[8,[32,0],[[16,0,[30,1]]],[["@value","@content","@onChange","@options"],[[30,2],[30,3],[30,4],[28,[32,1],null,[["filterable","none"],[true,"discourse_ai.ai_persona.no_llm_selected"]]]]],null],[1,"\\n"]],["@class","@value","@llms","@onChange"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llm-selector.js",scope:()=>[s.default,t.hash],isStrictMode:!0}),(0,a.default)(void 0,"ai-llm-selector:AiLlmSelector"))
e.default=n}),define("discourse/plugins/discourse-ai/discourse/components/ai-llms-list-editor",["exports","@glimmer/component","@ember/helper","@ember/object","@ember/service","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse-i18n","admin/components/admin-section-landing-item","admin/components/admin-section-landing-wrapper","float-kit/components/d-tooltip","discourse/plugins/discourse-ai/discourse/components/ai-default-llm-selector","discourse/plugins/discourse-ai/discourse/components/ai-llm-editor","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g){"use strict"
function f(e){if(e.id<0)return!0}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static{dt7948.g(this.prototype,"adminPluginNavManager",[o.service])}#V=void dt7948.i(this,"adminPluginNavManager")
static{dt7948.g(this.prototype,"router",[o.service])}#e=void dt7948.i(this,"router")
modelDescription(e){let t=""
return t="number"==typeof e.id?`${e.provider}-${e.name}`:e.id.replace(/[.:\/]/g,"-"),t=`discourse_ai.llms.model_description.${t}`,l.default.lookup(t,{ignoreMissing:!0})?(0,l.i18n)(t):""}static{dt7948.n(this.prototype,"modelDescription",[i.action])}preseededDescription(e){if(f(e))return(0,l.i18n)("discourse_ai.llms.preseeded_model_description",{model:e.name})}static{dt7948.n(this.prototype,"preseededDescription",[i.action])}sanitizedTranslationKey(e){return e.replace(/\./g,"-")}get hasLlmElements(){return 0!==this.args.llms.length}get preconfiguredTitle(){return this.hasLlmElements?"discourse_ai.llms.preconfigured.title":"discourse_ai.llms.preconfigured.title_no_llms"}get preConfiguredLlms(){const e=[{id:"none",name:(0,l.i18n)("discourse_ai.llms.preconfigured.fake"),provider:"fake"}],t=this.args.llms.content.map(e=>({provider:e.provider,name:e.name}))
return this.args.llms.resultSetMeta.presets.forEach(s=>{s.models&&s.models.forEach(i=>{const o=`${s.id}-${i.name}`
t.some(e=>e.provider===s.provider&&e.name===i.name)||e.push({id:o,name:i.display_name,provider:s.provider})})}),e}transitionToLlmEditor(e){this.router.transitionTo("adminPlugins.show.discourse-ai-llms.new",{queryParams:{llmTemplate:e}})}static{dt7948.n(this.prototype,"transitionToLlmEditor",[i.action])}localizeUsage(e){return(0,l.i18n)(`discourse_ai.llms.usage.${e.type}`,{persona:e.name})}static{(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"xuJzafVf",block:'[[[1,"\\n    "],[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-llms"]],[28,[32,1],["discourse_ai.llms.short_title"],null]]],null],[1,"\\n    "],[10,"section"],[14,0,"ai-llm-list-editor admin-detail"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[8,[32,2],null,[["@model","@llms","@llmTemplate"],[[30,1],[30,2],[30,3]]],null],[1,"\\n"]],[]],[[[1,"        "],[8,[32,3],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[28,[32,1],["discourse_ai.llms.short_title"],null],[28,[32,1],["discourse_ai.llms.preconfigured.description"],null],"https://meta.discourse.org/t/discourse-ai-large-language-model-llm-settings-page/319903"]],null],[1,"\\n\\n        "],[8,[32,4],null,null,null],[1,"\\n\\n"],[41,[30,0,["hasLlmElements"]],[[[1,"          "],[10,"section"],[14,0,"ai-llms-list-editor__configured"],[12],[1,"\\n            "],[8,[32,3],null,[["@titleLabel"],[[28,[32,1],["discourse_ai.llms.configured.title"],null]]],null],[1,"\\n            "],[10,"table"],[14,0,"d-admin-table"],[12],[1,"\\n              "],[10,"thead"],[12],[1,"\\n                "],[10,"tr"],[12],[1,"\\n                  "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.llms.display_name"],null]],[13],[1,"\\n                  "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.llms.provider"],null]],[13],[1,"\\n                  "],[10,"th"],[12],[13],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n              "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2]],null]],null],null,[[[1,"                  "],[10,"tr"],[15,"data-llm-id",[30,4,["name"]]],[14,0,"ai-llm-list__row d-admin-row__content"],[12],[1,"\\n                    "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n\\n                      "],[10,0],[14,0,"ai-llm-list__name"],[12],[1,"\\n                        "],[10,"strong"],[12],[1,"\\n                          "],[1,[30,4,["display_name"]]],[1,"\\n                        "],[13],[1,"\\n                      "],[13],[1,"\\n                      "],[10,0],[14,0,"ai-llm-list__description"],[12],[1,"\\n                        "],[1,[28,[30,0,["modelDescription"]],[[30,4]],null]],[1,"\\n                        "],[1,[28,[30,0,["preseededDescription"]],[[30,4]],null]],[1,"\\n                      "],[13],[1,"\\n"],[41,[30,4,["used_by"]],[[[1,"                        "],[10,"ul"],[14,0,"ai-llm-list-editor__usages"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,4,["used_by"]]],null]],null],null,[[[1,"                            "],[10,"li"],[12],[1,[28,[30,0,["localizeUsage"]],[[30,5]],null]],[13],[1,"\\n"]],[5]],null],[1,"                        "],[13],[1,"\\n"]],[]],null],[1,"                    "],[13],[1,"\\n                    "],[10,"td"],[14,0,"d-admin-row__detail"],[12],[1,"\\n                      "],[10,0],[14,0,"d-admin-row__mobile-label"],[12],[1,"\\n                        "],[1,[28,[32,1],["discourse_ai.llms.provider"],null]],[1,"\\n                      "],[13],[1,"\\n                      "],[1,[28,[32,1],[[28,[32,5],["discourse_ai.llms.providers.",[30,4,["provider"]]],null]],null]],[1,"\\n                    "],[13],[1,"\\n                    "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n"],[41,[28,[32,6],[[30,4]],null],[[[1,"                        "],[8,[32,7],[[24,0,"ai-llm-list__edit-disabled-tooltip"]],null,[["trigger","content"],[[[[1,"\\n                            "],[8,[32,8],[[24,0,"btn btn-default btn-small disabled"]],[["@label"],["discourse_ai.llms.edit"]],null],[1,"\\n                          "]],[]],[[[1,"\\n                            "],[1,[28,[32,1],["discourse_ai.llms.seeded_warning"],null]],[1,"\\n                          "]],[]]]]],[1,"\\n"]],[]],[[[1,"                        "],[8,[32,8],[[24,0,"btn btn-default btn-small ai-llm-list__delete-button"]],[["@label","@route","@routeModels"],["discourse_ai.llms.edit","adminPlugins.show.discourse-ai-llms.edit",[30,4,["id"]]]],null],[1,"\\n"]],[]]],[1,"                    "],[13],[1,"\\n                  "],[13],[1,"\\n"]],[4]],null],[1,"              "],[13],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"        "],[10,"section"],[14,0,"ai-llms-list-editor__templates"],[12],[1,"\\n          "],[8,[32,3],null,[["@titleLabel"],[[28,[32,1],[[30,0,["preconfiguredTitle"]]],null]]],null],[1,"\\n          "],[8,[32,9],[[24,0,"ai-llms-list-editor__templates-list"]],null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["preConfiguredLlms"]]],null]],null],null,[[[1,"              "],[8,[32,10],[[16,"data-llm-id",[30,6,["id"]]],[24,0,"ai-llms-list-editor__templates-list-item"]],[["@titleLabelTranslated","@descriptionLabelTranslated","@taglineLabel"],[[30,6,["name"]],[28,[30,0,["modelDescription"]],[[30,6]],null],[28,[32,5],["discourse_ai.llms.providers.",[30,6,["provider"]]],null]]],[["buttons"],[[[[1,"\\n                  "],[8,[30,7,["Default"]],null,[["@action","@icon","@label"],[[28,[32,11],[[30,0,["transitionToLlmEditor"]],[30,6,["id"]]],null],"gear","discourse_ai.llms.preconfigured.button"]],null],[1,"\\n                "]],[7]]]]],[1,"\\n"]],[6]],null],[1,"          "]],[]]]]],[1,"\\n        "],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],["@currentLlm","@llms","@llmTemplate","llm","usage","llm","buttons"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llms-list-editor.js",scope:()=>[a.default,l.i18n,m.default,r.default,p.default,s.concat,f,c.default,n.default,u.default,d.default,s.fn],isStrictMode:!0}),this)}}e.default=_}),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/routing","@ember/runloop","@ember/service","truth-helpers","discourse/components/back-button","discourse/components/form","discourse/helpers/bound-avatar-template","discourse/lib/ajax-error","discourse/lib/get-url","discourse/models/group","discourse-i18n","admin/models/admin-user","select-kit/components/group-chooser","discourse/plugins/discourse-ai/discourse/components/modal/ai-persona-response-format-editor","discourse/plugins/discourse-ai/discourse/components/ai-llm-selector","discourse/plugins/discourse-ai/discourse/components/ai-persona-example","discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options","discourse/plugins/discourse-ai/discourse/components/ai-tool-selector","discourse/plugins/discourse-ai/discourse/components/rag-options-fk","discourse/plugins/discourse-ai/discourse/components/rag-uploader","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f,_,b,v,y,w,S,x,k,T,P,C){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class j extends t.default{static{dt7948.g(this.prototype,"router",[l.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"dialog",[l.service])}#L=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"toasts",[l.service])}#R=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"siteSettings",[l.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"allGroups",[s.tracked],function(){return[]})}#Z=void dt7948.i(this,"allGroups")
static{dt7948.g(this.prototype,"isSaving",[s.tracked],function(){return!1})}#N=void dt7948.i(this,"isSaving")
dirtyFormData=null
get formData(){if(this.dirtyFormData){const e=this.dirtyFormData
return this.dirtyFormData=null,e}{const e=this.args.model.toPOJO()
return e.tools&&(e.toolOptions=this.mapToolOptions(e.toolOptions,e.tools)),e}}static{dt7948.n(this.prototype,"formData",[s.cached])}get chatPluginEnabled(){return this.siteSettings.chat_enabled}get allTools(){return this.args.personas.resultSetMeta.tools}get maxPixelValues(){const e=e=>(0,f.i18n)(`discourse_ai.ai_persona.vision_max_pixel_sizes.${e}`)
return[{name:e("low"),id:65536},{name:e("medium"),id:262144},{name:e("high"),id:1048576}]}get forcedToolStrategies(){const e=[{id:-1,name:(0,f.i18n)("discourse_ai.ai_persona.tool_strategies.all")}]
return[1,2,5].forEach(t=>{e.push({id:t,name:(0,f.i18n)("discourse_ai.ai_persona.tool_strategies.replies",{count:t})})}),e}async updateAllGroups(){const e=await g.default.findAll({include_everyone:!0})
if(!e.find(e=>0===e.id)){const t="everyone"
e.push({id:0,name:t})}this.allGroups=e}static{dt7948.n(this.prototype,"updateAllGroups",[o.action])}async save(e){const t=this.args.model.isNew
this.isSaving=!0
try{const s=Object.assign(this.args.model,this.args.model.fromPOJO(e))
await s.save(),this.#ee(),t&&0===this.args.model.rag_uploads.length&&(this.args.personas.addObject(s),await this.router.replaceWith("adminPlugins.show.discourse-ai-personas.edit",s)),this.toasts.success({data:{message:(0,f.i18n)("discourse_ai.ai_persona.saved")},duration:"short"})}catch(s){(0,m.popupAjaxError)(s)}finally{(0,r.later)(()=>{this.isSaving=!1},1e3)}}static{dt7948.n(this.prototype,"save",[o.action])}get adminUser(){const e=Object.assign({},this.args.model?.user)
return _.default.create(e)}delete(){return this.dialog.confirm({message:(0,f.i18n)("discourse_ai.ai_persona.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then(()=>{this.args.personas.removeObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-personas.index")})})}static{dt7948.n(this.prototype,"delete",[o.action])}async toggleEnabled(e,t,{set:s}){s("enabled",t),await this.persistField(e,"enabled",t)}static{dt7948.n(this.prototype,"toggleEnabled",[o.action])}async togglePriority(e,t,{set:s}){s("priority",t),await this.persistField(e,"priority",t,!0)}static{dt7948.n(this.prototype,"togglePriority",[o.action])}async createUser(e){try{let t=await this.args.model.createUser()
e.set("user",t),e.set("user_id",t.id)}catch(t){(0,m.popupAjaxError)(t)}}static{dt7948.n(this.prototype,"createUser",[o.action])}updateUploads(e,t){e.set("rag_uploads",t)}static{dt7948.n(this.prototype,"updateUploads",[o.action])}async removeUpload(e,t,s,i){const o=s.filter(e=>e.id!==i.id)
e.set("rag_uploads",o),this.args.model.isNew||await this.persistField(t,"rag_uploads",o)}static{dt7948.n(this.prototype,"removeUpload",[o.action])}updateToolNames(e,t,s){const i=t?.tools?.filter(e=>!s.includes(e))||[],o=this.mapToolOptions(t.toolOptions,s)
if(e.setProperties({tools:s,toolOptions:o}),t.forcedTools?.length>0){const s=t.forcedTools.filter(e=>!i.includes(e))
e.set("forcedTools",s)}}static{dt7948.n(this.prototype,"updateToolNames",[o.action])}availableForcedTools(e){return this.allTools.filter(t=>e.includes(t.id))}static{dt7948.n(this.prototype,"availableForcedTools",[o.action])}addExamplesPair(e,t){const s=[...t.examples,["",""]]
e.set("examples",s)}static{dt7948.n(this.prototype,"addExamplesPair",[o.action])}mapToolOptions(e,t){const s=Object.assign({},e)
return t.forEach(e=>{const t=this.allTools.findBy("id",e),i=t?.options
if(!i||s[e])return
const o={}
Object.keys(i).forEach(e=>{o[e]=null}),s[e]=o}),s}async persistField(e,t,s,i){if(!this.args.model.isNew){const a=Object.assign({},e)
a[t]=s
try{const e={}
e[t]=s,this.dirtyFormData=a,await this.args.model.update(e),i&&this.#ee()}catch(o){(0,m.popupAjaxError)(o)}}}#ee(){const e=this.args.personas.toArray().sort((e,t)=>e.priority&&!t.priority?-1:!e.priority&&t.priority?1:e.name.localeCompare(t.name))
this.args.personas.clear(),this.args.personas.setObjects(e)}exportPersona(){const e=`/admin/plugins/discourse-ai/ai-personas/${this.args.model.id}/export.json`
window.location.href=(0,h.default)(e)}static{dt7948.n(this.prototype,"exportPersona",[o.action])}static{(0,P.setComponentTemplate)((0,C.createTemplateFactory)({id:"AkaXQyvI",block:'[[[1,"\\n    "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-personas","discourse_ai.ai_persona.back"]],null],[1,"\\n    "],[11,0],[24,0,"ai-persona-editor"],[4,[32,1],[[30,0,["updateAllGroups"]],[30,1,["id"]]],null],[12],[1,"\\n      "],[8,[32,2],null,[["@onSubmit","@data"],[[30,0,["save"]],[30,0,["formData"]]]],[["default"],[[[[1,"\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@disabled","@format"],["name",[28,[32,3],["discourse_ai.ai_persona.name"],null],"required|length:1,100",[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,4,["Input"]],null,null,null],[1,"\\n        "]],[4]]]]],[1,"\\n\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@disabled","@format"],["description",[28,[32,3],["discourse_ai.ai_persona.description"],null],"required|length:1,100",[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,5,["Textarea"]],null,null,null],[1,"\\n        "]],[5]]]]],[1,"\\n\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@disabled","@format"],["system_prompt",[28,[32,3],["discourse_ai.ai_persona.system_prompt"],null],"required|length:1,100000",[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,6,["Textarea"]],null,null,null],[1,"\\n        "]],[6]]]]],[1,"\\n\\n        "],[8,[32,4],null,[["@form","@data"],[[30,2],[30,3]]],null],[1,"\\n\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["default_llm_id",[28,[32,3],["discourse_ai.ai_persona.default_llm"],null],[28,[32,3],["discourse_ai.ai_persona.default_llm_help"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,7,["Custom"]],null,null,[["default"],[[[[1,"\\n            "],[8,[32,5],null,[["@value","@llms","@onChange","@class"],[[30,7,["value"]],[30,8,["resultSetMeta","llms"]],[30,7,["set"]],"ai-persona-editor__llms"]],null],[1,"\\n          "]],[]]]]],[1,"\\n        "]],[7]]]]],[1,"\\n\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["allowed_group_ids",[28,[32,3],["discourse_ai.ai_persona.allowed_groups"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,9,["Custom"]],null,null,[["default"],[[[[1,"\\n            "],[8,[32,6],null,[["@value","@content","@onChange"],[[30,3,["allowed_group_ids"]],[30,0,["allGroups"]],[30,9,["set"]]]],null],[1,"\\n          "]],[]]]]],[1,"\\n        "]],[9]]]]],[1,"\\n\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["vision_enabled",[28,[32,3],["discourse_ai.ai_persona.vision_enabled"],null],[28,[32,3],["discourse_ai.ai_persona.vision_enabled_help"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,10,["Checkbox"]],null,null,null],[1,"\\n        "]],[10]]]]],[1,"\\n\\n"],[41,[30,3,["vision_enabled"]],[[[1,"          "],[8,[30,2,["Field"]],null,[["@name","@title","@onSet","@format"],["vision_max_pixels",[28,[32,3],["discourse_ai.ai_persona.vision_max_pixels"],null],[30,0,["onChangeMaxPixels"]],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,11,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["maxPixelValues"]]],null]],null],null,[[[1,"                "],[8,[30,12,["Option"]],null,[["@value"],[[30,13,["id"]]]],[["default"],[[[[1,[30,13,["name"]]]],[]]]]],[1,"\\n"]],[13]],null],[1,"            "]],[12]]]]],[1,"\\n          "]],[11]]]]],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["max_context_posts",[28,[32,3],["discourse_ai.ai_persona.max_context_posts"],null],[28,[32,3],["discourse_ai.ai_persona.max_context_posts_help"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,14,["Input"]],[[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n        "]],[14]]]]],[1,"\\n\\n"],[41,[51,[30,3,["system"]]],[[[1,"          "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@disabled","@format"],["temperature",[28,[32,3],["discourse_ai.ai_persona.temperature"],null],[28,[32,3],["discourse_ai.ai_persona.temperature_help"],null],[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,15,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n          "]],[15]]]]],[1,"\\n\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@disabled","@format"],["top_p",[28,[32,3],["discourse_ai.ai_persona.top_p"],null],[28,[32,3],["discourse_ai.ai_persona.top_p_help"],null],[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,16,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n          "]],[16]]]]],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[30,2,["Section"]],null,[["@title","@subtitle"],[[28,[32,3],["discourse_ai.ai_persona.examples.title"],null],[28,[32,3],["discourse_ai.ai_persona.examples.examples_help"],null]]],[["default"],[[[[1,"\\n"],[41,[51,[30,3,["system"]]],[[[1,"            "],[8,[30,2,["Container"]],null,null,[["default"],[[[[1,"\\n              "],[8,[30,2,["Button"]],[[24,0,"ai-persona-editor__new_example"]],[["@action","@label"],[[28,[32,7],[[30,0,["addExamplesPair"]],[30,2],[30,3]],null],"discourse_ai.ai_persona.examples.new"]],null],[1,"\\n            "]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,8],[[30,3,["examples","length"]],0],null],[[[1,"            "],[8,[30,2,["Collection"]],null,[["@name"],["examples"]],[["default"],[[[[1,"\\n              "],[8,[32,9],null,[["@examplesCollection","@exampleNumber","@system","@form"],[[30,17],[30,18],[30,3,["system"]],[30,2]]],null],[1,"\\n            "]],[17,18]]]]],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n\\n        "],[8,[30,2,["Section"]],null,[["@title"],[[28,[32,3],["discourse_ai.ai_persona.ai_tools"],null]]],[["default"],[[[[1,"\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["tools",[28,[32,3],["discourse_ai.ai_persona.tools"],null],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,19,["Custom"]],null,null,[["default"],[[[[1,"\\n              "],[8,[32,10],null,[["@value","@disabled","@onChange","@content"],[[30,19,["value"]],[30,3,["system"]],[28,[32,7],[[30,0,["updateToolNames"]],[30,2],[30,3]],null],[30,8,["resultSetMeta","tools"]]]],null],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[19]]]]],[1,"\\n\\n"],[41,[28,[32,8],[[30,3,["tools","length"]],0],null],[[[1,"            "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["forcedTools",[28,[32,3],["discourse_ai.ai_persona.forced_tools"],null],"large"]],[["default"],[[[[1,"\\n              "],[8,[30,20,["Custom"]],null,null,[["default"],[[[[1,"\\n                "],[8,[32,10],null,[["@value","@disabled","@onChange","@content"],[[30,20,["value"]],[30,3,["system"]],[30,20,["set"]],[28,[30,0,["availableForcedTools"]],[[30,3,["tools"]]],null]]],null],[1,"\\n              "]],[]]]]],[1,"\\n            "]],[20]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,8],[[30,3,["forcedTools","length"]],0],null],[[[1,"            "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["forced_tool_count",[28,[32,3],["discourse_ai.ai_persona.forced_tool_strategy"],null],"large"]],[["default"],[[[[1,"\\n              "],[8,[30,21,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["forcedToolStrategies"]]],null]],null],null,[[[1,"                  "],[8,[30,22,["Option"]],null,[["@value"],[[30,23,["id"]]]],[["default"],[[[[1,[30,23,["name"]]]],[]]]]],[1,"\\n"]],[23]],null],[1,"              "]],[22]]]]],[1,"\\n            "]],[21]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,8],[[30,3,["tools","length"]],0],null],[[[1,"            "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["tool_details",[28,[32,3],["discourse_ai.ai_persona.tool_details"],null],[28,[32,3],["discourse_ai.ai_persona.tool_details_help"],null],"large"]],[["default"],[[[[1,"\\n              "],[8,[30,24,["Checkbox"]],null,null,null],[1,"\\n            "]],[24]]]]],[1,"\\n\\n            "],[8,[32,11],null,[["@form","@data","@llms","@allTools"],[[30,2],[30,3],[30,8,["resultSetMeta","llms"]],[30,8,["resultSetMeta","tools"]]]],null],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"          "],[8,[30,2,["Section"]],null,[["@title"],[[28,[32,3],["discourse_ai.rag.title"],null]]],[["default"],[[[[1,"\\n            "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["rag_uploads",[28,[32,3],["discourse_ai.rag.uploads.title"],null],"full"]],[["default"],[[[[1,"\\n              "],[8,[30,25,["Custom"]],null,null,[["default"],[[[[1,"\\n                "],[8,[32,12],null,[["@target","@targetName","@updateUploads","@onRemove","@allowImages"],[[30,3],"AiPersona",[28,[32,7],[[30,0,["updateUploads"]],[30,2]],null],[28,[32,7],[[30,0,["removeUpload"]],[30,2],[30,3],[30,25,["value"]]],null],[30,8,["resultSetMeta","settings","rag_images_enabled"]]]],null],[1,"\\n              "]],[]]]]],[1,"\\n            "]],[25]]]]],[1,"\\n\\n            "],[8,[32,13],null,[["@form","@data","@llms","@allowImages"],[[30,2],[30,3],[30,8,["resultSetMeta","llms"]],[30,8,["resultSetMeta","settings","rag_images_enabled"]]]],[["default"],[[[[1,"\\n              "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_conversation_chunks",[28,[32,3],["discourse_ai.ai_persona.rag_conversation_chunks"],null],[28,[32,3],["discourse_ai.ai_persona.rag_conversation_chunks_help"],null],"large"]],[["default"],[[[[1,"\\n                "],[8,[30,26,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n              "]],[26]]]]],[1,"\\n\\n              "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["question_consolidator_llm_id",[28,[32,3],["discourse_ai.ai_persona.question_consolidator_llm"],null],[28,[32,3],["discourse_ai.ai_persona.question_consolidator_llm_help"],null],"large"]],[["default"],[[[[1,"\\n                "],[8,[30,27,["Custom"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,5],null,[["@value","@llms","@onChange","@class"],[[30,27,["value"]],[30,8,["resultSetMeta","llms"]],[30,27,["set"]],"ai-persona-editor__llms"]],null],[1,"\\n                "]],[]]]]],[1,"\\n              "]],[27]]]]],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[30,2,["Section"]],null,[["@title"],[[28,[32,3],["discourse_ai.ai_persona.ai_bot.title"],null]]],[["default"],[[[[1,"\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@onSet"],["enabled",[28,[32,3],["discourse_ai.ai_persona.enabled"],null],[28,[32,7],[[30,0,["toggleEnabled"]],[30,3]],null]]],[["default"],[[[[1,"\\n            "],[8,[30,28,["Toggle"]],null,null,null],[1,"\\n          "]],[28]]]]],[1,"\\n\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@onSet","@tooltip"],["priority",[28,[32,3],["discourse_ai.ai_persona.priority"],null],[28,[32,7],[[30,0,["togglePriority"]],[30,3]],null],[28,[32,3],["discourse_ai.ai_persona.priority_help"],null]]],[["default"],[[[[1,"\\n            "],[8,[30,29,["Toggle"]],null,null,null],[1,"\\n          "]],[29]]]]],[1,"\\n\\n"],[41,[30,1,["isNew"]],[[[1,"            "],[10,0],[12],[1,[28,[32,3],["discourse_ai.ai_persona.ai_bot.save_first"],null]],[13],[1,"\\n"]],[]],[[[41,[30,3,["default_llm_id"]],[[[1,"              "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["force_default_llm",[28,[32,3],["discourse_ai.ai_persona.force_default_llm"],null],"large"]],[["default"],[[[[1,"\\n                "],[8,[30,30,["Checkbox"]],null,null,null],[1,"\\n              "]],[30]]]]],[1,"\\n"]],[]],null],[1,"\\n            "],[8,[30,2,["Container"]],[[24,0,"ai-persona-editor__ai_bot_user"]],[["@title","@tooltip"],[[28,[32,3],["discourse_ai.ai_persona.user"],null],[52,[51,[30,3,["user"]]],[28,[32,3],["discourse_ai.ai_persona.create_user_help"],null]]]],[["default"],[[[[1,"\\n"],[41,[30,3,["user"]],[[[1,"                "],[10,3],[14,0,"avatar"],[15,6,[30,3,["user","path"]]],[15,"data-user-card",[30,3,["user","username"]]],[12],[1,"\\n                  "],[1,[28,[32,14],[[30,3,["user","avatar_template"]],"small"],null]],[1,"\\n                "],[13],[1,"\\n                "],[8,[32,15],null,[["@route","@model"],["adminUser",[30,0,["adminUser"]]]],[["default"],[[[[1,"\\n                  "],[1,[30,3,["user","username"]]],[1,"\\n                "]],[]]]]],[1,"\\n"]],[]],[[[1,"                "],[8,[30,2,["Button"]],[[24,0,"ai-persona-editor__create-user"]],[["@action","@label"],[[28,[32,7],[[30,0,["createUser"]],[30,2]],null],"discourse_ai.ai_persona.create_user"]],null],[1,"\\n"]],[]]],[1,"            "]],[]]]]],[1,"\\n\\n"],[41,[30,3,["user"]],[[[1,"              "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["allow_personal_messages",[28,[32,3],["discourse_ai.ai_persona.allow_personal_messages"],null],[28,[32,3],["discourse_ai.ai_persona.allow_personal_messages_help"],null],"large"]],[["default"],[[[[1,"\\n                "],[8,[30,31,["Checkbox"]],null,null,null],[1,"\\n              "]],[31]]]]],[1,"\\n\\n              "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["allow_topic_mentions",[28,[32,3],["discourse_ai.ai_persona.allow_topic_mentions"],null],[28,[32,3],["discourse_ai.ai_persona.allow_topic_mentions_help"],null],"large"]],[["default"],[[[[1,"\\n                "],[8,[30,32,["Checkbox"]],null,null,null],[1,"\\n              "]],[32]]]]],[1,"\\n\\n"],[41,[30,0,["chatPluginEnabled"]],[[[1,"                "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["allow_chat_direct_messages",[28,[32,3],["discourse_ai.ai_persona.allow_chat_direct_messages"],null],[28,[32,3],["discourse_ai.ai_persona.allow_chat_direct_messages_help"],null],"large"]],[["default"],[[[[1,"\\n                  "],[8,[30,33,["Checkbox"]],null,null,null],[1,"\\n                "]],[33]]]]],[1,"\\n\\n                "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["allow_chat_channel_mentions",[28,[32,3],["discourse_ai.ai_persona.allow_chat_channel_mentions"],null],[28,[32,3],["discourse_ai.ai_persona.allow_chat_channel_mentions_help"],null],"large"]],[["default"],[[[[1,"\\n                  "],[8,[30,34,["Checkbox"]],null,null,null],[1,"\\n                "]],[34]]]]],[1,"\\n"]],[]],null]],[]],null]],[]]],[1,"        "]],[]]]]],[1,"\\n\\n        "],[8,[30,2,["Actions"]],null,null,[["default"],[[[[1,"\\n          "],[8,[30,2,["Submit"]],null,null,null],[1,"\\n\\n"],[41,[51,[28,[32,16],[[30,1,["isNew"]],[30,1,["system"]]],null]],[[[1,"            "],[8,[30,2,["Button"]],[[24,0,"ai-persona-editor__export"]],[["@label","@action"],["discourse_ai.ai_persona.export",[30,0,["exportPersona"]]]],null],[1,"\\n            "],[8,[30,2,["Button"]],[[24,0,"btn-danger"]],[["@action","@label"],[[30,0,["delete"]],"discourse_ai.ai_persona.delete"]],null],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n      "]],[2,3]]]]],[1,"\\n    "],[13],[1,"\\n  "]],["@model","form","data","field","field","field","field","@personas","field","field","field","select","pixelValue","field","field","field","exCollection","exCollectionIdx","field","field","field","select","fts","field","field","field","field","field","field","field","field","field","field","field"],false,["if","each","-track-array","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-editor.js",scope:()=>[u.default,a.default,c.default,f.i18n,v.default,y.default,b.default,i.fn,d.gt,w.default,x.default,S.default,T.default,k.default,p.default,n.LinkTo,d.or],isStrictMode:!0}),this)}}e.default=j}),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-example",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","truth-helpers","discourse/helpers/d-icon","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static{dt7948.g(this.prototype,"collapsed",[s.tracked],function(){return!0})}#te=void dt7948.i(this,"collapsed")
get caretIcon(){return this.collapsed?"angle-right":"angle-down"}toggleExample(){this.collapsed=!this.collapsed}static{dt7948.n(this.prototype,"toggleExample",[a.action])}deletePair(){this.collapsed=!0,this.args.examplesCollection.remove(this.args.exampleNumber)}static{dt7948.n(this.prototype,"deletePair",[a.action])}get exampleTitle(){return(0,l.i18n)("discourse_ai.ai_persona.examples.collapsable_title",{number:this.args.exampleNumber+1})}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"VT1ymzpg",block:'[[[1,"\\n    "],[11,0],[24,"role","button"],[4,[32,0],["click",[30,0,["toggleExample"]]],null],[12],[1,"\\n      "],[10,1],[12],[1,[28,[32,1],[[30,0,["caretIcon"]]],null]],[13],[1,"\\n      "],[1,[30,0,["exampleTitle"]]],[1,"\\n    "],[13],[1,"\\n"],[41,[51,[30,0,["collapsed"]]],[[[1,"      "],[8,[30,1,["Collection"]],null,null,[["default"],[[[[1,"\\n        "],[8,[30,2,["Field"]],null,[["@title","@validation","@disabled"],[[28,[32,2],[[28,[32,3],["discourse_ai.ai_persona.examples.",[52,[28,[32,4],[[30,3],0],null],"user","model"]],null]],null],"required|length:1,5000",[30,4]]],[["default"],[[[[1,"\\n          "],[8,[30,5,["Textarea"]],null,null,null],[1,"\\n        "]],[5]]]]],[1,"\\n      "]],[2,3]]]]],[1,"\\n\\n"],[41,[51,[30,4]],[[[1,"        "],[8,[30,6,["Container"]],null,null,[["default"],[[[[1,"\\n          "],[8,[30,6,["Button"]],[[24,0,"ai-persona-editor__delete_example btn-danger"]],[["@action","@label"],[[30,0,["deletePair"]],"discourse_ai.ai_persona.examples.remove"]],null],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null]],[]],null],[1,"  "]],["@examplesCollection","exPair","pairIdx","@system","field","@form"],false,["unless","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-example.js",scope:()=>[o.on,r.default,l.i18n,i.concat,n.eq],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-list-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/routing","@ember/service","truth-helpers","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse/components/dropdown-menu","discourse/helpers/avatar","discourse/helpers/concat-class","discourse/helpers/d-icon","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","admin/components/admin-config-area-empty-list","admin/components/admin-filter-controls","float-kit/components/d-menu","discourse/plugins/discourse-ai/discourse/admin/models/ai-persona","discourse/plugins/discourse-ai/discourse/components/ai-persona-editor","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f,_,b,v,y,w,S,x,k){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const T=[{id:"table",label:"discourse_ai.layout.table",icon:"discourse-table"},{id:"card",label:"discourse_ai.layout.card",icon:"table"}]
class P extends t.default{static{dt7948.g(this.prototype,"adminPluginNavManager",[n.service])}#V=void dt7948.i(this,"adminPluginNavManager")
static{dt7948.g(this.prototype,"keyValueStore",[n.service])}#se=void dt7948.i(this,"keyValueStore")
static{dt7948.g(this.prototype,"capabilities",[n.service])}#ie=void dt7948.i(this,"capabilities")
static{dt7948.g(this.prototype,"dialog",[n.service])}#L=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"currentLayout",[s.tracked],function(){return T[0]})}#oe=void dt7948.i(this,"currentLayout")
constructor(){super(...arguments)
const e=this.keyValueStore.get("ai-persona-list-layout")
if(e){const t=T.find(t=>t.id===e)
t&&(this.currentLayout=t)}}get searchableProps(){return["name","description"]}get dropdownOptions(){let e=[]
return(this.args.personas?.content||[]).forEach(t=>{(t.features||[]).forEach(t=>{t?.module_name&&!e.includes(t.module_name)&&e.push(t.module_name)})}),e.sort(),[{value:"all",label:(0,_.i18n)("discourse_ai.ai_persona.filters.all_features"),filterFn:()=>!0},...e.map(e=>({value:e,label:(0,_.i18n)(`discourse_ai.features.${e}.name`),filterFn:t=>(t.features||[]).some(t=>t.module_name===e)}))]}async toggleEnabled(e){const t=e.enabled,s=!t
try{e.set("enabled",s),await e.save()}catch(i){e.set("enabled",t),(0,f.popupAjaxError)(i)}}static{dt7948.n(this.prototype,"toggleEnabled",[o.action])}onRegisterApi(e){this.dMenu=e}static{dt7948.n(this.prototype,"onRegisterApi",[o.action])}onLayoutSelect(e){const t=T.find(t=>t.id===e)
t&&(this.currentLayout=t,this.keyValueStore.set({key:"ai-persona-list-layout",value:e})),this.dMenu.close()}static{dt7948.n(this.prototype,"onLayoutSelect",[o.action])}importPersona(){const e=document.createElement("input")
e.type="file",e.accept=".json",e.style.display="none",e.onchange=e=>this.handleFileSelect(e),document.body.appendChild(e),e.click(),document.body.removeChild(e)}static{dt7948.n(this.prototype,"importPersona",[o.action])}handleFileSelect(e){const t=e.target.files[0]
if(!t)return
const s=new FileReader
s.onload=e=>{try{const t=JSON.parse(e.target.result)
this.uploadPersona(t)}catch{this.dialog.alert((0,_.i18n)("discourse_ai.ai_persona.import_error_not_json"))}},s.readAsText(t)}static{dt7948.n(this.prototype,"handleFileSelect",[o.action])}uploadPersona(e,t=!1){const s=e
return t&&(s.force=!0),(0,g.ajax)("/admin/plugins/discourse-ai/ai-personas/import.json",{type:"POST",data:JSON.stringify(s),contentType:"application/json"}).then(e=>{let t=w.default.create(e),s=this.args.personas.findBy("id",t.id)
s&&this.args.personas.removeObject(s),this.args.personas.insertAt(0,t)}).catch(t=>{422===t.jqXHR?.status?this.dialog.confirm({message:(0,_.i18n)("discourse_ai.ai_persona.import_error_conflict",{name:e.persona.name})+"\n"+t.jqXHR.responseJSON?.errors?.join("\n"),confirmButtonLabel:"discourse_ai.ai_persona.overwrite",didConfirm:()=>this.uploadPersona(e,!0)}):(0,f.popupAjaxError)(t)})}static{(0,x.setComponentTemplate)((0,k.createTemplateFactory)({id:"n0EhzpU8",block:'[[[1,"\\n    "],[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-personas"]],[28,[32,1],["discourse_ai.ai_persona.short_title"],null]]],null],[1,"\\n    "],[10,"section"],[14,0,"ai-persona-list-editor__current admin-detail"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[8,[32,2],null,[["@model","@personas"],[[30,1],[30,2]]],null],[1,"\\n"]],[]],[[[1,"        "],[8,[32,3],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[28,[32,1],["discourse_ai.ai_persona.short_title"],null],[28,[32,1],["discourse_ai.ai_persona.persona_description"],null],"https://meta.discourse.org/t/ai-bot-personas/306099"]],[["actions"],[[[[1,"\\n            "],[8,[30,3,["Default"]],[[24,0,"ai-persona-list-editor__import-button"]],[["@label","@action","@icon"],["discourse_ai.ai_persona.import",[30,0,["importPersona"]],"upload"]],null],[1,"\\n            "],[8,[30,3,["Primary"]],[[24,0,"ai-persona-list-editor__new-button"]],[["@label","@route","@icon"],["discourse_ai.ai_persona.new","adminPlugins.show.discourse-ai-personas.new","plus"]],null],[1,"\\n          "]],[3]]]]],[1,"\\n"],[41,[30,2],[[[1,"          "],[8,[32,4],null,[["@array","@searchableProps","@dropdownOptions","@inputPlaceholder","@noResultsMessage"],[[30,2,["content"]],[30,0,["searchableProps"]],[30,0,["dropdownOptions"]],[28,[32,1],["discourse_ai.ai_persona.filters.text"],null],[28,[32,1],["discourse_ai.ai_persona.filters.no_results"],null]]],[["actions","content"],[[[[1,"\\n"],[41,[30,0,["capabilities","viewport","md"]],[[[1,"                "],[8,[32,5],null,[["@modalForMobile","@autofocus","@identifier","@onRegisterApi","@triggerClass"],[true,true,"persona-list-layout",[30,0,["onRegisterApi"]],"btn-default btn-icon"]],[["trigger","content"],[[[[1,"\\n                    "],[1,[28,[32,6],[[30,0,["currentLayout","icon"]]],null]],[1,"\\n                  "]],[]],[[[1,"\\n                    "],[8,[32,7],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[32,8]],null]],null],null,[[[1,"                        "],[8,[30,4,["item"]],null,null,[["default"],[[[[1,"\\n                          "],[8,[32,9],[[24,0,"btn-transparent"]],[["@label","@icon","@action"],[[30,5,["label"]],[30,5,["icon"]],[28,[32,10],[[30,0,["onLayoutSelect"]],[30,5,["id"]]],null]]],null],[1,"\\n                        "]],[]]]]],[1,"\\n"]],[5]],null],[1,"                    "]],[4]]]]],[1,"\\n                  "]],[]]]]],[1,"\\n"]],[]],null],[1,"            "]],[]],[[[1,"\\n              "],[10,"table"],[15,0,[28,[32,11],["content-list ai-persona-list-editor d-admin-table",[28,[32,12],["--layout-",[30,0,["currentLayout","id"]]],null]],null]],[12],[1,"\\n                "],[10,"thead"],[12],[1,"\\n                  "],[10,"tr"],[12],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.ai_persona.name"],null]],[13],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.llms.short_title"],null]],[13],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.features.short_title"],null]],[13],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n                "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,6]],null]],null],null,[[[1,"                    "],[10,"tr"],[15,"data-persona-id",[30,7,["id"]]],[15,0,[28,[32,11],["ai-persona-list__row d-admin-row__content",[52,[30,7,["priority"]],"--priority"],[52,[30,7,["enabled"]],"--enabled"]],null]],[12],[1,"\\n                      "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n                        "],[10,0],[14,0,"ai-persona-list__name-with-description"],[12],[1,"\\n                          "],[10,"h3"],[14,0,"ai-persona-list__name"],[12],[1,"\\n"],[41,[30,7,["user"]],[[[1,"                              "],[1,[28,[32,13],[[30,7,["user"]]],[["imageSize"],["tiny"]]]],[1,"\\n"]],[]],null],[1,"                            "],[1,[30,7,["name"]]],[1,"\\n                          "],[13],[1,"\\n                          "],[10,0],[14,0,"ai-persona-list__description"],[12],[1,"\\n                            "],[1,[30,7,["description"]]],[1,"\\n                          "],[13],[1,"\\n                        "],[13],[1,"\\n                      "],[13],[1,"\\n                      "],[10,"td"],[14,0,"d-admin-row__llms"],[12],[1,"\\n"],[41,[30,7,["default_llm"]],[[[1,"                          "],[10,1],[14,0,"--card-label"],[12],[1,"\\n                            "],[1,[28,[32,1],["discourse_ai.ai_persona.llms_list"],null]],[1,"\\n                          "],[13],[1,"\\n                          "],[8,[32,9],[[24,0,"btn-flat btn-small ai-persona-list__row-item-feature"]],[["@translatedLabel","@route","@routeModels"],[[30,7,["default_llm","display_name"]],"adminPlugins.show.discourse-ai-llms.edit",[30,7,["default_llm","id"]]]],null],[1,"\\n"]],[]],null],[1,"                      "],[13],[1,"\\n                      "],[10,"td"],[14,0,"d-admin-row__features"],[12],[1,"\\n"],[41,[30,7,["features","length"]],[[[1,"                          "],[10,1],[14,0,"--card-label"],[12],[1,"\\n                            "],[1,[28,[32,1],["discourse_ai.ai_persona.features_list"],[["count"],[[30,7,["features","length"]]]]]],[1,"\\n                          "],[13],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,7,["features"]]],null]],null],null,[[[1,"                            "],[10,1],[14,0,"d-admin-row__row-feature-list"],[12],[1,"\\n                              "],[41,[28,[32,14],[[30,9],0],null],[[[1,", "]],[]],null],[1,"\\n                              "],[8,[32,9],[[24,0,"btn-flat btn-small ai-persona-list__row-item-feature"]],[["@translatedLabel","@route","@routeModels"],[[28,[32,1],[[28,[32,12],["discourse_ai.features.",[30,8,["module_name"]],".name"],null]],null],"adminPlugins.show.discourse-ai-features.edit",[30,8,["id"]]]],null],[1,"\\n                            "],[13],[1,"\\n"]],[8,9]],null]],[]],null],[1,"                      "],[13],[1,"\\n                      "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n                        "],[8,[32,15],[[24,0,"btn btn-text btn-small"]],[["@route","@model"],["adminPlugins.show.discourse-ai-personas.edit",[30,7]]],[["default"],[[[[1,[28,[32,1],["discourse_ai.ai_persona.edit"],null]],[1," "]],[]]]]],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n"]],[7]],null],[1,"                "],[13],[1,"\\n              "],[13],[1,"\\n            "]],[6]]]]],[1,"\\n"]],[]],[[[1,"          "],[8,[32,16],null,[["@ctaLabel","@ctaRoute","@ctaClass","@emptyLabel"],["discourse_ai.ai_persona.new","adminPlugins.show.discourse-ai-personas.new","ai-persona-list-editor__empty-new-button","discourse_ai.ai_persona.no_personas"]],null],[1,"\\n"]],[]]]],[]]],[1,"    "],[13],[1,"\\n  "]],["@currentPersona","@personas","actions","dropdown","button","filteredPersonas","persona","feature","index"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-list-editor.js",scope:()=>[l.default,_.i18n,S.default,u.default,v.default,y.default,h.default,c.default,T,d.default,i.fn,m.default,i.concat,p.default,r.gt,a.LinkTo,b.default],isStrictMode:!0}),this)}}e.default=P}),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-llm-selector",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/runloop","@ember/service","discourse-i18n","select-kit/components/dropdown-select-box","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const u="ai_persona_selector_id",c="ai_llm_selector_id"
class p extends t.default{static{dt7948.g(this.prototype,"currentUser",[a.service])}#k=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"keyValueStore",[a.service])}#se=void dt7948.i(this,"keyValueStore")
static{dt7948.g(this.prototype,"llm",[s.tracked])}#ae=void dt7948.i(this,"llm")
static{dt7948.g(this.prototype,"allowLLMSelector",[s.tracked],function(){return!0})}#ne=void dt7948.i(this,"allowLLMSelector")
constructor(){super(...arguments),this.botOptions?.length&&(this.#re(),this.#le(),(0,o.next)(()=>{this.resetTargetRecipients()}))}get composer(){return this.args?.outletArgs?.model}get hasLlmSelector(){return this.currentUser.ai_enabled_chat_bots.any(e=>!e.is_persona)}get botOptions(){if(!this.currentUser.ai_enabled_personas)return
let e=this.currentUser.ai_enabled_personas
return e=e.filter(e=>e.allow_personal_messages),this.hasLlmSelector||(e=e.filter(e=>e.username)),e.map(e=>({id:e.id,name:e.name,description:e.description}))}get filterable(){return this.botOptions.length>8}get value(){return this._value}set value(e){this._value=e,this.keyValueStore.setItem(u,e),this.args.setPersonaId(e),this.setAllowLLMSelector(),this.resetTargetRecipients()}setAllowLLMSelector(){if(!this.hasLlmSelector)return void(this.allowLLMSelector=!1)
const e=this.currentUser.ai_enabled_personas.find(e=>e.id===this._value)
this.allowLLMSelector=!e?.force_default_llm}get currentLlm(){return this.llm}set currentLlm(e){this.llm=e,this.keyValueStore.setItem(c,e),this.resetTargetRecipients()}resetTargetRecipients(){if(this.allowLLMSelector){const e=this.currentUser.ai_enabled_chat_bots.find(e=>e.id===this.llm).username
this.args.setTargetRecipient(e)}else{const e=this.currentUser.ai_enabled_personas.find(e=>e.id===this._value)
this.args.setTargetRecipient(e.username||"")}}get llmOptions(){return this.currentUser.ai_enabled_chat_bots.filter(e=>!e.is_persona).filter(Boolean).map(e=>({id:e.id,name:e.display_name})).sort((e,t)=>e.name.localeCompare(t.name))}get showLLMSelector(){return this.allowLLMSelector&&this.llmOptions.length>1}#de(){const e=this.args?.personaName
if(e){const t=this.botOptions.find(t=>t.name===e)
if(t)return t.id}}#ue(){const e=this.args?.llmName
if(e){const t=this.llmOptions.find(t=>t.name===e)
if(t)return t.id}}#re(){let e=this.#de()||this.keyValueStore.getItem(u)
this._value=this.botOptions[0].id,e&&(e=parseInt(e,10),this.botOptions.any(t=>t.id===e)&&(this._value=e)),this.args.setPersonaId(this._value)}#le(){if(this.setAllowLLMSelector(),this.hasLlmSelector){let e=this.#ue()||this.keyValueStore.getItem(c)
e&&(e=parseInt(e,10))
const t=this.llmOptions.find(t=>t.id===e)||this.llmOptions[0]
e=t?t.id:"",e&&(0,o.next)(()=>{this.currentLlm=e})}}static{(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"38qykDxh",block:'[[[1,"\\n    "],[10,0],[14,0,"persona-llm-selector"],[12],[1,"\\n      "],[10,0],[14,0,"persona-llm-selector__selection-wrapper gpt-persona"],[12],[1,"\\n"],[41,[30,1],[[[1,"          "],[10,"label"],[12],[1,[28,[32,0],["discourse_ai.ai_bot.persona"],null]],[13],[1,"\\n"]],[]],null],[1,"        "],[8,[32,1],[[24,0,"persona-llm-selector__persona-dropdown"]],[["@value","@content","@options"],[[30,0,["value"]],[30,0,["botOptions"]],[28,[32,2],null,[["icon","filterable"],[[52,[30,1],"angle-down","robot"],[30,0,["filterable"]]]]]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["showLLMSelector"]],[[[1,"        "],[10,0],[14,0,"persona-llm-selector__selection-wrapper llm-selector"],[12],[1,"\\n"],[41,[30,1],[[[1,"            "],[10,"label"],[12],[1,[28,[32,0],["discourse_ai.ai_bot.llm"],null]],[13],[1,"\\n"]],[]],null],[1,"          "],[8,[32,1],[[24,0,"persona-llm-selector__llm-dropdown"]],[["@value","@content","@options"],[[30,0,["currentLlm"]],[30,0,["llmOptions"]],[28,[32,2],null,[["icon"],[[52,[30,1],"angle-down","globe"]]]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],["@showLabels"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-llm-selector.js",scope:()=>[n.i18n,r.default,i.hash],isStrictMode:!0}),this)}}e.default=p}),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options",["exports","@glimmer/component","@ember/object","truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-llm-selector","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{get showToolOptions(){const e=this.args.allTools
return!(!e||!this.args.data.tools)&&this.args.data?.tools.any(t=>e.findBy("id",t)?.options)}get toolsMetadata(){const e={}
return this.args.allTools.map(t=>{e[t.id]={name:t.name,...t?.options}}),e}formObjectKeys(e){return e?Object.keys(e):[]}static{dt7948.n(this.prototype,"formObjectKeys",[s.action])}toolOptionKeys(e){const t=this.toolsMetadata[e]
if(!t)return[]
return Object.keys(t).filter(e=>"name"!==e)}static{dt7948.n(this.prototype,"toolOptionKeys",[s.action])}static{(0,n.setComponentTemplate)((0,r.createTemplateFactory)({id:"FyUiSBtg",block:'[[[1,"\\n"],[41,[30,0,["showToolOptions"]],[[[1,"      "],[8,[30,1,["Container"]],null,[["@title","@direction","@format"],[[28,[32,0],["discourse_ai.ai_persona.tool_options"],null],"column","full"]],[["default"],[[[[1,"\\n        "],[8,[30,1,["Object"]],null,[["@name","@title"],["toolOptions",[28,[32,0],["discourse_ai.ai_persona.tool_options"],null]]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[28,[30,0,["formObjectKeys"]],[[30,3]],null]],null]],null],null,[[[1,"            "],[10,0],[14,0,"ai-persona-editor__tool-options"],[12],[1,"\\n"],[44,[[28,[32,1],[[30,0,["toolsMetadata"]],[30,4]],null]],[[[1,"                "],[10,0],[14,0,"ai-persona-editor__tool-options-name"],[12],[1,"\\n                  "],[1,[30,5,["name"]]],[1,"\\n                "],[13],[1,"\\n                "],[8,[30,2,["Object"]],null,[["@name"],[[30,4]]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[28,[30,0,["toolOptionKeys"]],[[30,4]],null]],null]],null],null,[[[44,[[28,[32,1],[[30,5],[30,7]],null]],[[[1,"                      "],[8,[30,6,["Field"]],null,[["@name","@title","@helpText","@format"],[[30,7],[30,8,["name"]],[30,8,["description"]],"full"]],[["default"],[[[[1,"\\n"],[41,[28,[32,2],[[30,8,["type"]],"enum"],null],[[[1,"                          "],[8,[30,9,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,8,["values"]]],null]],null],null,[[[1,"                              "],[8,[30,10,["Option"]],null,[["@value"],[[30,11]]],[["default"],[[[[1,[30,11]]],[]]]]],[1,"\\n"]],[11]],null],[1,"                          "]],[10]]]]],[1,"\\n"]],[]],[[[41,[28,[32,2],[[30,8,["type"]],"llm"],null],[[[1,"                          "],[8,[30,9,["Custom"]],null,null,[["default"],[[[[1,"\\n                            "],[8,[32,3],null,[["@value","@llms","@onChange","@class"],[[30,9,["value"]],[30,12],[30,9,["set"]],"ai-persona-tool-option-editor__llms"]],null],[1,"\\n                          "]],[]]]]],[1,"\\n"]],[]],[[[41,[28,[32,2],[[30,8,["type"]],"boolean"],null],[[[1,"                          "],[8,[30,9,["Checkbox"]],null,null,null],[1,"\\n"]],[]],[[[1,"                          "],[8,[30,9,["Input"]],null,null,null],[1,"\\n                        "]],[]]]],[]]]],[]]],[1,"                      "]],[9]]]]],[1,"\\n"]],[8]]]],[7]],null],[1,"                "]],[6]]]]],[1,"\\n"]],[5]]],[1,"            "],[13],[1,"\\n"]],[4]],null],[1,"        "]],[2,3]]]]],[1,"\\n      "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],["@form","toolObj","optsPerTool","toolId","toolMeta","optionsObj","optionName","optionMeta","field","select","v","@llms"],false,["if","each","-track-array","let"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options.js",scope:()=>[o.i18n,s.get,i.eq,a.default],isStrictMode:!0}),this)}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/components/ai-post-helper-menu",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/will-destroy","@ember/service","ember-modifier","truth-helpers","discourse/components/cook-text","discourse/components/d-button","discourse/components/fast-edit","discourse/components/modal/fast-edit","discourse/helpers/concat-class","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/decorators","discourse/lib/text","discourse/lib/utilities","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-helper-loading","discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list","discourse/plugins/discourse-ai/discourse/lib/smooth-streamer","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f,_,b,v,y,w,S,x){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class k extends t.default{static{dt7948.g(this.prototype,"messageBus",[a.service])}#ce=void dt7948.i(this,"messageBus")
static{dt7948.g(this.prototype,"site",[a.service])}#y=void dt7948.i(this,"site")
static{dt7948.g(this.prototype,"modal",[a.service])}#j=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"siteSettings",[a.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"currentUser",[a.service])}#k=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"menu",[a.service])}#pe=void dt7948.i(this,"menu")
static{dt7948.g(this.prototype,"tooltip",[a.service])}#me=void dt7948.i(this,"tooltip")
static{dt7948.g(this.prototype,"menuState",[s.tracked],function(){return this.MENU_STATES.options})}#he=void dt7948.i(this,"menuState")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ge=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"suggestion",[s.tracked],function(){return""})}#fe=void dt7948.i(this,"suggestion")
static{dt7948.g(this.prototype,"customPromptValue",[s.tracked],function(){return""})}#O=void dt7948.i(this,"customPromptValue")
static{dt7948.g(this.prototype,"copyButtonIcon",[s.tracked],function(){return"copy"})}#_e=void dt7948.i(this,"copyButtonIcon")
static{dt7948.g(this.prototype,"copyButtonLabel",[s.tracked],function(){return"discourse_ai.ai_helper.post_options_menu.copy"})}#be=void dt7948.i(this,"copyButtonLabel")
static{dt7948.g(this.prototype,"showFastEdit",[s.tracked],function(){return!1})}#ve=void dt7948.i(this,"showFastEdit")
static{dt7948.g(this.prototype,"showAiButtons",[s.tracked],function(){return!0})}#ye=void dt7948.i(this,"showAiButtons")
static{dt7948.g(this.prototype,"streaming",[s.tracked],function(){return!1})}#we=void dt7948.i(this,"streaming")
static{dt7948.g(this.prototype,"lastSelectedOption",[s.tracked],function(){return null})}#Se=void dt7948.i(this,"lastSelectedOption")
static{dt7948.g(this.prototype,"isSavingFootnote",[s.tracked],function(){return!1})}#xe=void dt7948.i(this,"isSavingFootnote")
static{dt7948.g(this.prototype,"supportsAddFootnote",[s.tracked],function(){return this.args.data.supportsFastEdit})}#ke=void dt7948.i(this,"supportsAddFootnote")
static{dt7948.g(this.prototype,"smoothStreamer",[s.tracked],function(){return new w.default(()=>this.suggestion,e=>this.suggestion=e)})}#Te=void dt7948.i(this,"smoothStreamer")
MENU_STATES={options:"OPTIONS",loading:"LOADING",result:"RESULT"}
showFootnoteTooltip=(0,n.modifier)(e=>{if(this.supportsAddFootnote||this.streaming)return
const t=this.tooltip.register(e,{identifier:"cannot-add-footnote-tooltip",content:(0,b.i18n)("discourse_ai.ai_helper.post_options_menu.footnote_disabled"),placement:"top",triggers:"hover"})
return()=>{t.destroy()}})
static{dt7948.g(this.prototype,"_activeAiRequest",[s.tracked],function(){return null})}#Pe=void dt7948.i(this,"_activeAiRequest")
get footnoteDisabled(){return this.streaming||!this.supportsAddFootnote}get helperOptions(){let e=this.currentUser?.ai_helper_prompts
e=e.filter(e=>e.location.includes("post"))
const t=e.findIndex(e=>"custom_prompt"===e.name)
if(-1!==t){const s=e.splice(t,1)[0]
e.unshift(s)}return this._showUserCustomPrompts()||(e=e.filter(e=>"custom_prompt"!==e.name)),this.args.data.canEditPost||(e=e.filter(e=>"proofread"!==e.name)),e}get highlightedTextToggleIcon(){return this.showHighlightedText?"angle-double-left":"angle-double-right"}get allowInsertFootnote(){const e=this.siteSettings,t=this.args.data.canEditPost
return!!(e?.enable_markdown_footnotes&&e?.display_footnotes_inline&&t)&&"explain"===this.lastSelectedOption?.name}_showUserCustomPrompts(){return this.currentUser?.can_use_custom_prompts}_sanitizeForFootnote(e){return e=(e=(e=e.replace(/[\r\n]+/g," ")).replace(/^(#+)\s+/gm,"")).trim(),(0,f.sanitize)(e)}set progressChannel(e){this._progressChannel&&this.unsubscribe(),this._progressChannel=e,this.subscribe()}subscribe(){this.messageBus.subscribe(this._progressChannel,this._updateResult,0)}unsubscribe(){this._progressChannel&&(this.messageBus.unsubscribe(this._progressChannel,this._updateResult),this._progressChannel=null)}static{dt7948.n(this.prototype,"unsubscribe",[g.bind])}async _updateResult(e){this.streaming=!e.done,await this.smoothStreamer.updateResult(e,"result")}static{dt7948.n(this.prototype,"_updateResult",[g.bind])}toggleHighlightedTextPreview(){this.showHighlightedText=!this.showHighlightedText}static{dt7948.n(this.prototype,"toggleHighlightedTextPreview",[i.action])}async performAiSuggestion(e){this.menuState=this.MENU_STATES.loading,this.lastSelectedOption=e
const t=["explain","translate","custom_prompt"]
try{if(t.includes(e.name)){const t=await this._handleStreamedResult(e)
return void(this.progressChannel=t.progress_channel)}this._activeAiRequest=(0,m.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:e.name,text:this.args.data.quoteState.buffer,custom_prompt:this.customPromptValue}}),this._activeAiRequest.then(({suggestions:t})=>{if(this.suggestion=t[0].trim(),"proofread"===e.name)return this._handleProofreadOption()}).finally(()=>{this.loading=!1,this.menuState=this.MENU_STATES.result})}catch(s){(0,h.popupAjaxError)(s)}return this._activeAiRequest}static{dt7948.n(this.prototype,"performAiSuggestion",[i.action])}_handleStreamedResult(e){this.menuState=this.MENU_STATES.result
const t=this.menu.getByIdentifier("post-text-selection-toolbar")
t&&(t.options.placement="bottom")
return this._activeAiRequest=(0,m.ajax)("/discourse-ai/ai-helper/stream_suggestion",{method:"POST",data:{location:"post",mode:e.name,text:this.args.data.quoteState.buffer,post_id:this.args.data.quoteState.postId,custom_prompt:this.customPromptValue,client_id:this.messageBus.clientId}}),this._activeAiRequest}_handleProofreadOption(){return this.showAiButtons=!1,this.site.desktopView?void(this.showFastEdit=!0):this.modal.show(c.default,{model:{initialValue:this.args.data.quoteState.buffer,newValue:this.suggestion,post:this.args.data.post,close:this.closeFastEdit}})}cancelAiAction(){this._activeAiRequest&&(this._activeAiRequest.abort(),this._activeAiRequest=null,this.loading=!1,this.menuState=this.MENU_STATES.options)}static{dt7948.n(this.prototype,"cancelAiAction",[i.action])}copySuggestion(){this.suggestion?.length>0&&((0,_.clipboardCopy)(this.suggestion),this.copyButtonIcon="check",this.copyButtonLabel="discourse_ai.ai_helper.post_options_menu.copied",setTimeout(()=>{this.copyButtonIcon="copy",this.copyButtonLabel="discourse_ai.ai_helper.post_options_menu.copy"},3500))}static{dt7948.n(this.prototype,"copySuggestion",[i.action])}closeMenu(){return this.suggestion="",this.customPromptValue="",this.args.close()}static{dt7948.n(this.prototype,"closeMenu",[i.action])}async closeFastEdit(){this.showFastEdit=!1,await this.args.data.hideToolbar()}static{dt7948.n(this.prototype,"closeFastEdit",[i.action])}async insertFootnote(){if(this.isSavingFootnote=!0,this.allowInsertFootnote)try{const e=await(0,m.ajax)(`/posts/${this.args.data.post.id}`),t=this._sanitizeForFootnote(this.suggestion),s=(0,b.i18n)("discourse_ai.ai_helper.post_options_menu.footnote_credits"),i=`${this.args.data.quoteState.buffer} ^[${t} (${s})]`,o=e.raw.replace(this.args.data.quoteState.buffer,i)
await this.args.data.post.save({raw:o})}catch(e){(0,h.popupAjaxError)(e)}finally{this.isSavingFootnote=!1,await this.closeMenu()}}static{dt7948.n(this.prototype,"insertFootnote",[i.action])}static{(0,S.setComponentTemplate)((0,x.createTemplateFactory)({id:"uIh/QidT",block:'[[[1,"\\n"],[41,[28,[32,0],[[30,0,["site","mobileView"]],[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","options"]]],null]],null],[[[1,"      "],[10,0],[14,0,"ai-post-helper-menu__selected-text"],[12],[1,"\\n        "],[1,[30,1,["quoteState","buffer"]]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showAiButtons"]],[[[1,"      "],[10,0],[14,0,"ai-post-helper"],[12],[1,"\\n"],[41,[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","options"]]],null],[[[1,"          "],[8,[32,2],null,[["@options","@customPromptValue","@performAction","@shortcutVisible"],[[30,0,["helperOptions"]],[30,0,["customPromptValue"]],[30,0,["performAiSuggestion"]],false]],null],[1,"\\n"]],[]],[[[41,[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","loading"]]],null],[[[1,"          "],[8,[32,3],null,[["@cancel"],[[30,0,["cancelAiAction"]]]],null],[1,"\\n"]],[]],[[[41,[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","result"]]],null],[[[1,"          "],[11,0],[24,0,"ai-post-helper__suggestion"],[4,[32,4],[[30,0,["unsubscribe"]]],null],[12],[1,"\\n"],[41,[30,0,["suggestion"]],[[[1,"              "],[10,0],[15,0,[28,[32,5],[[52,[30,0,["smoothStreamer","isStreaming"]],"streaming"],"streamable-content","ai-post-helper__suggestion__text"],null]],[14,"dir","auto"],[12],[1,"\\n                "],[8,[32,6],[[24,0,"cooked"]],[["@rawText"],[[30,0,["smoothStreamer","renderedText"]]]],null],[1,"\\n              "],[13],[1,"\\n              "],[10,0],[14,0,"ai-post-helper__suggestion__buttons"],[12],[1,"\\n                "],[8,[32,7],[[24,0,"btn-flat ai-post-helper__suggestion__cancel"]],[["@icon","@label","@action"],["xmark","discourse_ai.ai_helper.post_options_menu.cancel",[30,0,["cancelAiAction"]]]],null],[1,"\\n                "],[8,[32,7],[[24,0,"btn-flat ai-post-helper__suggestion__copy"]],[["@icon","@label","@action","@disabled"],[[30,0,["copyButtonIcon"]],[30,0,["copyButtonLabel"]],[30,0,["copySuggestion"]],[30,0,["streaming"]]]],null],[1,"\\n"],[41,[30,0,["allowInsertFootnote"]],[[[1,"                  "],[8,[32,7],[[24,0,"btn-flat ai-post-helper__suggestion__insert-footnote"],[4,[30,0,["showFootnoteTooltip"]],null,null]],[["@icon","@label","@action","@isLoading","@disabled"],["asterisk","discourse_ai.ai_helper.post_options_menu.insert_footnote",[30,0,["insertFootnote"]],[30,0,["isSavingFootnote"]],[30,0,["footnoteDisabled"]]]],null],[1,"\\n"]],[]],null],[1,"              "],[13],[1,"\\n"]],[]],[[[1,"              "],[8,[32,3],null,[["@cancel"],[[30,0,["cancelAiAction"]]]],null],[1,"\\n"]],[]]],[1,"          "],[13],[1,"\\n        "]],[]],null]],[]]]],[]]],[1,"      "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showFastEdit"]],[[[1,"      "],[10,0],[14,0,"ai-post-helper__fast-edit"],[12],[1,"\\n        "],[8,[32,8],null,[["@initialValue","@newValue","@post","@close"],[[30,1,["quoteState","buffer"]],[30,0,["suggestion"]],[30,1,["post"]],[30,0,["closeFastEdit"]]]],null],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["@data"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-post-helper-menu.js",scope:()=>[r.and,r.eq,y.default,v.default,o.default,p.default,l.default,d.default,u.default],isStrictMode:!0}),this)}}e.default=k}),define("discourse/plugins/discourse-ai/discourse/components/ai-quota-duration-selector",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","discourse-i18n","select-kit/components/combo-box","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=[{id:"3600",seconds:3600,nameKey:"discourse_ai.llms.quotas.durations.hour"},{id:"21600",seconds:21600,nameKey:"discourse_ai.llms.quotas.durations.six_hours"},{id:"86400",seconds:86400,nameKey:"discourse_ai.llms.quotas.durations.day"},{id:"604800",seconds:604800,nameKey:"discourse_ai.llms.quotas.durations.week"},{id:"custom",nameKey:"discourse_ai.llms.quotas.durations.custom"}]
class u extends t.default{static{dt7948.g(this.prototype,"selectedPresetId",[s.tracked],function(){return"86400"})}#Ce=void dt7948.i(this,"selectedPresetId")
static{dt7948.g(this.prototype,"customHours",[s.tracked],function(){return null})}#je=void dt7948.i(this,"customHours")
constructor(){super(...arguments)
const e=this.args.value,t=d.find(t=>t.seconds===e)
t?this.selectedPresetId=t.id:(this.selectedPresetId="custom",this.customHours=Math.round(e/3600))}get presetOptions(){return d.map(e=>({id:e.id,name:(0,a.i18n)(e.nameKey),seconds:e.seconds}))}get isCustom(){return"custom"===this.selectedPresetId}get currentDurationSeconds(){return this.isCustom?this.customHours?3600*this.customHours:0:parseInt(this.selectedPresetId,10)}onPresetChange(e){this.selectedPresetId=e,this.updateValue()}static{dt7948.n(this.prototype,"onPresetChange",[o.action])}onCustomHoursChange(e){this.customHours=parseInt(e.target.value,10),this.updateValue()}static{dt7948.n(this.prototype,"onCustomHoursChange",[o.action])}updateValue(){this.args.onChange&&this.args.onChange(this.currentDurationSeconds)}static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"qzu/tJzR",block:'[[[1,"\\n    "],[10,0],[14,0,"duration-selector"],[12],[1,"\\n      "],[8,[32,0],[[24,0,"duration-selector__preset"]],[["@content","@value","@onChange"],[[30,0,["presetOptions"]],[30,0,["selectedPresetId"]],[30,0,["onPresetChange"]]]],null],[1,"\\n\\n"],[41,[30,0,["isCustom"]],[[[1,"        "],[10,0],[14,0,"duration-selector__custom"],[12],[1,"\\n          "],[11,"input"],[16,2,[30,0,["customHours"]]],[24,0,"duration-selector__hours-input"],[24,"min","1"],[24,4,"number"],[4,[32,1],["input",[30,0,["onCustomHoursChange"]]],null],[12],[13],[1,"\\n          "],[10,1],[14,0,"duration-selector__hours-label"],[12],[1,"\\n            "],[1,[28,[32,2],["discourse_ai.llms.quotas.hours"],null]],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-quota-duration-selector.js",scope:()=>[n.default,i.on,a.i18n],isStrictMode:!0}),this)}}e.default=u}),define("discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries-tooltip",["exports","@glimmer/component","@ember/service","discourse/components/d-button","discourse/helpers/d-icon","discourse-i18n","float-kit/components/d-tooltip","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static{dt7948.g(this.prototype,"discobotDiscoveries",[s.service])}#Me=void dt7948.i(this,"discobotDiscoveries")
static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"0UF2Kv3u",block:'[[[1,"\\n    "],[10,1],[14,0,"ai-search-discoveries-tooltip"],[12],[1,"\\n      "],[8,[32,0],null,[["@placement","@interactive"],["top-end",true]],[["trigger","content"],[[[[1,"\\n          "],[1,[28,[32,1],["circle-info"],null]],[1,"\\n        "]],[]],[[[1,"\\n          "],[10,0],[14,0,"ai-search-discoveries-tooltip__content"],[12],[1,"\\n            "],[10,0],[14,0,"ai-search-discoveries-tooltip__header"],[12],[1,"\\n              "],[1,[28,[32,2],["discourse_ai.discobot_discoveries.tooltip.header"],null]],[1,"\\n            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"ai-search-discoveries-tooltip__description"],[12],[1,"\\n"],[41,[30,0,["discobotDiscoveries","modelUsed"]],[[[1,"                "],[1,[28,[32,2],["discourse_ai.discobot_discoveries.tooltip.content"],[["model"],[[30,0,["discobotDiscoveries","modelUsed"]]]]]],[1,"\\n"]],[]],null],[1,"            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"ai-search-discoveries-tooltip__actions"],[12],[1,"\\n              "],[8,[32,3],[[24,0,"btn-transparent btn-primary"]],[["@label","@href"],["discourse_ai.discobot_discoveries.tooltip.actions.info","https://meta.discourse.org/t/conversational-ai-search-coming-to-discourse-ai/355939"]],null],[1,"\\n              "],[8,[32,3],[[24,0,"btn-transparent btn-danger"]],[["@label","@action"],["discourse_ai.discobot_discoveries.tooltip.actions.disable",[30,0,["discobotDiscoveries","disableDiscoveries"]]]],null],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n        "]],[]]]]],[1,"\\n    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries-tooltip.js",scope:()=>[n.default,o.default,a.i18n,i.default],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/runloop","@ember/service","discourse/components/cook-text","discourse/components/d-button","discourse/helpers/concat-class","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/decorators","discourse/lib/plugin-api","discourse/lib/url","discourse/models/topic","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/smooth-streamer","discourse/plugins/discourse-ai/discourse/components/ai-blinking-animation","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f,_,b,v,y,w,S,x){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class k extends t.default{static{dt7948.g(this.prototype,"search",[l.service])}#Ae=void dt7948.i(this,"search")
static{dt7948.g(this.prototype,"messageBus",[l.service])}#ce=void dt7948.i(this,"messageBus")
static{dt7948.g(this.prototype,"discobotDiscoveries",[l.service])}#Me=void dt7948.i(this,"discobotDiscoveries")
static{dt7948.g(this.prototype,"appEvents",[l.service])}#S=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"currentUser",[l.service])}#k=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"siteSettings",[l.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"composer",[l.service])}#x=void dt7948.i(this,"composer")
static{dt7948.g(this.prototype,"loadingConversationTopic",[s.tracked],function(){return!1})}#Oe=void dt7948.i(this,"loadingConversationTopic")
static{dt7948.g(this.prototype,"hideDiscoveries",[s.tracked],function(){return!1})}#Ee=void dt7948.i(this,"hideDiscoveries")
static{dt7948.g(this.prototype,"fullDiscoveryToggled",[s.tracked],function(){return!1})}#Ie=void dt7948.i(this,"fullDiscoveryToggled")
static{dt7948.g(this.prototype,"discoveryPreviewLength",[s.tracked],function(){return this.args.discoveryPreviewLength||150})}#Fe=void dt7948.i(this,"discoveryPreviewLength")
static{dt7948.g(this.prototype,"smoothStreamer",[s.tracked],function(){return new v.default(()=>this.discobotDiscoveries.discovery,e=>this.discobotDiscoveries.discovery=e)})}#Te=void dt7948.i(this,"smoothStreamer")
discoveryTimeout=null
constructor(){super(...arguments),this.appEvents.on("full-page-search:trigger-search",this,this.triggerDiscovery)}willDestroy(){super.willDestroy(...arguments),this.appEvents.off("full-page-search:trigger-search",this,this.triggerDiscovery)}detectSearch(){0===this.query?.length&&this.discobotDiscoveries.discovery?.length>0&&(this.discobotDiscoveries.resetDiscovery(),this.smoothStreamer.resetStreaming()),(0,g.withPluginApi)(e=>{e.addSearchMenuOnKeyDownCallback((e,t)=>{if(e)return this.discobotDiscoveries.lastQuery===this.query||"Enter"===t.key&&this.query&&this.triggerDiscovery(),!0})})}static{dt7948.n(this.prototype,"detectSearch",[h.bind])}async _updateDiscovery(e){this.query===e.query&&(this.discoveryTimeout&&(0,r.cancel)(this.discoveryTimeout),this.discobotDiscoveries.discovery||(this.discobotDiscoveries.discovery=""),this.discobotDiscoveries.modelUsed=e.model_used,this.discobotDiscoveries.loadingDiscoveries=!1,this.smoothStreamer.updateResult(e,"ai_discover_reply"))}static{dt7948.n(this.prototype,"_updateDiscovery",[h.bind])}unsubscribe(){this.messageBus.unsubscribe("/discourse-ai/ai-bot/discover",this._updateDiscovery)}static{dt7948.n(this.prototype,"unsubscribe",[h.bind])}subscribe(){this.messageBus.subscribe("/discourse-ai/ai-bot/discover",this._updateDiscovery)}static{dt7948.n(this.prototype,"subscribe",[h.bind])}get query(){return this.args?.searchTerm||this.search.activeGlobalSearchTerm}get toggleLabel(){return this.fullDiscoveryToggled?"discourse_ai.discobot_discoveries.collapse":"discourse_ai.discobot_discoveries.tell_me_more"}get toggleIcon(){return this.fullDiscoveryToggled?"chevron-up":""}get canShowExpandtoggle(){return!this.discobotDiscoveries.loadingDiscoveries&&this.smoothStreamer.renderedText.length>this.discoveryPreviewLength}get renderPreviewOnly(){return!this.fullDiscoveryToggled&&this.canShowExpandtoggle}get canContinueConversation(){const e=this.currentUser?.ai_enabled_personas
if(!e)return!1
if(this.discobotDiscoveries.discoveryTimedOut)return!1
const t=e.find(e=>e.id===parseInt(this.siteSettings?.ai_bot_discover_persona,10)),s=t?.username
return this.discobotDiscoveries.discovery?.length>0&&!this.smoothStreamer.isStreaming&&s}get continueConvoBtnLabel(){return this.loadingConversationTopic?"discourse_ai.discobot_discoveries.loading_convo":"discourse_ai.discobot_discoveries.continue_convo"}async triggerDiscovery(){if(0===this.query?.length)return this.discobotDiscoveries.resetDiscovery(),void this.smoothStreamer.resetStreaming()
if(this.discobotDiscoveries.lastQuery!==this.query){this.smoothStreamer.resetStreaming(),this.discobotDiscoveries.resetDiscovery(),this.hideDiscoveries=!1,this.discobotDiscoveries.loadingDiscoveries=!0,this.discoveryTimeout=(0,r.later)(this,this.timeoutDiscovery,1e4)
try{this.discobotDiscoveries.lastQuery=this.query,await(0,p.ajax)("/discourse-ai/ai-bot/discover",{data:{query:this.query}})}catch{this.hideDiscoveries=!0}}else this.hideDiscoveries=!1}static{dt7948.n(this.prototype,"triggerDiscovery",[i.action])}toggleDiscovery(){this.fullDiscoveryToggled=!this.fullDiscoveryToggled}static{dt7948.n(this.prototype,"toggleDiscovery",[i.action])}async continueConversation(){const e={user_id:this.currentUser.id,query:this.query,context:this.discobotDiscoveries.discovery}
try{this.loadingConversationTopic=!0
const t=await(0,p.ajax)("/discourse-ai/ai-bot/discover/continue-convo",{type:"POST",data:e}),s=await _.default.find(t.topic_id,{}),i=_.default.create(s)
f.default.routeTo(`/t/${t.topic_id}`,{afterRouteComplete:()=>{this.args.closeSearchMenu&&this.args.closeSearchMenu(),this.composer.focusComposer({topic:i})}})}catch(t){(0,m.popupAjaxError)(t)}finally{this.loadingConversationTopic=!1}}static{dt7948.n(this.prototype,"continueConversation",[i.action])}timeoutDiscovery(){this.discobotDiscoveries.discovery?.length>0||(this.discobotDiscoveries.loadingDiscoveries=!1,this.discobotDiscoveries.discovery="",this.discobotDiscoveries.discoveryTimedOut=!0)}static{(0,S.setComponentTemplate)((0,x.createTemplateFactory)({id:"beVZ2Biz",block:'[[[1,"\\n    "],[11,0],[24,0,"ai-search-discoveries"],[4,[32,0],[[30,0,["subscribe"]],[30,0,["query"]]],null],[4,[32,1],[[30,0,["subscribe"]],[30,0,["query"]]],null],[4,[32,1],[[30,0,["detectSearch"]],[30,0,["query"]]],null],[4,[32,0],[[30,0,["triggerDiscovery"]],[30,0,["query"]]],null],[4,[32,2],[[30,0,["unsubscribe"]]],null],[12],[1,"\\n      "],[10,0],[14,0,"ai-search-discoveries__completion"],[12],[1,"\\n"],[41,[30,0,["discobotDiscoveries","loadingDiscoveries"]],[[[1,"          "],[8,[32,3],null,null,null],[1,"\\n"]],[]],[[[41,[30,0,["discobotDiscoveries","discoveryTimedOut"]],[[[1,"          "],[1,[28,[32,4],["discourse_ai.discobot_discoveries.timed_out"],null]],[1,"\\n"]],[]],[[[1,"          "],[10,"article"],[15,0,[28,[32,5],["ai-search-discoveries__discovery",[52,[30,0,["renderPreviewOnly"]],"preview"],[52,[30,0,["smoothStreamer","isStreaming"]],"streaming"],"streamable-content"],null]],[12],[1,"\\n            "],[8,[32,6],[[24,0,"cooked"]],[["@rawText"],[[30,0,["smoothStreamer","renderedText"]]]],null],[1,"\\n          "],[13],[1,"\\n\\n"],[41,[30,0,["canShowExpandtoggle"]],[[[1,"            "],[8,[32,7],[[24,0,"btn-flat btn-text ai-search-discoveries__toggle"]],[["@label","@icon","@action"],[[30,0,["toggleLabel"]],[30,0,["toggleIcon"]],[30,0,["toggleDiscovery"]]]],null],[1,"\\n"]],[]],null],[1,"        "]],[]]]],[]]],[1,"      "],[13],[1,"\\n\\n"],[41,[30,0,["canContinueConversation"]],[[[1,"        "],[10,0],[14,0,"ai-search-discoveries__continue-conversation"],[12],[1,"\\n          "],[8,[32,7],[[24,0,"btn-small"]],[["@action","@label"],[[30,0,["continueConversation"]],[30,0,["continueConvoBtnLabel"]]]],[["default"],[[[[1,"\\n            "],[8,[32,8],null,[["@loading"],[[30,0,["loadingConversationTopic"]]]],null],[1,"\\n          "]],[]]]]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries.js",scope:()=>[o.default,a.default,n.default,y.default,b.i18n,c.default,d.default,u.default,w.default],isStrictMode:!0}),this)}}e.default=k}),define("discourse/plugins/discourse-ai/discourse/components/ai-sentiment-horizontal-bar",["exports","@ember/helper","@ember/template","truth-helpers","discourse-i18n","float-kit/components/d-tooltip","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,a,n,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=(0,n.setComponentTemplate)((0,r.createTemplateFactory)({id:"RxLInASj",block:'[[[1,"\\n"],[41,[28,[32,0],[[30,1],0],null],[[[1,"    "],[8,[32,1],[[16,0,[28,[32,2],["sentiment-horizontal-bar__",[30,2]],null]],[16,5,[28,[32,3],[[28,[32,2],["width: ",[30,3],"%"],null]],null]]],null,[["trigger","content"],[[[[1,"\\n        "],[10,1],[14,0,"sentiment-horizontal-bar__count"],[12],[1,"\\n          "],[1,[30,1]],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[1,[28,[32,4],[[28,[32,2],["discourse_ai.sentiments.sentiment_analysis.filter_types.",[30,2]],null]],null]],[1,":\\n        "],[1,[30,1]],[1,"\\n      "]],[]]]]],[1,"\\n"]],[]],null]],["@score","@type","@width"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-sentiment-horizontal-bar.js",scope:()=>[i.gt,a.default,t.concat,s.htmlSafe,o.i18n],isStrictMode:!0}),(0,l.default)(void 0,"ai-sentiment-horizontal-bar:AiSentimentHorizontalBar"))
e.default=d}),define("discourse/plugins/discourse-ai/discourse/components/ai-spam",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/routing","@ember/service","discourse/components/d-button","discourse/components/d-page-subheader","discourse/components/d-stat-tiles","discourse/components/d-toggle-switch","discourse/components/d-tooltip","discourse/helpers/d-icon","discourse/helpers/with-event-value","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/get-url","discourse-i18n","admin/components/admin-config-area-card","select-kit/components/combo-box","discourse/plugins/discourse-ai/discourse/components/modal/spam-test-modal","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f,_,b,v,y,w,S,x){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class k extends t.default{static{dt7948.g(this.prototype,"toasts",[r.service])}#R=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"modal",[r.service])}#j=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"stats",[s.tracked],function(){return{scanned_count:0,spam_detected:0,false_positives:0,false_negatives:0,daily_data:[]}})}#Re=void dt7948.i(this,"stats")
static{dt7948.g(this.prototype,"isEnabled",[s.tracked],function(){return!1})}#Le=void dt7948.i(this,"isEnabled")
static{dt7948.g(this.prototype,"selectedLLM",[s.tracked],function(){return null})}#De=void dt7948.i(this,"selectedLLM")
static{dt7948.g(this.prototype,"selectedPersonaId",[s.tracked],function(){return null})}#Ne=void dt7948.i(this,"selectedPersonaId")
static{dt7948.g(this.prototype,"customInstructions",[s.tracked],function(){return""})}#Ue=void dt7948.i(this,"customInstructions")
static{dt7948.g(this.prototype,"errors",[s.tracked],function(){return[]})}#qe=void dt7948.i(this,"errors")
constructor(){super(...arguments),this.initializeFromModel(),!1===this.args.model?.spam_scanning_user?.admin&&this.errors.push({message:(0,b.i18n)("discourse_ai.spam.errors.scan_not_admin.message"),button:{label:(0,b.i18n)("discourse_ai.spam.errors.scan_not_admin.action"),action:this.fixScanUserNotAdmin}})}async fixScanUserNotAdmin(){const e=this.args.model.spam_scanning_user
if(e&&!e.admin)try{(await(0,g.ajax)("/admin/plugins/discourse-ai/ai-spam/fix-errors",{type:"POST",data:{error:"spam_scanner_not_admin"}})).success&&this.toasts.success({data:{message:(0,b.i18n)("discourse_ai.spam.errors.resolved")},duration:"short"})}catch(t){(0,f.popupAjaxError)(t)}finally{window.location.reload()}}static{dt7948.n(this.prototype,"fixScanUserNotAdmin",[a.action])}initializeFromModel(){const e=this.args.model
this.isEnabled=e.is_enabled,e.llm_id?this.selectedLLM=e.llm_id:this.availableLLMs.length&&(this.selectedLLM=this.availableLLMs[0].id,this.autoSelectedLLM=!0),this.customInstructions=e.custom_instructions,this.stats=e.stats,this.selectedPersonaId=e.ai_persona_id}static{dt7948.n(this.prototype,"initializeFromModel",[a.action])}get availableLLMs(){return this.args.model?.available_llms||[]}async toggleEnabled(){this.isEnabled=!this.isEnabled
const e={is_enabled:this.isEnabled}
this.autoSelectedLLM&&(e.llm_model_id=this.llmId)
try{const t=await(0,g.ajax)("/admin/plugins/discourse-ai/ai-spam.json",{type:"PUT",data:e})
this.autoSelectedLLM=!1,this.isEnabled=t.is_enabled}catch(t){this.isEnabled=!this.isEnabled,(0,f.popupAjaxError)(t)}}static{dt7948.n(this.prototype,"toggleEnabled",[a.action])}get llmId(){return this.selectedLLM}async updateLLM(e){this.selectedLLM=e}static{dt7948.n(this.prototype,"updateLLM",[a.action])}async updatePersona(e){this.selectedPersonaId=e}static{dt7948.n(this.prototype,"updatePersona",[a.action])}async save(){try{await(0,g.ajax)("/admin/plugins/discourse-ai/ai-spam.json",{type:"PUT",data:{llm_model_id:this.llmId,custom_instructions:this.customInstructions,ai_persona_id:this.selectedPersonaId}}),this.toasts.success({data:{message:(0,b.i18n)("discourse_ai.spam.settings_saved")},duration:"short"})}catch(e){(0,f.popupAjaxError)(e)}}static{dt7948.n(this.prototype,"save",[a.action])}showTestModal(){this.modal.show(w.default,{model:{customInstructions:this.customInstructions,llmId:this.llmId}})}static{dt7948.n(this.prototype,"showTestModal",[a.action])}get metrics(){const e={label:(0,b.i18n)("discourse_ai.spam.spam_detected"),value:this.stats.spam_detected},t={label:(0,b.i18n)("discourse_ai.spam.false_positives"),value:this.stats.false_positives,tooltip:(0,b.i18n)("discourse_ai.spam.stat_tooltips.incorrectly_flagged")},s={label:(0,b.i18n)("discourse_ai.spam.false_negatives"),value:this.stats.false_negatives,tooltip:(0,b.i18n)("discourse_ai.spam.stat_tooltips.missed_spam")}
return this.args.model.flagging_username&&(e.href=(0,_.default)(`/review?flagged_by=${this.args.model.flagging_username}&status=all&sort_order=created_at`),t.href=(0,_.default)(`/review?flagged_by=${this.args.model.flagging_username}&status=rejected&sort_order=created_at`),s.href=(0,_.default)(`/review?status=approved&sort_order=created_at&additional_filters={"ai_spam_false_negative":true}&order=created&score_type=${this.args.model.spam_score_type}`)),[{label:(0,b.i18n)("discourse_ai.spam.scanned_count"),value:this.stats.scanned_count},e,t,s]}static{(0,S.setComponentTemplate)((0,x.createTemplateFactory)({id:"ezZxWZ3g",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-spam"],[12],[1,"\\n      "],[10,"section"],[14,0,"ai-spam__settings"],[12],[1,"\\n        "],[10,0],[14,0,"ai-spam__errors"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["errors"]]],null]],null],null,[[[1,"            "],[10,0],[14,0,"alert alert-error"],[12],[1,"\\n              "],[1,[28,[32,0],["triangle-exclamation"],null]],[1,"\\n              "],[10,2],[12],[1,[30,1,["message"]]],[13],[1,"\\n              "],[8,[32,1],null,[["@action","@translatedLabel"],[[30,1,["button","action"]],[30,1,["button","label"]]]],null],[1,"\\n            "],[13],[1,"\\n"]],[1]],null],[1,"        "],[13],[1,"\\n        "],[8,[32,2],null,[["@titleLabel","@descriptionLabel"],[[28,[32,3],["discourse_ai.spam.title"],null],[28,[32,3],["discourse_ai.spam.spam_description"],null]]],null],[1,"\\n        "],[10,0],[14,0,"control-group ai-spam__enabled"],[12],[1,"\\n          "],[8,[32,4],[[24,0,"ai-spam__toggle"],[4,[32,5],["click",[30,0,["toggleEnabled"]]],null]],[["@state","@label"],[[30,0,["isEnabled"]],"discourse_ai.spam.enable"]],null],[1,"\\n          "],[8,[32,6],null,[["@icon","@content"],["circle-question",[28,[32,3],["discourse_ai.spam.spam_tip"],null]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"ai-spam__llm"],[12],[1,"\\n          "],[10,"label"],[14,0,"ai-spam__llm-label"],[12],[1,[28,[32,3],["discourse_ai.spam.select_llm"],null]],[13],[1,"\\n"],[41,[30,0,["availableLLMs","length"]],[[[1,"            "],[8,[32,7],[[24,0,"ai-spam__llm-selector"]],[["@value","@content","@onChange"],[[30,0,["selectedLLM"]],[30,0,["availableLLMs"]],[30,0,["updateLLM"]]]],null],[1,"\\n"]],[]],[[[1,"            "],[10,1],[14,0,"ai-spam__llm-placeholder"],[12],[1,"\\n              "],[8,[32,8],null,[["@route"],["adminPlugins.show.discourse-ai-llms.index"]],[["default"],[[[[1,"\\n                "],[1,[28,[32,3],["discourse_ai.spam.no_llms"],null]],[1,"\\n              "]],[]]]]],[1,"\\n            "],[13],[1,"\\n"]],[]]],[1,"        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"ai-spam__persona"],[12],[1,"\\n          "],[10,"label"],[14,0,"ai-spam__persona-label"],[12],[1,[28,[32,3],["discourse_ai.spam.select_persona"],null]],[13],[1,"\\n          "],[8,[32,7],[[24,0,"ai-spam__persona-selector"]],[["@value","@content","@onChange"],[[30,0,["selectedPersonaId"]],[30,2,["available_personas"]],[30,0,["updatePersona"]]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"ai-spam__instructions"],[12],[1,"\\n          "],[10,"label"],[14,0,"ai-spam__instructions-label"],[12],[1,"\\n            "],[1,[28,[32,3],["discourse_ai.spam.custom_instructions"],null]],[1,"\\n            "],[8,[32,6],null,[["@icon","@content"],["circle-question",[28,[32,3],["discourse_ai.spam.custom_instructions_help"],null]]],null],[1,"\\n          "],[13],[1,"\\n          "],[11,"textarea"],[24,0,"ai-spam__instructions-input"],[16,"placeholder",[28,[32,3],["discourse_ai.spam.custom_instructions_placeholder"],null]],[4,[32,5],["input",[28,[32,9],[[28,[32,10],[[28,[31,3],[[30,0,["customInstructions"]]],null]],null]],null]],null],[12],[1,[30,0,["customInstructions"]]],[13],[1,"\\n          "],[8,[32,1],[[24,0,"ai-spam__instructions-save btn-primary"]],[["@action","@label"],[[30,0,["save"]],"discourse_ai.spam.save_button"]],null],[1,"\\n          "],[8,[32,1],[[24,0,"btn-default"]],[["@action","@label"],[[30,0,["showTestModal"]],"discourse_ai.spam.test_button"]],null],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n\\n      "],[8,[32,11],[[24,0,"ai-spam__stats"]],[["@heading"],["discourse_ai.spam.last_seven_days"]],[["content"],[[[[1,"\\n          "],[8,[32,12],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["metrics"]]],null]],null],null,[[[1,"              "],[8,[30,3,["Tile"]],null,[["@label","@url","@value","@tooltip"],[[30,4,["label"]],[30,4,["href"]],[30,4,["value"]],[30,4,["tooltip"]]]],null],[1,"\\n"]],[4]],null],[1,"          "]],[3]]]]],[1,"\\n        "]],[]]]]],[1,"\\n    "],[13],[1,"\\n  "]],["e","@model","tiles","metric"],false,["each","-track-array","if","mut"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-spam.js",scope:()=>[m.default,l.default,d.default,b.i18n,c.default,o.on,p.default,y.default,n.LinkTo,h.default,i.fn,v.default,u.default],isStrictMode:!0}),this)}}e.default=k}),define("discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","truth-helpers","discourse/components/d-button","discourse/helpers/category-badge","discourse/lib/ajax","discourse/lib/ajax-error","float-kit/components/d-menu","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static{dt7948.g(this.prototype,"site",[n.service])}#y=void dt7948.i(this,"site")
static{dt7948.g(this.prototype,"suggestions",[s.tracked],function(){return[]})}#Be=void dt7948.i(this,"suggestions")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ge=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"icon",[s.tracked],function(){return"discourse-sparkles"})}#ze=void dt7948.i(this,"icon")
SUGGESTION_TYPES={title:"suggest_title",category:"suggest_category",tag:"suggest_tags"}
get input(){return this.args.selectedPosts.map(e=>e.cooked).join("\n")}get disabled(){return this.loading||this.suggestions.length>0}loadSuggestions(){this.loading||this.suggestions.length>0||(this.loading=!0,(0,u.ajax)(`/discourse-ai/ai-helper/${this.args.mode}`,{method:"POST",data:{text:this.input}}).then(e=>{if(this.args.mode===this.SUGGESTION_TYPES.title)this.suggestions=e.suggestions
else if(this.args.mode===this.SUGGESTION_TYPES.category){const t=e.assistant.map(e=>e.id),s=this.site.categories.filter(e=>t.includes(e.id))
this.suggestions=s}else this.args.mode===this.SUGGESTION_TYPES.tag&&(this.suggestions=e.assistant.map(e=>({name:e.name,count:e.count})))}).catch(c.popupAjaxError).finally(()=>{this.loading=!1}))}static{dt7948.n(this.prototype,"loadSuggestions",[a.action])}applySuggestion(e,t){if(this.args.mode){if(this.args.mode===this.SUGGESTION_TYPES.title)return this.args.updateAction(e),t.close()
if(this.args.mode===this.SUGGESTION_TYPES.category)return this.args.updateAction(e.id),t.close()
if(this.args.mode===this.SUGGESTION_TYPES.tag){if(this.args.currentValue)if(Array.isArray(this.args.currentValue)){const t=[...this.args.currentValue,e]
this.args.updateAction([...new Set(t)])}else{const t=[this.args.currentValue,e]
this.args.updateAction([...new Set(t)])}else Array.isArray(e)?this.args.updateAction([...e]):this.args.updateAction([e])
return t.close()}}}static{dt7948.n(this.prototype,"applySuggestion",[a.action])}static{(0,m.setComponentTemplate)((0,h.createTemplateFactory)({id:"4ZszHd3J",block:'[[[1,"\\n"],[41,[30,0,["loading"]],[[[1,"      "],[8,[32,0],[[24,0,"ai-split-topic-loading-placeholder"]],[["@disabled","@icon"],[true,"spinner"]],null],[1,"\\n"]],[]],null],[1,"    "],[8,[32,1],[[24,0,"ai-split-topic-suggestion-button"],[16,"data-suggestion-mode",[30,1]],[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@icon","@interactive","@identifier"],["discourse-sparkles",true,"ai-split-topic-suggestion-menu"]],[["default"],[[[[1,"\\n      "],[10,"ul"],[14,0,"ai-split-topic-suggestion__results"],[12],[1,"\\n"],[41,[51,[30,0,["loading"]]],[[[42,[28,[31,3],[[28,[31,3],[[30,0,["suggestions"]]],null]],null],null,[[[41,[28,[32,3],[[30,1],"suggest_category"],null],[[[1,"              "],[11,"li"],[16,"data-name",[30,3,["name"]]],[16,"data-value",[30,3,["id"]]],[24,0,"ai-split-topic-suggestion__category-result"],[24,"role","button"],[4,[32,2],["click",[28,[32,4],[[30,0,["applySuggestion"]],[30,3],[30,2]],null]],null],[12],[1,"\\n                "],[1,[28,[32,5],[[30,3]],null]],[1,"\\n                "],[10,1],[14,0,"topic-count"],[12],[1,"x\\n                  "],[1,[30,3,["totalTopicCount"]]],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[41,[28,[32,3],[[30,1],"suggest_tags"],null],[[[1,"              "],[10,"li"],[15,"data-name",[30,3,["name"]]],[15,"data-value",[30,4]],[12],[1,"\\n                "],[8,[32,0],null,[["@translatedLabel","@action"],[[30,3,["name"]],[28,[32,4],[[30,0,["applySuggestion"]],[30,3,["name"]],[30,2]],null]]],[["default"],[[[[1,"\\n                  "],[10,1],[14,0,"topic-count"],[12],[1,"x"],[1,[30,3,["count"]]],[13],[1,"\\n                "]],[]]]]],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[1,"              "],[10,"li"],[15,"data-name",[30,3]],[15,"data-value",[30,4]],[12],[1,"\\n                "],[8,[32,0],null,[["@translatedLabel","@action"],[[30,3],[28,[32,4],[[30,0,["applySuggestion"]],[30,3],[30,2]],null]]],null],[1,"\\n              "],[13],[1,"\\n            "]],[]]]],[]]]],[3,4]],null]],[]],null],[1,"      "],[13],[1,"\\n    "]],[2]]]]],[1,"\\n  "]],["@mode","menu","suggestion","index"],false,["if","unless","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester.js",scope:()=>[l.default,p.default,o.on,r.eq,i.fn,d.default],isStrictMode:!0}),this)}}e.default=g}),define("discourse/plugins/discourse-ai/discourse/components/ai-summary-skeleton",["exports","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-blinking-animation","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,a,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const r=(0,o.setComponentTemplate)((0,a.createTemplateFactory)({id:"ndQrZh9f",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-summary__container"],[12],[1,"\\n    "],[8,[32,0],null,null,null],[1,"\\n\\n    "],[10,1],[12],[1,"\\n      "],[10,0],[14,0,"ai-summary__generating-text"],[12],[1,"\\n        "],[1,[28,[32,1],["summary.in_progress"],null]],[1,"\\n      "],[13],[1,"\\n      "],[8,[32,2],null,[["@loading"],[true]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-summary-skeleton.js",scope:()=>[s.default,t.i18n,i.default],isStrictMode:!0}),(0,n.default)(void 0,"ai-summary-skeleton:AiSummarySkeleton"))
e.default=r}),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-editor-form",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/service","truth-helpers","discourse/components/form","discourse/lib/ajax-error","discourse/lib/get-url","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal","discourse/plugins/discourse-ai/discourse/components/rag-options-fk","discourse/plugins/discourse-ai/discourse/components/rag-uploader","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static{dt7948.g(this.prototype,"modal",[a.service])}#j=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"siteSettings",[a.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"dialog",[a.service])}#L=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"router",[a.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"toasts",[a.service])}#R=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"uploadedFiles",[s.tracked],function(){return[]})}#He=void dt7948.i(this,"uploadedFiles")
static{dt7948.g(this.prototype,"isSaving",[s.tracked],function(){return!1})}#N=void dt7948.i(this,"isSaving")
PARAMETER_TYPES=[{name:"string",id:"string"},{name:"number",id:"number"},{name:"boolean",id:"boolean"},{name:"array",id:"array"}]
get formData(){const e=(this.args.editingModel.parameters??[]).map(e=>{const t={...e}
return t.isEnum=e.enum&&e.enum.length>0,t.isEnum||delete t.enum,t})
return{name:this.args.editingModel.name||"",tool_name:this.args.editingModel.tool_name||"",description:this.args.editingModel.description||"",summary:this.args.editingModel.summary||"",parameters:e,script:this.args.editingModel.script||"",rag_uploads:this.args.editingModel.rag_uploads||[]}}toggleIsEnum(e,{name:t,parentName:s,set:i}){i(`${s}.enum`,e?[""]:[]),i(t,e)}static{dt7948.n(this.prototype,"toggleIsEnum",[o.action])}async save(e){this.isSaving=!0
const t=JSON.parse(JSON.stringify(e))
t.parameters&&t.parameters.forEach(e=>{e.isEnum||delete e.enum,delete e.isEnum})
try{await this.args.model.save(t),this.toasts.success({data:{message:(0,u.i18n)("discourse_ai.tools.saved")},duration:"short"}),this.args.tools.any(e=>e.id===this.args.model.id)||this.args.tools.pushObject(this.args.model),await this.router.replaceWith("adminPlugins.show.discourse-ai-tools.edit",this.args.model)}catch(s){(0,l.popupAjaxError)(s)}finally{this.isSaving=!1}}static{dt7948.n(this.prototype,"save",[o.action])}delete(){return this.dialog.confirm({message:(0,u.i18n)("discourse_ai.tools.confirm_delete"),didConfirm:async()=>{await this.args.model.destroyRecord(),this.args.tools.removeObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-tools.index")}})}static{dt7948.n(this.prototype,"delete",[o.action])}updateUploads(e,t){const s=t.filter(e=>!this.uploadedFiles.some(t=>t.id===e.id))
e("rag_uploads",s),this.uploadedFiles=[...this.uploadedFiles,...s]}static{dt7948.n(this.prototype,"updateUploads",[o.action])}removeUpload(e,t){this.uploadedFiles=this.uploadedFiles.filter(e=>e.id!==t.id),e.set("rag_uploads",this.uploadedFiles)}static{dt7948.n(this.prototype,"removeUpload",[o.action])}openTestModal(){this.modal.show(c.default,{model:{tool:this.args.editingModel}})}static{dt7948.n(this.prototype,"openTestModal",[o.action])}currentParameterSelection(e,t){return e.parameters[t].type}get ragUploadsDescription(){return this.siteSettings.rag_images_enabled?(0,u.i18n)("discourse_ai.rag.uploads.description_with_images"):(0,u.i18n)("discourse_ai.rag.uploads.description")}exportTool(){const e=`/admin/plugins/discourse-ai/ai-tools/${this.args.model.id}/export.json`
window.location.href=(0,d.default)(e)}static{dt7948.n(this.prototype,"exportTool",[o.action])}static{(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"kA857xo2",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-tool-editor"]],[["@onSubmit","@data"],[[30,0,["save"]],[30,0,["formData"]]]],[["default"],[[[[1,"\\n"],[1,"      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip"],["name",[28,[32,1],["discourse_ai.tools.name"],null],"required|length:1,100","large",[28,[32,1],["discourse_ai.tools.name_help"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,3,["Input"]],[[24,0,"ai-tool-editor__name"]],null,null],[1,"\\n      "]],[3]]]]],[1,"\\n\\n"],[1,"      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip"],["tool_name",[28,[32,1],["discourse_ai.tools.tool_name"],null],"required|length:1,100","large",[28,[32,1],["discourse_ai.tools.tool_name_help"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,4,["Input"]],[[24,0,"ai-tool-editor__tool_name"]],null,null],[1,"\\n      "]],[4]]]]],[1,"\\n\\n"],[1,"      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip"],["description",[28,[32,1],["discourse_ai.tools.description"],null],"required|length:1,1000","full",[28,[32,1],["discourse_ai.tools.description_help"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,5,["Textarea"]],[[24,0,"ai-tool-editor__description"],[16,"placeholder",[28,[32,1],["discourse_ai.tools.description_help"],null]]],[["@height"],[60]],null],[1,"\\n      "]],[5]]]]],[1,"\\n\\n"],[1,"      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip"],["summary",[28,[32,1],["discourse_ai.tools.summary"],null],"required|length:1,255","large",[28,[32,1],["discourse_ai.tools.summary_help"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,6,["Input"]],[[24,0,"ai-tool-editor__summary"]],null,null],[1,"\\n      "]],[6]]]]],[1,"\\n\\n"],[1,"      "],[8,[30,1,["Collection"]],null,[["@name"],["parameters"]],[["default"],[[[[1,"\\n        "],[8,[30,1,["Container"]],[[24,0,"ai-tool-parameter"]],null,[["default"],[[[[1,"\\n          "],[8,[30,1,["Row"]],null,null,[["default"],[[[[1,"\\n            "],[8,[30,10,["Col"]],null,[["@size"],[6]],[["default"],[[[[1,"\\n              "],[8,[30,7,["Field"]],null,[["@name","@title","@validation","@format"],["name",[28,[32,1],["discourse_ai.tools.parameter_name"],null],"required|length:1,100","full"]],[["default"],[[[[1,"\\n                "],[8,[30,11,["Input"]],null,null,null],[1,"\\n              "]],[11]]]]],[1,"\\n            "]],[]]]]],[1,"\\n\\n            "],[8,[30,10,["Col"]],null,[["@size"],[6]],[["default"],[[[[1,"\\n              "],[8,[30,7,["Field"]],null,[["@name","@title","@validation","@format"],["type",[28,[32,1],["discourse_ai.tools.parameter_type"],null],"required","full"]],[["default"],[[[[1,"\\n                "],[8,[30,12,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["PARAMETER_TYPES"]]],null]],null],null,[[[1,"                    "],[8,[30,13,["Option"]],null,[["@value"],[[30,14,["id"]]]],[["default"],[[[[1,[30,14,["name"]]]],[]]]]],[1,"\\n"]],[14]],null],[1,"                "]],[13]]]]],[1,"\\n              "]],[12]]]]],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[10]]]]],[1,"\\n\\n          "],[8,[30,1,["Row"]],null,null,[["default"],[[[[1,"\\n            "],[8,[30,15,["Col"]],null,[["@size"],[12]],[["default"],[[[[1,"\\n              "],[8,[30,7,["Field"]],null,[["@name","@title","@validation","@format"],["description",[28,[32,1],["discourse_ai.tools.parameter_description"],null],"required|length:1,1000","full"]],[["default"],[[[[1,"\\n                "],[8,[30,16,["Input"]],[[24,0,"ai-tool-editor__parameter-description"]],null,null],[1,"\\n              "]],[16]]]]],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[15]]]]],[1,"\\n\\n          "],[8,[30,1,["Row"]],null,null,[["default"],[[[[1,"\\n            "],[8,[30,17,["Col"]],null,null,[["default"],[[[[1,"\\n              "],[8,[30,7,["Field"]],null,[["@name","@title"],["required","Required"]],[["default"],[[[[1,"\\n                "],[8,[30,18,["Checkbox"]],null,null,null],[1,"\\n              "]],[18]]]]],[1,"\\n            "]],[]]]]],[1,"\\n\\n            "],[8,[30,17,["Col"]],null,null,[["default"],[[[[1,"\\n              "],[8,[30,7,["Field"]],null,[["@name","@title","@onSet"],["isEnum","Enum",[30,0,["toggleIsEnum"]]]],[["default"],[[[[1,"\\n                "],[8,[30,19,["Checkbox"]],null,null,null],[1,"\\n              "]],[19]]]]],[1,"\\n            "]],[]]]]],[1,"\\n\\n"],[41,[30,9,["isEnum"]],[[[1,"              "],[8,[30,17,["Col"]],null,[["@size"],[8]],[["default"],[[[[1,"\\n                "],[8,[30,7,["Collection"]],null,[["@name"],["enum"]],[["default"],[[[[1,"\\n                  "],[8,[30,1,["Container"]],[[24,0,"ai-tool-parameter__enum-values"]],null,[["default"],[[[[1,"\\n                    "],[8,[30,20,["Field"]],null,[["@title","@validation"],[[28,[32,1],["discourse_ai.tools.enum_value"],null],"required"]],[["default"],[[[[1,"\\n                      "],[8,[30,22,["Input"]],null,null,null],[1,"\\n\\n"],[41,[28,[32,2],[[28,[32,3],[[30,9,["enum","length"]],1],null],[28,[32,3],[[30,21],0],null]],null],[[[1,"                        "],[8,[30,1,["Button"]],[[24,0,"btn-danger"]],[["@icon","@action"],["trash-can",[28,[32,4],[[30,20,["remove"]],[30,21]],null]]],null],[1,"\\n"]],[]],null],[1,"                    "]],[22]]]]],[1,"\\n                  "]],[]]]]],[1,"\\n                "]],[20,21]]]]],[1,"\\n              "]],[]]]]],[1,"\\n\\n              "],[8,[30,17,["Col"]],null,[["@size"],[8]],[["default"],[[[[1,"\\n                "],[8,[30,1,["Button"]],null,[["@icon","@label","@action"],["plus","discourse_ai.tools.add_enum_value",[28,[32,4],[[30,1,["addItemToCollection"]],[28,[32,5],["parameters.",[30,8],".enum"],null],""],null]]],null],[1,"\\n              "]],[]]]]],[1,"\\n"]],[]],null],[1,"          "]],[17]]]]],[1,"\\n          "],[8,[30,1,["Row"]],null,null,[["default"],[[[[1,"\\n            "],[8,[30,23,["Col"]],[[24,0,"ai-tool-parameter-actions"]],null,[["default"],[[[[1,"\\n              "],[8,[30,1,["Button"]],[[24,0,"btn-danger"]],[["@label","@icon","@action"],["discourse_ai.tools.remove_parameter","trash-can",[28,[32,4],[[30,7,["remove"]],[30,8]],null]]],null],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[23]]]]],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[7,8,9]]]]],[1,"\\n\\n      "],[8,[30,1,["Button"]],null,[["@icon","@label","@action"],["plus","discourse_ai.tools.add_parameter",[28,[32,4],[[30,1,["addItemToCollection"]],"parameters",[28,[32,6],null,[["name","type","description","required","isEnum"],["","string","",false,false]]]],null]]],null],[1,"\\n\\n"],[1,"      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format"],["script",[28,[32,1],["discourse_ai.tools.script"],null],"required|length:1,100000","full"]],[["default"],[[[[1,"\\n        "],[8,[30,24,["Code"]],null,[["@lang","@height"],["javascript",600]],null],[1,"\\n      "]],[24]]]]],[1,"\\n\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"        "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_uploads",[28,[32,1],["discourse_ai.rag.uploads.title"],null],[30,0,["ragUploadsDescription"]],"full"]],[["default"],[[[[1,"\\n          "],[8,[30,25,["Custom"]],null,null,[["default"],[[[[1,"\\n            "],[8,[32,7],null,[["@target","@updateUploads","@onRemove","@allowImages"],[[30,26],[28,[32,4],[[30,0,["updateUploads"]],[30,1,["addItemToCollection"]]],null],[28,[32,4],[[30,0,["removeUpload"]],[30,1]],null],[30,27,["rag_images_enabled"]]]],null],[1,"\\n            "],[8,[32,8],null,[["@form","@data","@llms","@allowImages"],[[30,1],[30,2],[30,28],[30,27,["rag_images_enabled"]]]],null],[1,"\\n          "]],[]]]]],[1,"\\n        "]],[25]]]]],[1,"\\n"]],[]],null],[1,"\\n      "],[8,[30,1,["Actions"]],null,null,[["default"],[[[[1,"\\n"],[41,[51,[30,29]],[[[1,"          "],[8,[30,1,["Button"]],[[24,0,"ai-tool-editor__test-button"]],[["@label","@action"],["discourse_ai.tools.test",[30,0,["openTestModal"]]]],null],[1,"\\n          "],[8,[30,1,["Button"]],[[24,0,"ai-tool-editor__export"]],[["@label","@action"],["discourse_ai.tools.export",[30,0,["exportTool"]]]],null],[1,"\\n          "],[8,[30,1,["Button"]],[[24,0,"btn-danger ai-tool-editor__delete"]],[["@label","@icon","@action"],["discourse_ai.tools.delete","trash-can",[30,0,["delete"]]]],null],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[30,1,["Submit"]],[[24,0,"ai-tool-editor__save"]],[["@label"],["discourse_ai.tools.save"]],null],[1,"\\n      "]],[]]]]],[1,"\\n    "]],[1,2]]]]],[1,"\\n  "]],["form","data","field","field","field","field","collection","index","collectionData","row","field","field","select","type","row","field","row","field","field","child","childIndex","field","row","field","field","@editingModel","@settings","@llms","@isNew"],false,["each","-track-array","if","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-editor-form.js",scope:()=>[r.default,u.i18n,n.and,n.gt,i.fn,i.concat,i.hash,m.default,p.default],isStrictMode:!0}),this)}}e.default=f}),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-editor",["exports","@glimmer/component","@ember/service","discourse/components/back-button","discourse/plugins/discourse-ai/discourse/components/ai-tool-editor-form","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static{dt7948.g(this.prototype,"store",[s.service])}#D=void dt7948.i(this,"store")
get selectedPreset(){return this.args.selectedPreset?this.args.presets.findBy("preset_id",this.args.selectedPreset):this.args.presets.findBy("preset_id","empty_tool")}get editingModel(){return this.args.model.isNew?this.store.createRecord("ai-tool",this.selectedPreset):this.args.model}static{(0,a.setComponentTemplate)((0,n.createTemplateFactory)({id:"+YeIg+yc",block:'[[[1,"\\n    "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-tools","discourse_ai.tools.back"]],null],[1,"\\n\\n    "],[8,[32,1],null,[["@model","@tools","@editingModel","@isNew","@selectedPreset"],[[30,1],[30,2],[30,0,["editingModel"]],[30,1,["isNew"]],[30,0,["selectedPreset"]]]],null],[1,"\\n  "]],["@model","@tools"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-editor.js",scope:()=>[i.default,o.default],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-list-editor",["exports","@glimmer/component","@ember/helper","@ember/object","@ember/routing","@ember/service","truth-helpers","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse/components/dropdown-menu","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","admin/components/admin-config-area-empty-list","float-kit/components/d-menu","discourse/plugins/discourse-ai/discourse/admin/models/ai-tool","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f,_,b){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class v extends t.default{static{dt7948.g(this.prototype,"adminPluginNavManager",[a.service])}#V=void dt7948.i(this,"adminPluginNavManager")
static{dt7948.g(this.prototype,"router",[a.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"dialog",[a.service])}#L=void dt7948.i(this,"dialog")
get lastIndexOfPresets(){return this.args.tools.resultSetMeta.presets.length-1}routeToNewTool(e){return this.router.transitionTo("adminPlugins.show.discourse-ai-tools.new",{queryParams:{presetId:e.preset_id}})}static{dt7948.n(this.prototype,"routeToNewTool",[i.action])}importTool(){const e=document.createElement("input")
e.type="file",e.accept=".json",e.style.display="none",e.onchange=e=>this.handleFileSelect(e),document.body.appendChild(e),e.click(),document.body.removeChild(e)}static{dt7948.n(this.prototype,"importTool",[i.action])}handleFileSelect(e){const t=e.target.files[0]
if(!t)return
const s=new FileReader
s.onload=e=>{try{const t=JSON.parse(e.target.result)
this.uploadTool(t.ai_tool)}catch{this.dialog.alert((0,m.i18n)("discourse_ai.tools.import_error_not_json"))}},s.readAsText(t)}static{dt7948.n(this.prototype,"handleFileSelect",[i.action])}uploadTool(e,t=!1){const s={ai_tool:e}
return t&&(s.force=!0),(0,c.ajax)("/admin/plugins/discourse-ai/ai-tools/import.json",{type:"POST",data:JSON.stringify(s),contentType:"application/json"}).then(e=>{let t=f.default.create(e.ai_tool),s=this.args.tools.findBy("id",t.id)
s&&this.args.tools.removeObject(s),this.args.tools.insertAt(0,t)}).catch(t=>{409===t.jqXHR?.status?this.dialog.confirm({message:(0,m.i18n)("discourse_ai.tools.import_error_conflict",{name:e.tool_name}),confirmButtonLabel:"discourse_ai.tools.overwrite",didConfirm:()=>this.uploadTool(e,!0)}):(0,p.popupAjaxError)(t)})}static{(0,_.setComponentTemplate)((0,b.createTemplateFactory)({id:"JdJLSec5",block:'[[[1,"\\n    "],[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-tools"]],[28,[32,1],["discourse_ai.tools.short_title"],null]]],null],[1,"\\n    "],[10,"section"],[14,0,"ai-tool-list-editor__current admin-detail pull-left"],[12],[1,"\\n      "],[8,[32,2],null,[["@titleLabel","@learnMoreUrl","@descriptionLabel"],[[28,[32,1],["discourse_ai.tools.short_title"],null],"https://meta.discourse.org/t/ai-bot-custom-tools/314103",[28,[32,1],["discourse_ai.tools.subheader_description"],null]]],[["actions"],[[[[1,"\\n          "],[8,[32,3],[[24,0,"btn btn-small ai-tool-list-editor__import-button"]],[["@translatedLabel","@icon","@action"],[[28,[32,1],["discourse_ai.tools.import"],null],"upload",[30,0,["importTool"]]]],null],[1,"\\n          "],[8,[32,4],null,[["@triggerClass","@label","@icon","@placement"],["btn-primary btn-small ai-tool-list-editor__new-button",[28,[32,1],["discourse_ai.tools.new"],null],"plus","bottom-end"]],[["content"],[[[[1,"\\n              "],[8,[32,5],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2,["resultSetMeta","presets"]]],null]],null],null,[[[41,[28,[32,6],[[30,4],[30,0,["lastIndexOfPresets"]]],null],[[[1,"                    "],[8,[30,1,["divider"]],null,null,null],[1,"\\n"]],[]],null],[1,"\\n                  "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                    "],[8,[32,3],[[24,0,"btn-transparent"],[16,"data-option",[30,3,["preset_id"]]]],[["@translatedLabel","@action"],[[30,3,["preset_name"]],[28,[32,7],[[30,0,["routeToNewTool"]],[30,3]],null]]],null],[1,"\\n                  "]],[]]]]],[1,"\\n"]],[3,4]],null],[1,"              "]],[1]]]]],[1,"\\n\\n            "]],[]]]]],[1,"\\n        "]],[]]]]],[1,"\\n\\n"],[41,[30,2],[[[1,"        "],[10,"table"],[14,0,"d-admin-table ai-tool-list-editor"],[12],[1,"\\n          "],[10,"thead"],[12],[1,"\\n            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.tools.name"],null]],[13],[1,"\\n            "],[10,"th"],[12],[13],[1,"\\n          "],[13],[1,"\\n          "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2]],null]],null],null,[[[1,"              "],[10,"tr"],[15,"data-tool-id",[30,5,["id"]]],[14,0,"ai-tool-list__row d-admin-row__content"],[12],[1,"\\n                "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n                  "],[10,0],[14,0,"ai-tool-list__name-with-description"],[12],[1,"\\n                    "],[10,0],[14,0,"ai-tool-list__name"],[12],[1,"\\n                      "],[10,"strong"],[12],[1,"\\n                        "],[1,[30,5,["name"]]],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                    "],[10,0],[14,0,"ai-tool-list__description"],[12],[1,"\\n                      "],[1,[30,5,["description"]]],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n                "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n                  "],[8,[32,8],[[24,0,"btn btn-text btn-small"]],[["@route","@model"],["adminPlugins.show.discourse-ai-tools.edit",[30,5]]],[["default"],[[[[1,[28,[32,1],["discourse_ai.tools.edit"],null]]],[]]]]],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n"]],[5]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],[[[1,"        "],[8,[32,9],null,[["@ctaLabel","@ctaRoute","@ctaClass","@emptyLabel"],["discourse_ai.tools.new","adminPlugins.show.discourse-ai-tools.new","ai-tool-list-editor__empty-new-button","discourse_ai.tools.no_tools"]],null],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],["dropdown","@tools","preset","index","tool"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-list-editor.js",scope:()=>[r.default,m.i18n,d.default,l.default,g.default,u.default,n.eq,s.fn,o.LinkTo,h.default],isStrictMode:!0}),this)}}e.default=v}),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-selector",["exports","@ember/helper","select-kit/components/multi-select","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"gsEPc7NG",block:'[[[1,"\\n  "],[8,[32,0],null,[["@value","@onChange","@content","@options"],[[30,1],[30,2],[30,3],[28,[32,1],null,[["filterable","allowAny","disabled"],[true,false,[30,4]]]]]],null],[1,"\\n"]],["@value","@onChange","@content","@disabled"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-selector.js",scope:()=>[s.default,t.hash],isStrictMode:!0}),(0,a.default)(void 0,"ai-tool-selector:AiToolSelector"))
e.default=n}),define("discourse/plugins/discourse-ai/discourse/components/ai-topic-gist",["exports","@glimmer/component","@ember/service","@ember/template","discourse/plugins/discourse-ai/discourse/services/gists","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static{dt7948.g(this.prototype,"gists",[s.service])}#X=void dt7948.i(this,"gists")
get shouldShow(){return this.gists.currentPreference===o.TABLE_AI_LAYOUT&&this.gists.showToggle}get hasGist(){return!!this.gist}get gist(){return this.args.topic.get("ai_topic_gist")}get escapedExcerpt(){return this.args.topic.get("escapedExcerpt")}static{(0,a.setComponentTemplate)((0,n.createTemplateFactory)({id:"Jq5DO/FZ",block:'[[[1,"\\n"],[41,[30,0,["shouldShow"]],[[[41,[30,0,["hasGist"]],[[[1,"        "],[10,3],[15,6,[30,1,["lastUnreadUrl"]]],[14,0,"excerpt"],[12],[1,"\\n          "],[10,0],[14,0,"excerpt__contents"],[12],[1,[30,0,["gist"]]],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],[[[41,[30,0,["escapedExcerpt"]],[[[1,"          "],[10,3],[15,6,[30,1,["lastUnreadUrl"]]],[14,0,"excerpt"],[12],[1,"\\n            "],[10,0],[14,0,"excerpt__contents"],[12],[1,"\\n              "],[1,[28,[32,0],[[30,0,["escapedExcerpt"]]],null]],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null]],[]]]],[]],null],[1,"  "]],["@topic"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-topic-gist.js",scope:()=>[i.htmlSafe],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/components/ai-translations",["exports","@glimmer/component","@glimmer/tracking","@ember/service","discourse/components/d-page-subheader","discourse-i18n","admin/components/admin-config-area-card","admin/components/admin-config-area-empty-list","admin/components/chart","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static{dt7948.g(this.prototype,"siteSettings",[i.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"store",[i.service])}#D=void dt7948.i(this,"store")
static{dt7948.g(this.prototype,"data",[s.tracked],function(){return this.args.model?.translation_progress})}#Ve=void dt7948.i(this,"data")
getLanguageName(e){try{const t=this.siteSettings.available_locales.find(t=>t.value===e)
return t?t.name:e}catch{return e}}get chartConfig(){if(!this.data||!this.data.length)return{}
const e=document.querySelector(".ai-translations"),t=getComputedStyle(e),s={progress:t.getPropertyValue("--chart-progress-color").trim(),remaining:t.getPropertyValue("--chart-remaining-color").trim()},i=this.data.map(e=>({locale:this.getLanguageName(e.locale),completionPercentage:e.completion_percentage,remainingPercentage:e.remaining_percentage}))
return{type:"bar",data:{labels:i.map(e=>e.locale),datasets:[{label:(0,a.i18n)("discourse_ai.translations.progress_chart.completed"),data:i.map(e=>e.completionPercentage),backgroundColor:s.progress},{label:(0,a.i18n)("discourse_ai.translations.progress_chart.remaining"),data:i.map(e=>e.remainingPercentage),backgroundColor:s.remaining}]},options:{indexAxis:"y",responsive:!0,scales:{x:{stacked:!0,beginAtZero:!0,max:100,ticks:{callback:e=>`${e}%`}},y:{stacked:!0}},plugins:{tooltip:{callbacks:{label:e=>`${e.dataset.label}: ${e.raw.toFixed(1)}%`}}}}}}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"OY7LYhGV",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-translations admin-detail"],[12],[1,"\\n      "],[8,[32,0],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[28,[32,1],["discourse_ai.translations.title"],null],[28,[32,1],["discourse_ai.translations.description"],null],"https://meta.discourse.org/t/-/370969"]],[["actions"],[[[[1,"\\n"],[41,[30,2,["enabled"]],[[[1,"            "],[8,[30,1,["Default"]],[[24,0,"ai-translation-settings-button"]],[["@label","@route","@routeModels"],["discourse_ai.translations.admin_actions.translation_settings","adminPlugins.show.discourse-ai-features.edit",[30,2,["translation_id"]]]],null],[1,"\\n            "],[8,[30,1,["Default"]],[[24,0,"ai-localization-settings-button"]],[["@label","@route"],["discourse_ai.translations.admin_actions.localization_settings","adminConfig.localization.settings"]],null],[1,"\\n"]],[]],null],[1,"        "]],[1]]]]],[1,"\\n\\n"],[41,[30,2,["enabled"]],[[[1,"        "],[8,[32,2],[[24,0,"ai-translation__charts"]],[["@heading"],["discourse_ai.translations.progress_chart.title"]],[["content"],[[[[1,"\\n            "],[10,0],[14,0,"ai-translation__chart-container"],[12],[1,"\\n              "],[8,[32,3],[[24,0,"ai-translation__chart"]],[["@chartConfig"],[[30,0,["chartConfig"]]]],null],[1,"\\n            "],[13],[1,"\\n          "]],[]]]]],[1,"\\n"]],[]],[[[1,"        "],[8,[32,4],null,[["@ctaLabel","@ctaRoute","@ctaRouteModels","@ctaClass","@emptyLabel"],["discourse_ai.translations.admin_actions.disabled_state.configure","adminPlugins.show.discourse-ai-features.edit",[30,2,["translation_id"]],"ai-translations__configure-button","discourse_ai.translations.admin_actions.disabled_state.empty_label"]],null],[1,"\\n"]],[]]],[1,"\\n    "],[13],[1,"\\n  "]],["actions","@model"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-translations.js",scope:()=>[o.default,a.i18n,n.default,l.default,r.default],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/ai-usage",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/routing","@ember/service","truth-helpers","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/d-page-subheader","discourse/components/d-stat-tiles","discourse/components/date-time-input-range","discourse/helpers/avatar","discourse/helpers/concat-class","discourse/lib/ajax","discourse/lib/decorators","discourse/lib/formatter","discourse-i18n","admin/components/admin-config-area-card","admin/components/admin-config-area-empty-list","admin/components/chart","select-kit/components/combo-box","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f,_,b,v,y,w,S,x,k,T,P){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class C extends t.default{static{dt7948.g(this.prototype,"currentUser",[l.service])}#k=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"startDate",[s.tracked],function(){return moment().subtract(30,"days").toDate()})}#$e=void dt7948.i(this,"startDate")
static{dt7948.g(this.prototype,"endDate",[s.tracked],function(){return new Date})}#Ge=void dt7948.i(this,"endDate")
static{dt7948.g(this.prototype,"data",[s.tracked],function(){return this.args.model})}#Ve=void dt7948.i(this,"data")
static{dt7948.g(this.prototype,"selectedFeature",[s.tracked])}#Ye=void dt7948.i(this,"selectedFeature")
static{dt7948.g(this.prototype,"selectedModel",[s.tracked])}#We=void dt7948.i(this,"selectedModel")
static{dt7948.g(this.prototype,"selectedPeriod",[s.tracked],function(){return"month"})}#Ke=void dt7948.i(this,"selectedPeriod")
static{dt7948.g(this.prototype,"isCustomDateActive",[s.tracked],function(){return!1})}#Je=void dt7948.i(this,"isCustomDateActive")
static{dt7948.g(this.prototype,"loadingData",[s.tracked],function(){return!0})}#Qe=void dt7948.i(this,"loadingData")
constructor(){super(...arguments),this.fetchData()}async fetchData(){const e=await(0,_.ajax)("/admin/plugins/discourse-ai/ai-usage-report.json",{data:{start_date:moment(this.startDate).format("YYYY-MM-DD"),end_date:moment(this.endDate).format("YYYY-MM-DD"),timezone:this.currentUser?.user_option?.timezone||moment.tz.guess(),feature:this.selectedFeature,model:this.selectedModel}})
this.data=e,this.loadingData=!1,this._cachedFeatures=null,this._cachedModels=null}static{dt7948.n(this.prototype,"fetchData",[o.action])}async onFilterChange(){await this.fetchData()}static{dt7948.n(this.prototype,"onFilterChange",[o.action])}onFeatureChanged(e){this.selectedFeature=e,this.onFilterChange()}static{dt7948.n(this.prototype,"onFeatureChanged",[o.action])}onModelChanged(e){this.selectedModel=e,this.onFilterChange()}static{dt7948.n(this.prototype,"onModelChanged",[o.action])}addCurrencyChar(e){e.querySelectorAll(".d-stat-tile__label").forEach(e=>{if(e.innerText.trim()===(0,y.i18n)("discourse_ai.usage.total_spending")){const t=e.closest(".d-stat-tile")?.querySelector(".d-stat-tile__value")
t&&(t.innerText=`$${t.innerText}`)}})}static{dt7948.n(this.prototype,"addCurrencyChar",[o.action])}takeUsers(e,t){return this.data.users.slice(e,t)}static{dt7948.n(this.prototype,"takeUsers",[b.bind])}normalizeTimeSeriesData(e){if(!e?.length)return[]
const t=moment(this.startDate),s=moment(this.endDate),i=[]
let o,a
"hour"===this.data.period?(o="hour",a="YYYY-MM-DD HH:00:00"):"day"===this.data.period?(o="day",a="YYYY-MM-DD"):(o="month",a="YYYY-MM")
const n=new Map(e.map(e=>[moment(e.period).format(a),e]))
for(let r=moment(t);r.isSameOrBefore(s);r.add(1,o)){const e=r.format(a),t=n.get(e)
i.push(t||{period:r.format(),total_tokens:0,total_cached_tokens:0,total_request_tokens:0,total_response_tokens:0})}return i}get metrics(){return[{label:(0,y.i18n)("discourse_ai.usage.total_requests"),value:this.data.summary.total_requests,tooltip:(0,y.i18n)("discourse_ai.usage.stat_tooltips.total_requests")},{label:(0,y.i18n)("discourse_ai.usage.total_tokens"),value:this.data.summary.total_tokens,tooltip:(0,y.i18n)("discourse_ai.usage.stat_tooltips.total_tokens")},{label:(0,y.i18n)("discourse_ai.usage.request_tokens"),value:this.data.summary.total_request_tokens,tooltip:(0,y.i18n)("discourse_ai.usage.stat_tooltips.request_tokens")},{label:(0,y.i18n)("discourse_ai.usage.response_tokens"),value:this.data.summary.total_response_tokens,tooltip:(0,y.i18n)("discourse_ai.usage.stat_tooltips.response_tokens")},{label:(0,y.i18n)("discourse_ai.usage.cached_tokens"),value:this.data.summary.total_cached_tokens,tooltip:(0,y.i18n)("discourse_ai.usage.stat_tooltips.cached_tokens")},{label:(0,y.i18n)("discourse_ai.usage.total_spending"),value:this.data.summary.total_spending,tooltip:(0,y.i18n)("discourse_ai.usage.stat_tooltips.total_spending")}]}get chartConfig(){if(!this.data?.data)return
const e=this.normalizeTimeSeriesData(this.data.data),t=document.querySelector(".ai-usage__chart"),s=getComputedStyle(t),i={response:s.getPropertyValue("--chart-response-color").trim(),request:s.getPropertyValue("--chart-request-color").trim(),cached:s.getPropertyValue("--chart-cached-color").trim()}
return{type:"bar",data:{labels:e.map(e=>{const t=moment(e.period)
return"hour"===this.data.period?t.format("HH:00"):"day"===this.data.period?t.format("DD-MMM"):t.format("MMM-YY")}),datasets:[{label:(0,y.i18n)("discourse_ai.usage.response_tokens"),data:e.map(e=>e.total_response_tokens),backgroundColor:i.response},{label:(0,y.i18n)("discourse_ai.usage.net_request_tokens"),data:e.map(e=>e.total_request_tokens-e.total_cached_tokens),backgroundColor:i.request},{label:(0,y.i18n)("discourse_ai.usage.cached_request_tokens"),data:e.map(e=>e.total_cached_tokens),backgroundColor:i.cached}]},options:{responsive:!0,scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0}}}}}get availableFeatures(){return this._cachedFeatures=this._cachedFeatures||(this.data?.features||[]).map(e=>({id:e.feature_name,name:e.feature_name})),this._cachedFeatures}get availableModels(){return this._cachedModels=this._cachedModels||(this.data?.models||[]).map(e=>({id:e.llm,name:e.llm})),this._cachedModels}get periodOptions(){return[{id:"day",name:(0,y.i18n)("discourse_ai.usage.periods.last_day")},{id:"week",name:(0,y.i18n)("discourse_ai.usage.periods.last_week")},{id:"month",name:(0,y.i18n)("discourse_ai.usage.periods.last_month")}]}setPeriodDates(e){const t=moment()
switch(e){case"day":this.startDate=t.clone().subtract(1,"day").toDate(),this.endDate=t.toDate()
break
case"week":this.startDate=t.clone().subtract(7,"days").toDate(),this.endDate=t.toDate()
break
case"month":this.startDate=t.clone().subtract(30,"days").toDate(),this.endDate=t.toDate()}}static{dt7948.n(this.prototype,"setPeriodDates",[o.action])}onPeriodSelect(e){this.selectedPeriod=e,this.isCustomDateActive=!1,this.setPeriodDates(e),this.fetchData()}static{dt7948.n(this.prototype,"onPeriodSelect",[o.action])}onCustomDateClick(){this.isCustomDateActive=!this.isCustomDateActive,this.isCustomDateActive&&(this.selectedPeriod=null)}static{dt7948.n(this.prototype,"onCustomDateClick",[o.action])}onDateChange(){this.isCustomDateActive=!0,this.selectedPeriod=null,this.fetchData()}static{dt7948.n(this.prototype,"onDateChange",[o.action])}onChangeDateRange({from:e,to:t}){this._startDate=e,this._endDate=t}static{dt7948.n(this.prototype,"onChangeDateRange",[o.action])}onRefreshDateRange(){this.startDate=this._startDate,this.endDate=this._endDate,this.fetchData()}static{dt7948.n(this.prototype,"onRefreshDateRange",[o.action])}totalSpending(e,t,s){return`$${(e+t+s).toFixed(2)}`}static{(0,T.setComponentTemplate)((0,P.createTemplateFactory)({id:"hX10WeQL",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-usage admin-detail"],[12],[1,"\\n      "],[8,[32,0],null,[["@titleLabel","@learnMoreUrl","@descriptionLabel"],[[28,[32,1],["discourse_ai.usage.short_title"],null],"https://meta.discourse.org/t/-/348677",[28,[32,1],["discourse_ai.usage.subheader_description"],null]]],null],[1,"\\n      "],[10,0],[14,0,"ai-usage__filters"],[12],[1,"\\n        "],[10,0],[14,0,"ai-usage__filters-dates"],[12],[1,"\\n          "],[10,0],[14,0,"ai-usage__period-buttons"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["periodOptions"]]],null]],null],null,[[[1,"              "],[8,[32,2],[[16,0,[52,[28,[32,3],[[30,0,["selectedPeriod"]],[30,1,["id"]]],null],"btn-primary","btn-default"]]],[["@action","@translatedLabel"],[[28,[32,4],[[30,0,["onPeriodSelect"]],[30,1,["id"]]],null],[30,1,["name"]]]],null],[1,"\\n"]],[1]],null],[1,"            "],[8,[32,2],[[16,0,[52,[30,0,["isCustomDateActive"]],"btn-primary","btn-default"]]],[["@action","@label"],[[30,0,["onCustomDateClick"]],"discourse_ai.usage.periods.custom"]],null],[1,"\\n          "],[13],[1,"\\n\\n"],[41,[30,0,["isCustomDateActive"]],[[[1,"            "],[10,0],[14,0,"ai-usage__custom-date-pickers"],[12],[1,"\\n\\n              "],[8,[32,5],null,[["@from","@to","@onChange","@showFromTime","@showToTime"],[[30,0,["startDate"]],[30,0,["endDate"]],[30,0,["onChangeDateRange"]],false,false]],null],[1,"\\n\\n              "],[8,[32,2],null,[["@action","@label"],[[30,0,["onRefreshDateRange"]],"refresh"]],null],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"ai-usage__filters-row"],[12],[1,"\\n          "],[8,[32,6],[[24,0,"ai-usage__feature-selector"]],[["@value","@content","@onChange","@options"],[[30,0,["selectedFeature"]],[30,0,["availableFeatures"]],[30,0,["onFeatureChanged"]],[28,[32,7],null,[["none"],["discourse_ai.usage.all_features"]]]]],null],[1,"\\n\\n          "],[8,[32,6],[[24,0,"ai-usage__model-selector"]],[["@value","@content","@onChange","@options"],[[30,0,["selectedModel"]],[30,0,["availableModels"]],[30,0,["onModelChanged"]],[28,[32,7],null,[["none"],["discourse_ai.usage.all_models"]]]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[8,[32,8],null,[["@condition"],[[30,0,["loadingData"]]]],[["default"],[[[[1,"\\n          "],[8,[32,9],[[24,0,"ai-usage__summary"]],[["@heading"],["discourse_ai.usage.summary"]],[["content"],[[[[1,"\\n              "],[8,[32,10],[[4,[32,11],[[30,0,["addCurrencyChar"]],[30,0,["metrics"]]],null],[4,[32,12],[[30,0,["addCurrencyChar"]],[30,0,["metrics"]]],null]],null,[["default"],[[[[1,"\\n\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["metrics"]]],null]],null],null,[[[1,"                  "],[8,[30,2,["Tile"]],[[24,0,"bar"]],[["@label","@href","@value","@tooltip"],[[30,3,["label"]],[30,3,["href"]],[30,3,["value"]],[30,3,["tooltip"]]]],null],[1,"\\n"]],[3]],null],[1,"              "]],[2]]]]],[1,"\\n            "]],[]]]]],[1,"\\n\\n          "],[8,[32,9],[[24,0,"ai-usage__charts"]],[["@heading"],["discourse_ai.usage.tokens_over_time"]],[["content"],[[[[1,"\\n              "],[10,0],[14,0,"ai-usage__chart-container"],[12],[1,"\\n                "],[8,[32,13],[[24,0,"ai-usage__chart"]],[["@chartConfig"],[[30,0,["chartConfig"]]]],null],[1,"\\n              "],[13],[1,"\\n            "]],[]]]]],[1,"\\n\\n          "],[10,0],[14,0,"ai-usage__breakdowns"],[12],[1,"\\n            "],[8,[32,9],[[24,0,"ai-usage__features"]],[["@heading"],["discourse_ai.usage.features_breakdown"]],[["content"],[[[[1,"\\n"],[41,[51,[30,0,["data","features","length"]]],[[[1,"                  "],[8,[32,14],null,[["@emptyLabel"],["discourse_ai.usage.no_features"]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["data","features","length"]],[[[1,"                  "],[10,"table"],[14,0,"ai-usage__features-table"],[12],[1,"\\n                    "],[10,"thead"],[12],[1,"\\n                      "],[10,"tr"],[12],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.feature"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_spending"],null]],[13],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                    "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["data","features"]]],null]],null],null,[[[1,"                        "],[10,"tr"],[14,0,"ai-usage__features-row"],[12],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__features-cell"],[12],[1,[30,4,["feature_name"]]],[13],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__features-cell"],[15,"title",[30,4,["usage_count"]]],[12],[1,[28,[32,15],[[30,4,["usage_count"]]],null]],[13],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__features-cell"],[15,"title",[30,4,["total_tokens"]]],[12],[1,[28,[32,15],[[30,4,["total_tokens"]]],null]],[13],[1,"\\n                          "],[10,"td"],[12],[1,"\\n                            "],[1,[28,[30,0,["totalSpending"]],[[30,4,["input_spending"]],[30,4,["cached_input_spending"]],[30,4,["output_spending"]]],null]],[1,"\\n                          "],[13],[1,"\\n                        "],[13],[1,"\\n"]],[4]],null],[1,"                    "],[13],[1,"\\n                  "],[13],[1,"\\n"]],[]],null],[1,"              "]],[]]]]],[1,"\\n\\n            "],[8,[32,9],[[24,0,"ai-usage__models"]],[["@heading"],["discourse_ai.usage.models_breakdown"]],[["content"],[[[[1,"\\n"],[41,[51,[30,0,["data","models","length"]]],[[[1,"                  "],[8,[32,14],null,[["@emptyLabel"],["discourse_ai.usage.no_models"]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["data","models","length"]],[[[1,"                  "],[10,"table"],[14,0,"ai-usage__models-table"],[12],[1,"\\n                    "],[10,"thead"],[12],[1,"\\n                      "],[10,"tr"],[12],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.model"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_spending"],null]],[13],[1,"\\n\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                    "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["data","models"]]],null]],null],null,[[[1,"                        "],[10,"tr"],[14,0,"ai-usage__models-row"],[12],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__models-cell"],[12],[1,[30,5,["llm"]]],[13],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__models-cell"],[15,"title",[30,5,["usage_count"]]],[12],[1,[28,[32,15],[[30,5,["usage_count"]]],null]],[13],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__models-cell"],[15,"title",[30,5,["total_tokens"]]],[12],[1,[28,[32,15],[[30,5,["total_tokens"]]],null]],[13],[1,"\\n                          "],[10,"td"],[12],[1,"\\n                            "],[1,[28,[30,0,["totalSpending"]],[[30,5,["input_spending"]],[30,5,["cached_input_spending"]],[30,5,["output_spending"]]],null]],[1,"\\n                          "],[13],[1,"\\n                        "],[13],[1,"\\n"]],[5]],null],[1,"                    "],[13],[1,"\\n                  "],[13],[1,"\\n"]],[]],null],[1,"              "]],[]]]]],[1,"\\n\\n            "],[8,[32,9],[[24,0,"ai-usage__users"]],[["@heading"],["discourse_ai.usage.users_breakdown"]],[["content"],[[[[1,"\\n"],[41,[51,[30,0,["data","users","length"]]],[[[1,"                  "],[8,[32,14],null,[["@emptyLabel"],["discourse_ai.usage.no_users"]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["data","users","length"]],[[[1,"                  "],[10,"table"],[15,0,[28,[32,16],["ai-usage__users-table",[52,[28,[32,17],[[30,0,["data","users","length"]],25],null],"-double-width"]],null]],[12],[1,"\\n                    "],[10,"thead"],[12],[1,"\\n                      "],[10,"tr"],[12],[1,"\\n                        "],[10,"th"],[14,0,"ai-usage__users-username"],[12],[1,[28,[32,1],["discourse_ai.usage.username"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_spending"],null]],[13],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                    "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[28,[30,0,["takeUsers"]],[0,24],null]],null]],null],null,[[[1,"                        "],[10,"tr"],[14,0,"ai-usage__users-row"],[12],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__users-cell"],[12],[1,"\\n                            "],[10,0],[14,0,"user-info"],[12],[1,"\\n                              "],[8,[32,18],[[24,0,"username"]],[["@route","@model"],["user",[30,6,["username"]]]],[["default"],[[[[1,"\\n                                "],[1,[28,[32,19],[[30,6]],[["imageSize"],["tiny"]]]],[1,"\\n                                "],[1,[30,6,["username"]]],[1,"\\n                              "]],[]]]]],[1,"\\n                            "],[13],[13],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__users-cell"],[15,"title",[30,6,["usage_count"]]],[12],[1,[28,[32,15],[[30,6,["usage_count"]]],null]],[13],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__users-cell"],[15,"title",[30,6,["total_tokens"]]],[12],[1,[28,[32,15],[[30,6,["total_tokens"]]],null]],[13],[1,"\\n                          "],[10,"td"],[12],[1,"\\n                            "],[1,[28,[30,0,["totalSpending"]],[[30,6,["input_spending"]],[30,6,["cached_input_spending"]],[30,6,["output_spending"]]],null]],[1,"\\n                          "],[13],[1,"\\n                        "],[13],[1,"\\n"]],[6]],null],[1,"                    "],[13],[1,"\\n                  "],[13],[1,"\\n\\n"],[41,[28,[32,20],[[30,0,["data","users","length"]],25],null],[[[1,"                    "],[10,"table"],[14,0,"ai-usage__users-table"],[12],[1,"\\n                      "],[10,"thead"],[12],[1,"\\n                        "],[10,"tr"],[12],[1,"\\n                          "],[10,"th"],[14,0,"ai-usage__users-username"],[12],[1,[28,[32,1],["discourse_ai.usage.username"],null]],[13],[1,"\\n                          "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                          "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                        "],[13],[1,"\\n                      "],[13],[1,"\\n                      "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[28,[30,0,["takeUsers"]],[25,49],null]],null]],null],null,[[[1,"                          "],[10,"tr"],[14,0,"ai-usage__users-row"],[12],[1,"\\n                            "],[10,"td"],[14,0,"ai-usage__users-cell"],[12],[1,"\\n                              "],[10,0],[14,0,"user-info"],[12],[1,"\\n                                "],[8,[32,18],[[24,0,"username"]],[["@route","@model"],["user",[30,7,["username"]]]],[["default"],[[[[1,"\\n                                  "],[1,[28,[32,19],[[30,7]],[["imageSize"],["tiny"]]]],[1,"\\n                                  "],[1,[30,7,["username"]]],[1,"\\n                                "]],[]]]]],[1,"\\n                              "],[13],[13],[1,"\\n                            "],[10,"td"],[14,0,"ai-usage__users-cell"],[15,"title",[30,7,["usage_count"]]],[12],[1,[28,[32,15],[[30,7,["usage_count"]]],null]],[13],[1,"\\n                            "],[10,"td"],[14,0,"ai-usage__users-cell"],[15,"title",[30,7,["total_tokens"]]],[12],[1,[28,[32,15],[[30,7,["total_tokens"]]],null]],[13],[1,"\\n                          "],[13],[1,"\\n"]],[7]],null],[1,"                      "],[13],[1,"\\n                    "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"              "]],[]]]]],[1,"\\n          "],[13],[1,"\\n        "]],[]]]]],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["option","tiles","metric","feature","model","user","user"],false,["each","-track-array","if","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-usage.js",scope:()=>[p.default,y.i18n,c.default,d.eq,i.fn,h.default,k.default,i.hash,u.default,w.default,m.default,a.default,n.default,x.default,S.default,v.number,f.default,d.lt,r.LinkTo,g.default,d.gt],isStrictMode:!0}),this)}}e.default=C}),define("discourse/plugins/discourse-ai/discourse/components/doughnut-chart",["exports","@glimmer/component","@glimmer/tracking","admin/components/chart","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static{dt7948.g(this.prototype,"canvasSize",[s.tracked],function(){return null})}#Xe=void dt7948.i(this,"canvasSize")
get config(){const e=this.args.totalScore||""
return{type:"doughnut",data:{labels:this.args.labels,datasets:[{data:this.args.data,backgroundColor:this.args.colors,cutout:"50%",radius:100}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:this.args.displayLegend||!1,position:"bottom"}}},plugins:[{id:"centerText",afterDraw:function(t){const s=getComputedStyle(document.documentElement).getPropertyValue("--primary-high")||"#000",i=getComputedStyle(document.documentElement).getPropertyValue("--font-up-4")||"1.3em",o=getComputedStyle(document.documentElement).getPropertyValue("--font-family")||"sans-serif",{ctx:a,chartArea:n}=t,r=(n.left+n.right)/2,l=(n.top+n.bottom)/2
a.restore(),a.textAlign="center",a.textBaseline="middle",a.fillStyle=s.trim(),a.font=`bold ${i.trim()} ${o.trim()}`,a.fillText(e,r,l),a.save()}},{id:"doughnutLabels",afterDraw(e){const t=e.ctx,s=e.data.datasets[0],i=e.getDatasetMeta(0),o=getComputedStyle(document.documentElement).getPropertyValue("--font-down-2")||"1.3em",a=getComputedStyle(document.documentElement).getPropertyValue("--font-family")||"sans-serif"
t.font=`${o.trim()} ${a.trim()}`,t.fillStyle="#fafafa",t.textAlign="center",t.textBaseline="middle",i.data.forEach((e,i)=>{const{x:o,y:a}=e.tooltipPosition(),n=s.data[i],r=s.data.filter(e=>e>0).length
0!==n&&1!==r&&t.fillText(n,o,a)})}}]}}static{(0,o.setComponentTemplate)((0,a.createTemplateFactory)({id:"HiYQwgXb",block:'[[[1,"\\n"],[41,[30,0,["config"]],[[[1,"      "],[10,"h3"],[14,0,"doughnut-chart-title"],[12],[1,[30,1]],[13],[1,"\\n      "],[8,[32,0],[[24,0,"admin-report-doughnut"]],[["@chartConfig"],[[30,0,["config"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@doughnutTitle"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/doughnut-chart.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-llm-quota-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/service","discourse/components/d-modal","discourse/components/form","discourse-i18n","select-kit/components/group-chooser","discourse/plugins/discourse-ai/discourse/components/ai-quota-duration-selector","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends t.default{static{dt7948.g(this.prototype,"site",[a.service])}#y=void dt7948.i(this,"site")
save(e){const t={...e}
t.group_name=this.site.groups.findBy("id",e.group_id).name,t.llm_model_id=this.args.model.id,this.args.model.addItemToCollection(t),this.args.closeModal(),this.args.model.onSave&&this.args.model.onSave()}static{dt7948.n(this.prototype,"save",[o.action])}get availableGroups(){const e=this.args.model.llm.llm_quotas.map(e=>e.group_id)||[]
return this.site.groups.filter(t=>!e.includes(t.id)&&0!==t.id)}get quota(){return{group_id:null,llm_model_id:null,max_tokens:null,max_usages:null,duration_seconds:moment.duration(1,"day").asSeconds()}}static{dt7948.n(this.prototype,"quota",[s.cached])}setGroupId(e,t){e.set(t[0])}static{dt7948.n(this.prototype,"setGroupId",[o.action])}validateForm(e,{addError:t,removeError:s}){e.max_tokens||e.max_usages?(s("max_tokens"),s("max_usages")):(t("max_tokens",{title:(0,l.i18n)("discourse_ai.llms.quotas.max_tokens"),message:(0,l.i18n)("discourse_ai.llms.quotas.max_tokens_required")}),t("max_usages",{title:(0,l.i18n)("discourse_ai.llms.quotas.max_usages"),message:(0,l.i18n)("discourse_ai.llms.quotas.max_usages_required")}))}static{dt7948.n(this.prototype,"validateForm",[o.action])}static{(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"MLB+nwD5",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-llm-quota-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.llms.quotas.add_title"],null],[30,1]]],[["body"],[[[[1,"\\n        "],[8,[32,2],null,[["@validate","@onSubmit","@data"],[[30,0,["validateForm"]],[30,0,["save"]],[30,0,["quota"]]]],[["default"],[[[[1,"\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@format"],["group_id",[28,[32,1],["discourse_ai.llms.quotas.group"],null],"required","large"]],[["default"],[[[[1,"\\n            "],[8,[30,4,["Custom"]],null,null,[["default"],[[[[1,"\\n              "],[8,[32,3],null,[["@value","@content","@onChange","@options"],[[30,3,["group_id"]],[30,0,["availableGroups"]],[28,[32,4],[[30,0,["setGroupId"]],[30,4]],null],[28,[32,5],null,[["maximum"],[1]]]]],null],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[4]]]]],[1,"\\n\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["max_tokens",[28,[32,1],["discourse_ai.llms.quotas.max_tokens"],null],[28,[32,1],["discourse_ai.llms.quotas.max_tokens_help"],null],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,5,["Input"]],[[24,"min","1"]],[["@type"],["number"]],null],[1,"\\n          "]],[5]]]]],[1,"\\n\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["max_usages",[28,[32,1],["discourse_ai.llms.quotas.max_usages"],null],[28,[32,1],["discourse_ai.llms.quotas.max_usages_help"],null],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,6,["Input"]],[[24,"min","1"]],[["@type"],["number"]],null],[1,"\\n          "]],[6]]]]],[1,"\\n\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@format"],["duration_seconds",[28,[32,1],["discourse_ai.llms.quotas.duration"],null],"required","large"]],[["default"],[[[[1,"\\n            "],[8,[30,7,["Custom"]],null,null,[["default"],[[[[1,"\\n              "],[8,[32,6],null,[["@value","@onChange"],[[30,3,["duration_seconds"]],[30,7,["set"]]]],null],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[7]]]]],[1,"\\n\\n          "],[8,[30,2,["Submit"]],[[24,0,"btn-primary"]],[["@label"],["discourse_ai.llms.quotas.add"]],null],[1,"\\n        "]],[2,3]]]]],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","form","data","field","field","field","field"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-llm-quota-modal.js",scope:()=>[n.default,l.i18n,r.default,d.default,i.fn,i.hash,u.default],isStrictMode:!0}),this)}}e.default=m}),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-persona-response-format-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","truth-helpers","discourse/components/modal/json-schema-editor","discourse/lib/formatter","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static{dt7948.g(this.prototype,"showJsonEditorModal",[s.tracked],function(){return!1})}#Ze=void dt7948.i(this,"showJsonEditorModal")
jsonSchema={type:"array",uniqueItems:!0,title:(0,l.i18n)("discourse_ai.ai_persona.response_format.modal.root_title"),items:{type:"object",title:(0,l.i18n)("discourse_ai.ai_persona.response_format.modal.key_title"),properties:{key:{type:"string"},type:{type:"string",enum:["string","integer","boolean","array"]},array_type:{type:"string",enum:["string","integer","boolean"],options:{dependencies:{type:"array"}}}},required:["key","type"]}}
get editorTitle(){return(0,l.i18n)("discourse_ai.ai_persona.response_format.title")}get responseFormatAsJSON(){return JSON.stringify(this.args.data.response_format)}get displayJSON(){const e={}
return this.args.data.response_format.forEach(t=>{"array"===t.type?e[t.key]=`[${t.array_type}]`:e[t.key]=t.type}),(0,r.prettyJSON)(e)}openModal(){this.showJsonEditorModal=!0}static{dt7948.n(this.prototype,"openModal",[o.action])}closeModal(){this.showJsonEditorModal=!1}static{dt7948.n(this.prototype,"closeModal",[o.action])}updateResponseFormat(e,t){e.set("response_format",JSON.parse(t))}static{dt7948.n(this.prototype,"updateResponseFormat",[o.action])}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"TiBnMIeT",block:'[[[1,"\\n    "],[8,[30,1,["Container"]],null,[["@title","@format"],[[30,0,["editorTitle"]],"large"]],[["default"],[[[[1,"\\n      "],[10,0],[14,0,"ai-persona-editor__response-format"],[12],[1,"\\n"],[41,[28,[32,0],[[30,2,["response_format","length"]],0],null],[[[1,"          "],[10,"pre"],[14,0,"ai-persona-editor__response-format-pre"],[12],[1,"            "],[10,"code"],[12],[1,[30,0,["displayJSON"]]],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[1,"          "],[10,0],[14,0,"ai-persona-editor__response-format-none"],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_persona.response_format.no_format"],null]],[1,"\\n          "],[13],[1,"\\n"]],[]]],[1,"\\n        "],[8,[30,1,["Button"]],null,[["@action","@label","@disabled"],[[30,0,["openModal"]],"discourse_ai.ai_persona.response_format.open_modal",[30,2,["system"]]]],null],[1,"\\n      "],[13],[1,"\\n    "]],[]]]]],[1,"\\n\\n"],[41,[30,0,["showJsonEditorModal"]],[[[1,"      "],[8,[32,2],null,[["@model","@closeModal"],[[28,[32,3],null,[["value","updateValue","settingName","jsonSchema"],[[30,0,["responseFormatAsJSON"]],[28,[32,4],[[30,0,["updateResponseFormat"]],[30,1]],null],[30,0,["editorTitle"]],[30,0,["jsonSchema"]]]]],[30,0,["closeModal"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@form","@data"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-persona-response-format-editor.js",scope:()=>[a.gt,l.i18n,n.default,i.hash,i.fn],isStrictMode:!0}),this)}}e.default=c})
define("discourse/plugins/discourse-ai/discourse/components/modal/ai-summary-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/service","truth-helpers","discourse/components/cook-text","discourse/components/d-button","discourse/components/d-modal","discourse/helpers/concat-class","discourse/helpers/d-icon","discourse/helpers/html-class","discourse/lib/ajax","discourse/lib/decorators","discourse/lib/formatter","discourse-i18n","float-kit/components/d-tooltip","discourse/plugins/discourse-ai/discourse/components/ai-summary-skeleton","discourse/plugins/discourse-ai/discourse/lib/smooth-streamer","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f,_,b,v,y,w,S,x,k){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class T extends t.default{static{dt7948.g(this.prototype,"messageBus",[l.service])}#ce=void dt7948.i(this,"messageBus")
static{dt7948.g(this.prototype,"currentUser",[l.service])}#k=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"modal",[l.service])}#j=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"text",[s.tracked],function(){return""})}#et=void dt7948.i(this,"text")
static{dt7948.g(this.prototype,"summarizedOn",[s.tracked],function(){return null})}#tt=void dt7948.i(this,"summarizedOn")
static{dt7948.g(this.prototype,"summarizedBy",[s.tracked],function(){return null})}#st=void dt7948.i(this,"summarizedBy")
static{dt7948.g(this.prototype,"newPostsSinceSummary",[s.tracked],function(){return null})}#it=void dt7948.i(this,"newPostsSinceSummary")
static{dt7948.g(this.prototype,"outdated",[s.tracked],function(){return!1})}#ot=void dt7948.i(this,"outdated")
static{dt7948.g(this.prototype,"canRegenerate",[s.tracked],function(){return!1})}#at=void dt7948.i(this,"canRegenerate")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ge=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"currentIndex",[s.tracked],function(){return 0})}#nt=void dt7948.i(this,"currentIndex")
static{dt7948.g(this.prototype,"smoothStreamer",[s.tracked],function(){return new S.default(()=>this.text,e=>this.text=e)})}#Te=void dt7948.i(this,"smoothStreamer")
get outdatedSummaryWarningText(){let e=(0,v.i18n)("summary.outdated")
return!this.topRepliesSummaryEnabled&&this.newPostsSinceSummary>0&&(e+=" ",e+=(0,v.i18n)("summary.outdated_posts",{count:this.newPostsSinceSummary})),e}resetSummary(){this.smoothStreamer.resetStreaming(),this.currentIndex=0,this.text="",this.summarizedOn=null,this.summarizedBy=null,this.newPostsSinceSummary=null,this.outdated=!1,this.canRegenerate=!1,this.loading=!1,this._channel=null}get topRepliesSummaryEnabled(){return this.args.model.postStream.summary}get topicId(){return this.args.model.topic.id}get baseSummarizationURL(){return`/discourse-ai/summarization/t/${this.topicId}`}subscribe(){const e=`/discourse-ai/summaries/topic/${this.args.model.topic.id}`
this._channel=e,this.messageBus.subscribe(e,this._updateSummary)}static{dt7948.n(this.prototype,"subscribe",[_.bind])}unsubscribe(){this.messageBus.unsubscribe("/discourse-ai/summaries/topic/*",this._updateSummary),this.resetSummary()}static{dt7948.n(this.prototype,"unsubscribe",[_.bind])}generateSummary(){let e=this.baseSummarizationURL
return this.currentUser&&(e+="?stream=true"),this._requestSummary(e)}static{dt7948.n(this.prototype,"generateSummary",[o.action])}regenerateSummary(){let e=this.baseSummarizationURL
return this.currentUser&&(e+="?stream=true",this.canRegenerate&&(e+="&skip_age_check=true")),this.resetSummary(),this._requestSummary(e)}static{dt7948.n(this.prototype,"regenerateSummary",[o.action])}_requestSummary(e){if(!(this.loading||this.text&&!this.canRegenerate))return this.loading=!0,this.summarizedOn=null,(0,f.ajax)(e).then(e=>{e?.ai_topic_summary?.summarized_text&&(e.done=!0,this._updateSummary(e))})}static{dt7948.n(this.prototype,"_requestSummary",[o.action])}async _updateSummary(e){const t={done:e.done,raw:e.ai_topic_summary?.summarized_text,...e.ai_topic_summary}
this.loading=!1,this.smoothStreamer.updateResult(t,"raw"),e.done&&(this.summarizedOn=(0,b.shortDateNoYear)(moment(t.updated_at,"YYYY-MM-DD HH:mm:ss Z")),this.summarizedBy=t.algorithm,this.newPostsSinceSummary=t.new_posts_since_summary,this.outdated=t.outdated,this.canRegenerate=t.outdated&&t.can_regenerate)}static{dt7948.n(this.prototype,"_updateSummary",[_.bind])}onRegisterApi(e){this.dMenu=e}static{dt7948.n(this.prototype,"onRegisterApi",[o.action])}handleClose(){this.modal.triggerElement=null,this.args.closeModal()}static{dt7948.n(this.prototype,"handleClose",[o.action])}static{(0,x.setComponentTemplate)((0,k.createTemplateFactory)({id:"hwMiUKLt",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-summary-modal"],[4,[32,3],[[30,0,["subscribe"]],[30,1,["topic","id"]]],null],[4,[32,4],[[30,0,["subscribe"]],[30,1,["topic","id"]]],null],[4,[32,5],[[30,0,["unsubscribe"]]],null]],[["@title","@closeModal","@bodyClass","@hideFooter"],[[28,[32,1],["discourse_ai.summarization.topic.title"],null],[30,0,["handleClose"]],"ai-summary-modal__body",[28,[32,2],[[30,0,["summarizedOn"]]],null]]],[["body","footer"],[[[[1,"\\n        "],[1,[28,[32,6],["scrollable-modal"],null]],[1,"\\n        "],[11,0],[24,0,"ai-summary-container"],[4,[32,3],[[30,0,["generateSummary"]]],null],[12],[1,"\\n          "],[10,"article"],[15,0,[28,[32,7],["ai-summary-box","streamable-content",[52,[30,0,["smoothStreamer","isStreaming"]],"streaming"]],null]],[12],[1,"\\n"],[41,[30,0,["loading"]],[[[1,"              "],[8,[32,8],null,null,null],[1,"\\n"]],[]],[[[1,"              "],[10,0],[14,0,"generated-summary cooked"],[12],[1,"\\n                "],[8,[32,9],null,[["@rawText"],[[30,0,["smoothStreamer","renderedText"]]]],null],[1,"\\n              "],[13],[1,"\\n"]],[]]],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[10,2],[14,0,"summarized-on"],[12],[1,"\\n          "],[1,[28,[32,1],["summary.summarized_on"],[["date"],[[30,0,["summarizedOn"]]]]]],[1,"\\n          "],[8,[32,10],null,[["@placements"],[[28,[32,11],["top-end"],null]]],[["trigger","content"],[[[[1,"\\n              "],[1,[28,[32,12],["circle-info"],null]],[1,"\\n            "]],[]],[[[1,"\\n              "],[1,[28,[32,1],["summary.model_used"],[["model"],[[30,0,["summarizedBy"]]]]]],[1,"\\n            "]],[]]]]],[1,"\\n        "],[13],[1,"\\n"],[41,[30,0,["outdated"]],[[[1,"          "],[10,2],[14,0,"summary-outdated"],[12],[1,[30,0,["outdatedSummaryWarningText"]]],[13],[1,"\\n"]],[]],null],[41,[30,0,["canRegenerate"]],[[[1,"          "],[8,[32,13],null,[["@label","@title","@action","@icon"],["summary.buttons.regenerate","summary.buttons.regenerate",[30,0,["regenerateSummary"]],"arrows-rotate"]],null],[1,"\\n"]],[]],null],[1,"      "]],[]]]]],[1,"\\n  "]],["@model"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-summary-modal.js",scope:()=>[p.default,v.i18n,d.not,a.default,n.default,r.default,g.default,m.default,w.default,u.default,y.default,i.array,h.default,c.default],isStrictMode:!0}),this)}}e.default=T}),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/utilities","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static{dt7948.g(this.prototype,"testResult",[s.tracked])}#B=void dt7948.i(this,"testResult")
static{dt7948.g(this.prototype,"isLoading",[s.tracked],function(){return!1})}#rt=void dt7948.i(this,"isLoading")
parameterValues={}
updateParameter(e,t){this.parameterValues[e]=t.target.value}static{dt7948.n(this.prototype,"updateParameter",[a.action])}async runTest(){this.isLoading=!0
try{const e=await(0,l.ajax)(`/admin/plugins/discourse-ai/ai-tools/${this.args.model.tool.id}/test.json`,{type:"POST",data:JSON.stringify({ai_tool:this.args.model.tool,parameters:this.parameterValues}),contentType:"application/json"})
this.testResult=(0,c.jsonToHtml)(e.output)}catch(e){(0,d.popupAjaxError)(e)}finally{this.isLoading=!1}}static{dt7948.n(this.prototype,"runTest",[a.action])}static{(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"LJMGtGI7",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-tool-test-modal"]],[["@title","@closeModal","@bodyClass"],[[28,[32,1],["discourse_ai.tools.test_modal.title"],null],[30,1],"ai-tool-test-modal__body"]],[["body","footer"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2,["tool","parameters"]]],null]],null],null,[[[1,"          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[10,"label"],[12],[1,[30,3,["name"]]],[13],[1,"\\n            "],[11,"input"],[16,3,[30,3,["name"]]],[24,4,"text"],[4,[32,2],["input",[28,[32,3],[[30,0,["updateParameter"]],[30,3,["name"]]],null]],null],[12],[13],[1,"\\n          "],[13],[1,"\\n"]],[3]],null],[1,"\\n"],[41,[30,0,["testResult"]],[[[1,"          "],[10,0],[14,0,"ai-tool-test-modal__test-result"],[12],[1,"\\n            "],[10,"h3"],[12],[1,[28,[32,1],["discourse_ai.tools.test_modal.result"],null]],[13],[1,"\\n            "],[10,0],[12],[1,[30,0,["testResult"]]],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"      "]],[]],[[[1,"\\n        "],[8,[32,4],[[24,0,"btn-primary ai-tool-test-modal__run-button"]],[["@action","@label","@disabled"],[[30,0,["runTest"]],"discourse_ai.tools.test_modal.run",[30,0,["isLoading"]]]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","@model","param"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal.js",scope:()=>[r.default,u.i18n,o.on,i.fn,n.default],isStrictMode:!0}),this)}}e.default=h}),define("discourse/plugins/discourse-ai/discourse/components/modal/chat-modal-channel-summary",["exports","@glimmer/component","@glimmer/tracking","@ember/object","discourse/components/conditional-loading-section","discourse/components/d-modal","discourse/components/d-modal-cancel","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","select-kit/components/combo-box","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends t.default{static{dt7948.g(this.prototype,"sinceHours",[s.tracked],function(){return null})}#lt=void dt7948.i(this,"sinceHours")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ge=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"summary",[s.tracked],function(){return null})}#dt=void dt7948.i(this,"summary")
availableSummaries={}
sinceOptions=[1,3,6,12,24,72,168].map(e=>({name:(0,d.i18n)("discourse_ai.summarization.chat.since",{count:e}),value:e}))
get channelId(){return this.args.model.channelId}summarize(e){return this.sinceHours=e,this.loading=!0,this.availableSummaries[e]?(this.summary=this.availableSummaries[e],void(this.loading=!1)):(0,r.ajax)(`/discourse-ai/summarization/channels/${this.channelId}.json`,{type:"GET",data:{since:e}}).then(e=>{this.availableSummaries[this.sinceHours]=e.summary,this.summary=this.availableSummaries[this.sinceHours]}).catch(l.popupAjaxError).finally(()=>this.loading=!1)}static{dt7948.n(this.prototype,"summarize",[i.action])}static{(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"ye9ZWC9O",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"chat-modal-channel-summary"]],[["@closeModal","@title"],[[30,1],[28,[32,1],["discourse_ai.summarization.chat.title"],null]]],[["body","footer"],[[[[1,"\\n        "],[10,1],[12],[1,[28,[32,1],["discourse_ai.summarization.chat.description"],null]],[13],[1,"\\n        "],[8,[32,2],[[24,0,"summarization-since"]],[["@value","@content","@onChange","@valueProperty"],[[30,0,["sinceHours"]],[30,0,["sinceOptions"]],[30,0,["summarize"]],"value"]],null],[1,"\\n        "],[8,[32,3],null,[["@isLoading"],[[30,0,["loading"]]]],[["default"],[[[[1,"\\n          "],[10,2],[14,0,"summary-area"],[12],[1,[30,0,["summary"]]],[13],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,4],null,[["@close"],[[30,1]]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/chat-modal-channel-summary.js",scope:()=>[a.default,d.i18n,u.default,o.default,n.default],isStrictMode:!0}),this)}}e.default=m}),define("discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/runloop","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/later","discourse/lib/utilities","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/utilities","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static{dt7948.g(this.prototype,"info",[s.tracked],function(){return null})}#ut=void dt7948.i(this,"info")
static{dt7948.g(this.prototype,"justCopiedText",[s.tracked],function(){return""})}#ct=void dt7948.i(this,"justCopiedText")
static{dt7948.g(this.prototype,"activeTab",[s.tracked],function(){return"request"})}#pt=void dt7948.i(this,"activeTab")
constructor(){super(...arguments),(0,a.next)(()=>{this.loadApiRequestInfo()})}get htmlContext(){if(!this.info)return""
let e
try{if("request"!==this.activeTab)return this.formattedResponse(this.info.raw_response_payload)
e=JSON.parse(this.info.raw_request_payload)}catch{return this.info.raw_request_payload}return(0,h.jsonToHtml)(e)}formattedResponse(e){const t=e.split("\n").map(e=>(0,p.escapeExpression)(e)).join("<br>")
return(0,n.htmlSafe)(t)}copyRequest(){this.copy(this.info.raw_request_payload)}static{dt7948.n(this.prototype,"copyRequest",[o.action])}copyResponse(){this.copy(this.info.raw_response_payload)}static{dt7948.n(this.prototype,"copyResponse",[o.action])}async loadLog(e){try{await(0,d.ajax)(`/discourse-ai/ai-bot/show-debug-info/${e}.json`).then(e=>{this.info=e})}catch(t){(0,u.popupAjaxError)(t)}}prevLog(){this.loadLog(this.info.prev_log_id)}static{dt7948.n(this.prototype,"prevLog",[o.action])}nextLog(){this.loadLog(this.info.next_log_id)}static{dt7948.n(this.prototype,"nextLog",[o.action])}copy(e){(0,p.clipboardCopy)(e),this.justCopiedText=(0,m.i18n)("discourse_ai.ai_bot.conversation_shared"),(0,c.default)(()=>{this.justCopiedText=""},2e3)}loadApiRequestInfo(){(0,d.ajax)(`/discourse-ai/ai-bot/post/${this.args.model.id}/show-debug-info.json`).then(e=>{this.info=e}).catch(e=>{(0,u.popupAjaxError)(e)})}get requestActive(){return"request"===this.activeTab?"active":""}get responseActive(){return"response"===this.activeTab?"active":""}requestClicked(e){this.activeTab="request",e.preventDefault()}static{dt7948.n(this.prototype,"requestClicked",[o.action])}responseClicked(e){this.activeTab="response",e.preventDefault()}static{dt7948.n(this.prototype,"responseClicked",[o.action])}static{(0,g.setComponentTemplate)((0,f.createTemplateFactory)({id:"/0GMjCML",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-debug-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[10,"ul"],[14,0,"nav nav-pills ai-debug-modal__nav"],[12],[1,"\\n          "],[10,"li"],[12],[11,3],[24,6,""],[16,0,[30,0,["requestActive"]]],[4,[32,2],["click",[30,0,["requestClicked"]]],null],[12],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.request"],null]],[13],[13],[1,"\\n          "],[10,"li"],[12],[11,3],[24,6,""],[16,0,[30,0,["responseActive"]]],[4,[32,2],["click",[30,0,["responseClicked"]]],null],[12],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.response"],null]],[13],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"ai-debug-modal__tokens"],[12],[1,"\\n          "],[10,1],[14,0,"ai-debug-modal__tokens__count"],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.request_tokens"],null]],[1,"\\n            "],[1,[30,0,["info","request_tokens"]]],[1,"\\n          "],[13],[1,"\\n          "],[10,1],[14,0,"ai-debug-modal__tokens__count"],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.response_tokens"],null]],[1,"\\n            "],[1,[30,0,["info","response_tokens"]]],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"debug-ai-modal__preview"],[12],[1,"\\n          "],[1,[30,0,["htmlContext"]]],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,3],[[24,0,"btn confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyRequest"]],"discourse_ai.ai_bot.debug_ai_modal.copy_request"]],null],[1,"\\n        "],[8,[32,3],[[24,0,"btn confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyResponse"]],"discourse_ai.ai_bot.debug_ai_modal.copy_response"]],null],[1,"\\n"],[41,[30,0,["info","prev_log_id"]],[[[1,"          "],[8,[32,3],[[24,0,"btn"]],[["@icon","@action","@label"],["angles-left",[30,0,["prevLog"]],"discourse_ai.ai_bot.debug_ai_modal.previous_log"]],null],[1,"\\n"]],[]],null],[41,[30,0,["info","next_log_id"]],[[[1,"          "],[8,[32,3],[[24,0,"btn"]],[["@icon","@action","@label"],["angles-right",[30,0,["nextLog"]],"discourse_ai.ai_bot.debug_ai_modal.next_log"]],null],[1,"\\n"]],[]],null],[1,"        "],[10,1],[14,0,"ai-debut-modal__just-copied"],[12],[1,[30,0,["justCopiedText"]]],[13],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal.js",scope:()=>[l.default,m.i18n,i.on,r.default],isStrictMode:!0}),this)}}e.default=_}),define("discourse/plugins/discourse-ai/discourse/components/modal/diff-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/will-destroy","@ember/service","@ember/template","truth-helpers","discourse/components/cook-text","discourse/components/d-button","discourse/components/d-modal","discourse/helpers/concat-class","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/decorators","discourse/lib/utilities","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/diff-streamer","discourse/plugins/discourse-ai/discourse/lib/smooth-streamer","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f,_,b,v,y,w){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class S extends t.default{static{dt7948.g(this.prototype,"messageBus",[a.service])}#ce=void dt7948.i(this,"messageBus")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ge=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"finalResult",[s.tracked],function(){return""})}#mt=void dt7948.i(this,"finalResult")
static{dt7948.g(this.prototype,"escapedSelectedText",[s.tracked],function(){return(0,g.escapeExpression)(this.args.model.selectedText)})}#ht=void dt7948.i(this,"escapedSelectedText")
static{dt7948.g(this.prototype,"diffStreamer",[s.tracked],function(){return new _.default(this.args.model.selectedText)})}#gt=void dt7948.i(this,"diffStreamer")
static{dt7948.g(this.prototype,"suggestion",[s.tracked],function(){return""})}#fe=void dt7948.i(this,"suggestion")
static{dt7948.g(this.prototype,"smoothStreamer",[s.tracked],function(){return new b.default(()=>this.suggestion,e=>this.suggestion=e)})}#Te=void dt7948.i(this,"smoothStreamer")
constructor(){super(...arguments),this.suggestChanges()}get diffResult(){return this.loading?this.escapedSelectedText:this.diffStreamer.diff?.length>0?this.diffStreamer.diff:this.escapedSelectedText}get smoothStreamerResult(){return this.loading?this.escapedSelectedText:this.smoothStreamer.renderedText}get isStreaming(){return this.args.model.showResultAsDiff?!this.diffStreamer.isDone:this.smoothStreamer.isStreaming}get primaryBtnLabel(){return this.loading?(0,f.i18n)("discourse_ai.ai_helper.context_menu.loading"):(0,f.i18n)("discourse_ai.ai_helper.context_menu.confirm")}get primaryBtnDisabled(){return this.loading||this.isStreaming}set progressChannel(e){this._progressChannel&&this.messageBus.unsubscribe(this._progressChannel,this.updateResult),this._progressChannel=e,this.subscribe()}subscribe(){this.messageBus.subscribe(this._progressChannel,this.updateResult,0)}cleanup(){this.#ft(),this._progressChannel&&this.messageBus.unsubscribe(this._progressChannel,this.updateResult)}static{dt7948.n(this.prototype,"cleanup",[h.bind])}updateResult(e){this.loading=!1,e.done&&(this.finalResult=e.result,this.loading=!1),this.args.model.showResultAsDiff?this.diffStreamer.updateResult(e,"result"):this.smoothStreamer.updateResult(e,"result")}static{dt7948.n(this.prototype,"updateResult",[i.action])}async suggestChanges(){this.#ft()
try{this.loading=!0
const e=await(0,p.ajax)("/discourse-ai/ai-helper/stream_suggestion",{method:"POST",data:{location:"composer",mode:this.args.model.mode,text:this.args.model.selectedText,custom_prompt:this.args.model.customPromptValue,force_default_locale:!0,client_id:this.messageBus.clientId}})
this.progressChannel=e.progress_channel}catch(e){(0,m.popupAjaxError)(e)}}static{dt7948.n(this.prototype,"suggestChanges",[i.action])}triggerConfirmChanges(){this.args.closeModal(),this.suggestion&&this.args.model.toolbarEvent.replaceText(this.args.model.selectedText,this.suggestion)
const e=this.finalResult?.length>0?this.finalResult:this.diffStreamer.suggestion
this.args.model.showResultAsDiff&&e&&this.args.model.toolbarEvent.replaceText(this.args.model.selectedText,e)}static{dt7948.n(this.prototype,"triggerConfirmChanges",[i.action])}cleanupAndClose(){this.#ft(),this.loading=!1,this.args.closeModal()}static{dt7948.n(this.prototype,"cleanupAndClose",[i.action])}#ft(){this.suggestion="",this.finalResult="",this.smoothStreamer.resetStreaming(),this.diffStreamer.reset()}static{(0,y.setComponentTemplate)((0,w.createTemplateFactory)({id:"BZ80Ev5M",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"composer-ai-helper-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_helper.context_menu.changes"],null],[30,0,["cleanupAndClose"]]]],[["body","footer"],[[[[1,"\\n        "],[11,0],[24,0,"text-preview"],[4,[32,2],[[30,0,["cleanup"]]],null],[12],[1,"\\n          "],[10,0],[15,0,[28,[32,3],["composer-ai-helper-modal__suggestion","streamable-content",[52,[30,0,["isStreaming"]],"streaming"],[52,[30,1,["showResultAsDiff"]],"inline-diff"],[52,[30,0,["diffStreamer","isThinking"]],"thinking"],[52,[30,0,["loading"]],"composer-ai-helper-modal__loading"]],null]],[12],[41,[30,1,["showResultAsDiff"]],[[[10,1],[14,0,"diff-inner"],[12],[1,[28,[32,4],[[30,0,["diffResult"]]],null]],[13],[1,"\\n"]],[]],[[[41,[28,[32,5],[[30,0,["loading"]],[30,0,["smoothStreamer","isStreaming"]]],null],[[[1,"                "],[8,[32,6],[[24,0,"cooked"]],[["@rawText"],[[30,0,["smoothStreamerResult"]]]],null],[1,"\\n"]],[]],[[[1,"                "],[10,0],[14,0,"composer-ai-helper-modal__old-value"],[12],[1,[30,0,["escapedSelectedText"]]],[13],[1,"\\n                "],[10,0],[14,0,"composer-ai-helper-modal__new-value"],[12],[1,"\\n                  "],[8,[32,6],[[24,0,"cooked"]],[["@rawText"],[[30,0,["smoothStreamerResult"]]]],null],[1,"\\n                "],[13],[1,"\\n"]],[]]]],[]]],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,7],[[24,0,"btn-primary confirm"]],[["@disabled","@action","@translatedLabel"],[[30,0,["primaryBtnDisabled"]],[30,0,["triggerConfirmChanges"]],[30,0,["primaryBtnLabel"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["loading"]],[[[1,"            "],[8,[32,8],null,[["@loading"],[[30,0,["loading"]]]],null],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n        "],[8,[32,7],[[24,0,"btn-flat discard"]],[["@action","@label"],[[30,0,["cleanupAndClose"]],"discourse_ai.ai_helper.context_menu.discard"]],null],[1,"\\n        "],[8,[32,7],[[24,0,"regenerate"]],[["@icon","@action","@label"],["arrows-rotate",[30,0,["suggestChanges"]],"discourse_ai.ai_helper.context_menu.regen"]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@model"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/diff-modal.js",scope:()=>[u.default,f.i18n,o.default,c.default,n.htmlSafe,r.or,l.default,d.default,v.default],isStrictMode:!0}),this)}}e.default=S}),define("discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/service","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/get-url","discourse/lib/utilities","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static{dt7948.g(this.prototype,"toasts",[a.service])}#R=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"shareKey",[s.tracked],function(){return""})}#_t=void dt7948.i(this,"shareKey")
constructor(){super(...arguments),this.shareKey=this.args.model.share_key}get htmlContext(){let e=[]
return this.args.model.context.forEach(t=>{e.push(`<p><b>${t.username}:</b></p>`),e.push(t.cooked)}),(0,n.htmlSafe)(e.join("\n"))}async generateShareURL(){try{const e=await(0,d.ajax)("/discourse-ai/ai-bot/shared-ai-conversations",{type:"POST",data:{topic_id:this.args.model.topic_id}}),t=(0,c.getAbsoluteURL)(`/discourse-ai/ai-bot/shared-ai-conversations/${e.share_key}`)
return this.shareKey=e.share_key,new Blob([t],{type:"text/plain"})}catch(e){return void(0,u.popupAjaxError)(e)}}get primaryLabel(){return this.shareKey?"discourse_ai.ai_bot.share_full_topic_modal.update":"discourse_ai.ai_bot.share_full_topic_modal.share"}async deleteLink(){try{await(0,d.ajax)(`/discourse-ai/ai-bot/shared-ai-conversations/${this.shareKey}.json`,{type:"DELETE"}),this.shareKey=null}catch(e){(0,u.popupAjaxError)(e)}}static{dt7948.n(this.prototype,"deleteLink",[o.action])}async share(){await(0,p.clipboardCopyAsync)(this.generateShareURL.bind(this)),this.toasts.success({duration:"short",data:{message:(0,m.i18n)("discourse_ai.ai_bot.conversation_shared")}})}static{dt7948.n(this.prototype,"share",[o.action])}async maybeCopyEmbed(e){if(!e.target.classList.contains("copy-embed"))return!0
e.stopPropagation(),e.preventDefault()
let t=""
e.target.dataset.artifactVersion&&(t=`data-ai-artifact-version="${e.target.dataset.artifactVersion}"`)
const s=`<div class="ai-artifact" ${t} data-ai-artifact-id="${e.target.dataset.artifactId}"></div>`,i=new Promise(e=>{e(s)})
await(0,p.clipboardCopyAsync)(()=>i),this.toasts.success({duration:"short",data:{message:(0,m.i18n)("discourse_ai.ai_bot.embed_copied")}})}static{dt7948.n(this.prototype,"maybeCopyEmbed",[o.action])}static{(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"usffRdOP",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-share-full-topic-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.share_full_topic_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n"],[1,"        "],[11,0],[24,0,"ai-share-full-topic-modal__body"],[4,[32,2],["click",[30,0,["maybeCopyEmbed"]]],null],[12],[1,"\\n          "],[1,[30,0,["htmlContext"]]],[1,"\\n        "],[13],[1,"\\n"],[1,"      "]],[]],[[[1,"\\n        "],[8,[32,3],[[24,0,"btn-primary confirm"]],[["@icon","@action","@label"],["copy",[30,0,["share"]],[30,0,["primaryLabel"]]]],null],[1,"\\n"],[41,[30,0,["shareKey"]],[[[1,"          "],[8,[32,3],[[24,0,"btn-danger"]],[["@icon","@action","@label"],["far-trash-can",[30,0,["deleteLink"]],"discourse_ai.ai_bot.share_full_topic_modal.delete"]],null],[1,"\\n"]],[]],null],[1,"      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal.js",scope:()=>[l.default,m.i18n,i.on,r.default],isStrictMode:!0}),this)}}e.default=f}),define("discourse/plugins/discourse-ai/discourse/components/modal/share-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/modifier","@ember/object","@ember/service","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse/lib/later","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/lib/copy-conversation","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static{dt7948.g(this.prototype,"modal",[n.service])}#j=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"currentUser",[n.service])}#k=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"contextValue",[s.tracked],function(){return 1})}#bt=void dt7948.i(this,"contextValue")
static{dt7948.g(this.prototype,"htmlContext",[s.tracked],function(){return""})}#vt=void dt7948.i(this,"htmlContext")
static{dt7948.g(this.prototype,"maxContext",[s.tracked],function(){return 0})}#yt=void dt7948.i(this,"maxContext")
static{dt7948.g(this.prototype,"allPosts",[s.tracked],function(){return[]})}#wt=void dt7948.i(this,"allPosts")
static{dt7948.g(this.prototype,"justCopiedText",[s.tracked],function(){return""})}#ct=void dt7948.i(this,"justCopiedText")
constructor(){super(...arguments)
const e=this.args.model.topic.get("postStream")
let t=[]
for(let s=1;s<=this.args.model.post_number;s++)t.push(s)
this.allPosts=t.map(t=>{let s=e.findPostIdForPostNumber(t)
if(s)return e.findLoadedPost(s)}).filter(e=>e),this.maxContext=this.allPosts.length/2,this.contextValue=1,this.updateHtmlContext()}updateHtmlContext(){let e=[]
for(let t=this.allPosts.length-2*this.contextValue;t<this.allPosts.length;t++){const s=this.allPosts[t]
e.push(`<p><b>${s.username}:</b></p>`),e.push(s.cooked)}this.htmlContext=(0,r.htmlSafe)(e.join("\n"))}static{dt7948.n(this.prototype,"updateHtmlContext",[a.action])}async copyContext(){const e=this.allPosts[this.allPosts.length-2*this.contextValue].post_number,t=this.args.model.post_number
await(0,m.default)(this.args.model.topic,e,t),this.justCopiedText=(0,c.i18n)("discourse_ai.ai_bot.conversation_shared"),(0,u.default)(()=>{this.justCopiedText=""},2e3)}static{dt7948.n(this.prototype,"copyContext",[a.action])}shareConversationModal(e){return e?.preventDefault(),this.args.closeModal(),(0,p.showShareConversationModal)(this.modal,this.args.model.topic_id),!1}static{dt7948.n(this.prototype,"shareConversationModal",[a.action])}static{(0,i.setComponentTemplate)((0,h.createTemplateFactory)({id:"Ccsc9yzh",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-share-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.share_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[10,0],[14,0,"ai-share-modal__preview"],[12],[1,"\\n          "],[1,[30,0,["htmlContext"]]],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[10,0],[14,0,"ai-share-modal__slider"],[12],[1,"\\n          "],[8,[32,2],[[24,"min","1"],[16,"max",[30,0,["maxContext"]]],[4,[32,3],["change",[30,0,["updateHtmlContext"]]],null]],[["@type","@value"],["range",[30,0,["contextValue"]]]],null],[1,"\\n          "],[10,0],[14,0,"ai-share-modal__context"],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_bot.share_modal.context"],null]],[1,"\\n            "],[1,[30,0,["contextValue"]]],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[8,[32,4],[[24,0,"btn-primary confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyContext"]],"discourse_ai.ai_bot.share_modal.copy"]],null],[1,"\\n        "],[10,1],[14,0,"ai-share-modal__just-copied"],[12],[1,[30,0,["justCopiedText"]]],[13],[1,"\\n"],[41,[30,0,["currentUser","can_share_ai_bot_conversations"]],[[[1,"          "],[11,3],[24,6,""],[4,[32,3],["click",[30,0,["shareConversationModal"]]],null],[12],[1,"\\n            "],[10,1],[14,0,"ai-share-modal__share-tip"],[12],[1,"\\n              "],[1,[28,[32,1],["discourse_ai.ai_bot.share_modal.share_tip"],null]],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/share-modal.js",scope:()=>[d.default,c.i18n,i.Input,o.on,l.default],isStrictMode:!0}),this)}}e.default=g}),define("discourse/plugins/discourse-ai/discourse/components/modal/spam-test-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/components/d-modal","discourse/helpers/with-event-value","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static{dt7948.g(this.prototype,"testResult",[s.tracked])}#B=void dt7948.i(this,"testResult")
static{dt7948.g(this.prototype,"isLoading",[s.tracked],function(){return!1})}#rt=void dt7948.i(this,"isLoading")
static{dt7948.g(this.prototype,"postUrl",[s.tracked],function(){return""})}#St=void dt7948.i(this,"postUrl")
static{dt7948.g(this.prototype,"scanLog",[s.tracked],function(){return""})}#xt=void dt7948.i(this,"scanLog")
static{dt7948.g(this.prototype,"isSpam",[s.tracked])}#kt=void dt7948.i(this,"isSpam")
async runTest(){this.isLoading=!0
try{const e=await(0,d.ajax)("/admin/plugins/discourse-ai/ai-spam/test.json",{type:"POST",data:{post_url:this.postUrl,custom_instructions:this.args.model.customInstructions,llm_id:this.args.model.llmId}})
this.isSpam=e.is_spam,this.testResult=e.is_spam?(0,c.i18n)("discourse_ai.spam.test_modal.spam"):(0,c.i18n)("discourse_ai.spam.test_modal.not_spam"),this.scanLog=e.log}catch(e){(0,u.popupAjaxError)(e)}finally{this.isLoading=!1}}static{dt7948.n(this.prototype,"runTest",[a.action])}static{(0,m.setComponentTemplate)((0,h.createTemplateFactory)({id:"34+xPAxG",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"spam-test-modal"]],[["@title","@closeModal","@bodyClass"],[[28,[32,1],["discourse_ai.spam.test_modal.title"],null],[30,1],"spam-test-modal__body"]],[["body","footer"],[[[[1,"\\n        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,1],["discourse_ai.spam.test_modal.post_url_label"],null]],[13],[1,"\\n          "],[11,"input"],[16,"placeholder",[28,[32,1],["discourse_ai.spam.test_modal.post_url_placeholder"],null]],[24,4,"text"],[4,[32,2],["input",[28,[32,3],[[28,[32,4],[[28,[31,0],[[30,0,["postUrl"]]],null]],null]],null]],null],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[30,0,["testResult"]],[[[1,"          "],[10,0],[14,0,"spam-test-modal__test-result"],[12],[1,"\\n            "],[10,"h3"],[12],[1,[28,[32,1],["discourse_ai.spam.test_modal.result"],null]],[13],[1,"\\n            "],[10,0],[15,0,[29,["spam-test-modal__verdict\\n                ",[52,[30,0,["isSpam"]],"is-spam","not-spam"]]]],[12],[1,"\\n              "],[1,[30,0,["testResult"]]],[1,"\\n            "],[13],[1,"\\n"],[41,[30,0,["scanLog"]],[[[1,"              "],[10,0],[14,0,"spam-test-modal__log"],[12],[1,"\\n                "],[10,"h4"],[12],[1,[28,[32,1],["discourse_ai.spam.test_modal.scan_log"],null]],[13],[1,"\\n                "],[10,"pre"],[12],[1,[30,0,["scanLog"]]],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],null],[1,"          "],[13],[1,"\\n"]],[]],null],[1,"      "]],[]],[[[1,"\\n        "],[8,[32,5],[[24,0,"btn-primary spam-test-modal__run-button"]],[["@action","@label","@disabled"],[[30,0,["runTest"]],"discourse_ai.spam.test_modal.run",[30,0,["isLoading"]]]],[["default"],[[[[1,"\\n          "],[8,[32,6],null,[["@loading"],[[30,0,["isLoading"]]]],null],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,["mut","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/spam-test-modal.js",scope:()=>[r.default,c.i18n,o.on,l.default,i.fn,n.default,p.default],isStrictMode:!0}),this)}}e.default=g}),define("discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions",["exports","@glimmer/component","@glimmer/tracking","@ember/object","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/d-modal","discourse/components/d-modal-cancel","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ge=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"selectedImages",[s.tracked],function(){return[]})}#Tt=void dt7948.i(this,"selectedImages")
static{dt7948.g(this.prototype,"thumbnails",[s.tracked],function(){return null})}#Pt=void dt7948.i(this,"thumbnails")
constructor(){super(...arguments),this.findThumbnails()}get isDisabled(){return 0===this.selectedImages.length}async findThumbnails(){this.loading=!0
try{const e=await(0,l.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:this.args.model.mode,text:this.args.model.selectedText,force_default_locale:!0}})
this.thumbnails=e.thumbnails}catch(e){(0,d.popupAjaxError)(e)}finally{this.loading=!1}}addSelection(e){const t=`![${e.original_filename}|${e.width}x${e.height}](${e.short_url})`
this.selectedImages=[...this.selectedImages,t]}static{dt7948.n(this.prototype,"addSelection",[i.action])}removeSelection(e){const t=`![${e.original_filename}|${e.width}x${e.height}](${e.short_url})`
this.selectedImages=this.selectedImages.filter(e=>{if(e!==t)return e})}static{dt7948.n(this.prototype,"removeSelection",[i.action])}appendSelectedImages(){const e="\n\n"+this.selectedImages.join("\n"),t=document.querySelector(".d-editor-input")
t.setSelectionRange(t.value.length,t.value.length),t.focus(),document.execCommand("insertText",!1,e),this.args.closeModal()}static{dt7948.n(this.prototype,"appendSelectedImages",[i.action])}static{(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"NK1Pg0q5",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"thumbnail-suggestions-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_helper.thumbnail_suggestions.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[8,[32,2],null,[["@condition"],[[30,0,["loading"]]]],[["default"],[[[[1,"\\n          "],[10,0],[14,0,"ai-thumbnail-suggestions"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["thumbnails"]]],null]],null],null,[[[1,"              "],[8,[32,3],null,[["@thumbnail","@addSelection","@removeSelection"],[[30,2],[30,0,["addSelection"]],[30,0,["removeSelection"]]]],null],[1,"\\n"]],[2]],null],[1,"          "],[13],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,4],[[24,0,"btn-primary create"]],[["@action","@label","@disabled"],[[30,0,["appendSelectedImages"]],"save",[30,0,["isDisabled"]]]],null],[1,"\\n        "],[8,[32,5],null,[["@close"],[[30,1]]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","thumbnail"],false,["each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions.js",scope:()=>[n.default,u.i18n,o.default,c.default,a.default,r.default],isStrictMode:!0}),this)}}e.default=h}),define("discourse/plugins/discourse-ai/discourse/components/model-accuracies",["exports","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,s.setComponentTemplate)((0,i.createTemplateFactory)({id:"+cgPW/Ry",block:'[[[1,"\\n"],[41,[30,1],[[[1,"    "],[10,"table"],[14,0,"reviewable-scores"],[12],[1,"\\n      "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[30,1]],null],null,[[[1,"          "],[10,"tr"],[12],[1,"\\n            "],[10,"td"],[14,"colspan","4"],[12],[1,[28,[32,0],["discourse_ai.reviewables.model_used"],null]],[13],[1,"\\n            "],[10,"td"],[14,"colspan","3"],[12],[1,[30,3]],[13],[1,"\\n            "],[10,"td"],[14,"colspan","4"],[12],[1,[28,[32,0],["discourse_ai.reviewables.accuracy"],null]],[13],[1,"\\n            "],[10,"td"],[14,"colspan","3"],[12],[1,[30,2]],[1,"%"],[13],[1,"\\n          "],[13],[1,"\\n"]],[2,3]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n"]],[]],null]],["@accuracies","acc","model"],false,["if","each","-each-in"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/model-accuracies.js",scope:()=>[t.i18n],isStrictMode:!0}),(0,o.default)(void 0,"model-accuracies:ModelAccuracies"))
e.default=a}),define("discourse/plugins/discourse-ai/discourse/components/post-menu/ai-cancel-streaming-button",["exports","@glimmer/component","@ember/object","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{async cancelStreaming(){const e=this.args.post
try{await(0,o.ajax)(`/discourse-ai/ai-bot/post/${e.id}/stop-streaming`,{type:"POST"}),document.querySelector(`#post_${e.post_number}`).classList.remove("streaming")}catch(t){(0,a.popupAjaxError)(t)}}static{dt7948.n(this.prototype,"cancelStreaming",[s.action])}static{(0,n.setComponentTemplate)((0,r.createTemplateFactory)({id:"eS4Xq4iv",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"post-action-menu__ai-cancel-streaming cancel-streaming"],[17,1]],[["@action","@icon","@title"],[[30,0,["cancelStreaming"]],"pause","discourse_ai.ai_bot.cancel_streaming"]],null],[1,"\\n  "]],["&attrs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/post-menu/ai-cancel-streaming-button.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/components/post-menu/ai-debug-button",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static shouldRender(e){return(0,a.isPostFromAiBot)(e.post,e.state.currentUser)}static{dt7948.g(this.prototype,"modal",[i.service])}#j=void dt7948.i(this,"modal")
debugAiResponse(){this.modal.show(n.default,{model:this.args.post})}static{dt7948.n(this.prototype,"debugAiResponse",[s.action])}static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"a7gp58E/",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"post-action-menu__debug-ai"],[17,1]],[["@action","@icon","@title"],[[30,0,["debugAiResponse"]],"info","discourse_ai.ai_bot.debug_ai"]],null],[1,"\\n  "]],["&attrs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/post-menu/ai-debug-button.js",scope:()=>[o.default],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/discourse-ai/discourse/components/post-menu/ai-share-button",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/lib/copy-conversation","discourse/plugins/discourse-ai/discourse/components/modal/share-modal","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static shouldRender(e){return(0,a.isPostFromAiBot)(e.post,e.state.currentUser)}static{dt7948.g(this.prototype,"modal",[i.service])}#j=void dt7948.i(this,"modal")
async shareAiResponse(){const e=this.args.post
e.post_number<=4?(await(0,n.default)(e.topic,1,e.post_number),this.args.showFeedback("discourse_ai.ai_bot.conversation_shared")):this.modal.show(r.default,{model:e})}static{dt7948.n(this.prototype,"shareAiResponse",[s.action])}static{(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"GGDSzGUM",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"post-action-menu__share-ai"],[17,1]],[["@action","@icon","@title"],[[30,0,["shareAiResponse"]],"far-copy","discourse_ai.ai_bot.share"]],null],[1,"\\n  "]],["&attrs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/post-menu/ai-share-button.js",scope:()=>[o.default],isStrictMode:!0}),this)}}e.default=u}),define("discourse/plugins/discourse-ai/discourse/components/post/ai-persona-flair",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e){return(0,s.isGPTBot)(e.post.user)}static{(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"g/xynBPl",block:'[[[1,"\\n    "],[10,1],[14,0,"persona-flair"],[12],[1,"\\n      "],[1,[30,1,["post","topic","ai_persona_name"]]],[1,"\\n    "],[13],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/post/ai-persona-flair.js",isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/components/rag-options-fk",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-llm-selector","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static{dt7948.g(this.prototype,"showIndexingOptions",[s.tracked],function(){return!1})}#Ct=void dt7948.i(this,"showIndexingOptions")
toggleIndexingOptions(e){this.showIndexingOptions=!this.showIndexingOptions,e.preventDefault(),e.stopPropagation()}static{dt7948.n(this.prototype,"toggleIndexingOptions",[o.action])}get indexingOptionsText(){return this.showIndexingOptions?(0,a.i18n)("discourse_ai.rag.options.hide_indexing_options"):(0,a.i18n)("discourse_ai.rag.options.show_indexing_options")}get visionLlms(){return this.args.llms.filter(e=>e.vision_enabled)}static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"aJfOKu/I",block:'[[[1,"\\n"],[41,[30,1,["rag_uploads"]],[[[1,"      "],[11,3],[24,6,"#"],[24,0,"rag-options__indexing-options"],[4,[32,0],["click",[30,0,["toggleIndexingOptions"]]],null],[12],[1,[30,0,["indexingOptionsText"]]],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showIndexingOptions"]],[[[1,"      "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_chunk_tokens",[28,[32,1],["discourse_ai.rag.options.rag_chunk_tokens"],null],[28,[32,1],["discourse_ai.rag.options.rag_chunk_tokens_help"],null],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,3,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n      "]],[3]]]]],[1,"\\n\\n      "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_chunk_overlap_tokens",[28,[32,1],["discourse_ai.rag.options.rag_chunk_tokens"],null],[28,[32,1],["discourse_ai.rag.options.rag_chunk_overlap_tokens_help"],null],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,4,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n      "]],[4]]]]],[1,"\\n\\n"],[41,[30,5],[[[1,"        "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_llm_model_id",[28,[32,1],["discourse_ai.rag.options.rag_llm_model"],null],[28,[32,1],["discourse_ai.rag.options.rag_llm_model_help"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,6,["Custom"]],null,null,[["default"],[[[[1,"\\n            "],[8,[32,2],null,[["@value","@llms","@onChange","@class"],[[30,6,["value"]],[30,0,["visionLlms"]],[30,6,["set"]],"ai-persona-editor__llms"]],null],[1,"\\n          "]],[]]]]],[1,"\\n        "]],[6]]]]],[1,"\\n"]],[]],null],[1,"      "],[18,7,null],[1,"\\n"]],[]],null],[1,"  "]],["@data","@form","field","field","@allowImages","field","&default"],false,["if","yield"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/rag-options-fk.js",scope:()=>[i.on,a.i18n,n.default],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/discourse-ai/discourse/components/rag-upload-progress",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","discourse/helpers/d-icon","discourse/lib/decorators","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static{dt7948.g(this.prototype,"messageBus",[a.service])}#ce=void dt7948.i(this,"messageBus")
static{dt7948.g(this.prototype,"updatedProgress",[s.tracked],function(){return null})}#jt=void dt7948.i(this,"updatedProgress")
willDestroy(){super.willDestroy(...arguments),this.messageBus.unsubscribe(`/discourse-ai/rag/${this.args.upload.id}`)}trackProgress(){this.messageBus.subscribe(`/discourse-ai/rag/${this.args.upload.id}`,this.onIndexingUpdate)}static{dt7948.n(this.prototype,"trackProgress",[i.action])}onIndexingUpdate(e){(!this.updatedProgress||0===this.updatedProgress.left||this.updatedProgress.left>e.left||e.total===e.indexed)&&(this.updatedProgress=e)}static{dt7948.n(this.prototype,"onIndexingUpdate",[r.bind])}get calculateProgress(){return 0===this.progress.total?0:Math.ceil(100*this.progress.indexed/this.progress.total)}get fullyIndexed(){return this.progress&&0!==this.progress.total&&0===this.progress.left}get progress(){return this.updatedProgress?this.updatedProgress:this.args.ragIndexingStatuses?this.args.ragIndexingStatuses[this.args.upload.id]:[]}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"AyWODt7W",block:'[[[1,"\\n    "],[11,"td"],[24,0,"rag-uploader__upload-status"],[4,[32,0],[[30,0,["trackProgress"]]],null],[12],[1,"\\n"],[41,[30,0,["progress"]],[[[41,[30,0,["fullyIndexed"]],[[[1,"          "],[10,1],[14,0,"indexed"],[12],[1,"\\n            "],[1,[28,[32,1],["check"],null]],[1,"\\n            "],[1,[28,[32,2],["discourse_ai.rag.uploads.indexed"],null]],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[1,"          "],[10,1],[14,0,"indexing"],[12],[1,"\\n            "],[1,[28,[32,1],["robot"],null]],[1,"\\n            "],[1,[28,[32,2],["discourse_ai.rag.uploads.indexing"],null]],[1,"\\n            "],[1,[30,0,["calculateProgress"]]],[1,"%\\n          "],[13],[1,"\\n"]],[]]]],[]],[[[1,"        "],[10,1],[14,0,"uploaded"],[12],[1,[28,[32,2],["discourse_ai.rag.uploads.uploaded"],null]],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/rag-upload-progress.js",scope:()=>[o.default,n.default,l.i18n],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/rag-uploader",["exports","@glimmer/tracking","@ember/component","@ember/helper","@ember/modifier","@ember/object","@ember/owner","@ember/render-modifiers/modifiers/did-insert","@ember/service","discourse/components/d-button","discourse/helpers/d-icon","discourse/lib/ajax","discourse/lib/debounce","discourse/lib/uppy/uppy-upload","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/rag-upload-progress","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends s.default{static{dt7948.g(this.prototype,"appEvents",[l.service])}#S=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"term",[t.tracked],function(){return null})}#Mt=void dt7948.i(this,"term")
static{dt7948.g(this.prototype,"filteredUploads",[t.tracked],function(){return null})}#At=void dt7948.i(this,"filteredUploads")
static{dt7948.g(this.prototype,"ragIndexingStatuses",[t.tracked],function(){return null})}#Ot=void dt7948.i(this,"ragIndexingStatuses")
static{dt7948.g(this.prototype,"ragUploads",[t.tracked],function(){return null})}#Et=void dt7948.i(this,"ragUploads")
uppyUpload=new m.default((0,n.getOwner)(this),{id:"discourse-ai-rag-uploader",maxFiles:20,type:"discourse_ai_rag_upload",uploadUrl:"/admin/plugins/discourse-ai/rag-document-fragments/files/upload",preventDirectS3Uploads:!0,uploadDone:e=>{const t=e.upload
t.status="uploaded",t.statusText=(0,h.i18n)("discourse_ai.rag.uploads.uploaded"),this.ragUploads.pushObject(t),this.debouncedSearch()}})
willDestroy(){super.willDestroy(...arguments),this.appEvents.off(`upload-mixin:${this.uppyUpload.config}:all-uploads-complete`,this,"_updateTargetWithUploads")}didReceiveAttrs(){super.didReceiveAttrs(...arguments),this.uppyUpload.inProgressUploads?.length>0&&this.uppyUpload.cancelAllUploads(),this.ragUploads=this.target?.rag_uploads?.slice()||[],this.filteredUploads=this.ragUploads
const e=this.targetName||this.target?.constructor?.name
this.ragUploads?.length&&this.target?.id&&(0,c.ajax)(`/admin/plugins/discourse-ai/rag-document-fragments/files/status.json?target_type=${e}&target_id=${this.target.id}`).then(e=>{this.set("ragIndexingStatuses",e)}),this.appEvents.on(`upload-mixin:${this.uppyUpload.config.id}:all-uploads-complete`,this,"_updateTargetWithUploads")}_updateTargetWithUploads(){this.updateUploads(this.ragUploads)}get acceptedFileTypes(){return this.args?.allowImages?".txt,.md,.png,.jpg,.jpeg":".txt,.md,.pdf"}submitFiles(){this.uppyUpload.openPicker()}static{dt7948.n(this.prototype,"submitFiles",[a.action])}cancelUploading(e){this.uppyUpload.cancelSingleUpload({fileId:e.id})}static{dt7948.n(this.prototype,"cancelUploading",[a.action])}search(){this.term?this.filteredUploads=this.ragUploads.filter(e=>e.original_filename.toUpperCase().indexOf(this.term.toUpperCase())>-1):this.filteredUploads=this.ragUploads}static{dt7948.n(this.prototype,"search",[a.action])}debouncedSearch(){(0,p.default)(this,this.search,100)}static{dt7948.n(this.prototype,"debouncedSearch",[a.action])}removeUpload(e){this.ragUploads.removeObject(e),this.onRemove(e),this.debouncedSearch()}static{dt7948.n(this.prototype,"removeUpload",[a.action])}static{(0,s.setComponentTemplate)((0,f.createTemplateFactory)({id:"XwEOHoWK",block:'[[[1,"\\n    "],[10,0],[14,0,"rag-uploader"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[10,2],[12],[1,[28,[32,0],["discourse_ai.rag.uploads.description_with_images"],null]],[13],[1,"\\n"]],[]],[[[1,"        "],[10,2],[12],[1,[28,[32,0],["discourse_ai.rag.uploads.description"],null]],[13],[1,"\\n"]],[]]],[1,"\\n"],[41,[30,0,["ragUploads"]],[[[1,"        "],[10,0],[14,0,"rag-uploader__search-input-container"],[12],[1,"\\n          "],[10,0],[14,0,"rag-uploader__search-input"],[12],[1,"\\n            "],[1,[28,[32,1],["magnifying-glass"],[["class"],["rag-uploader__search-input__search-icon"]]]],[1,"\\n            "],[8,[32,2],[[24,0,"rag-uploader__search-input__input"],[16,"placeholder",[28,[32,0],["discourse_ai.rag.uploads.filter"],null]],[4,[32,3],["keyup",[30,0,["debouncedSearch"]]],null]],[["@value"],[[30,0,["term"]]]],null],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n      "],[10,"table"],[14,0,"rag-uploader__uploads-list"],[12],[1,"\\n        "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["filteredUploads"]]],null]],null],null,[[[1,"            "],[10,"tr"],[12],[1,"\\n              "],[10,"td"],[12],[1,"\\n                "],[10,1],[14,0,"rag-uploader__rag-file-icon"],[12],[1,[28,[32,1],["file"],null]],[13],[1,"\\n                "],[1,[30,2,["original_filename"]]],[1,"\\n              "],[13],[1,"\\n              "],[8,[32,4],null,[["@upload","@ragIndexingStatuses"],[[30,2],[30,0,["ragIndexingStatuses"]]]],null],[1,"\\n              "],[10,"td"],[14,0,"rag-uploader__remove-file"],[12],[1,"\\n                "],[8,[32,5],[[24,0,"btn-flat"]],[["@icon","@title","@action"],["xmark","discourse_ai.rag.uploads.remove",[28,[32,6],[[30,0,["removeUpload"]],[30,2]],null]]],null],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[2]],null],[42,[28,[31,2],[[28,[31,2],[[30,0,["uppyUpload","inProgressUploads"]]],null]],null],null,[[[1,"            "],[10,"tr"],[12],[1,"\\n              "],[10,"td"],[12],[10,1],[14,0,"rag-uploader__rag-file-icon"],[12],[1,[28,[32,1],["file"],null]],[13],[1,"\\n                "],[1,[30,3,["original_filename"]]],[13],[1,"\\n              "],[10,"td"],[14,0,"rag-uploader__upload-status"],[12],[1,"\\n                "],[10,0],[14,0,"spinner small"],[12],[13],[1,"\\n                "],[10,1],[12],[1,[28,[32,0],["discourse_ai.rag.uploads.uploading"],null]],[1,"\\n                  "],[1,[30,3,["uploadProgress"]]],[1,"%"],[13],[1,"\\n              "],[13],[1,"\\n              "],[10,"td"],[14,0,"rag-uploader__remove-file"],[12],[1,"\\n                "],[8,[32,5],[[24,0,"btn-flat"]],[["@icon","@title","@action"],["xmark","discourse_ai.rag.uploads.remove",[28,[32,6],[[30,0,["cancelUploading"]],[30,3]],null]]],null],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[3]],null],[1,"        "],[13],[1,"\\n      "],[13],[1,"\\n\\n      "],[11,"input"],[24,0,"hidden-upload-field"],[16,"disabled",[30,0,["uploading"]]],[24,"multiple","multiple"],[16,"accept",[30,0,["acceptedFileTypes"]]],[24,4,"file"],[4,[32,7],[[30,0,["uppyUpload","setup"]]],null],[12],[13],[1,"\\n      "],[8,[32,5],[[24,0,"btn-default"]],[["@label","@icon","@title","@action"],["discourse_ai.rag.uploads.button","plus","discourse_ai.rag.uploads.button",[30,0,["submitFiles"]]]],null],[1,"\\n    "],[13],[1,"\\n  "]],["@allowImages","upload","upload"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/rag-uploader.js",scope:()=>[h.i18n,u.default,s.Input,o.on,g.default,d.default,i.fn,r.default],isStrictMode:!0}),this)}}e.default=_}),define("discourse/plugins/discourse-ai/discourse/components/reviewable-ai-chat-message",["exports","@glimmer/component","@ember/helper","@ember/routing","@ember/template","truth-helpers","discourse/components/reviewable-created-by","discourse/components/reviewable-post-header","discourse/plugins/chat/discourse/components/chat-channel-title","discourse/plugins/chat/discourse/models/chat-channel","discourse/plugins/discourse-ai/discourse/components/model-accuracies","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends t.default{get chatChannel(){if(this.args.reviewable.chat_channel)return d.default.create(this.args.reviewable.chat_channel)}static{(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"I2fblp9y",block:'[[[1,"\\n"],[41,[30,0,["chatChannel"]],[[[1,"      "],[10,0],[14,0,"flagged-post-header"],[12],[1,"\\n        "],[8,[32,0],null,[["@route","@models"],["chat.channel.near-message",[28,[32,1],[[30,0,["chatChannel","slugifiedTitle"]],[30,0,["chatChannel","id"]],[30,1,["target_id"]]],null]]],[["default"],[[[[1,"\\n          "],[8,[32,2],null,[["@channel"],[[30,0,["chatChannel"]]]],null],[1,"\\n        "]],[]]]]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"\\n    "],[10,0],[14,0,"post-contents-wrapper"],[12],[1,"\\n      "],[8,[32,3],null,[["@user","@tagName"],[[30,1,["target_created_by"]],""]],null],[1,"\\n      "],[10,0],[14,0,"post-contents"],[12],[1,"\\n        "],[8,[32,4],null,[["@reviewable","@createdBy","@tagName"],[[30,1],[30,1,["target_created_by"]],""]],null],[1,"\\n\\n        "],[10,0],[14,0,"post-body"],[12],[1,"\\n          "],[1,[28,[32,5],[[28,[32,6],[[30,1,["payload","message_cooked"]],[30,1,["cooked"]]],null]],null]],[1,"\\n        "],[13],[1,"\\n\\n        "],[18,2,null],[1,"\\n\\n        "],[8,[32,7],null,[["@accuracies"],[[30,1,["payload","accuracies"]]]],null],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@reviewable","&default"],false,["if","yield"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/reviewable-ai-chat-message.js",scope:()=>[i.LinkTo,s.array,l.default,n.default,r.default,o.htmlSafe,a.or,u.default],isStrictMode:!0}),this)}}e.default=m}),define("discourse/plugins/discourse-ai/discourse/components/reviewable-ai-post",["exports","@ember/template","discourse/components/reviewable-created-by","discourse/components/reviewable-post-edits","discourse/components/reviewable-post-header","discourse/components/reviewable-topic-link","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/model-accuracies","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,a,n,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"o5RtJSg5",block:'[[[1,"\\n  "],[10,0],[14,0,"flagged-post-header"],[12],[1,"\\n    "],[8,[32,0],null,[["@reviewable","@tagName"],[[30,1],""]],null],[1,"\\n    "],[8,[32,1],null,[["@reviewable","@tagName"],[[30,1],""]],null],[1,"\\n  "],[13],[1,"\\n\\n  "],[10,0],[14,0,"post-contents-wrapper"],[12],[1,"\\n    "],[8,[32,2],null,[["@user","@tagName"],[[30,1,["target_created_by"]],""]],null],[1,"\\n    "],[10,0],[14,0,"post-contents"],[12],[1,"\\n      "],[8,[32,3],null,[["@reviewable","@createdBy","@tagName"],[[30,1],[30,1,["target_created_by"]],""]],null],[1,"\\n      "],[10,0],[14,0,"post-body"],[12],[1,"\\n"],[41,[30,1,["blank_post"]],[[[1,"          "],[10,2],[12],[1,[28,[32,4],["review.deleted_post"],null]],[13],[1,"\\n"]],[]],[[[1,"          "],[1,[28,[32,5],[[30,1,["cooked"]]],null]],[1,"\\n"]],[]]],[1,"      "],[13],[1,"\\n\\n      "],[18,2,null],[1,"\\n\\n      "],[8,[32,6],null,[["@accuracies"],[[30,1,["payload","accuracies"]]]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],["@reviewable","&default"],false,["if","yield"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/reviewable-ai-post.js",scope:()=>[a.default,i.default,s.default,o.default,n.i18n,t.htmlSafe,r.default],isStrictMode:!0}),(0,u.default)(void 0,"reviewable-ai-post:ReviewableAiPost"))
e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/components/dropdown-menu","discourse/helpers/category-badge","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","float-kit/components/d-menu","discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static{dt7948.g(this.prototype,"siteSettings",[n.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ge=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"suggestions",[s.tracked],function(){return null})}#Be=void dt7948.i(this,"suggestions")
static{dt7948.g(this.prototype,"untriggers",[s.tracked],function(){return[]})}#It=void dt7948.i(this,"untriggers")
static{dt7948.g(this.prototype,"triggerIcon",[s.tracked],function(){return"discourse-sparkles"})}#Ft=void dt7948.i(this,"triggerIcon")
static{dt7948.g(this.prototype,"content",[s.tracked],function(){return null})}#Rt=void dt7948.i(this,"content")
get showSuggestionButton(){const e=document.querySelector(".composer-fields")
this.content=this.args.composer?.reply
const t=this.content?.length>h.MIN_CHARACTER_COUNT||"edit"===this.args.topicState
return e&&(t?e.classList.add("showing-ai-suggestions"):e.classList.remove("showing-ai-suggestions")),this.siteSettings.ai_embeddings_enabled&&t}get showDropdown(){return this.suggestions?.length<=0&&this.dMenu.close(),!this.loading&&this.suggestions?.length>0}async loadSuggestions(){if(this.suggestions&&this.suggestions?.length>0&&!this.dMenu.expanded)return this.suggestions
this.loading=!0,this.triggerIcon="spinner"
const e={}
this.content?e.text=this.content:e.topic_id=this.args.buffered.content.id
try{const{assistant:t}=await(0,u.ajax)("/discourse-ai/ai-helper/suggest_category",{method:"POST",data:e})
if(this.suggestions=t,this.suggestions?.length<=0)return void(0,h.showSuggestionsError)(this,this.loadSuggestions.bind(this))}catch(t){(0,c.popupAjaxError)(t)}finally{this.loading=!1,this.triggerIcon="rotate"}return this.suggestions}static{dt7948.n(this.prototype,"loadSuggestions",[a.action])}applySuggestion(e){const t=this.args.composer,s=this.args.buffered
return t&&(t.set("categoryId",e.id),t.get("categoryId")),s&&this.args.buffered.set("category_id",e.id),this.dMenu.close()}static{dt7948.n(this.prototype,"applySuggestion",[a.action])}onRegisterApi(e){this.dMenu=e}static{dt7948.n(this.prototype,"onRegisterApi",[a.action])}onClose(){this.suggestions?.length>0&&(this.triggerIcon="discourse-sparkles")}static{dt7948.n(this.prototype,"onClose",[a.action])}static{(0,g.setComponentTemplate)((0,f.createTemplateFactory)({id:"MyQ0Js5H",block:'[[[1,"\\n"],[41,[30,0,["showSuggestionButton"]],[[[1,"      "],[8,[32,0],[[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@title","@icon","@identifier","@onClose","@triggerClass","@contentClass","@onRegisterApi","@modalForMobile","@untriggers"],[[28,[32,1],["discourse_ai.ai_helper.suggest"],null],[30,0,["triggerIcon"]],"ai-category-suggester",[30,0,["onClose"]],[29,["btn-transparent suggestion-button suggest-category-button ",[52,[30,0,["loading"]],"is-loading"]]],"ai-suggestions-menu",[30,0,["onRegisterApi"]],true,[30,0,["untriggers"]]]],[["content"],[[[[1,"\\n"],[41,[30,0,["showDropdown"]],[[[1,"            "],[8,[32,3],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["suggestions"]]],null]],null],null,[[[1,"                "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,4],[[24,0,"category-row"],[16,"data-name",[30,2,["name"]]],[16,"data-value",[30,3]],[16,"title",[30,2,["name"]]]],[["@action"],[[28,[32,5],[[30,0,["applySuggestion"]],[30,2]],null]]],[["default"],[[[[1,"\\n                    "],[10,0],[14,0,"category-status"],[12],[1,"\\n                      "],[1,[28,[32,6],[[30,2]],null]],[1,"\\n                      "],[10,1],[14,0,"topic-count"],[12],[1,"x\\n                        "],[1,[30,2,["topicCount"]]],[13],[1,"\\n                    "],[13],[1,"\\n                  "]],[]]]]],[1,"\\n                "]],[]]]]],[1,"\\n"]],[2,3]],null],[1,"            "]],[1]]]]],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],["dropdown","suggestion","index"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester.js",scope:()=>[m.default,p.i18n,o.on,l.default,r.default,i.fn,d.default],isStrictMode:!0}),this)}}e.default=_}),define("discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/components/dropdown-menu","discourse/helpers/discourse-tag","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","float-kit/components/d-menu","discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g,f){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static{dt7948.g(this.prototype,"siteSettings",[n.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"toasts",[n.service])}#R=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"composer",[n.service])}#x=void dt7948.i(this,"composer")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ge=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"suggestions",[s.tracked],function(){return null})}#Be=void dt7948.i(this,"suggestions")
static{dt7948.g(this.prototype,"untriggers",[s.tracked],function(){return[]})}#It=void dt7948.i(this,"untriggers")
static{dt7948.g(this.prototype,"triggerIcon",[s.tracked],function(){return"discourse-sparkles"})}#Ft=void dt7948.i(this,"triggerIcon")
static{dt7948.g(this.prototype,"content",[s.tracked],function(){return null})}#Rt=void dt7948.i(this,"content")
get showSuggestionButton(){if(this.composer.disableTagsChooser)return!1
const e=document.querySelector(".composer-fields")
this.content=this.args.composer?.reply
const t=this.content?.length>h.MIN_CHARACTER_COUNT||"edit"===this.args.topicState
return e&&(t?e.classList.add("showing-ai-suggestions"):e.classList.remove("showing-ai-suggestions")),this.siteSettings.ai_embeddings_enabled&&t}get showDropdown(){return this.suggestions?.length<=0&&this.dMenu.close(),!this.loading&&this.suggestions?.length>0}async loadSuggestions(){if(this.suggestions&&this.suggestions?.length>0&&!this.dMenu.expanded)return this.suggestions
this.loading=!0,this.triggerIcon="spinner"
const e={}
this.content?e.text=this.content:e.topic_id=this.args.buffered.content.id
try{const{assistant:t}=await(0,u.ajax)("/discourse-ai/ai-helper/suggest_tags",{method:"POST",data:e})
this.suggestions=t
const s=this.args.composer?this.args.composer:this.args.buffered
if(this.#Lt()&&(this.suggestions=this.suggestions.filter(e=>!s.get("tags").includes(e.name))),this.suggestions?.length<=0)return void(0,h.showSuggestionsError)(this,this.loadSuggestions.bind(this))}catch(t){(0,c.popupAjaxError)(t)}finally{this.loading=!1,this.triggerIcon="rotate"}return this.suggestions}static{dt7948.n(this.prototype,"loadSuggestions",[a.action])}#Lt(){const e=this.args.composer?this.args.composer:this.args.buffered
return e.get("tags")&&e.get("tags").length>0}#Dt(e){return this.suggestions=this.suggestions.filter(t=>t.id!==e.id)}applySuggestion(e){const t=this.siteSettings.max_tags_per_topic,s=this.args.composer?this.args.composer:this.args.buffered
if(!s)return
const i=s.get("tags")
return i?i?.length>=t?this.toasts.error({class:"ai-suggestion-error",duration:"short",data:{message:(0,p.i18n)("discourse_ai.ai_helper.suggest_errors.too_many_tags",{count:t})}}):(i.push(e.name),s.set("tags",[...i]),e.disabled=!0,void this.#Dt(e)):(s.set("tags",[e.name]),void this.#Dt(e))}static{dt7948.n(this.prototype,"applySuggestion",[a.action])}onRegisterApi(e){this.dMenu=e}static{dt7948.n(this.prototype,"onRegisterApi",[a.action])}onClose(){this.suggestions?.length>0&&(this.triggerIcon="discourse-sparkles")}static{dt7948.n(this.prototype,"onClose",[a.action])}static{(0,g.setComponentTemplate)((0,f.createTemplateFactory)({id:"8IJI8bF5",block:'[[[1,"\\n"],[41,[30,0,["showSuggestionButton"]],[[[1,"      "],[8,[32,0],[[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@title","@icon","@identifier","@onClose","@triggerClass","@contentClass","@onRegisterApi","@modalForMobile","@untriggers"],[[28,[32,1],["discourse_ai.ai_helper.suggest"],null],[30,0,["triggerIcon"]],"ai-tag-suggester",[30,0,["onClose"]],[29,["btn-transparent suggestion-button suggest-tags-button ",[52,[30,0,["loading"]],"is-loading"]]],"ai-suggestions-menu",[30,0,["onRegisterApi"]],true,[30,0,["untriggers"]]]],[["content"],[[[[1,"\\n"],[41,[30,0,["showDropdown"]],[[[1,"            "],[8,[32,3],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["suggestions"]]],null]],null],null,[[[1,"                "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,4],[[24,0,"tag-row"],[16,"data-name",[30,2,["name"]]],[16,"data-value",[30,3]],[16,"title",[30,2,["name"]]]],[["@translatedLabel","@disabled","@action"],[[30,2,["name"]],[28,[30,0,["isDisabled"]],[[30,2]],null],[28,[32,5],[[30,0,["applySuggestion"]],[30,2]],null]]],[["default"],[[[[1,"\\n                    "],[1,[28,[32,6],[[30,2,["name"]]],[["count","noHref"],[[30,2,["count"]],true]]]],[1,"\\n                  "]],[]]]]],[1,"\\n                "]],[]]]]],[1,"\\n"]],[2,3]],null],[1,"            "]],[1]]]]],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],["dropdown","suggestion","index"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester.js",scope:()=>[m.default,p.i18n,o.on,l.default,r.default,i.fn,d.default],isStrictMode:!0}),this)}}e.default=_}),define("discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/components/dropdown-menu","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","float-kit/components/d-menu","discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ge=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"suggestions",[s.tracked],function(){return null})}#Be=void dt7948.i(this,"suggestions")
static{dt7948.g(this.prototype,"untriggers",[s.tracked],function(){return[]})}#It=void dt7948.i(this,"untriggers")
static{dt7948.g(this.prototype,"triggerIcon",[s.tracked],function(){return"discourse-sparkles"})}#Ft=void dt7948.i(this,"triggerIcon")
static{dt7948.g(this.prototype,"content",[s.tracked],function(){return null})}#Rt=void dt7948.i(this,"content")
get showSuggestionButton(){const e=document.querySelector(".composer-fields"),t=document.querySelector(".edit-topic-title")
this.content=this.args.composer?.reply
const s=this.content?.length>p.MIN_CHARACTER_COUNT||"edit"===this.args.topicState
return e&&(s?e.classList.add("showing-ai-suggestions"):e.classList.remove("showing-ai-suggestions")),t&&(s?t.classList.add("showing-ai-suggestions"):t.classList.remove("showing-ai-suggestions")),s}get showDropdown(){return this.suggestions?.length<=0&&this.dMenu.close(),!this.loading&&this.suggestions?.length>0}async loadSuggestions(){if(this.suggestions&&this.suggestions?.length>0&&!this.dMenu.expanded)return this.suggestions
this.loading=!0,this.triggerIcon="spinner"
const e={}
this.content?e.text=this.content:e.topic_id=this.args.buffered.content.id
try{const{suggestions:t}=await(0,l.ajax)("/discourse-ai/ai-helper/suggest_title",{method:"POST",data:e})
if(this.suggestions=t,this.suggestions?.length<=0)return void(0,p.showSuggestionsError)(this,this.loadSuggestions.bind(this))}catch(t){(0,d.popupAjaxError)(t)}finally{this.loading=!1,this.triggerIcon="rotate"}return this.suggestions}static{dt7948.n(this.prototype,"loadSuggestions",[a.action])}applySuggestion(e){const t=this.args.composer?this.args.composer:this.args.buffered
t&&(t.set("title",e),this.dMenu.close())}static{dt7948.n(this.prototype,"applySuggestion",[a.action])}onRegisterApi(e){this.dMenu=e}static{dt7948.n(this.prototype,"onRegisterApi",[a.action])}onClose(){this.suggestions?.length>0&&(this.triggerIcon="discourse-sparkles")}static{dt7948.n(this.prototype,"onClose",[a.action])}static{(0,m.setComponentTemplate)((0,h.createTemplateFactory)({id:"VM+2XnI7",block:'[[[1,"\\n"],[41,[30,0,["showSuggestionButton"]],[[[1,"      "],[8,[32,0],[[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@title","@icon","@identifier","@onClose","@triggerClass","@contentClass","@onRegisterApi","@modalForMobile","@untriggers"],[[28,[32,1],["discourse_ai.ai_helper.suggest"],null],[30,0,["triggerIcon"]],"ai-title-suggester",[30,0,["onClose"]],[29,["btn-transparent suggestion-button suggest-titles-button ",[52,[30,0,["loading"]],"is-loading"]]],"ai-suggestions-menu",[30,0,["onRegisterApi"]],true,[30,0,["untriggers"]]]],[["content"],[[[[1,"\\n"],[41,[30,0,["showDropdown"]],[[[1,"            "],[8,[32,3],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["suggestions"]]],null]],null],null,[[[1,"                "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,4],[[16,"data-name",[30,2]],[16,"data-value",[30,3]],[16,"title",[30,2]]],[["@action"],[[28,[32,5],[[30,0,["applySuggestion"]],[30,2]],null]]],[["default"],[[[[1,"\\n                    "],[1,[30,2]],[1,"\\n                  "]],[]]]]],[1,"\\n                "]],[]]]]],[1,"\\n"]],[2,3]],null],[1,"            "]],[1]]]]],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],["dropdown","suggestion","index"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester.js",scope:()=>[c.default,u.i18n,o.on,r.default,n.default,i.fn],isStrictMode:!0}),this)}}e.default=g}),define("discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","discourse/components/d-button","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static{dt7948.g(this.prototype,"selected",[s.tracked],function(){return!1})}#Nt=void dt7948.i(this,"selected")
static{dt7948.g(this.prototype,"selectIcon",[s.tracked],function(){return"far-circle"})}#Ut=void dt7948.i(this,"selectIcon")
static{dt7948.g(this.prototype,"selectLabel",[s.tracked],function(){return"discourse_ai.ai_helper.thumbnail_suggestions.select"})}#qt=void dt7948.i(this,"selectLabel")
toggleSelection(e){return this.selected?(this.selectIcon="far-circle",this.selectLabel="discourse_ai.ai_helper.thumbnail_suggestions.select",this.selected=!1,this.args.removeSelection(e)):(this.selectIcon="circle-check",this.selectLabel="discourse_ai.ai_helper.thumbnail_suggestions.selected",this.selected=!0,this.args.addSelection(e))}static{dt7948.n(this.prototype,"toggleSelection",[o.action])}static{(0,n.setComponentTemplate)((0,r.createTemplateFactory)({id:"BsBgpDKw",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-thumbnail-suggestions__item"],[12],[1,"\\n      "],[8,[32,0],[[16,0,[52,[30,0,["selected"]],"btn-primary"]]],[["@icon","@label","@action"],[[30,0,["selectIcon"]],[30,0,["selectLabel"]],[28,[32,1],[[30,0,["toggleSelection"]],[30,1]],null]]],null],[1,"\\n      "],[10,"img"],[15,"src",[30,1,["url"]]],[14,"loading","lazy"],[15,"width",[30,1,["thumbnail_width"]]],[15,"height",[30,1,["thumbnail_height"]]],[12],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@thumbnail"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item.js",scope:()=>[a.default,i.fn],isStrictMode:!0}),this)}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/connectors/admin-dashboard-tabs-after/admin-sentiment-dashbboard",["exports","@glimmer/component","@ember/routing","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e,t){return t.siteSettings.ai_sentiment_enabled}static{(0,o.setComponentTemplate)((0,a.createTemplateFactory)({id:"aCrw9598",block:'[[[1,"\\n    "],[10,"li"],[14,0,"navigation-item sentiment"],[12],[1,"\\n      "],[8,[32,0],[[24,0,"navigation-link"]],[["@route"],["admin.dashboardSentiment"]],[["default"],[[[[1,"\\n        "],[1,[28,[32,1],["discourse_ai.sentiments.dashboard.title"],null]],[1,"\\n      "]],[]]]]],[1,"\\n    "],[13],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/admin-dashboard-tabs-after/admin-sentiment-dashbboard.js",scope:()=>[s.LinkTo,i.i18n],isStrictMode:!0}),this)}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-category-input/ai-category-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static{dt7948.g(this.prototype,"composer",[s.service])}#x=void dt7948.i(this,"composer")
static{(0,a.setComponentTemplate)((0,n.createTemplateFactory)({id:"doeO/ThB",block:'[[[1,"\\n"],[41,[51,[30,0,["composer","disableCategoryChooser"]]],[[[1,"      "],[8,[32,0],null,[["@composer","@topicState"],[[30,1,["composer"]],"new"]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-category-input/ai-category-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-tag-input/ai-tag-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static{(0,o.setComponentTemplate)((0,a.createTemplateFactory)({id:"u3rz9DLM",block:'[[[1,"\\n    "],[8,[32,0],null,[["@composer","@topicState"],[[30,1,["composer"]],"new"]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-tag-input/ai-tag-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-title-input/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static{(0,o.setComponentTemplate)((0,a.createTemplateFactory)({id:"Ptl68I7m",block:'[[[1,"\\n"],[41,[51,[30,1,["composer","disableTitleInput"]]],[[[1,"      "],[8,[32,0],null,[["@composer","@topicState"],[[30,1,["composer"]],"new"]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-title-input/ai-title-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/connectors/after-d-editor/composer-open",["exports","@glimmer/component","@ember/object","@ember/service","discourse/helpers/body-class","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static{dt7948.g(this.prototype,"currentUser",[i.service])}#k=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"siteSettings",[i.service])}#l=void dt7948.i(this,"siteSettings")
get composerModel(){return this.args?.outletArgs?.composer}get renderChatWarning(){return this.siteSettings.ai_bot_enable_chat_warning}get aiBotClasses(){return this.composerModel?.title===(0,a.i18n)("discourse_ai.ai_bot.default_pm_prefix")?"ai-bot-chat":"ai-bot-pm"}static{dt7948.n(this.prototype,"aiBotClasses",[(0,s.computed)("composerModel.targetRecipients","composerModel.title")])}get isAiBotChat(){if(this.composerModel&&this.composerModel.targetRecipients&&this.currentUser.ai_enabled_chat_bots){let e=this.composerModel.targetRecipients.split(",")
return this.currentUser.ai_enabled_chat_bots.any(t=>e.any(e=>e===t.username))}return!1}static{dt7948.n(this.prototype,"isAiBotChat",[(0,s.computed)("composerModel.targetRecipients")])}static{(0,n.setComponentTemplate)((0,r.createTemplateFactory)({id:"er7lpl54",block:'[[[1,"\\n"],[41,[30,0,["isAiBotChat"]],[[[1,"      "],[1,[28,[32,0],[[30,0,["aiBotClasses"]]],null]],[1,"\\n"],[41,[30,0,["renderChatWarning"]],[[[1,"        "],[10,0],[14,0,"ai-bot-chat-warning"],[12],[1,[28,[32,1],["discourse_ai.ai_bot.pm_warning"],null]],[13],[1,"\\n"]],[]],null]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-d-editor/composer-open.js",scope:()=>[o.default,a.i18n],isStrictMode:!0}),this)}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/connectors/after-search-result-entry/search-result-decoration",["exports","discourse/helpers/d-icon","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"+zzrKPCx",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-result__icon"],[15,"title",[28,[32,0],["discourse_ai.embeddings.ai_generated_result"],null]],[12],[1,"\\n    "],[1,[28,[32,1],["discourse-sparkles"],null]],[1,"\\n  "],[13],[1,"\\n"]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-search-result-entry/search-result-decoration.js",scope:()=>[s.i18n,t.default],isStrictMode:!0}),(0,a.default)(void 0,"search-result-decoration:SearchResultDecoration"))
e.default=n}),define("discourse/plugins/discourse-ai/discourse/connectors/before-create-topic-button/topic-list-gist-toggle",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static{dt7948.g(this.prototype,"topicThumbnails",[s.service])}#Bt=void dt7948.i(this,"topicThumbnails")
get shouldShow(){return!this.topicThumbnails?.enabledForRoute}static{(0,o.setComponentTemplate)((0,a.createTemplateFactory)({id:"7j6Az6wp",block:"[[[8,[32,0],null,null,null]],[],false,[]]",moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/before-create-topic-button/topic-list-gist-toggle.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=n})
define("discourse/plugins/discourse-ai/discourse/connectors/composer-fields/persona-llm-selector",["exports","@glimmer/component","@ember/object","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-persona-llm-selector","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return t?.currentUser?.ai_enabled_personas&&function(e,t){if(e&&e.targetRecipients&&t.ai_enabled_chat_bots){const s=e.targetRecipients.split(",")
return t.ai_enabled_chat_bots.filter(e=>e.username).any(e=>s.any(t=>t===e.username))}return!1}(e.model,t.currentUser)}static{dt7948.g(this.prototype,"currentUser",[i.service])}#k=void dt7948.i(this,"currentUser")
setPersonaIdOnComposer(e){this.args.outletArgs.model.metaData={ai_persona_id:e}}static{dt7948.n(this.prototype,"setPersonaIdOnComposer",[s.action])}setTargetRecipientsOnComposer(e){this.args.outletArgs.model.set("targetRecipients",e)}static{dt7948.n(this.prototype,"setTargetRecipientsOnComposer",[s.action])}static{(0,a.setComponentTemplate)((0,n.createTemplateFactory)({id:"35crcj6G",block:'[[[1,"\\n    "],[8,[32,0],null,[["@setPersonaId","@setTargetRecipient"],[[30,0,["setPersonaIdOnComposer"]],[30,0,["setTargetRecipientsOnComposer"]]]],null],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/composer-fields/persona-llm-selector.js",scope:()=>[o.default],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/connectors/edit-topic-category__after/ai-category-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static{(0,o.setComponentTemplate)((0,a.createTemplateFactory)({id:"xD6ygZtG",block:'[[[1,"\\n    "],[8,[32,0],null,[["@buffered","@topicState"],[[30,1,["buffered"]],"edit"]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/edit-topic-category__after/ai-category-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/connectors/edit-topic-tags__after/ai-tag-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static{(0,o.setComponentTemplate)((0,a.createTemplateFactory)({id:"3ec6gwOx",block:'[[[1,"\\n    "],[8,[32,0],null,[["@buffered","@topicState"],[[30,1,["buffered"]],"edit"]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/edit-topic-tags__after/ai-tag-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/connectors/edit-topic-title__after/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static{(0,o.setComponentTemplate)((0,a.createTemplateFactory)({id:"QwHpqwnO",block:'[[[1,"\\n    "],[8,[32,0],null,[["@buffered","@topicState"],[[30,1,["buffered"]],"edit"]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/edit-topic-title__after/ai-title-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/connectors/editor-preview/ai-image-caption-container",["exports","@glimmer/component","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/service","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/d-textarea","discourse/helpers/d-icon","discourse/modifiers/auto-focus","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static{dt7948.g(this.prototype,"imageCaptionPopup",[r.service])}#zt=void dt7948.i(this,"imageCaptionPopup")
updateCaption(e){e.preventDefault(),this.imageCaptionPopup.newCaption=e.target.value}static{dt7948.n(this.prototype,"updateCaption",[i.action])}saveCaption(){this.imageCaptionPopup.updateCaption(),this.hidePopup()}static{dt7948.n(this.prototype,"saveCaption",[i.action])}resizeTextarea(e){const t=window.getComputedStyle(e),s=parseInt(t.borderTopWidth,10),i=parseInt(t.borderBottomWidth,10)
e.scrollTop=0,e.style.height=`${e.scrollHeight+s+i}px`}static{dt7948.n(this.prototype,"resizeTextarea",[i.action])}hidePopup(){this.imageCaptionPopup.showPopup=!1,this.imageCaptionPopup._request&&(this.imageCaptionPopup._request.abort(),this.imageCaptionPopup._request=null,this.imageCaptionPopup.toggleLoadingState(!1))}static{dt7948.n(this.prototype,"hidePopup",[i.action])}static{(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"84lcZtW4",block:'[[[1,"\\n"],[41,[30,0,["imageCaptionPopup","showPopup"]],[[[1,"      "],[11,0],[24,0,"composer-popup education-message ai-caption-popup"],[4,[32,0],[[30,0,["hidePopup"]]],null],[12],[1,"\\n        "],[8,[32,1],null,[["@condition"],[[30,0,["imageCaptionPopup","loading"]]]],[["default"],[[[[1,"\\n          "],[8,[32,2],[[4,[32,3],[[30,0,["resizeTextarea"]]],null],[4,[32,4],[[30,0,["resizeTextarea"]],[30,0,["imageCaptionPopup","newCaption"]]],null],[4,[32,5],["change",[30,0,["updateCaption"]]],null],[4,[32,6],null,null]],[["@value"],[[30,0,["imageCaptionPopup","newCaption"]]]],null],[1,"\\n        "]],[]]]]],[1,"\\n\\n        "],[10,0],[14,0,"actions"],[12],[1,"\\n          "],[8,[32,7],[[24,0,"btn-primary"]],[["@label","@icon","@action"],["discourse_ai.ai_helper.image_caption.save_caption","check",[30,0,["saveCaption"]]]],null],[1,"\\n          "],[8,[32,7],[[24,0,"btn-flat cancel-request"]],[["@label","@action"],["cancel",[30,0,["hidePopup"]]]],null],[1,"\\n\\n          "],[10,1],[14,0,"credits"],[12],[1,"\\n            "],[1,[28,[32,8],["discourse-sparkles"],null]],[1,"\\n            "],[10,1],[12],[1,[28,[32,9],["discourse_ai.ai_helper.image_caption.credits"],null]],[13],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/editor-preview/ai-image-caption-container.js",scope:()=>[n.default,l.default,u.default,o.default,a.default,s.on,p.default,d.default,c.default,m.i18n],isStrictMode:!0}),this)}}e.default=f}),define("discourse/plugins/discourse-ai/discourse/connectors/fast-edit-footer-after/ai-edit-suggestion-button",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static shouldRender(e,t){return(0,l.showPostAIHelper)(e,t)}static{dt7948.g(this.prototype,"currentUser",[o.service])}#k=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ge=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"suggestion",[s.tracked],function(){return""})}#fe=void dt7948.i(this,"suggestion")
static{dt7948.g(this.prototype,"_activeAIRequest",[s.tracked],function(){return null})}#Ht=void dt7948.i(this,"_activeAIRequest")
get disabled(){return this.loading||this.suggestion?.length>0}get mode(){return this.currentUser?.ai_helper_prompts.find(e=>"proofread"===e.name)}suggest(){return this.loading=!0,this._activeAIRequest=(0,n.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:this.mode.name,text:this.args.outletArgs.initialValue,custom_prompt:""}}),this._activeAIRequest.then(({suggestions:e})=>{this.suggestion=e[0].trim(),this.args.outletArgs.updateValue(this.suggestion)}).catch(r.popupAjaxError).finally(()=>{this.loading=!1}),this._activeAIRequest}static{dt7948.n(this.prototype,"suggest",[i.action])}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"9jHc25oQ",block:'[[[1,"\\n"],[41,[51,[30,1,["newValue"]]],[[[1,"      "],[8,[32,0],[[24,0,"btn-small btn-ai-suggest-edit"]],[["@action","@icon","@label","@isLoading","@disabled"],[[30,0,["suggest"]],"discourse-sparkles","discourse_ai.ai_helper.fast_edit.suggest_button",[30,0,["loading"]],[30,0,["disabled"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/fast-edit-footer-after/ai-edit-suggestion-button.js",scope:()=>[a.default],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/ai-full-page-discobot-discoveries",["exports","@glimmer/component","@ember/service","discourse/helpers/body-class","discourse/helpers/d-icon","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries","discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries-tooltip","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static shouldRender(e,{siteSettings:t,currentUser:s}){return t.ai_bot_discover_persona&&s?.can_use_ai_bot_discover_persona&&s?.user_option?.ai_search_discoveries}static{dt7948.g(this.prototype,"capabilities",[s.service])}#ie=void dt7948.i(this,"capabilities")
static{dt7948.g(this.prototype,"discobotDiscoveries",[s.service])}#Me=void dt7948.i(this,"discobotDiscoveries")
static{dt7948.g(this.prototype,"site",[s.service])}#y=void dt7948.i(this,"site")
get previewLength(){return this.capabilities.viewport.md?1e4:50}static{(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"lInfOcXN",block:'[[[1,"\\n    "],[1,[28,[32,0],["has-discoveries"],null]],[1,"\\n    "],[10,0],[14,0,"ai-search-discoveries__discoveries-wrapper"],[12],[1,"\\n"],[41,[30,0,["discobotDiscoveries","showDiscoveryTitle"]],[[[1,"        "],[10,"h3"],[14,0,"ai-search-discoveries__discoveries-title full-page-discoveries"],[12],[1,"\\n          "],[10,1],[12],[1,"\\n            "],[1,[28,[32,1],["discobot"],null]],[1,"\\n            "],[1,[28,[32,2],["discourse_ai.discobot_discoveries.main_title"],null]],[1,"\\n          "],[13],[1,"\\n          "],[8,[32,3],null,null,null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n      "],[10,0],[14,0,"full-page-discoveries"],[12],[1,"\\n        "],[8,[32,4],null,[["@discoveryPreviewLength","@searchTerm"],[[30,0,["previewLength"]],[30,1,["search"]]]],null],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/ai-full-page-discobot-discoveries.js",scope:()=>[i.default,o.default,a.i18n,r.default,n.default],isStrictMode:!0}),this)}}e.default=u}),define("discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/ai-full-page-search",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/ai-full-page-search","@ember/component","@ember/template-factory"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,{siteSettings:t}){return t.ai_embeddings_semantic_search_enabled}static{(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"4RggybC1",block:'[[[1,"\\n    "],[8,[32,0],null,[["@sortOrder","@searchTerm","@searchType","@addSearchResults"],[[30,1,["sortOrder"]],[30,1,["search"]],[30,1,["type"]],[30,1,["addSearchResults"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/ai-full-page-search.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/connectors/post-text-buttons/ai-post-helper-trigger",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/utilities","discourse/plugins/discourse-ai/discourse/components/ai-post-helper-menu","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static shouldRender(e,t){return(0,l.showPostAIHelper)(e,t)}static{dt7948.g(this.prototype,"menu",[o.service])}#pe=void dt7948.i(this,"menu")
static{dt7948.g(this.prototype,"postHighlighted",[s.tracked],function(){return!1})}#Vt=void dt7948.i(this,"postHighlighted")
static{dt7948.g(this.prototype,"currentMenu",[s.tracked],function(){return this.menu.getByIdentifier("post-text-selection-toolbar")})}#$t=void dt7948.i(this,"currentMenu")
menuData={...this.args.outletArgs.data,quoteState:{buffer:this.args.outletArgs.data.quoteState.buffer,opts:this.args.outletArgs.data.quoteState.opts,postId:this.args.outletArgs.data.quoteState.postId},post:this.args.outletArgs.post,selectedRange:(0,n.selectedRange)()}
highlightSelectedText(){const e=this.args.outletArgs.data.quoteState.postId
if(!document.querySelector(`article[data-post-id='${e}'] .cooked`))return
const t=this.menuData.selectedRange
if(t.startContainer.nodeType===Node.TEXT_NODE&&t.startOffset>0){const e=t.startContainer.splitText(t.startOffset)
t.setStart(e,0)}t.endContainer.nodeType===Node.TEXT_NODE&&t.endOffset<t.endContainer.length&&t.endContainer.splitText(t.endOffset)
const s=document.createTreeWalker(t.commonAncestorContainer,NodeFilter.SHOW_TEXT,{acceptNode:e=>t.intersectsNode(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),i=[]
if(s.currentNode?.nodeType===Node.TEXT_NODE)i.push(s.currentNode)
else for(;s.nextNode();)i.push(s.currentNode)
for(let o of i){const e=document.createElement("span")
e.classList.add("ai-helper-highlighted-selection")
const t=o.cloneNode(!0)
e.appendChild(t),o.parentNode.replaceChild(e,o)}window.getSelection().removeAllRanges(),this.postHighlighted=!0}removeHighlightedText(){if(!this.postHighlighted)return
document.querySelectorAll("span.ai-helper-highlighted-selection").forEach(e=>{const t=document.createTextNode(e.textContent)
e.parentNode.replaceChild(t,e)}),this.postHighlighted=!1}async showAiPostHelperMenu(){await this.currentMenu.close(),await this.menu.show(this.currentMenu.trigger,{identifier:"ai-post-helper-menu",component:r.default,interactive:!0,trapTab:!1,closeOnScroll:!1,modalForMobile:!0,data:this.menuData,placement:"top-start",fallbackPlacements:["bottom-start"],updateOnScroll:!1,onClose:()=>{this.removeHighlightedText()}}),await this.currentMenu.destroy(),this.highlightSelectedText()}static{dt7948.n(this.prototype,"showAiPostHelperMenu",[i.action])}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"R72pW812",block:'[[[1,"\\n    "],[18,1,null],[1,"\\n\\n    "],[10,0],[14,0,"ai-post-helper"],[12],[1,"\\n      "],[8,[32,0],[[24,0,"btn-flat ai-post-helper__trigger"]],[["@icon","@title","@label","@action"],["discourse-sparkles","discourse_ai.ai_helper.post_options_menu.title","discourse_ai.ai_helper.post_options_menu.trigger",[30,0,["showAiPostHelperMenu"]]]],null],[1,"\\n    "],[13],[1,"\\n  "]],["&default"],false,["yield"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/post-text-buttons/ai-post-helper-trigger.js",scope:()=>[a.default],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-before-advanced-search/ai-quick-search-loader",["exports","@glimmer/component","@ember/service","discourse/helpers/loading-spinner","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static{dt7948.g(this.prototype,"quickSearch",[s.service])}#Gt=void dt7948.i(this,"quickSearch")
static{(0,o.setComponentTemplate)((0,a.createTemplateFactory)({id:"apo2cAJf",block:'[[[1,"\\n"],[41,[30,0,["quickSearch","loading"]],[[[1,"      "],[10,0],[14,0,"ai-quick-search-spinner"],[12],[1,"\\n        "],[1,[32,0]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-before-advanced-search/ai-quick-search-loader.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-initial-options/ai-quick-semantic-search",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/search-menu/results/assistant-item","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/search","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static shouldRender(e,{siteSettings:t}){return t.ai_embeddings_semantic_quick_search_enabled}static{dt7948.g(this.prototype,"search",[i.service])}#Ae=void dt7948.i(this,"search")
static{dt7948.g(this.prototype,"quickSearch",[i.service])}#Gt=void dt7948.i(this,"quickSearch")
static{dt7948.g(this.prototype,"siteSettings",[i.service])}#l=void dt7948.i(this,"siteSettings")
async searchTermChanged(){if(this.search.activeGlobalSearchTerm){if(!(0,r.isValidSearchTerm)(this.search.activeGlobalSearchTerm,this.siteSettings))return this.search.noResults=!0,this.search.results={},this.quickSearch.loading=!1,void(this.quickSearch.invalidTerm=!0)
await this.performSearch()}else this.search.noResults=!1,this.search.results={},this.quickSearch.loading=!1,this.quickSearch.invalidTerm=!1}static{dt7948.n(this.prototype,"searchTermChanged",[s.action])}async performSearch(){this.quickSearch.loading=!0,this.quickSearch.invalidTerm=!1
try{const e=await(0,a.ajax)("/discourse-ai/embeddings/quick-search",{data:{q:this.search.activeGlobalSearchTerm}}),t=await(0,r.translateResults)(e)
t&&(this.search.noResults=0===e.resultTypes.length,this.search.results=t)}catch(e){(0,n.popupAjaxError)(e)}finally{this.quickSearch.loading=!1}}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"xqHDbd5x",block:'[[[1,"\\n    "],[18,3,null],[1,"\\n\\n"],[41,[30,0,["search","activeGlobalSearchTerm"]],[[[1,"      "],[8,[32,0],null,[["@suffix","@icon","@closeSearchMenu","@searchTermChanged","@suggestionKeyword"],[[28,[32,1],["discourse_ai.embeddings.quick_search.suffix"],null],"discourse-sparkles",[30,1],[30,0,["searchTermChanged"]],[30,2]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@closeSearchMenu","@suggestionKeyword","&default"],false,["yield","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-initial-options/ai-quick-semantic-search.js",scope:()=>[o.default,l.i18n],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-discobot-discoveries",["exports","@glimmer/component","@ember/service","discourse/helpers/d-icon","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries","discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries-tooltip","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static shouldRender(e,{siteSettings:t,currentUser:s}){return t.ai_bot_discover_persona&&s?.can_use_ai_bot_discover_persona&&s?.user_option?.ai_search_discoveries}static{dt7948.g(this.prototype,"discobotDiscoveries",[s.service])}#Me=void dt7948.i(this,"discobotDiscoveries")
static{dt7948.g(this.prototype,"search",[s.service])}#Ae=void dt7948.i(this,"search")
static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"kJMYLbPh",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-discobot-discoveries"],[12],[1,"\\n"],[41,[30,0,["discobotDiscoveries","showDiscoveryTitle"]],[[[1,"        "],[10,"h3"],[14,0,"ai-search-discoveries__discoveries-title"],[12],[1,"\\n          "],[10,1],[12],[1,"\\n            "],[1,[28,[32,0],["discobot"],null]],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.discobot_discoveries.main_title"],null]],[1,"\\n          "],[13],[1,"\\n\\n          "],[8,[32,2],null,null,null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n      "],[8,[32,3],null,[["@searchTerm","@discoveryPreviewLength","@closeSearchMenu"],[[30,1,["searchTerm"]],50,[30,1,["closeSearchMenu"]]]],null],[1,"\\n\\n"],[41,[30,0,["search","results","topics","length"]],[[[1,"        "],[10,"h3"],[14,0,"ai-search-discoveries__regular-results-title"],[12],[1,"\\n          "],[1,[28,[32,0],["bars-staggered"],null]],[1,"\\n          "],[1,[28,[32,1],["discourse_ai.discobot_discoveries.regular_results"],null]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-discobot-discoveries.js",scope:()=>[i.default,o.i18n,n.default,a.default],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-quick-search-info",["exports","@glimmer/component","@ember/service","discourse/lib/search","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static{dt7948.g(this.prototype,"search",[s.service])}#Ae=void dt7948.i(this,"search")
static{dt7948.g(this.prototype,"siteSettings",[s.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"quickSearch",[s.service])}#Gt=void dt7948.i(this,"quickSearch")
get termTooShort(){return!(0,i.isValidSearchTerm)(this.search.activeGlobalSearchTerm,this.siteSettings)&&this.quickSearch.invalidTerm&&this.search.activeGlobalSearchTerm?.length>0}static{(0,a.setComponentTemplate)((0,n.createTemplateFactory)({id:"k6uzZwr4",block:'[[[1,"\\n"],[41,[30,0,["termTooShort"]],[[[1,"      "],[10,0],[14,0,"no-results"],[12],[1,[28,[32,0],["search.too_short"],null]],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-quick-search-info.js",scope:()=>[o.i18n],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-category-after/ai-category-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showPostAIHelper)(e,t)}static{dt7948.g(this.prototype,"siteSettings",[s.service])}#l=void dt7948.i(this,"siteSettings")
static{(0,a.setComponentTemplate)((0,n.createTemplateFactory)({id:"4O7HJkah",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction"],[[30,1,["selectedPosts"]],"suggest_category",[30,1,["updateCategoryId"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-category-after/ai-category-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-tag-after/ai-tag-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showPostAIHelper)(e,t)}static{dt7948.g(this.prototype,"siteSettings",[s.service])}#l=void dt7948.i(this,"siteSettings")
static{(0,a.setComponentTemplate)((0,n.createTemplateFactory)({id:"jo6+zYZR",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction","@currentValue"],[[30,1,["selectedPosts"]],"suggest_tags",[30,1,["updateTags"]],[30,1,["tags"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-tag-after/ai-tag-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-title-after/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e,t){return(0,i.showPostAIHelper)(e,t)}static{(0,o.setComponentTemplate)((0,a.createTemplateFactory)({id:"obhR2Q8M",block:'[[[1,"\\n    "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction"],[[30,1,["selectedPosts"]],"suggest_title",[30,1,["updateTopicName"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-title-after/ai-title-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/connectors/topic-map-expanded-after/ai-summary-trigger",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/plugins/discourse-ai/discourse/components/modal/ai-summary-modal","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static{dt7948.g(this.prototype,"modal",[i.service])}#j=void dt7948.i(this,"modal")
get isAiConversation(){return this.args.outletArgs.topic.is_bot_pm}openAiSummaryModal(){this.modal.show(a.default,{model:{topic:this.args.outletArgs.topic,postStream:this.args.outletArgs.postStream}})}static{dt7948.n(this.prototype,"openAiSummaryModal",[s.action])}static{(0,n.setComponentTemplate)((0,r.createTemplateFactory)({id:"zAyGCacI",block:'[[[1,"\\n"],[41,[51,[30,0,["isAiConversation"]]],[[[41,[30,1,["topic","summarizable"]],[[[1,"        "],[10,"section"],[14,0,"topic-map__additional-contents toggle-summary"],[12],[1,"\\n          "],[8,[32,0],[[24,0,"btn-default ai-summarization-button"]],[["@label","@icon","@action"],["summary.buttons.generate","discourse-sparkles",[30,0,["openAiSummaryModal"]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"  "]],["@outletArgs"],false,["unless","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/topic-map-expanded-after/ai-summary-trigger.js",scope:()=>[o.default],isStrictMode:!0}),this)}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/connectors/topic-map-participants-after/ai-conversation-invite",["exports","@glimmer/component","@ember/object","@ember/service","truth-helpers","discourse/components/d-button","discourse/components/header/topic/participant","discourse/components/modal/add-pm-participants","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static shouldRender(e){return e.topic.is_bot_pm}static{dt7948.g(this.prototype,"site",[i.service])}#y=void dt7948.i(this,"site")
static{dt7948.g(this.prototype,"modal",[i.service])}#j=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"header",[i.service])}#Yt=void dt7948.i(this,"header")
static{dt7948.g(this.prototype,"sidebarState",[i.service])}#P=void dt7948.i(this,"sidebarState")
get participants(){return[...this.header.topicInfo.details?.allowed_users??[],...this.header.topicInfo.details?.allowed_groups??[]]}showInvite(){this.modal.show(r.default,{model:{title:"discourse_ai.ai_bot.invite_ai_conversation.title",inviteModel:this.args.outletArgs.topic}})}static{dt7948.n(this.prototype,"showInvite",[s.action])}static{(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"iRQqMyq7",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-conversation__participants"],[12],[1,"\\n      "],[8,[32,0],[[24,0,"btn-default ai-conversations__invite-button"]],[["@icon","@label","@action"],["user-plus","discourse_ai.ai_bot.invite_ai_conversation.button",[30,0,["showInvite"]]]],null],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["participants"]]],null]],null],null,[[[1,"        "],[8,[32,1],null,[["@user","@type","@username","@avatarSize"],[[30,1],[52,[30,1,["username"]],"user","group"],[28,[32,2],[[30,1,["username"]],[30,1,["name"]]],null],"medium"]],null],[1,"\\n"]],[1]],null],[1,"    "],[13],[1,"\\n  "]],["participant"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/topic-map-participants-after/ai-conversation-invite.js",scope:()=>[a.default,n.default,o.or],isStrictMode:!0}),this)}}e.default=u}),define("discourse/plugins/discourse-ai/discourse/connectors/user-messages-controls-bottom/pm-list-gist-toggle",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static{dt7948.g(this.prototype,"topicThumbnails",[s.service])}#Bt=void dt7948.i(this,"topicThumbnails")
get shouldShow(){return!this.topicThumbnails?.enabledForRoute}static{(0,o.setComponentTemplate)((0,a.createTemplateFactory)({id:"FFVUfQnW",block:"[[[8,[32,0],null,null,null]],[],false,[]]",moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/user-messages-controls-bottom/pm-list-gist-toggle.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/connectors/user-preferences-nav/ai-preferences",["exports","@glimmer/component","@ember/routing","discourse/helpers/d-icon","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,a,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return t.siteSettings.discourse_ai_enabled}static{(0,a.setComponentTemplate)((0,n.createTemplateFactory)({id:"/y5E1bgJ",block:'[[[1,"\\n    "],[10,"li"],[14,0,"user-nav__preferences-ai"],[12],[1,"\\n      "],[8,[32,0],null,[["@route"],["preferences.ai"]],[["default"],[[[[1,"\\n        "],[1,[28,[32,1],["discourse-sparkles"],null]],[1,"\\n        "],[10,1],[12],[1,[28,[32,2],["discourse_ai.title"],null]],[13],[1,"\\n      "]],[]]]]],[1,"\\n    "],[13],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/user-preferences-nav/ai-preferences.js",scope:()=>[s.LinkTo,i.default,o.i18n],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/controllers/admin-dashboard-sentiment",["exports","@ember/object","admin/controllers/admin-dashboard-tab"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{get filters(){return{startDate:this.startDate,endDate:this.endDate}}static{dt7948.n(this.prototype,"filters",[(0,t.computed)("startDate","endDate")])}get emotionFilters(){return{startDate:moment().subtract(2,"month").format("YYYY-MM-DD"),endDate:moment().format("YYYY-MM-DD")}}get emotions(){return["admiration","amusement","anger","annoyance","approval","caring","confusion","curiosity","desire","disappointment","disapproval","disgust","embarrassment","excitement","fear","gratitude","grief","joy","love","nervousness","neutral","optimism","pride","realization","relief","remorse","sadness","surprise"]}}e.default=i}),define("discourse/plugins/discourse-ai/discourse/controllers/discourse-ai-bot-conversations",["exports","@glimmer/tracking","@ember/controller"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static{dt7948.g(this.prototype,"llm",[t.tracked],function(){return null})}#ae=void dt7948.i(this,"llm")
static{dt7948.g(this.prototype,"persona",[t.tracked],function(){return null})}#Wt=void dt7948.i(this,"persona")
queryParams=["llm","persona"]}e.default=i}),define("discourse/plugins/discourse-ai/discourse/controllers/preferences-ai",["exports","@glimmer/tracking","@ember/controller","@ember/object","@ember/service","discourse/lib/ajax-error","discourse/lib/environment"],function(e,t,s,i,o,a,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends s.default{static{dt7948.g(this.prototype,"siteSettings",[o.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"saved",[t.tracked],function(){return!1})}#Kt=void dt7948.i(this,"saved")
get booleanSettings(){return[{key:"ai_search_discoveries",label:"discourse_ai.discobot_discoveries.user_setting",settingName:"ai-search-discoveries",checked:this.model.user_option.ai_search_discoveries,isIncluded:(()=>this.siteSettings.ai_bot_discover_persona&&this.model?.can_use_ai_bot_discover_persona&&this.siteSettings.ai_bot_enabled)()}]}get userSettingAttributes(){const e=[]
return this.booleanSettings.forEach(t=>{t.isIncluded&&e.push(t.key)}),e}save(){return this.saved=!1,this.model.save(this.userSettingAttributes).then(()=>{this.saved=!0,(0,n.isTesting)()||location.reload()}).catch(a.popupAjaxError)}static{dt7948.n(this.prototype,"save",[i.action])}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/discourse-ai-bot-dashboard-route-map",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){this.route("discourse-ai-bot-conversations",{path:"/discourse-ai/ai-bot/conversations"})}}),define("discourse/plugins/discourse-ai/discourse/discourse-ai-shared-conversation-show-route-map",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){this.route("discourse-ai-shared-conversation-show",{path:"/discourse-ai/ai-bot/shared-ai-conversations/:share_key"})}}),define("discourse/plugins/discourse-ai/discourse/initializers/admin-plugin-configuration-nav",["exports","discourse/lib/plugin-api"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"discourse-ai-admin-plugin-configuration-nav",initialize(e){const s=e.lookup("service:current-user")
s&&s.admin&&(0,t.withPluginApi)(e=>{e.addAdminPluginConfigurationNav("discourse-ai",[{label:"discourse_ai.features.short_title",route:"adminPlugins.show.discourse-ai-features",description:"discourse_ai.features.description"},{label:"discourse_ai.usage.short_title",route:"adminPlugins.show.discourse-ai-usage",description:"discourse_ai.usage.subheader_description"},{label:"discourse_ai.llms.short_title",route:"adminPlugins.show.discourse-ai-llms",description:"discourse_ai.llms.preconfigured.description"},{label:"discourse_ai.ai_persona.short_title",route:"adminPlugins.show.discourse-ai-personas",description:"discourse_ai.ai_persona.persona_description"},{label:"discourse_ai.embeddings.short_title",route:"adminPlugins.show.discourse-ai-embeddings",description:"discourse_ai.embeddings.description"},{label:"discourse_ai.tools.short_title",route:"adminPlugins.show.discourse-ai-tools",description:"discourse_ai.tools.subheader_description"},{label:"discourse_ai.spam.short_title",route:"adminPlugins.show.discourse-ai-spam",description:"discourse_ai.spam.spam_description"},{label:"discourse_ai.translations.title",route:"adminPlugins.show.discourse-ai-translations",description:"discourse_ai.translations.description"}])})}}}),define("discourse/plugins/discourse-ai/discourse/initializers/admin-reports",["exports","discourse/lib/plugin-api","discourse/plugins/discourse-ai/discourse/components/admin-report-emotion"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"discourse-ai-admin-reports",initialize(e){const i=e.lookup("service:current-user")
if(!i||!i.admin)return
const o=require("discourse/plugins/discourse-ai/discourse/components/admin-report-sentiment-analysis").default;(0,t.withPluginApi)(e=>{e.registerReportModeComponent("emotion",s.default),e.registerReportModeComponent("sentiment_analysis",o),e.registerValueTransformer("admin-reports-show-query-params",({value:e})=>[...e,"selectedChart"])})}}}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-artifacts",["exports","discourse/lib/plugin-api","discourse/plugins/discourse-ai/discourse/components/ai-artifact","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,a){"use strict"
function n(e){e.decorateCookedElement((e,t)=>{t.renderGlimmer&&[...e.querySelectorAll("div.ai-artifact")].forEach(e=>{const n=e.getAttribute("data-ai-artifact-id"),r=e.getAttribute("data-ai-artifact-version"),l=e.getAttribute("data-ai-artifact-height"),d=e.getAttribute("data-ai-artifact-autorun")||e.hasAttribute("data-ai-artifact-autorun"),u=e.getAttribute("data-ai-artifact-seamless")||e.hasAttribute("data-ai-artifact-seamless"),c={}
for(const t of e.attributes)t.name.startsWith("data-")&&"data-ai-artifact-id"!==t.name&&"data-ai-artifact-version"!==t.name&&"data-ai-artifact-height"!==t.name&&"data-ai-artifact-autorun"!==t.name&&"data-ai-artifact-seamless"!==t.name&&(c[t.name]=t.value)
t.renderGlimmer(e,(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"1GHagHFs",block:'[[[1,"\\n              "],[8,[32,0],null,[["@artifactId","@artifactVersion","@artifactHeight","@autorun","@seamless","@dataAttributes"],[[32,1],[32,2],[32,3],[32,4],[32,5],[32,6]]],null],[1,"\\n            "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/initializers/ai-artifacts.js",scope:()=>[s.default,n,r,l,d,u,c],isStrictMode:!0}),(0,a.default)(void 0,void 0)))})},{id:"ai-artifact",onlyStream:!0})}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"ai-artifact",initialize(){(0,t.withPluginApi)(n)}}}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-bot-replies",["exports","discourse/lib/deprecated","discourse/lib/plugin-api","discourse/widgets/render-glimmer","discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon","discourse/plugins/discourse-ai/discourse/components/post/ai-persona-flair","discourse/plugins/discourse-ai/discourse/components/post-menu/ai-cancel-streaming-button","discourse/plugins/discourse-ai/discourse/components/post-menu/ai-debug-button","discourse/plugins/discourse-ai/discourse/components/post-menu/ai-share-button","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/progress-handlers","@ember/template-factory"],function(e,t,s,i,o,a,n,r,l,d,u,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
let p=!1
function m(e){(function(e){e.registerValueTransformer("post-menu-buttons",({value:e,context:{post:t,firstButtonKey:s}})=>{(0,d.isGPTBot)(t.user)&&e.add("ai-cancel-gpt",n.default,{before:s,after:["ai-share","ai-debug"]})})})(e),e.modifyClass("controller:topic",{pluginId:"discourse-ai",onAIBotStreamedReply:function(e){(0,u.streamPostText)(this.model.postStream,e)},subscribe:function(){this._super(),this.model.isPrivateMessage&&this.model.details.allowed_users&&this.model.details.allowed_users.filter(d.isGPTBot).length>=1&&this.messageBus.subscribe(`discourse-ai/ai-bot/topic/${this.model.id}`,this.onAIBotStreamedReply.bind(this),-2)},unsubscribe:function(){this.messageBus.unsubscribe("discourse-ai/ai-bot/topic/*"),this._super()}})}function h(e){e.renderAfterWrapperOutlet("post-meta-data-poster-name",a.default),(0,t.withSilencedDeprecations)("discourse.post-stream-widget-overrides",()=>function(e){e.decorateWidget("poster-name:after",e=>{const t=(0,d.getBotType)(e.attrs.user)
return"llm"===t?e.widget.attach("persona-flair",{personaName:e.model?.topic?.ai_persona_name}):"persona"===t?e.widget.attach("persona-flair",{personaName:e.model?.llm_name}):void 0}),(0,i.registerWidgetShim)("persona-flair","span.persona-flair",(0,c.createTemplateFactory)({id:"ImoUEZuD",block:'[[[1,[30,1,["personaName"]]]],["@data"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/initializers/ai-bot-replies.js",isStrictMode:!1}))}(e))}e.default={name:"discourse-ai-bot-replies",initialize(e){const t=e.lookup("service:current-user")
t?.ai_enabled_chat_bots&&(p=t.can_debug_ai_bot_conversations,(0,s.withPluginApi)(e=>{(function(e){e.headerIcons.add("ai",o.default)})(e),m(e),h(e),function(e){const t=e.getCurrentUser()
t&&t.ai_enabled_chat_bots&&p&&e.registerValueTransformer("post-menu-buttons",({value:e,context:{post:t,firstButtonKey:s}})=>{"private_message"===t.topic?.archetype&&e.add("ai-debug",r.default,{before:s,after:"ai-share"})})}(e),function(e){const t=e.getCurrentUser()
t&&t.ai_enabled_chat_bots&&e.registerValueTransformer("post-menu-buttons",({value:e,context:{post:t,firstButtonKey:s}})=>{"private_message"===t.topic?.archetype&&e.add("ai-share",l.default,{before:s})})}(e),function(e){const t=e.container.lookup("service:modal"),s=e.container.lookup("service:current-user")
e.registerTopicFooterButton({id:"share-ai-conversation",icon:"share-nodes",label:"discourse_ai.ai_bot.share_ai_conversation.name",title:"discourse_ai.ai_bot.share_ai_conversation.title",action(){(0,d.showShareConversationModal)(t,this.topic.id)},classNames:["share-ai-conversation-button"],dependentKeys:["topic.ai_persona_name"],displayed(){return s?.can_share_ai_bot_conversations&&this.topic.ai_persona_name}})}(e)}))}}}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-chat-summarization",["exports","discourse/lib/api","discourse/plugins/discourse-ai/discourse/components/modal/chat-modal-channel-summary"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)(e=>{const t=e.container.lookup("service:site-settings"),i=e.getCurrentUser(),o=e.container.lookup("service:chat"),a=e.container.lookup("service:modal"),n=i&&i.can_summarize
t.chat_enabled&&o?.userCanChat&&n&&e.registerChatComposerButton({translatedLabel:"discourse_ai.summarization.chat.title",id:"channel-summary",icon:"discourse-sparkles",position:"dropdown",action:()=>{a.show(s.default,{model:{channelId:o.activeChannel?.id}})}})})})
define("discourse/plugins/discourse-ai/discourse/initializers/ai-conversations-sidebar",["exports","discourse/lib/plugin-api","discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-new-conversation","discourse/plugins/discourse-ai/discourse/services/ai-conversations-sidebar-manager"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"ai-conversations-sidebar",initialize(){(0,t.withPluginApi)(e=>{if(!e.container.lookup("service:site-settings").ai_bot_enable_dedicated_ux)return
const t=e.container.lookup("service:current-user")
if(!t)return
const o=e.container.lookup("service:ai-conversations-sidebar-manager")
o.api=e,e.addSidebarPanel(e=>class extends e{key=i.AI_CONVERSATIONS_PANEL
hidden=!0
displayHeader=!1
expandActiveSection=!0}),e.renderInOutlet("before-sidebar-sections",s.default)
e.container.lookup("service:router").on("routeDidChange",s=>{if("discourse-ai-bot-conversations"===s?.to?.name)return o.forceCustomSidebar()
const i=e.container.lookup("controller:topic").model
if("private_message"===i?.archetype&&i.user_id===t.id&&i.is_bot_pm)return o.forceCustomSidebar()
o.stopForcingCustomSidebar()})})}}}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-gist-connector",["exports","discourse/lib/ajax","discourse/lib/api","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-topic-gist","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,a,n,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,s.apiInitializer)(e=>{const s=e.container.lookup("service:site"),l=e.container.lookup("service:site-settings")
async function d(e,s,o=null){try{await(0,t.ajax)("/discourse-ai/summarization/regen_gist",{type:"PUT",data:{topic_ids:e}}),1===e.length&&await(0,t.ajax)(`/discourse-ai/summarization/t/${e[0]}`,{type:"GET"}),s.success({duration:"short",data:{message:(0,i.i18n)("discourse_ai.summarization.topic.regenerate_success",{count:e.length})}}),o&&o()}catch{s.error({duration:"short",data:{message:(0,i.i18n)("discourse_ai.summarization.topic.regenerate_error",{count:e.length})}})}}if(e.addBulkActionButton({label:"discourse_ai.summarization.topic.regenerate_bulk",icon:"arrows-rotate",class:"btn-default",visible:({topics:e,siteSettings:t,currentUser:s})=>!(e?.length>30)&&(t.discourse_ai_enabled&&t.ai_summarization_enabled&&t.ai_summary_gists_enabled&&s.staff),async action(e){const t=e.model.bulkSelectHelper.selected.map(e=>e.id),s=e.toasts
await d(t,s,()=>{e.model.refreshClosure?.().then(()=>{e.args.closeModal(),e.model.bulkSelectHelper.toggleBulkSelect(),e.showToast()})})},actionType:"performAndRefresh"}),l.discourse_ai_enabled&&l.ai_summarization_enabled){const t=(0,a.setComponentTemplate)((0,n.createTemplateFactory)({id:"heZe2mQY",block:'[[[1,"\\n      "],[8,[32,0],null,[["@topic"],[[30,1,["topic"]]]],null],[1,"\\n    "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/initializers/ai-gist-connector.js",scope:()=>[o.default],isStrictMode:!0}),(0,r.default)(void 0,"ai-gist-connector:gistTemplate")),i=s.mobileView?"topic-list-before-category":"topic-list-topic-cell-link-bottom-line__before"
e.renderInOutlet(i,t),e.addTopicAdminMenuButton(t=>{if(l.ai_summary_gists_enabled)return{action:async()=>{const s=t.id,i=e.container.lookup("service:toasts")
await d([s],i,()=>{window.location.reload()})},icon:"arrows-rotate",className:"regenerate-gist-button",label:"discourse_ai.summarization.topic.regenerate"}})}})}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-gist-topic-list-class",["exports","discourse/lib/api"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)(e=>{const t=e.container.lookup("service:gists")
e.registerValueTransformer("topic-list-item-class",({value:e,context:s})=>{const i="table-ai"===t.preference&&t.shouldShow
return s.topic.get("ai_topic_gist")&&i&&e.push("excerpt-expanded"),e})})}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-helper",["exports","discourse/lib/plugin-api","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-composer-helper-menu","discourse/plugins/discourse-ai/discourse/components/modal/diff-modal","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"discourse-ai-helper",initialize(){(0,t.withPluginApi)(e=>{(function(e){e.onToolbarCreate(t=>{const n=e.getCurrentUser(),r=e.container.lookup("service:modal"),l=e=>{const t=e.getText(),s=e.selected.value
return s&&s.length>0?s:t&&t.length>0?t:void 0}
t.addButton({id:"ai-helper-trigger",group:"extras",icon:"discourse-sparkles",title:"discourse_ai.ai_helper.context_menu.trigger",preventFocus:!0,hideShortcutInTitle:!0,shortcut:"ALT+P",shortcutAction:t=>{if(0===t.getText().length)return e.container.lookup("service:toasts").error({class:"ai-proofread-error-toast",duration:"short",data:{message:(0,s.i18n)("discourse_ai.ai_helper.no_content_error")}})
const i=n?.ai_helper_prompts.find(e=>"proofread"===e.name).name
r.show(o.default,{model:{mode:i,selectedText:l(t),toolbarEvent:t,showResultAsDiff:!0}})},condition:()=>(0,a.showComposerAiHelper)(e.container.lookup("service:composer").model,e.container.lookup("service:site-settings"),n,"context_menu"),sendAction:t=>{e.container.lookup("service:menu").show(document.querySelector(".ai-helper-trigger"),{identifier:"ai-composer-helper-menu",component:i.default,modalForMobile:!0,interactive:!0,data:{toolbarEvent:t,selectedText:l(t)}})}})})})(e)})}}}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-image-caption",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/api","discourse-i18n"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,i.apiInitializer)(e=>{const i={label:(0,o.i18n)("discourse_ai.ai_helper.image_caption.button_label"),icon:"discourse-sparkles",class:"generate-caption"},a=e.container.lookup("service:site-settings"),n=e.getCurrentUser()
a.ai_helper_enabled_features.includes("image_caption")&&n?.can_use_assistant&&e.addComposerImageWrapperButton(i.label,i.class,i.icon,i=>{const o=e.container.lookup("service:imageCaptionPopup")
if(o.popupTrigger=i.target,o.popupTrigger.classList.contains("generate-caption")){const a=i.target.closest(".button-wrapper"),n=parseInt(a.getAttribute("data-image-index"),10),r=i.target.closest(".image-wrapper").querySelector("img").getAttribute("src")
o.toggleLoadingState(!0)
const l=e.container.lookup("service:site")
l.mobileView||(o.showPopup=!o.showPopup),o._request=(0,t.ajax)("/discourse-ai/ai-helper/caption_image",{method:"POST",data:{image_url:r,image_url_type:"long_url"}}),o._request.then(({caption:e})=>{o.imageSrc=r,o.imageIndex=n,o.newCaption=e,l.mobileView&&o.updateCaption()}).catch(s.popupAjaxError).finally(()=>{o.toggleLoadingState(!1)})}})})}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-search-discoveries",["exports","discourse/lib/api"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)(e=>{const t=e.getCurrentUser()
e.container.lookup("service:site-settings").ai_bot_enabled&&t?.can_use_ai_bot_discover_persona&&e.addSaveableUserOptionField("ai_search_discoveries")})}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-semantic-search",["exports","discourse/lib/api"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)(e=>{e.modifyClass("component:search-result-entry",{pluginId:"discourse-ai",classNameBindings:["bulkSelectEnabled","post.generatedByAi:ai-result"]})})}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-sentiment-admin-nav",["exports","discourse/lib/api"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)(e=>{const t=e.getCurrentUser()
t&&t.admin&&t.can_see_sentiment_reports&&(e.addAdminSidebarSectionLink("reports",{name:"sentiment_overview",route:"admin.dashboardSentiment",label:"discourse_ai.sentiments.sidebar.overview",icon:"chart-column"}),e.addAdminSidebarSectionLink("reports",{name:"sentiment_analysis",route:"adminReports.show",routeModels:["sentiment_analysis"],label:"discourse_ai.sentiments.sidebar.analysis",icon:"chart-pie"}))})}),define("discourse/plugins/discourse-ai/discourse/initializers/related-topics",["exports","@glimmer/tracking","discourse/components/basic-topic-list","discourse/helpers/d-icon","discourse/lib/plugin-api","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,a,n,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=(0,n.setComponentTemplate)((0,r.createTemplateFactory)({id:"BD0VyKCH",block:'[[[1,"\\n  "],[10,0],[14,"role","complementary"],[14,"aria-labelledby","related-topics-title"],[14,1,"related-topics"],[14,0,"more-topics__list"],[12],[1,"\\n    "],[10,"h3"],[14,1,"related-topics-title"],[14,0,"more-topics__list-title"],[12],[1,"\\n      "],[1,[28,[32,0],["discourse-sparkles"],null]],[1,[28,[32,1],["discourse_ai.related_topics.title"],null]],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"topics"],[12],[1,"\\n      "],[8,[32,2],null,[["@topics"],[[30,1,["relatedTopics"]]]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],["@topic"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/initializers/related-topics.js",scope:()=>[i.default,a.i18n,s.default],isStrictMode:!0}),(0,l.default)(void 0,"related-topics:RelatedTopics"))
e.default={name:"discourse-ai-related-topics",initialize(e){const s=e.lookup("service:site-settings")
s.ai_embeddings_enabled&&s.ai_embeddings_semantic_related_topics_enabled&&(0,o.withPluginApi)(e=>{e.registerMoreTopicsTab({id:"related-topics",name:(0,a.i18n)("discourse_ai.related_topics.pill"),icon:"discourse-sparkles",component:d,condition:({topic:e})=>e.relatedTopics?.length}),e.modifyClass("model:topic",e=>class extends e{static{dt7948.g(this.prototype,"related_topics",[t.tracked])}#Jt=void dt7948.i(this,"related_topics")
relatedTopicsCache=[]
get relatedTopics(){return this.related_topics&&(this.relatedTopicsCache=this.related_topics),this.relatedTopicsCache?.map(e=>this.store.createRecord("topic",e))}static{dt7948.n(this.prototype,"relatedTopics",[t.cached])}}),e.modifyClass("model:post-stream",e=>class extends e{_setSuggestedTopics(e){super._setSuggestedTopics(...arguments),this.topic.related_topics=e.related_topics}})})}}}),define("discourse/plugins/discourse-ai/discourse/initializers/translation",["exports","discourse/lib/api","discourse/lib/cookie"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)(e=>{const t=e.container.lookup("service:site-settings")
t.discourse_ai_enabled&&t.ai_translation_enabled&&e.registerCustomPostMessageCallback("localized",(e,t)=>{if(!(0,s.default)("content-localization-show-original")){e.get("model.postStream").triggerChangedPost(t.id,t.updated_at).then(()=>{e.appEvents.trigger("post-stream:refresh",{id:t.id})})}})})}),define("discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/get-owner","discourse/models/composer","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal"],function(e,t,s,i,o,a,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.composeAiBotMessage=async function(e,t,s={skipFocus:!1,topicBody:"",personaUsername:null}){const i=t.currentUser,n="new_private_message_ai_"+(new Date).getTime()
let r
r=e?i.ai_enabled_chat_bots.find(t=>t.model_name===e)?.username:s.personaUsername?s.personaUsername:i.ai_enabled_chat_bots[0].username
const l={action:o.default.PRIVATE_MESSAGE,recipients:r,topicTitle:(0,a.i18n)("discourse_ai.ai_bot.default_pm_prefix"),archetypeId:"private_message",draftKey:n,hasGroups:!1,warningsDisabled:!0}
s.skipFocus?(l.topicBody=s.topicBody,await t.open(l)):t.focusComposer({fallbackToNewTopic:!0,openOpts:l})},e.getBotType=function(e){if(!e)return
d()
const t=l[e.id]
if(!t)return
return t.is_persona?"persona":"llm"},e.isGPTBot=function(e){if(!e)return
return d(),!!l[e.id]},e.isPostFromAiBot=function(e,t){return e.user_id<=r||!!t?.ai_enabled_chat_bots?.any(t=>e.username===t.username)},e.showShareConversationModal=function(e,i){(0,t.ajax)(`/discourse-ai/ai-bot/shared-ai-conversations/preview/${i}.json`).then(t=>{e.show(n.default,{model:t})}).catch(s.popupAjaxError)}
const r=-1200
let l=null
function d(){if(!l){const e=(0,i.getOwnerWithFallback)(this).lookup("service:current-user")
l={},e.ai_enabled_chat_bots.forEach(e=>{l[e.id]=e})}}}),define("discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions",["exports","@ember/owner","@ember/runloop","discourse-i18n"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.MIN_CHARACTER_COUNT=void 0,e.showSuggestionsError=function(e,o){(0,t.getOwner)(e).lookup("service:toasts").error({class:"ai-suggestion-error",duration:"long",showProgressBar:!0,data:{message:(0,i.i18n)("discourse_ai.ai_helper.suggest_errors.no_suggestions"),actions:[{label:(0,i.i18n)("discourse_ai.ai_helper.context_menu.regen"),icon:"rotate",class:"btn btn-small",action:async t=>{t.close(),await o(),e.dMenu?.show&&e.suggestions?.length>0&&(0,s.later)(()=>e.dMenu.show(),50)}}]}})}
e.MIN_CHARACTER_COUNT=40}),define("discourse/plugins/discourse-ai/discourse/lib/ai-streamer/progress-handlers",["exports","@ember/runloop","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/post-updater"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.MIN_LETTERS_PER_INTERVAL=void 0,e.addProgressDot=function(e){let t=e
for(;;){let e=l(t)
if(!e)break
if(e.nodeType!==Node.ELEMENT_NODE)break
t=e}const s=document.createElement("span")
s.classList.add("progress-dot"),t.appendChild(s)},e.applyProgress=d,e.default=function(e,s,o){const a=new e(s,o)
r||(r=(0,t.later)(async()=>{await d(s,a),r=null,s.done||await d(s,a)},i))},e.streamPostText=function(e,t){if(t.noop)return;(e.aiStreamingStatus=e.aiStreamingStatus||{})[t.post_id]=t,u(e)}
const i=40,o=6e5,a=e.MIN_LETTERS_PER_INTERVAL=6,n=800
let r=null
function l(e){let t=e.lastChild
for(;t&&t.nodeType===Node.TEXT_NODE&&!/\S/.test(t.textContent);)t=t.previousSibling
return t}async function d(e,t){if(e.startTime=e.startTime||Date.now(),Date.now()-e.startTime>o)return t.streaming=!1,!0
if(!t.element)return!1
const s=t.raw
if(e.raw===s&&!e.done){if(t.element.querySelector(".progress-dot"))return!1}if(void 0!==e.raw){let o=e.raw
if(!e.done)if(0===s.length&&-1!==o.indexOf("</details>"))o=e.raw
else{const t=o.length-s.length
let r=Math.floor(t/(n/i))
r<a&&(r=a),o=e.raw.substring(0,s.length+r)}await t.setRaw(o,e.done)}return e.done&&(e.cooked&&await t.setCooked(e.cooked,!0),t.streaming=!1),e.done}function u(e){r||(r=(0,t.later)(async()=>{const t=await async function(e){const t=e.aiStreamingStatus
let i=!1
const o=Object.keys(t).map(async o=>{let a=t[o]
const n=new s.default(e,a.post_id)
await d(a,n)?delete t[o]:i=!0})
return await Promise.all(o),i}(e)
r=null,t&&u(e)},i))}}),define("discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/post-updater",["exports","discourse/lib/load-morphlex","discourse/lib/plugin-api","discourse/lib/text","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/progress-handlers","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/stream-updater"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends a.default{morphingOptions={beforeAttributeUpdated:(e,t)=>!("DETAILS"===e.tagName&&"open"===t)}
constructor(e,t){super(),this.postStream=e,this.postId=t,this.post=e.findLoadedPost(t)
const s=e.topic.id
this.post&&(this.postElement=document.querySelector(`.topic-area[data-topic-id="${s}"] #post_${this.post.post_number}`))}get element(){return this.postElement}set streaming(e){this.postElement&&(e?this.postElement.classList.add("streaming"):this.postElement.classList.remove("streaming"))}async setRaw(e,t){this.post.set("raw",e)
const s=await(0,i.cook)(e)
this.element.classList.remove("streaming"),this.element.offsetWidth,this.element.classList.add("streaming")
const a=document.createElement("div")
a.innerHTML=s,t||(0,o.addProgressDot)(a),await this.setCooked(a.innerHTML,t)}async setCooked(e,i){this.postElement&&((0,s.withPluginApi)(e=>e.preventCloak(this.postId)),(await(0,t.default)()).morphInner(this.postElement.querySelector(".cooked"),`<div>${e}</div>`,this.morphingOptions),i&&(this.post.set("cooked",e),(0,s.withPluginApi)(e=>e.preventCloak(this.postId,!1))))}get raw(){return this.post.get("raw")||""}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/stream-updater",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{set streaming(e){throw"not implemented"}async setCooked(){throw"not implemented"}async setRaw(){throw"not implemented"}get element(){throw"not implemented"}get raw(){throw"not implemented"}}}),define("discourse/plugins/discourse-ai/discourse/lib/ai-topic-summary",["exports","@glimmer/tracking","discourse/lib/ajax","discourse/lib/formatter","discourse/lib/text"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a{static{dt7948.g(this.prototype,"text",[t.tracked],function(){return""})}#et=void dt7948.i(this,"text")
static{dt7948.g(this.prototype,"summarizedOn",[t.tracked],function(){return null})}#tt=void dt7948.i(this,"summarizedOn")
static{dt7948.g(this.prototype,"summarizedBy",[t.tracked],function(){return null})}#st=void dt7948.i(this,"summarizedBy")
static{dt7948.g(this.prototype,"newPostsSinceSummary",[t.tracked],function(){return null})}#it=void dt7948.i(this,"newPostsSinceSummary")
static{dt7948.g(this.prototype,"outdated",[t.tracked],function(){return!1})}#ot=void dt7948.i(this,"outdated")
static{dt7948.g(this.prototype,"canRegenerate",[t.tracked],function(){return!1})}#at=void dt7948.i(this,"canRegenerate")
static{dt7948.g(this.prototype,"regenerated",[t.tracked],function(){return!1})}#Qt=void dt7948.i(this,"regenerated")
static{dt7948.g(this.prototype,"showSummaryBox",[t.tracked],function(){return!1})}#Xt=void dt7948.i(this,"showSummaryBox")
static{dt7948.g(this.prototype,"canCollapseSummary",[t.tracked],function(){return!1})}#Zt=void dt7948.i(this,"canCollapseSummary")
static{dt7948.g(this.prototype,"loadingSummary",[t.tracked],function(){return!1})}#es=void dt7948.i(this,"loadingSummary")
processUpdate(e){const t=e.ai_topic_summary
return(0,o.cook)(t.summarized_text).then(e=>{this.text=e,this.loading=!1}).then(()=>{e.done&&(this.summarizedOn=(0,i.shortDateNoYear)(t.summarized_on),this.summarizedBy=t.algorithm,this.newPostsSinceSummary=t.new_posts_since_summary,this.outdated=t.outdated,this.newPostsSinceSummary=t.new_posts_since_summary,this.canRegenerate=t.outdated&&t.can_regenerate)})}collapse(){this.showSummaryBox=!1,this.canCollapseSummary=!1}generateSummary(e,t){if(this.showSummaryBox=!0,this.text&&!this.canRegenerate)return void(this.canCollapseSummary=!1)
let i=`/discourse-ai/summarization/t/${t}?`
return e&&(i+="stream=true",this.canRegenerate&&(i+="&skip_age_check=true")),this.loading=!0,(0,s.ajax)(i).then(t=>{e||(t.done=!0,this.processUpdate(t))})}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/lib/copy-conversation",["exports","discourse/lib/ajax","discourse/lib/utilities","discourse-i18n"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(e,o,a){await(0,s.clipboardCopyAsync)(async()=>{const s=await async function(e,s,o){const a=e.get("postStream")
let n=[]
for(let t=s;t<=o;t++)n.push(t)
const r=n.map(e=>a.findPostIdForPostNumber(e)),l=`/t/${e.id}/posts.json`,d={post_ids:r,include_raw:!0},u=await(0,t.ajax)(l,{data:d})
let c=[]
c.push("<details class='ai-quote'>"),c.push("<summary>"),c.push(`<span>${e.title}</span>`),c.push(`<span title='${(0,i.i18n)("discourse_ai.ai_bot.ai_title")}'>${(0,i.i18n)("discourse_ai.ai_bot.ai_label")}</span>`),c.push("</summary>"),u.post_stream.posts.forEach(e=>{c.push(""),c.push(`**${e.username}:**`),c.push(""),c.push(e.raw)}),c.push("</details>")
const p=c.join("\n")
return p}(e,o,a)
return new Blob([s],{type:"text/plain"})})}}),define("discourse/plugins/discourse-ai/discourse/lib/diff-streamer",["exports","@glimmer/tracking","@ember/runloop","discourse/lib/load-js-diff","discourse/lib/utilities"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a{static{dt7948.g(this.prototype,"isStreaming",[t.tracked],function(){return!1})}#ts=void dt7948.i(this,"isStreaming")
static{dt7948.g(this.prototype,"words",[t.tracked],function(){return[]})}#ss=void dt7948.i(this,"words")
static{dt7948.g(this.prototype,"lastResultText",[t.tracked],function(){return""})}#is=void dt7948.i(this,"lastResultText")
static{dt7948.g(this.prototype,"diff",[t.tracked],function(){return this.selectedText})}#A=void dt7948.i(this,"diff")
static{dt7948.g(this.prototype,"suggestion",[t.tracked],function(){return""})}#fe=void dt7948.i(this,"suggestion")
static{dt7948.g(this.prototype,"isDone",[t.tracked],function(){return!1})}#os=void dt7948.i(this,"isDone")
static{dt7948.g(this.prototype,"isThinking",[t.tracked],function(){return!0})}#as=void dt7948.i(this,"isThinking")
typingTimer=null
currentWordIndex=0
currentCharIndex=0
jsDiff=null
bufferedToken=null
rushMode=!1
rushBatchSize=1
rushTicksLeft=0
receivedFinalUpdate=!1
constructor(e,t){this.selectedText=e,this.typingDelay=t||10,this.loadJSDiff()}async loadJSDiff(){this.jsDiff=await(0,i.default)()}async updateResult(e,t){if(this.receivedFinalUpdate)return
this.jsDiff||await this.loadJSDiff(),this.isThinking=!1
const i=e[t]
if(!!e?.done){this.receivedFinalUpdate=!0,this.typingTimer&&((0,s.cancel)(this.typingTimer),this.typingTimer=null),this.bufferedToken&&(this.words.push(this.bufferedToken),this.bufferedToken=null)
const e=i.slice(this.lastResultText.length)
e.length&&this.words.push(...this.#ns(e))
const t=i.length-this.suggestion.length
return t<=0?(this.suggestion=i,this.diff=this.#rs(this.jsDiff.diffWordsWithSpace(this.selectedText,i),!1),this.isStreaming=!1,void(this.isDone=!0)):(this.rushBatchSize=Math.ceil(t/10),this.rushTicksLeft=10,this.rushMode=!0,this.isStreaming=!0,this.lastResultText=i,void this.#ls())}const o=i.slice(this.lastResultText.length)
if(!o)return void(this.lastResultText=i)
const a=(this.bufferedToken||"")+o,n=this.#ns(a)
this.bufferedToken=n.pop()||null,n.length&&this.words.push(...n),this.isStreaming=!0,this.typingTimer||this.#ls(),this.lastResultText=i}reset(){this.diff="",this.suggestion="",this.lastResultText="",this.words=[],this.currentWordIndex=0,this.currentCharIndex=0,this.bufferedToken=null,this.isStreaming=!1,this.isDone=!1,this.receivedFinalUpdate=!1,this.isThinking=!0,this.rushMode=!1,this.rushBatchSize=1,this.rushTicksLeft=0,this.typingTimer&&((0,s.cancel)(this.typingTimer),this.typingTimer=null)}streamingDiff(e,t){const s=Math.floor(t.length+.1*t.length+10),i=e.slice(0,s),o=e.slice(s),a=this.jsDiff.diffWordsWithSpace(i,t)
if(o.length){let e=a.at(-1),t=a.at(-2)
e.added&&t?.removed&&(a.splice(-2,2,e,t),e=t),e.removed||(e={added:!1,removed:!0,value:""},a.push(e)),e.value+=o}return a}#ls(){if(!this.isStreaming)return
const e=this.rushMode?this.rushBatchSize:1
let t=0
for(;t<e&&this.currentWordIndex<this.words.length;){const e=this.words[this.currentWordIndex]
this.suggestion+=e.charAt(this.currentCharIndex),this.currentCharIndex++,t++,this.currentCharIndex>=e.length&&(this.currentWordIndex++,this.currentCharIndex=0)}let i=!1
if(this.rushMode?this.rushTicksLeft>0&&(this.rushTicksLeft--,i=!0):i=0===this.currentCharIndex,i||this.currentWordIndex>=this.words.length){const e=this.currentWordIndex<this.words.length||this.rushMode
this.diff=this.#rs(e?this.streamingDiff(this.selectedText,this.suggestion):this.jsDiff.diffWordsWithSpace(this.selectedText,this.suggestion),!this.rushMode)}if(this.currentWordIndex>=this.words.length)this.isStreaming=!1,this.rushMode=!1,this.typingTimer=null,this.receivedFinalUpdate&&(this.isDone=!0)
else{const e=this.rushMode?100:this.typingDelay
this.typingTimer=(0,s.later)(this,this.#ls,e)}}#ns(e){return e.split(/(?<=\S)(?=\s)/)}#ds(e,t){return"added"===t?`<ins>${e}</ins>`:"removed"===t?/^\s+$/.test(e)?"":`<del>${e}</del>`:`<span>${e}</span>`}#rs(e,t=!0){const s=[]
e.forEach(e=>(e.value.match(/\S+|\s+/g)||[]).forEach(t=>s.push({text:t,type:e.added?"added":e.removed?"removed":"unchanged"})))
let i=-1
if(t)for(let o=s.length-1;o>=0;o--)if("removed"!==s[o].type&&/\S/.test(s[o].text)){i=o
break}const a=[]
for(let n=0;n<=i;n++){let{text:e,type:r}=s[n]
if(e=(0,o.escapeExpression)(e),/^\s+$/.test(e)){a.push(e)
continue}let l=this.#ds(e,r)
t&&n===i&&(l=`<mark class="highlight">${l}</mark>`),a.push(l)}for(let n=i+1;n<s.length;){const e=s[n].type
let t=""
for(;n<s.length&&s[n].type===e;)t+=s[n++].text
a.push(this.#ds((0,o.escapeExpression)(t),e))}return a.join("")}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/lib/show-ai-helper",["exports"],function(e){"use strict"
function t(e){return e.discourse_ai_enabled&&e.ai_helper_enabled}Object.defineProperty(e,"__esModule",{value:!0}),e.showComposerAiHelper=function(e,s,i,o){const a=t(s),n=i.can_use_assistant,r=s.ai_helper_allowed_in_pm,l=s.ai_helper_enabled_features.includes(o)
if(e?.privateMessage)return a&&n&&r&&l
return a&&n&&l},e.showPostAIHelper=function(e,s){return t(s.siteSettings)&&s.currentUser?.can_use_assistant_in_post}}),define("discourse/plugins/discourse-ai/discourse/lib/smooth-streamer",["exports","@glimmer/tracking","@ember/runloop"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i{static{dt7948.g(this.prototype,"isStreaming",[t.tracked],function(){return!1})}#ts=void dt7948.i(this,"isStreaming")
static{dt7948.g(this.prototype,"streamedText",[t.tracked],function(){return""})}#us=void dt7948.i(this,"streamedText")
typingTimer=null
streamedTextLength=0
constructor(e,t,s){this.getRealtimeText=e,this.setRealtimeText=t,this.typingDelay=s||15}get renderedText(){return this.isStreaming?this.streamedText:this.realtimeText}get realtimeText(){return this.getRealtimeText()}set realtimeText(e){this.setRealtimeText(e)}resetStreaming(){this.#cs(),this.isStreaming=!1,this.streamedText="",this.streamedTextLength=0}async updateResult(e,t){const s=e[t]
e?.done?(this.streamedText=s,this.realtimeText=s,this.isStreaming=!1,this.#cs()):s.length>this.realtimeText.length&&(this.realtimeText=s,this.isStreaming=!0,await this.#ps())}#ms(){this.streamedTextLength<this.realtimeText.length?(this.streamedText+=this.realtimeText.charAt(this.streamedTextLength),this.streamedTextLength++,this.typingTimer=(0,s.later)(this,this.#ms,this.typingDelay)):this.typingTimer=null}#ps(){this.#cs(),this.#ms()}#cs(){this.typingTimer&&(0,s.cancel)(this.typingTimer)}}e.default=i}),define("discourse/plugins/discourse-ai/discourse/lib/utilities",["exports","@ember/template","discourse/lib/utilities"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.jsonToHtml=function e(i){if(null===i)return"null"
if("object"!=typeof i)return(0,s.escapeExpression)(i)
let o="<ul>"
for(let[t,a]of Object.entries(i))o+="<li>",t=(0,s.escapeExpression)(t),"object"==typeof a&&Array.isArray(a)?o+=`<strong>${t}:</strong> ${e(a)}`:"object"==typeof a?o+=`<strong>${t}:</strong> <ul><li>${e(a)}</li></ul>`:("string"==typeof a&&(a=(0,s.escapeExpression)(a).replace(/\n/g,"<br>")),o+=`<strong>${t}:</strong> ${a}`),o+="</li>"
return o+="</ul>",(0,t.htmlSafe)(o)}}),define("discourse/plugins/discourse-ai/discourse/preferences-ai-route-map",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"user.preferences",map(){this.route("ai")}}}),define("discourse/plugins/discourse-ai/discourse/routes/discourse-ai-shared-conversation-show",["exports","@ember/service","discourse/routes/discourse"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static{dt7948.g(this.prototype,"currentUser",[t.service])}#k=void dt7948.i(this,"currentUser")
beforeModel(e){this.currentUser?.user_option?.external_links_in_new_tab?window.open(e.intent.url,"_blank"):this.redirect(e.intent.url),e.abort()}redirect(e){window.location=e}}e.default=i}),define("discourse/plugins/discourse-ai/discourse/routes/preferences-ai",["exports","@ember/service","discourse/lib/utilities","discourse/routes/restricted-user"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends i.default{static{dt7948.g(this.prototype,"siteSettings",[t.service])}#l=void dt7948.i(this,"siteSettings")
setupController(e,t){if(!this.siteSettings.discourse_ai_enabled)return this.router.transitionTo(`discovery.${(0,s.defaultHomepage)()}`)
e.set("model",t)}}e.default=o}),define("discourse/plugins/discourse-ai/discourse/services/ai-bot-conversations-hidden-submit",["exports","@ember/object","@ember/runloop","@ember/service","@ember-compat/tracked-built-ins","discourse/lib/ajax","discourse/lib/uploads","discourse-i18n"],function(e,t,s,i,o,a,n,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends i.default{static{dt7948.g(this.prototype,"aiConversationsSidebarManager",[i.service])}#C=void dt7948.i(this,"aiConversationsSidebarManager")
static{dt7948.g(this.prototype,"appEvents",[i.service])}#S=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"composer",[i.service])}#x=void dt7948.i(this,"composer")
static{dt7948.g(this.prototype,"dialog",[i.service])}#L=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"router",[i.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"siteSettings",[i.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"loading",[o.tracked],function(){return!1})}#ge=void dt7948.i(this,"loading")
personaId
targetUsername
inputValue=""
focusInput(){this.composer.destroyDraft(),this.composer.close(),(0,s.next)(()=>{document.getElementById("ai-bot-conversations-input").focus()})}static{dt7948.n(this.prototype,"focusInput",[t.action])}async submitToBot(e){if(this.inputValue.length<this.siteSettings.min_personal_message_post_length)return this.dialog.alert({message:(0,r.i18n)("discourse_ai.ai_bot.conversations.min_input_length_message",{count:this.siteSettings.min_personal_message_post_length}),didConfirm:()=>this.focusInput(),didCancel:()=>this.focusInput()})
if(e.inProgressUploadsCount>0)return this.dialog.alert({message:(0,r.i18n)("discourse_ai.ai_bot.conversations.uploads_in_progress")})
this.loading=!0
const t=(0,r.i18n)("discourse_ai.ai_bot.default_pm_prefix")
let s=this.inputValue
e.uploads&&e.uploads.length>0&&(s+="\n\n",e.uploads.forEach(e=>{const t=(0,n.getUploadMarkdown)(e)
s+=t+"\n"}))
try{const e=await(0,a.ajax)("/posts.json",{method:"POST",data:{raw:s,title:t,archetype:"private_message",target_recipients:this.targetUsername,meta_data:{ai_persona_id:this.personaId}}})
this.inputValue="",this.appEvents.trigger("discourse-ai:bot-pm-created",{id:e.topic_id,slug:e.topic_slug,title:t}),this.router.transitionTo(e.post_url)}finally{this.loading=!1}}static{dt7948.n(this.prototype,"submitToBot",[t.action])}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/services/ai-conversations-sidebar-manager",["exports","@glimmer/tracking","@ember/runloop","@ember/service","@ember/template","@ember-compat/tracked-built-ins","discourse/lib/ajax","discourse/lib/debounce","discourse/lib/formatter","discourse/lib/sidebar/panels","discourse/lib/utilities","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-empty-state"],function(e,t,s,i,o,a,n,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.AI_CONVERSATIONS_PANEL=void 0
const m=e.AI_CONVERSATIONS_PANEL="ai-conversations"
class h extends i.default{static{dt7948.g(this.prototype,"appEvents",[i.service])}#S=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"sidebarState",[i.service])}#P=void dt7948.i(this,"sidebarState")
static{dt7948.g(this.prototype,"messageBus",[i.service])}#ce=void dt7948.i(this,"messageBus")
static{dt7948.g(this.prototype,"routeHistory",[i.service])}#hs=void dt7948.i(this,"routeHistory")
static{dt7948.g(this.prototype,"router",[i.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"topics",[t.tracked],function(){return[]})}#gs=void dt7948.i(this,"topics")
static{dt7948.g(this.prototype,"sections",[t.tracked],function(){return new a.TrackedArray})}#fs=void dt7948.i(this,"sections")
static{dt7948.g(this.prototype,"isLoading",[t.tracked],function(){return!0})}#rt=void dt7948.i(this,"isLoading")
api=null
isFetching=!1
page=0
hasMore=!0
_registered=new Set
_hasScrollListener=!1
_scrollElement=null
_didInit=!1
_debouncedScrollHandler=()=>{(0,r.default)(this,()=>{const e=this._scrollElement
if(!e)return
const{scrollTop:t,scrollHeight:s,clientHeight:i}=e
s-t-i-100<100&&!this.isFetching&&this.hasMore&&this.fetchMessages()},100)}
constructor(){super(...arguments),this.appEvents.on("discourse-ai:bot-pm-created",this,this._handleNewBotPM),this.appEvents.on("discourse-ai:conversations-sidebar-updated",this,this._attachScrollListener)}willDestroy(){super.willDestroy(...arguments),this.appEvents.off("discourse-ai:bot-pm-created",this,this._handleNewBotPM),this.appEvents.off("discourse-ai:conversations-sidebar-updated",this,this._attachScrollListener)}addEmptyStateClass(){document.body.classList.toggle("has-empty-ai-conversations-sidebar",!this.topics.length)}forceCustomSidebar(){return document.body.classList.add("has-ai-conversations-sidebar"),this.sidebarState.isForcingSidebar||this.appEvents.trigger("discourse-ai:force-conversations-sidebar"),this.sidebarState.isForcingSidebar=!0,this.sidebarState.setPanel(m),this.sidebarState.setSeparatedMode(),this.sidebarState.hideSwitchPanelButtons(),this._didInit?(this.addEmptyStateClass(),!0):(this._didInit=!0,this.fetchMessages().then(()=>{this.sidebarState.setPanel(m),this.addEmptyStateClass()}),!0)}_attachScrollListener(){const e=document.querySelector(".sidebar-sections.ai-conversations-panel")
this._scrollElement=e,!this._hasScrollListener&&this._scrollElement&&(e.addEventListener("scroll",this._debouncedScrollHandler),this._hasScrollListener=!0)}_removeScrollListener(){this._hasScrollListener&&(this._scrollElement.removeEventListener("scroll",this._debouncedScrollHandler),this._hasScrollListener=!1,this._scrollElement=null)}stopForcingCustomSidebar(){document.body.classList.remove("has-ai-conversations-sidebar"),document.body.classList.remove("has-empty-ai-conversations-sidebar")
const e=this.sidebarState.currentPanel?.key===d.ADMIN_PANEL
this.sidebarState.isForcingSidebar&&!e&&(this.sidebarState.setPanel(d.MAIN_PANEL),this.sidebarState.isForcingSidebar=!1,this.appEvents.trigger("discourse-ai:stop-forcing-conversations-sidebar")),this._removeScrollListener()}get lastKnownAppURL(){return this.routeHistory.history.find(e=>!e.startsWith("/discourse-ai"))||this.router.urlFor(`discovery.${(0,u.defaultHomepage)()}`)}async fetchMessages(){if(this.isFetching||!this.hasMore)return
const e=0===this.page
this.isFetching=!0
try{let{conversations:t,meta:s}=await(0,n.ajax)("/discourse-ai/ai-bot/conversations.json",{data:{page:this.page,per_page:40}})
e?this.topics=t:(this.topics=[...this.topics,...t],this.sidebarState.setPanel(m)),this.page+=1,this.hasMore=s.has_more,this._rebuildSections()}finally{this.isFetching=!1,this.isLoading=!1}}_handleNewBotPM(e){this.topics=[e,...this.topics],this._rebuildSections(),this._watchForTitleUpdate(e.id)}_watchForTitleUpdate(e){if(this._subscribedTopicIds?.has(e))return
this._subscribedTopicIds=this._subscribedTopicIds||new Set,this._subscribedTopicIds.add(e)
const t=`/discourse-ai/ai-bot/topic/${e}`
this.messageBus.subscribe(t,s=>{this._applyTitleUpdate(e,s.title),this.messageBus.unsubscribe(t)})}_applyTitleUpdate(e,t){this.topics=this.topics.map(s=>s.id===e?{...s,title:t}:s),this._rebuildSections()}_rebuildSections(){const e=Date.now(),t=[],n={name:"today",title:(0,c.i18n)("discourse_ai.ai_bot.conversations.today"),links:new a.TrackedArray}
t.push(n),this.topics.forEach(s=>{const i=new Date(s.last_posted_at||e).valueOf(),o=Math.floor((e-i)/864e5)
let r,d
if(o<=1)r="today"
else if(o<=7)r="last-7-days"
else if(o<=30)r="last-30-days"
else{const e=new Date(i),t=`${e.getFullYear()}-${e.getMonth()}`
r=t}if(d="today"===r?n:t.find(e=>e.name===r),!d){let e
switch(r){case"last-7-days":e=(0,c.i18n)("discourse_ai.ai_bot.conversations.last_7_days")
break
case"last-30-days":e=(0,c.i18n)("discourse_ai.ai_bot.conversations.last_30_days")
break
default:e=(0,l.autoUpdatingRelativeAge)(new Date(s.last_posted_at))}d={name:r,title:e,links:new a.TrackedArray},t.push(d)}d.links.push({key:s.id,route:"topic.fromParamsNear",models:[s.slug,s.id,s.last_read_post_number||0],title:s.title,text:s.title,classNames:`ai-conversation-${s.id}`})}),this.sections=new a.TrackedArray(t)
for(let a of t)this._registered.has(a.name)||(this._registered.add(a.name),this.api.addSidebarSection(e=>class extends e{static{dt7948.g(this.prototype,"manager",[(0,i.service)("ai-conversations-sidebar-manager")])}#_s=void dt7948.i(this,"manager")
static{dt7948.g(this.prototype,"events",[(0,i.service)("appEvents")])}#bs=void dt7948.i(this,"events")
constructor(){super(...arguments),(0,s.scheduleOnce)("afterRender",this,this.triggerEvent)}triggerEvent(){this.events.trigger("discourse-ai:conversations-sidebar-updated")}get name(){return a.name}get title(){return a.title}get text(){return(0,o.htmlSafe)(a.title)}get links(){return this.manager.sections.find(e=>e.name===a.name)?.links||[]}get emptyStateComponent(){if(!this.manager.isLoading&&0===this.links.length)return p.default}},m))}}e.default=h}),define("discourse/plugins/discourse-ai/discourse/services/discobot-discoveries",["exports","@glimmer/tracking","@ember/object","@ember/service"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends i.default{static{dt7948.g(this.prototype,"currentUser",[i.service])}#k=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"discovery",[t.tracked],function(){return""})}#vs=void dt7948.i(this,"discovery")
static{dt7948.g(this.prototype,"lastQuery",[t.tracked],function(){return""})}#ys=void dt7948.i(this,"lastQuery")
static{dt7948.g(this.prototype,"discoveryTimedOut",[t.tracked],function(){return!1})}#ws=void dt7948.i(this,"discoveryTimedOut")
static{dt7948.g(this.prototype,"modelUsed",[t.tracked],function(){return""})}#Ss=void dt7948.i(this,"modelUsed")
static{dt7948.g(this.prototype,"loadingDiscoveries",[t.tracked],function(){return!1})}#xs=void dt7948.i(this,"loadingDiscoveries")
resetDiscovery(){this.loadingDiscoveries=!1,this.discovery="",this.discoveryTimedOut=!1,this.modelUsed=""}get showDiscoveryTitle(){return this.discovery.length>0||this.loadingDiscoveries||this.discoveryTimedOut}async disableDiscoveries(){this.currentUser.user_option.ai_search_discoveries=!1,await this.currentUser.save(["ai_search_discoveries"]),location.reload()}static{dt7948.n(this.prototype,"disableDiscoveries",[s.action])}}e.default=o}),define("discourse/plugins/discourse-ai/discourse/services/gists",["exports","@glimmer/tracking","@ember/service"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.TABLE_LAYOUT=e.TABLE_AI_LAYOUT=void 0
const i="topicListLayout",o="pmTopicListLayout"
e.TABLE_LAYOUT="table",e.TABLE_AI_LAYOUT="table-ai"
class a extends s.default{static{dt7948.g(this.prototype,"router",[s.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"preference",[t.tracked],function(){return localStorage.getItem(i)})}#ks=void dt7948.i(this,"preference")
static{dt7948.g(this.prototype,"pmPreference",[t.tracked],function(){return localStorage.getItem(o)})}#Ts=void dt7948.i(this,"pmPreference")
get routerAttributes(){return this.router.currentRoute.attributes}get publicTopics(){return this.routerAttributes?.list?.topics}get pmTopics(){return this.routerAttributes?.topics}get isPm(){return!this.publicTopics&&this.pmTopics}get showToggle(){const e=this.publicTopics??this.pmTopics
return e?.some(e=>e.ai_topic_gist)}get currentPreference(){return this.isPm?this.pmPreference:this.preference}setPreference(e,t=!1){t?(this.pmPreference=e,localStorage.setItem(o,e)):(this.preference=e,localStorage.setItem(i,e))}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/services/image-caption-popup",["exports","@glimmer/tracking","@ember/service","discourse/lib/uploads"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends s.default{static{dt7948.g(this.prototype,"composer",[s.service])}#x=void dt7948.i(this,"composer")
static{dt7948.g(this.prototype,"appEvents",[s.service])}#S=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"showPopup",[t.tracked],function(){return!1})}#Ps=void dt7948.i(this,"showPopup")
static{dt7948.g(this.prototype,"imageIndex",[t.tracked],function(){return null})}#Cs=void dt7948.i(this,"imageIndex")
static{dt7948.g(this.prototype,"imageSrc",[t.tracked],function(){return null})}#js=void dt7948.i(this,"imageSrc")
static{dt7948.g(this.prototype,"newCaption",[t.tracked],function(){return null})}#Ms=void dt7948.i(this,"newCaption")
static{dt7948.g(this.prototype,"loading",[t.tracked],function(){return!1})}#ge=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"popupTrigger",[t.tracked],function(){return null})}#As=void dt7948.i(this,"popupTrigger")
static{dt7948.g(this.prototype,"_request",[t.tracked],function(){return null})}#Os=void dt7948.i(this,"_request")
updateCaption(){const e=this.composer.model.reply.match(i.IMAGE_MARKDOWN_REGEX)
if(e){const t=e[this.imageIndex],s=t.replace(i.IMAGE_MARKDOWN_REGEX,`![${this.newCaption}|$2$3$4]($5)`)
t&&this.appEvents.trigger("composer:replace-text",t,s)}}toggleLoadingState(e){return e?(this.popupTrigger?.classList.add("disabled"),this.loading=!0):(this.popupTrigger?.classList.remove("disabled"),this.loading=!1)}}e.default=o}),define("discourse/plugins/discourse-ai/discourse/services/quick-search",["exports","@glimmer/tracking","@ember/service"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static{dt7948.g(this.prototype,"loading",[t.tracked],function(){return!1})}#ge=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"invalidTerm",[t.tracked],function(){return!1})}#Es=void dt7948.i(this,"invalidTerm")}e.default=i})
define("discourse/plugins/discourse-ai/discourse/templates/admin-dashboard-sentiment",["exports","@ember/routing","ember-route-template","discourse/helpers/d-icon","discourse-i18n","admin/components/admin-report","admin/components/dashboard-period-selector","float-kit/components/d-tooltip","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,a,n,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,s.default)((0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"20JiKdh5",block:'[[[1,"\\n    "],[10,0],[14,0,"sentiment section"],[12],[1,"\\n      "],[10,0],[14,0,"period-section"],[12],[1,"\\n        "],[10,0],[14,0,"section-title"],[12],[1,"\\n          "],[10,"h2"],[14,1,"sentiment-heading"],[12],[1,"\\n            "],[1,[28,[32,0],["discourse_ai.sentiments.dashboard.title"],null]],[1,"\\n          "],[13],[1,"\\n\\n          "],[8,[32,1],null,[["@period","@setPeriod","@startDate","@endDate","@setCustomDateRange"],[[30,1,["period"]],[30,1,["setPeriod"]],[30,1,["startDate"]],[30,1,["endDate"]],[30,1,["setCustomDateRange"]]]],null],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n\\n      "],[10,0],[14,0,"section-body"],[12],[1,"\\n        "],[10,0],[14,0,"charts"],[12],[1,"\\n          "],[8,[32,2],null,[["@dataSourceName","@filters","@showHeader"],["overall_sentiment",[30,1,["filters"]],true]],null],[1,"\\n          "],[10,0],[14,0,"admin-report activity-metrics"],[12],[1,"\\n            "],[10,0],[14,0,"header"],[12],[1,"\\n              "],[10,"ul"],[14,0,"breadcrumb"],[12],[1,"\\n                "],[10,"li"],[14,0,"item report"],[12],[1,"\\n                  "],[8,[32,3],[[24,0,"report-url"]],[["@route"],["adminReports"]],[["default"],[[[[1,"\\n                    "],[1,[28,[32,0],["admin.dashboard.emotion.title"],null]],[1,"\\n                  "]],[]]]]],[1,"\\n                  "],[8,[32,4],null,[["@interactive"],["true"]],[["trigger","content"],[[[[1,"\\n                      "],[1,[28,[32,5],["circle-question"],null]],[1,"\\n                    "]],[]],[[[1,"\\n                      "],[10,1],[12],[1,[28,[32,0],["admin.dashboard.emotion.description"],null]],[13],[1,"\\n                    "]],[]]]]],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n            "],[10,0],[14,0,"report-body"],[12],[1,"\\n              "],[10,0],[14,0,"counters-list"],[12],[1,"\\n                "],[10,0],[14,0,"counters-header"],[12],[1,"\\n                  "],[10,0],[14,0,"counters-cell"],[12],[13],[1,"\\n                  "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[32,0],["admin.dashboard.reports.today"],null]],[13],[1,"\\n                  "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[32,0],["admin.dashboard.reports.yesterday"],null]],[13],[1,"\\n                  "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[32,0],["admin.dashboard.reports.last_7_days"],null]],[13],[1,"\\n                  "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[32,0],["admin.dashboard.reports.last_30_days"],null]],[13],[1,"\\n                "],[13],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,1,["emotions"]]],null]],null],null,[[[1,"                  "],[8,[32,2],null,[["@showHeader","@filters","@forcedModes","@dataSourceName"],[false,[30,1,["emotionFilters"]],"emotion",[29,["emotion_",[30,2]]]]],null],[1,"\\n"]],[2]],null],[1,"              "],[13],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@controller","metric"],false,["each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/templates/admin-dashboard-sentiment.js",scope:()=>[o.i18n,n.default,a.default,t.LinkTo,r.default,i.default],isStrictMode:!0}),(0,u.default)(void 0,void 0)))}),define("discourse/plugins/discourse-ai/discourse/templates/discourse-ai-bot-conversations",["exports","ember-route-template","discourse/plugins/discourse-ai/discourse/components/ai-bot-conversations","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.default)((0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"a8WVTD3/",block:'[[[8,[32,0],null,[["@controller"],[[30,1]]],null]],["@controller"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/templates/discourse-ai-bot-conversations.js",scope:()=>[s.default],isStrictMode:!0}),(0,a.default)(void 0,void 0)))}),define("discourse/plugins/discourse-ai/discourse/templates/preferences/ai",["exports","@ember/helper","ember-route-template","truth-helpers","discourse/components/preference-checkbox","discourse/components/save-controls","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,a,n,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,s.default)((0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"wxtqQ3zy",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-user-preferences"],[12],[1,"\\n      "],[10,"legend"],[14,0,"control-label"],[12],[1,[28,[32,0],["discourse_ai.title"],null]],[13],[1,"\\n\\n"],[42,[28,[31,1],[[28,[31,1],[[30,1,["booleanSettings"]]],null]],null],null,[[[41,[30,2,["isIncluded"]],[[[1,"          "],[10,0],[14,0,"control-group ai-setting"],[12],[1,"\\n            "],[8,[32,1],[[16,"data-setting-name",[30,2,["settingName"]]],[16,0,[29,["pref-",[30,2,["settingName"]]]]]],[["@labelKey","@checked"],[[30,2,["label"]],[28,[32,2],[[30,1,["model","user_option"]],[30,2,["key"]]],null]]],null],[1,"\\n          "],[13],[1,"\\n"]],[]],null]],[2]],null],[1,"\\n"],[41,[28,[32,3],[[30,1,["userSettingAttributes","length"]],0],null],[[[1,"        "],[1,[28,[32,0],["discourse_ai.user_preferences.empty"],null]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[51,[28,[32,3],[[30,1,["userSettingAttributes","length"]],0],null]],[[[1,"        "],[8,[32,4],null,[["@id","@model","@action","@saved"],["user_ai_preference_save",[30,1,["model"]],[30,1,["save"]],[30,1,["saved"]]]],null],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],["@controller","setting"],false,["each","-track-array","if","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/templates/preferences/ai.js",scope:()=>[n.i18n,o.default,t.get,i.eq,a.default],isStrictMode:!0}),(0,d.default)(void 0,void 0)))}),define("discourse/plugins/discourse-ai/lib/discourse-markdown/ai-tags",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.setup=function(e){e.allowList(["details[class=ai-quote]"]),e.allowList(["div[class=ai-artifact]","div[data-ai-artifact-id]","div[data-ai-artifact-version]","div[data-ai-artifact-autorun]","div[data-ai-artifact-height]","div[data-ai-artifact-width]"])}})

//# sourceMappingURL=discourse-ai-ee6f2931.map