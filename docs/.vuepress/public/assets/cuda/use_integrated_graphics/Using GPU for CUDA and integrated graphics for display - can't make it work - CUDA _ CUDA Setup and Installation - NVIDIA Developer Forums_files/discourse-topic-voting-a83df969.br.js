define("discourse/plugins/discourse-topic-voting/discourse/components/vote-box",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/service","@ember/template","discourse/helpers/concat-class","discourse/helpers/route-action","discourse/lib/ajax","discourse/lib/ajax-error","discourse/modifiers/close-on-click-outside","discourse-i18n","discourse/plugins/discourse-topic-voting/discourse/components/vote-button","discourse/plugins/discourse-topic-voting/discourse/components/vote-count","discourse/plugins/discourse-topic-voting/discourse/components/vote-options","@ember/component","@ember/template-factory"],function(t,e,o,s,i,n,r,c,u,l,d,a,p,v,m,g,h,f){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class _ extends e.default{static{dt7948.g(this.prototype,"siteSettings",[n.service])}#t=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"currentUser",[n.service])}#e=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"votesAlert",[o.tracked])}#o=void dt7948.i(this,"votesAlert")
static{dt7948.g(this.prototype,"allowClick",[o.tracked],function(){return!0})}#s=void dt7948.i(this,"allowClick")
static{dt7948.g(this.prototype,"initialVote",[o.tracked],function(){return!1})}#i=void dt7948.i(this,"initialVote")
static{dt7948.g(this.prototype,"showOptions",[o.tracked],function(){return!1})}#n=void dt7948.i(this,"showOptions")
addVote(){let t=this.args.topic
return(0,l.ajax)("/voting/vote",{type:"POST",data:{topic_id:t.id}}).then(e=>{t.vote_count=e.vote_count,t.user_voted=!0,this.currentUser.votes_exceeded=!e.can_vote,this.currentUser.votes_left=e.votes_left,this.votesAlert=e.alert,this.allowClick=!0,this.showOptions=!1}).catch(d.popupAjaxError)}static{dt7948.n(this.prototype,"addVote",[i.action])}removeVote(){const t=this.args.topic
return(0,l.ajax)("/voting/unvote",{type:"POST",data:{topic_id:t.id}}).then(e=>{t.vote_count=e.vote_count,t.user_voted=!1,this.currentUser.votes_exceeded=!e.can_vote,this.currentUser.votes_left=e.votes_left,this.allowClick=!0,this.showOptions=!1}).catch(d.popupAjaxError)}static{dt7948.n(this.prototype,"removeVote",[i.action])}showVoteOptions(){this.showOptions=!0}static{dt7948.n(this.prototype,"showVoteOptions",[i.action])}closeVoteOptions(){this.showOptions=!1}static{dt7948.n(this.prototype,"closeVoteOptions",[i.action])}closeVotesAlert(){this.votesAlert=null}static{dt7948.n(this.prototype,"closeVotesAlert",[i.action])}static{(0,h.setComponentTemplate)((0,f.createTemplateFactory)({id:"1oSLlFUI",block:'[[[1,"\\n    "],[10,0],[15,0,[28,[32,0],["voting-wrapper",[52,[30,0,["siteSettings","topic_voting_show_who_voted"]],"show-pointer"]],null]],[12],[1,"\\n      "],[8,[32,1],null,[["@topic","@showLogin"],[[30,1],[28,[32,2],["showLogin"],null]]],null],[1,"\\n      "],[8,[32,3],null,[["@topic","@allowClick","@showVoteOptions","@addVote","@showLogin"],[[30,1],[30,0,["allowClick"]],[30,0,["showVoteOptions"]],[30,0,["addVote"]],[28,[32,2],["showLogin"],null]]],null],[1,"\\n\\n"],[41,[30,0,["showOptions"]],[[[1,"        "],[8,[32,4],[[4,[32,5],[[30,0,["closeVoteOptions"]],[28,[32,6],null,null]],null]],[["@topic","@removeVote"],[[30,1],[30,0,["removeVote"]]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["votesAlert"]],[[[1,"        "],[11,0],[24,0,"voting-popup-menu vote-options popup-menu"],[4,[32,5],[[30,0,["closeVotesAlert"]],[28,[32,6],null,null]],null],[12],[1,"\\n          "],[1,[28,[32,7],[[28,[32,8],["topic_voting.votes_left"],[["count","path"],[[30,0,["currentUser","votes_left"]],"/my/activity/votes"]]]],null]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],["@topic"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-topic-voting/discourse/components/vote-box.js",scope:()=>[c.default,m.default,u.default,v.default,g.default,a.default,s.hash,r.htmlSafe,p.i18n],isStrictMode:!0}),this)}}t.default=_}),define("discourse/plugins/discourse-topic-voting/discourse/components/vote-button",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/transformer","discourse-i18n","@ember/component","@ember/template-factory"],function(t,e,o,s,i,n,r,c,u){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class l extends e.default{static{dt7948.g(this.prototype,"siteSettings",[s.service])}#t=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"currentUser",[s.service])}#e=void dt7948.i(this,"currentUser")
get wrapperClasses(){const t=[],{topic:e}=this.args
return e.closed?t.push("voting-closed"):e.user_voted?this.currentUser&&this.currentUser.votes_exceeded?t.push("vote-limited nonvote"):t.push("vote"):t.push("nonvote"),this.siteSettings.topic_voting_show_who_voted&&t.push("show-pointer"),t.join(" ")}get buttonContent(){const{topic:t}=this.args
return this.currentUser?t.closed?(0,r.i18n)("topic_voting.voting_closed_title"):t.user_voted?(0,r.i18n)("topic_voting.voted_title"):this.currentUser.votes_exceeded?(0,r.i18n)("topic_voting.voting_limit"):(0,r.i18n)("topic_voting.vote_title"):t.vote_count?(0,r.i18n)("topic_voting.anonymous_button",{count:t.vote_count}):(0,r.i18n)("topic_voting.anonymous_button",{count:1})}click(){(0,n.applyBehaviorTransformer)("topic-vote-button-click",()=>{if(!this.currentUser)return this.args.showLogin()
const{topic:t}=this.args
t.closed||t.user_voted||this.currentUser.votes_exceeded||this.args.addVote(),(t.user_voted||this.currentUser.votes_exceeded)&&this.args.showVoteOptions()})}static{dt7948.n(this.prototype,"click",[o.action])}static{(0,c.setComponentTemplate)((0,u.createTemplateFactory)({id:"d3YMfFZR",block:'[[[1,"\\n    "],[10,0],[15,0,[30,0,["wrapperClasses"]]],[12],[1,"\\n      "],[8,[32,0],[[24,0,"btn-primary vote-button"]],[["@translatedTitle","@translatedLabel","@action"],[[52,[30,0,["currentUser"]],[28,[32,1],["topic_voting.votes_left_button_title"],[["count"],[[30,0,["currentUser","votes_left"]]]]],""],[30,0,["buttonContent"]],[30,0,["click"]]]],null],[1,"\\n    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-topic-voting/discourse/components/vote-button.js",scope:()=>[i.default,r.i18n],isStrictMode:!0}),this)}}t.default=l}),define("discourse/plugins/discourse-topic-voting/discourse/components/vote-count",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","truth-helpers","discourse/components/async-content","discourse/components/small-user-list","discourse/helpers/concat-class","discourse/lib/ajax","discourse/lib/decorators","discourse/lib/get-url","discourse/modifiers/close-on-click-outside","@ember/component","@ember/template-factory"],function(t,e,o,s,i,n,r,c,u,l,d,a,p,v,m,g,h){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class f extends e.default{static{dt7948.g(this.prototype,"siteSettings",[r.service])}#t=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"currentUser",[r.service])}#e=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"showWhoVoted",[o.tracked],function(){return!1})}#r=void dt7948.i(this,"showWhoVoted")
async loadWhoVoted(){return(0,a.ajax)("/voting/who",{type:"GET",data:{topic_id:this.args.topic.id}}).then(t=>t.map(t=>({template:t.avatar_template,username:t.username,post_url:t.post_url,url:(0,v.default)("/u/")+t.username.toLowerCase()})))}static{dt7948.n(this.prototype,"loadWhoVoted",[p.bind])}click(t){if(t.preventDefault(),t.stopPropagation(),!this.currentUser)return this.args.showLogin()
this.showWhoVoted?this.showWhoVoted=!1:this.siteSettings.topic_voting_show_who_voted&&(this.showWhoVoted=!0)}static{dt7948.n(this.prototype,"click",[n.action])}clickOutside(){this.showWhoVoted=!1}static{dt7948.n(this.prototype,"clickOutside",[n.action])}static{(0,g.setComponentTemplate)((0,h.createTemplateFactory)({id:"qF9Ehya9",block:'[[[1,"\\n    "],[11,0],[16,0,[28,[32,0],["vote-count-wrapper",[52,[28,[32,1],[[30,1,["vote_count"]],0],null],"no-votes"]],null]],[24,"role","button"],[4,[32,2],["click",[30,0,["click"]]],null],[12],[1,"\\n      "],[10,0],[14,0,"vote-count"],[12],[1,"\\n        "],[1,[30,1,["vote_count"]]],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[41,[30,0,["showWhoVoted"]],[[[1,"      "],[11,0],[24,0,"who-voted popup-menu voting-popup-menu"],[4,[32,3],[[30,0,["clickOutside"]],[28,[32,4],null,[["secondaryTargetSelector"],[".vote-count-wrapper"]]]],null],[12],[1,"\\n        "],[8,[32,5],null,[["@asyncData"],[[30,0,["loadWhoVoted"]]]],[["content"],[[[[1,"\\n            "],[8,[32,6],[[24,0,"regular-votes"]],[["@users"],[[30,2]]],null],[1,"\\n          "]],[2]]]]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["@topic","voters"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-topic-voting/discourse/components/vote-count.js",scope:()=>[d.default,c.eq,i.on,m.default,s.hash,u.default,l.default],isStrictMode:!0}),this)}}t.default=f}),define("discourse/plugins/discourse-topic-voting/discourse/components/vote-options",["exports","@glimmer/component","@ember/modifier","@ember/service","discourse/helpers/d-icon","discourse-i18n","@ember/component","@ember/template-factory"],function(t,e,o,s,i,n,r,c){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class u extends e.default{static{dt7948.g(this.prototype,"currentUser",[s.service])}#e=void dt7948.i(this,"currentUser")
static{(0,r.setComponentTemplate)((0,c.createTemplateFactory)({id:"1m7usocZ",block:'[[[1,"\\n    "],[11,0],[24,0,"vote-options voting-popup-menu popup-menu"],[17,1],[12],[1,"\\n"],[41,[30,2,["user_voted"]],[[[1,"        "],[11,0],[24,"role","button"],[24,0,"remove-vote vote-option"],[4,[32,0],["click",[30,3]],null],[12],[1,"\\n          "],[1,[28,[32,1],["xmark"],null]],[1,"\\n          "],[1,[28,[32,2],["topic_voting.remove_vote"],null]],[1,"\\n        "],[13],[1,"\\n"]],[]],[[[41,[30,0,["currentUser","votes_exceeded"]],[[[1,"        "],[10,0],[12],[1,[28,[32,2],["topic_voting.reached_limit"],null]],[13],[1,"\\n        "],[10,2],[12],[1,"\\n          "],[10,3],[14,6,"/my/activity/votes"],[12],[1,[28,[32,2],["topic_voting.list_votes"],null]],[13],[1,"\\n        "],[13],[1,"\\n      "]],[]],null]],[]]],[1,"    "],[13],[1,"\\n  "]],["&attrs","@topic","@removeVote"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-topic-voting/discourse/components/vote-options.js",scope:()=>[o.on,i.default,n.i18n],isStrictMode:!0}),this)}}t.default=u}),define("discourse/plugins/discourse-topic-voting/discourse/connectors/category-custom-settings/feature-voting-settings",["exports","@ember/component","@ember-decorators/component","discourse-i18n","@ember/template-factory"],function(t,e,o,s,i){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
const n=dt7948.c(class extends e.default{static{(0,e.setComponentTemplate)((0,i.createTemplateFactory)({id:"D69Rqwsp",block:'[[[1,"\\n    "],[10,"h3"],[12],[1,[28,[32,0],["topic_voting.title"],null]],[13],[1,"\\n    "],[10,"section"],[14,0,"field"],[12],[1,"\\n      "],[10,0],[14,0,"enable-topic-voting"],[12],[1,"\\n        "],[10,"label"],[14,0,"checkbox-label"],[12],[1,"\\n          "],[8,[32,1],null,[["@type","@checked"],["checkbox",[30,0,["category","custom_fields","enable_topic_voting"]]]],null],[1,"\\n          "],[1,[28,[32,0],["topic_voting.allow_topic_voting"],null]],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-topic-voting/discourse/connectors/category-custom-settings/feature-voting-settings.js",scope:()=>[s.i18n,e.Input],isStrictMode:!0}),this)}},[(0,o.classNames)("category-custom-settings-outlet","feature-voting-settings"),(0,o.tagName)("")])
t.default=n}),define("discourse/plugins/discourse-topic-voting/discourse/connectors/topic-above-post-stream/topic-title-voting",["exports","@ember/component","@ember-decorators/component","discourse/helpers/route-action","discourse/plugins/discourse-topic-voting/discourse/components/vote-box","@ember/template-factory"],function(t,e,o,s,i,n){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
const r=dt7948.c(class extends e.default{static{(0,e.setComponentTemplate)((0,n.createTemplateFactory)({id:"Z17smIYz",block:'[[[1,"\\n"],[41,[30,0,["model","can_vote"]],[[[41,[30,0,["model","postStream","loaded"]],[[[41,[30,0,["model","postStream","firstPostPresent"]],[[[1,"          "],[10,0],[14,0,"voting title-voting"],[12],[1,"\\n            "],[8,[32,0],null,[["@topic","@showLogin"],[[30,0,["model"]],[28,[32,1],["showLogin"],null]]],null],[1,"\\n          "],[13],[1,"\\n"]],[]],null]],[]],null]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-topic-voting/discourse/connectors/topic-above-post-stream/topic-title-voting.js",scope:()=>[i.default,s.default],isStrictMode:!0}),this)}},[(0,o.classNames)("topic-above-post-stream-outlet","topic-title-voting"),(0,o.tagName)("div")])
t.default=r}),define("discourse/plugins/discourse-topic-voting/discourse/connectors/user-activity-bottom/user-voted-topics",["exports","@glimmer/component","@ember/routing","@ember/service","discourse/helpers/d-icon","discourse-i18n","@ember/component","@ember/template-factory"],function(t,e,o,s,i,n,r,c){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class u extends e.default{static{dt7948.g(this.prototype,"siteSettings",[s.service])}#t=void dt7948.i(this,"siteSettings")
static{(0,r.setComponentTemplate)((0,c.createTemplateFactory)({id:"UdQFAOT8",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","topic_voting_show_votes_on_profile"]],[[[1,"      "],[10,"li"],[14,0,"user-nav__activity-votes"],[12],[1,"\\n\\n        "],[8,[32,0],null,[["@route"],["userActivity.votes"]],[["default"],[[[[1,"\\n          "],[1,[28,[32,1],["heart"],null]],[1,"\\n          "],[1,[28,[32,2],["topic_voting.vote_title_plural"],null]],[1,"\\n        "]],[]]]]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-topic-voting/discourse/connectors/user-activity-bottom/user-voted-topics.js",scope:()=>[o.LinkTo,i.default,n.i18n],isStrictMode:!0}),this)}}t.default=u}),define("discourse/plugins/discourse-topic-voting/discourse/feature-voting-route-map",["exports"],function(t){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
t.default={resource:"user",path:"users/:username",map(){this.route("userActivity",{path:"activity",resetNamespace:!0},function(){this.route("votes")})}}}),define("discourse/plugins/discourse-topic-voting/discourse/initializers/discourse-topic-voting",["exports","discourse/lib/plugin-api","discourse/models/nav-item","discourse-i18n"],function(t,e,o,s){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
t.default={name:"discourse-topic-voting",initialize(){(0,e.withPluginApi)(t=>{const e=t.container.lookup("service:site-settings")
if(e.topic_voting_enabled){t.container.lookup("controller:full-page-search").sortOrders.pushObject({name:(0,s.i18n)("search.most_votes"),id:5,term:"order:votes"}),t.addNavigationBarItem({name:"votes",before:"top",customFilter:t=>t&&t.can_vote,customHref:(t,e)=>`${o.default.pathFor("latest",e)}?order=votes`,forceActive:(t,e,o)=>{const s=o.currentRoute.queryParams
return s&&1===Object.keys(s).length&&"votes"===s.order}}),t.addNavigationBarItem({name:"my_votes",before:"top",customFilter:e=>e&&e.can_vote&&t.getCurrentUser(),customHref:(t,e)=>`${o.default.pathFor("latest",e)}?state=my_votes`,forceActive:(t,e,o)=>{const s=o.currentRoute.queryParams
return s&&1===Object.keys(s).length&&"my_votes"===s.state}})}e.topic_voting_enabled&&t.addSearchSuggestion("order:votes"),t.registerValueTransformer("category-available-views",({value:t,context:e})=>{e.customFields.enable_topic_voting&&t.push({name:(0,s.i18n)("filters.votes.title"),value:"votes"})})})}}}),define("discourse/plugins/discourse-topic-voting/discourse/pre-initializers/extend-category-for-voting",["exports","@glimmer/tracking","discourse/lib/plugin-api","discourse-i18n"],function(t,e,o,s){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
t.default={name:"extend-category-for-voting",before:"inject-discourse-objects",initialize(){(0,o.withPluginApi)(t=>function(t){t.addPostClassesCallback(t=>{if(1===t.post_number&&t.can_vote)return["voting-post"]}),t.addTrackedPostProperties("can_vote"),t.addTagsHtmlCallback(t=>{if(!t.can_vote)return
let e=[],o=""
t.user_voted&&(o=` title='${(0,s.i18n)("topic_voting.voted")}'`)
let i=t.user_voted?" voted":""
return e.push(`<a href='${t.url}' class='list-vote-count vote-count-${t.vote_count} discourse-tag simple${i}'${o}>`),e.push((0,s.i18n)("topic_voting.votes",{count:t.vote_count})),e.push("</a>"),e.length>0?e.join(""):void 0},{priority:-100}),t.modifyClass("model:topic",t=>class extends t{static{dt7948.g(this.prototype,"vote_count",[e.tracked])}#c=void dt7948.i(this,"vote_count")
static{dt7948.g(this.prototype,"user_voted",[e.tracked])}#u=void dt7948.i(this,"user_voted")}),t.modifyClass("model:user",t=>class extends t{static{dt7948.g(this.prototype,"votes_exceeded",[e.tracked])}#l=void dt7948.i(this,"votes_exceeded")
static{dt7948.g(this.prototype,"votes_left",[e.tracked])}#d=void dt7948.i(this,"votes_left")})}(t)),(0,o.withPluginApi)(t=>t.addCategorySortCriteria("votes"))}}}),define("discourse/plugins/discourse-topic-voting/discourse/pre-initializers/transformers",["exports","discourse/lib/plugin-api"],function(t,e){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
t.default={name:"discourse-topic-voting-transformers",before:"freeze-valid-transformers",initialize(){(0,e.withPluginApi)(t=>{t.addBehaviorTransformerName("topic-vote-button-click")})}}}),define("discourse/plugins/discourse-topic-voting/discourse/routes/user-activity-votes",["exports","discourse/models/user-action","discourse/routes/user-topic-list","discourse-i18n"],function(t,e,o,s){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class i extends o.default{userActionType=e.default.TYPES.topics
model(){return this.store.findFiltered("topicList",{filter:"topics/voted-by/"+this.modelFor("user").get("username_lower")}).then(t=>(t.set("emptyState",this.emptyState()),t))}emptyState(){const t=this.modelFor("user")
return{title:this.isCurrentUser(t)?(0,s.i18n)("topic_voting.no_votes_title_self"):(0,s.i18n)("topic_voting.no_votes_title_others",{username:t.username}),body:""}}}t.default=i})

//# sourceMappingURL=discourse-topic-voting-57dd3474.map