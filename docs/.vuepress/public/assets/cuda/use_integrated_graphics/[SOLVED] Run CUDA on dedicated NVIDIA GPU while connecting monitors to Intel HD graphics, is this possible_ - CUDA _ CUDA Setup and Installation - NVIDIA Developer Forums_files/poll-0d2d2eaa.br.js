define("discourse/plugins/poll/discourse/components/modal/poll-breakdown",["exports","@ember/component","@ember/helper","@ember/modifier","@ember/object","@ember/service","@ember/string","@ember/template","truth-helpers","discourse/components/d-modal","discourse/helpers/concat-class","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/decorators","discourse/lib/load-script","discourse-i18n","select-kit/components/combo-box","discourse/plugins/poll/discourse/components/poll-breakdown-chart","discourse/plugins/poll/discourse/components/poll-breakdown-option","@ember/template-factory"],function(e,t,l,o,s,n,i,r,a,p,u,d,c,h,m,g,f,b,v,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class y extends t.default{static{dt7948.g(this.prototype,"dialog",[n.service])}#e=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"siteSettings",[n.service])}#t=void dt7948.i(this,"siteSettings")
model=null
charts=null
groupedBy=null
highlightedOption=null
displayMode="percentage"
init(){this.set("groupedBy",this.groupableUserFields[0]?.id),(0,m.default)("/javascripts/Chart.min.js").then(()=>(0,m.default)("/javascripts/chartjs-plugin-datalabels.min.js")).then(()=>{this.fetchGroupedPollData()}),super.init(...arguments)}title(e,t){return e?(0,r.htmlSafe)(e):t}static{dt7948.n(this.prototype,"title",[(0,h.default)("model.poll.title","model.post.topic.title")])}get groupableUserFields(){return this.siteSettings.poll_groupable_user_fields.split("|").filter(Boolean).map(e=>{const t=e.split("_").filter(Boolean)
return t.length>1&&(t[0]=(0,i.classify)(t[0])),{id:e,label:t.join(" ")}})}totalVotes(e){return e.reduce((e,t)=>e+t.votes,0)}static{dt7948.n(this.prototype,"totalVotes",[(0,h.default)("model.poll.options")])}fetchGroupedPollData(){return(0,d.ajax)("/polls/grouped_poll_results.json",{data:{post_id:this.model.post.id,poll_name:this.model.poll.name,user_field_name:this.groupedBy}}).catch(e=>{e?(0,c.popupAjaxError)(e):this.dialog.alert((0,g.i18n)("poll.error_while_fetching_voters"))}).then(e=>{this.isDestroying||this.isDestroyed||this.set("charts",e.grouped_results)})}setGrouping(e){this.set("groupedBy",e),this.fetchGroupedPollData()}static{dt7948.n(this.prototype,"setGrouping",[s.action])}onSelectPanel(e){this.set("displayMode",e.id)}static{dt7948.n(this.prototype,"onSelectPanel",[s.action])}static{(0,t.setComponentTemplate)((0,_.createTemplateFactory)({id:"BkUS3o93",block:'[[[1,"\\n"],[1,"    "],[8,[32,0],[[24,0,"poll-breakdown has-tabs"]],[["@title","@closeModal"],[[28,[32,1],["poll.breakdown.title"],null],[30,1]]],[["headerBelowTitle","body"],[[[[1,"\\n        "],[10,"ul"],[14,0,"modal-tabs"],[12],[1,"\\n          "],[11,"li"],[16,0,[28,[32,2],["modal-tab percentage",[52,[28,[32,3],[[30,0,["displayMode"]],"percentage"],null],"is-active"]],null]],[4,[32,4],["click",[28,[32,5],[[28,[31,1],[[30,0,["displayMode"]]],null],"percentage"],null]],null],[12],[1,[28,[32,1],["poll.breakdown.percentage"],null]],[13],[1,"\\n          "],[11,"li"],[16,0,[28,[32,2],["modal-tab count",[52,[28,[32,3],[[30,0,["displayMode"]],"count"],null],"is-active"]],null]],[4,[32,4],["click",[28,[32,5],[[28,[31,1],[[30,0,["displayMode"]]],null],"count"],null]],null],[12],[1,[28,[32,1],["poll.breakdown.count"],null]],[13],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[10,0],[14,0,"poll-breakdown-sidebar"],[12],[1,"\\n          "],[10,2],[14,0,"poll-breakdown-title"],[12],[1,"\\n            "],[1,[30,0,["title"]]],[1,"\\n          "],[13],[1,"\\n\\n          "],[10,0],[14,0,"poll-breakdown-total-votes"],[12],[1,[28,[32,1],["poll.breakdown.votes"],[["count"],[[30,0,["model","poll","voters"]]]]]],[13],[1,"\\n\\n          "],[10,"ul"],[14,0,"poll-breakdown-options"],[12],[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,0,["model","poll","options"]]],null]],null],null,[[[1,"              "],[8,[32,6],null,[["@option","@index","@totalVotes","@optionsCount","@displayMode","@highlightedOption","@onMouseOver","@onMouseOut"],[[30,2],[30,3],[30,0,["totalVotes"]],[30,0,["model","poll","options","length"]],[30,0,["displayMode"]],[30,0,["highlightedOption"]],[28,[32,5],[[28,[31,1],[[30,0,["highlightedOption"]]],null],[30,3]],null],[28,[32,5],[[28,[31,1],[[30,0,["highlightedOption"]]],null],null],null]]],null],[1,"\\n"]],[2,3]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"poll-breakdown-body"],[12],[1,"\\n          "],[10,0],[14,0,"poll-breakdown-body-header"],[12],[1,"\\n            "],[10,"label"],[14,0,"poll-breakdown-body-header-label"],[12],[1,[28,[32,1],["poll.breakdown.breakdown"],null]],[13],[1,"\\n\\n            "],[8,[32,7],[[24,0,"poll-breakdown-dropdown"]],[["@content","@value","@nameProperty","@onChange"],[[30,0,["groupableUserFields"]],[30,0,["groupedBy"]],"label",[30,0,["setGrouping"]]]],null],[1,"\\n          "],[13],[1,"\\n\\n          "],[10,0],[14,0,"poll-breakdown-charts"],[12],[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,0,["charts"]]],null]],null],null,[[[1,"              "],[8,[32,8],null,[["@group","@options","@displayMode","@highlightedOption","@setHighlightedOption"],[[28,[32,9],[[30,4],"group"],null],[28,[32,9],[[30,4],"options"],null],[30,0,["displayMode"]],[30,0,["highlightedOption"]],[28,[32,5],[[28,[31,1],[[30,0,["highlightedOption"]]],null]],null]]],null],[1,"\\n"]],[4]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","option","index","chart"],false,["if","mut","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/modal/poll-breakdown.js",scope:()=>[p.default,g.i18n,u.default,a.eq,o.on,l.fn,v.default,f.default,b.default,l.get],isStrictMode:!0}),this)}}e.default=y}),define("discourse/plugins/poll/discourse/components/modal/poll-ui-builder",["exports","@ember/component","@ember/helper","@ember/modifier","@ember/object","@ember/object/computed","@ember/service","@ember-decorators/object","truth-helpers","discourse/components/d-button","discourse/components/d-modal","discourse/components/d-toggle-switch","discourse/components/date-time-input","discourse/components/input-tip","discourse/components/radio-button","discourse/helpers/concat-class","discourse/helpers/d-icon","discourse/helpers/with-event-value","discourse/lib/decorators","discourse/modifiers/auto-focus","discourse-i18n","select-kit/components/combo-box","select-kit/components/group-chooser","@ember/template-factory"],function(e,t,l,o,s,n,i,r,a,p,u,d,c,h,m,g,f,b,v,_,y,k,w,C){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.REGULAR_POLL_TYPE=e.RANKED_CHOICE_POLL_TYPE=e.PIE_CHART_TYPE=e.NUMBER_POLL_TYPE=e.MULTIPLE_POLL_TYPE=e.BAR_CHART_TYPE=void 0
const O=e.BAR_CHART_TYPE="bar",x=e.PIE_CHART_TYPE="pie",T=e.REGULAR_POLL_TYPE="regular",M=e.NUMBER_POLL_TYPE="number",P=e.MULTIPLE_POLL_TYPE="multiple",R=e.RANKED_CHOICE_POLL_TYPE="ranked_choice",S="always"
class j extends t.default{static{dt7948.g(this.prototype,"siteSettings",[i.service])}#t=void dt7948.i(this,"siteSettings")
showAdvanced=!1
pollType=T
pollTitle
pollOptions=[s.default.create({value:""})]
pollOptionsText=""
pollMin=1
pollMax=2
pollStep=1
pollGroups
pollAutoClose
pollResult=S
chartType=O
publicPoll=this.siteSettings.poll_default_public
dynamic=!1
static{dt7948.g(this.prototype,"showNumber",[(0,n.or)("showAdvanced","isNumber")])}#l=void dt7948.i(this,"showNumber")
static{dt7948.g(this.prototype,"showRankedChoice",[(0,n.or)("showAdvanced","isRankedChoice")])}#o=void dt7948.i(this,"showRankedChoice")
static{dt7948.g(this.prototype,"canRemoveOption",[(0,n.gt)("pollOptions.length",1)])}#s=void dt7948.i(this,"canRemoveOption")
static{dt7948.g(this.prototype,"rankedChoiceOrRegular",[(0,n.or)("isRankedChoice","isRegular")])}#n=void dt7948.i(this,"rankedChoiceOrRegular")
static{dt7948.g(this.prototype,"rankedChoiceOrNumber",[(0,n.or)("isRankedChoice","isNumber")])}#i=void dt7948.i(this,"rankedChoiceOrNumber")
pollResults(e){const t=[{name:(0,y.i18n)("poll.ui_builder.poll_result.always"),value:S},{name:(0,y.i18n)("poll.ui_builder.poll_result.vote"),value:"on_vote"},{name:(0,y.i18n)("poll.ui_builder.poll_result.closed"),value:"on_close"}]
return e&&t.push({name:(0,y.i18n)("poll.ui_builder.poll_result.staff"),value:"staff_only"}),t}static{dt7948.n(this.prototype,"pollResults",[(0,v.default)("currentUser.staff")])}isRegular(e){return e===T}static{dt7948.n(this.prototype,"isRegular",[(0,v.default)("pollType")])}isNumber(e){return e===M}static{dt7948.n(this.prototype,"isNumber",[(0,v.default)("pollType")])}isMultiple(e){return e===P}static{dt7948.n(this.prototype,"isMultiple",[(0,v.default)("pollType")])}isRankedChoice(e){return e===R}static{dt7948.n(this.prototype,"isRankedChoice",[(0,v.default)("pollType")])}pollOptionsCount(e){return(e||[]).filter(e=>e.value.length>0).length}static{dt7948.n(this.prototype,"pollOptionsCount",[(0,v.default)("pollOptions.@each.value")])}siteGroups(e){return e.filter(e=>0!==e.id)}static{dt7948.n(this.prototype,"siteGroups",[(0,v.default)("site.groups")])}isPie(e,t){return t!==M&&e===x}static{dt7948.n(this.prototype,"isPie",[(0,v.default)("chartType","pollType")])}_setPollMinMax(){this.isMultiple?((this.pollMin<=0||this.pollMin>=this.pollMax||this.pollMin>=this.pollOptionsCount)&&this.set("pollMin",this.pollOptionsCount>0?1:0),(this.pollMax<=0||this.pollMin>=this.pollMax||this.pollMax>this.pollOptionsCount)&&this.set("pollMax",this.pollOptionsCount)):this.isNumber&&this.set("pollMax",this.siteSettings.poll_maximum_options)}static{dt7948.n(this.prototype,"_setPollMinMax",[(0,r.observes)("pollType","pollOptionsCount")])}pollOutput(e,t,l,o,s,n,i,r,a,p,u,d){let c="[poll",h=""
const m=this.model.toolbarEvent.getText().match(/\[poll(\s+name=[^\s\]]+)*.*\]/gim)
m&&(c+=` name=poll${m.length+1}`)
let g=a
return g<1&&(g=1),e&&(c+=` type=${e}`),t&&(c+=` results=${t}`),i&&e!==T&&(c+=` min=${i}`),r&&e!==T&&(c+=` max=${r}`),e===M&&(c+=` step=${g}`),c+=" public="+(l?"true":"false"),d&&e!==M&&(c+=` chartType=${d}`),o&&(c+=" dynamic=true"),p&&p.length>0&&(c+=` groups=${p}`),u&&(c+=` close=${u.toISOString()}`),c+="]",h+=`${c}\n`,s&&(h+=`# ${s.trim()}\n`),n.length>0&&e!==M&&n.forEach(e=>{e.value.length>0&&(h+=`* ${e.value.trim()}\n`)}),h+="[/poll]\n",h}static{dt7948.n(this.prototype,"pollOutput",[(0,v.default)("pollType","pollResult","publicPoll","dynamic","pollTitle","pollOptions.@each.value","pollMin","pollMax","pollStep","pollGroups","pollAutoClose","chartType")])}minNumOfOptionsValidation(e,t){if(!e){if(t<1)return s.default.create({failed:!0,reason:(0,y.i18n)("poll.ui_builder.help.options_min_count")})
if(t>this.siteSettings.poll_maximum_options)return s.default.create({failed:!0,reason:(0,y.i18n)("poll.ui_builder.help.options_max_count",{count:this.siteSettings.poll_maximum_options})})}return s.default.create({ok:!0})}static{dt7948.n(this.prototype,"minNumOfOptionsValidation",[(0,v.default)("isNumber","pollOptionsCount")])}showMinNumOfOptionsValidation(e){return 1!==e.length||""!==e[0].value}static{dt7948.n(this.prototype,"showMinNumOfOptionsValidation",[(0,v.default)("pollOptions.@each.value")])}minMaxValueValidation(e,t,l,o,n,i){if(o=parseInt(o,10)||0,n=parseInt(n,10)||0,i=parseInt(i,10)||0,o<0)return s.default.create({failed:!0,reason:(0,y.i18n)("poll.ui_builder.help.invalid_min_value")})
if(n<0||e&&n>t)return s.default.create({failed:!0,reason:(0,y.i18n)("poll.ui_builder.help.invalid_max_value")})
if(o>n)return s.default.create({failed:!0,reason:(0,y.i18n)("poll.ui_builder.help.invalid_values")})
if(l){if(i<1)return s.default.create({failed:!0,reason:(0,y.i18n)("poll.ui_builder.help.min_step_value")})
const e=(n-o+1)/i
if(e<1)return s.default.create({failed:!0,reason:(0,y.i18n)("poll.ui_builder.help.options_min_count")})
if(e>this.siteSettings.poll_maximum_options)return s.default.create({failed:!0,reason:(0,y.i18n)("poll.ui_builder.help.options_max_count",{count:this.siteSettings.poll_maximum_options})})}return s.default.create({ok:!0})}static{dt7948.n(this.prototype,"minMaxValueValidation",[(0,v.default)("isMultiple","pollOptionsCount","isNumber","pollMin","pollMax","pollStep")])}disableInsert(e,t){return!e.ok||!t.ok}static{dt7948.n(this.prototype,"disableInsert",[(0,v.default)("minMaxValueValidation","minNumOfOptionsValidation")])}_comboboxOptions(e,t){return[...Array(t-e).keys()].map(t=>({value:t+e,name:t+e}))}onOptionsTextChange(e){this.set("pollOptions",e.target.value.split("\n").map(e=>s.default.create({value:e})))}static{dt7948.n(this.prototype,"onOptionsTextChange",[s.action])}insertPoll(){this.model.toolbarEvent.addText(this.pollOutput),this.closeModal()}static{dt7948.n(this.prototype,"insertPoll",[s.action])}toggleAdvanced(){this.toggleProperty("showAdvanced"),this.showAdvanced&&this.set("pollOptionsText",this.pollOptions.map(e=>e.value).join("\n"))}static{dt7948.n(this.prototype,"toggleAdvanced",[s.action])}updateValue(e,t){e.set("value",t.target.value)}static{dt7948.n(this.prototype,"updateValue",[s.action])}onInputKeydown(e,t){"Enter"===t.key&&(t.preventDefault(),t.stopPropagation(),""!==t.target.value&&this.addOption(e+1))}static{dt7948.n(this.prototype,"onInputKeydown",[s.action])}addOption(e){-1===e&&(e=this.pollOptions.length)
const t=s.default.create({value:""})
this.pollOptions.insertAt(e,t)}static{dt7948.n(this.prototype,"addOption",[s.action])}removeOption(e){this.pollOptions.removeObject(e)}static{dt7948.n(this.prototype,"removeOption",[s.action])}updatePollType(e,t){t?.preventDefault(),this.set("pollType",e)}static{dt7948.n(this.prototype,"updatePollType",[s.action])}togglePublic(){this.set("publicPoll",!this.publicPoll)}static{dt7948.n(this.prototype,"togglePublic",[s.action])}static{(0,t.setComponentTemplate)((0,C.createTemplateFactory)({id:"nIIO7zAT",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"poll-ui-builder"]],[["@title","@closeModal","@inline"],[[28,[32,1],["poll.ui_builder.title"],null],[30,1],[30,2]]],[["body","footer"],[[[[1,"\\n        "],[10,"ul"],[14,0,"nav nav-pills poll-type"],[12],[1,"\\n          "],[10,"li"],[12],[1,"\\n            "],[8,[32,2],[[16,0,[28,[32,3],["poll-type-value poll-type-value-regular",[52,[30,0,["isRegular"]],"active"]],null]]],[["@action"],[[28,[32,4],[[30,0,["updatePollType"]],"regular"],null]]],[["default"],[[[[1,"\\n              "],[1,[28,[32,1],["poll.ui_builder.poll_type.regular"],null]],[1,"\\n            "]],[]]]]],[1,"\\n          "],[13],[1,"\\n          "],[10,"li"],[12],[1,"\\n            "],[8,[32,2],[[16,0,[28,[32,3],["poll-type-value poll-type-value-multiple",[52,[30,0,["isMultiple"]],"active"]],null]]],[["@action"],[[28,[32,4],[[30,0,["updatePollType"]],"multiple"],null]]],[["default"],[[[[1,"\\n              "],[1,[28,[32,1],["poll.ui_builder.poll_type.multiple"],null]],[1,"\\n            "]],[]]]]],[1,"\\n          "],[13],[1,"\\n"],[41,[30,0,["showNumber"]],[[[1,"            "],[10,"li"],[12],[1,"\\n              "],[8,[32,2],[[16,0,[28,[32,3],["poll-type-value poll-type-value-number",[52,[30,0,["isNumber"]],"active"]],null]]],[["@action"],[[28,[32,4],[[30,0,["updatePollType"]],"number"],null]]],[["default"],[[[[1,"\\n                "],[1,[28,[32,1],["poll.ui_builder.poll_type.number"],null]],[1,"\\n              "]],[]]]]],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[41,[30,0,["showRankedChoice"]],[[[1,"            "],[10,"li"],[12],[1,"\\n              "],[8,[32,2],[[16,0,[28,[32,3],["poll-type-value poll-type-value-ranked-choice",[52,[30,0,["isRankedChoice"]],"active"]],null]]],[["@action"],[[28,[32,4],[[30,0,["updatePollType"]],"ranked_choice"],null]]],[["default"],[[[[1,"\\n                "],[1,[28,[32,1],["poll.ui_builder.poll_type.ranked_choice"],null]],[1,"\\n              "]],[]]]]],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n\\n"],[41,[30,0,["showAdvanced"]],[[[1,"          "],[10,0],[14,0,"input-group poll-title"],[12],[1,"\\n            "],[10,"label"],[14,0,"input-group-label"],[12],[1,[28,[32,1],["poll.ui_builder.poll_title.label"],null]],[13],[1,"\\n            "],[11,"input"],[16,2,[30,0,["pollTitle"]]],[24,4,"text"],[4,[32,5],["input",[28,[32,6],[[28,[32,4],[[28,[31,1],[[30,0,["pollTitle"]]],null]],null]],null]],null],[12],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[51,[30,0,["isNumber"]]],[[[1,"          "],[10,0],[14,0,"poll-options"],[12],[1,"\\n"],[41,[30,0,["showAdvanced"]],[[[1,"              "],[10,"label"],[14,0,"input-group-label"],[12],[1,[28,[32,1],["poll.ui_builder.poll_options.label"],null]],[13],[1,"\\n              "],[8,[32,7],[[4,[32,5],["input",[30,0,["onOptionsTextChange"]]],null]],[["@value"],[[30,0,["pollOptionsText"]]]],null],[1,""],[41,[30,0,["showMinNumOfOptionsValidation"]],[[[41,[51,[30,0,["minNumOfOptionsValidation","ok"]]],[[[1,"                  "],[8,[32,8],null,[["@validation"],[[30,0,["minNumOfOptionsValidation"]]]],null],[1,"\\n"]],[]],null]],[]],null]],[]],[[[42,[28,[31,4],[[28,[31,4],[[30,0,["pollOptions"]]],null]],null],null,[[[1,"                "],[10,0],[14,0,"input-group poll-option-value"],[12],[1,"\\n                  "],[11,"input"],[16,2,[30,3,["value"]]],[24,4,"text"],[4,[32,9],null,null],[4,[32,5],["input",[28,[32,4],[[30,0,["updateValue"]],[30,3]],null]],null],[4,[32,5],["keydown",[28,[32,4],[[30,0,["onInputKeydown"]],[30,4]],null]],null],[12],[13],[1,"\\n"],[41,[30,0,["canRemoveOption"]],[[[1,"                    "],[8,[32,2],null,[["@icon","@action"],["trash-can",[28,[32,4],[[30,0,["removeOption"]],[30,3]],null]]],null],[1,"\\n"]],[]],null],[1,"                "],[13],[1,"\\n"]],[3,4]],null],[1,"\\n              "],[10,0],[14,0,"poll-option-controls"],[12],[1,"\\n                "],[8,[32,2],[[24,0,"btn-default poll-option-add"]],[["@icon","@label","@action"],["plus","poll.ui_builder.poll_options.add",[28,[32,4],[[30,0,["addOption"]],-1],null]]],null],[1,"\\n"],[41,[28,[32,10],[[30,0,["showMinNumOfOptionsValidation"]],[28,[32,11],[[30,0,["minNumOfOptionsValidation","ok"]]],null]],null],[[[1,"                  "],[8,[32,8],null,[["@validation"],[[30,0,["minNumOfOptionsValidation"]]]],null],[1,"\\n"]],[]],null],[1,"              "],[13],[1,"\\n"]],[]]],[1,"          "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[51,[30,0,["rankedChoiceOrRegular"]]],[[[1,"          "],[10,0],[14,0,"options"],[12],[1,"\\n            "],[10,0],[14,0,"input-group poll-number"],[12],[1,"\\n              "],[10,"label"],[14,0,"input-group-label"],[12],[1,[28,[32,1],["poll.ui_builder.poll_config.min"],null]],[13],[1,"\\n              "],[11,"input"],[16,2,[30,0,["pollMin"]]],[24,0,"poll-options-min"],[24,"min","1"],[24,4,"number"],[4,[32,5],["input",[28,[32,6],[[28,[32,4],[[28,[31,1],[[30,0,["pollMin"]]],null]],null]],null]],null],[12],[13],[1,"\\n            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"input-group poll-number"],[12],[1,"\\n              "],[10,"label"],[14,0,"input-group-label"],[12],[1,[28,[32,1],["poll.ui_builder.poll_config.max"],null]],[13],[1,"\\n              "],[11,"input"],[16,2,[30,0,["pollMax"]]],[24,0,"poll-options-max"],[24,"min","1"],[24,4,"number"],[4,[32,5],["input",[28,[32,6],[[28,[32,4],[[28,[31,1],[[30,0,["pollMax"]]],null]],null]],null]],null],[12],[13],[1,"\\n            "],[13],[1,"\\n\\n"],[41,[30,0,["isNumber"]],[[[1,"              "],[10,0],[14,0,"input-group poll-number"],[12],[1,"\\n                "],[10,"label"],[14,0,"input-group-label"],[12],[1,[28,[32,1],["poll.ui_builder.poll_config.step"],null]],[13],[1,"\\n                "],[11,"input"],[16,2,[30,0,["pollStep"]]],[24,"min","1"],[24,0,"poll-options-step"],[24,4,"number"],[4,[32,5],["input",[28,[32,6],[[28,[32,4],[[28,[31,1],[[30,0,["pollStep"]]],null]],null]],null]],null],[12],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],null],[1,"          "],[13],[1,"\\n\\n"],[41,[51,[30,0,["minMaxValueValidation","ok"]]],[[[1,"            "],[8,[32,8],null,[["@validation"],[[30,0,["minMaxValueValidation"]]]],null],[1,"\\n"]],[]],null]],[]],null],[1,"\\n        "],[10,0],[14,0,"input-group poll-public"],[12],[1,"\\n          "],[8,[32,12],[[24,0,"poll-toggle-public"],[4,[32,5],["click",[30,0,["togglePublic"]]],null]],[["@state","@label"],[[30,0,["publicPoll"]],"poll.ui_builder.poll_public.label"]],null],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[30,0,["showAdvanced"]],[[[1,"          "],[10,0],[14,0,"input-group poll-dynamic"],[12],[1,"\\n            "],[8,[32,12],[[24,0,"poll-toggle-dynamic"],[4,[32,5],["click",[28,[32,4],[[28,[31,1],[[30,0,["dynamic"]]],null],[28,[32,11],[[30,0,["dynamic"]]],null]],null]],null]],[["@state","@label"],[[30,0,["dynamic"]],"poll.ui_builder.poll_dynamic.label"]],null],[1,"\\n          "],[13],[1,"\\n          "],[10,0],[14,0,"input-group poll-allowed-groups"],[12],[1,"\\n            "],[10,"label"],[14,0,"input-group-label"],[12],[1,[28,[32,1],["poll.ui_builder.poll_groups.label"],null]],[13],[1,"\\n            "],[8,[32,13],null,[["@content","@value","@onChange","@labelProperty","@valueProperty"],[[30,0,["siteGroups"]],[30,0,["pollGroups"]],[28,[32,4],[[28,[31,1],[[30,0,["pollGroups"]]],null]],null],"name","name"]],null],[1,"\\n          "],[13],[1,"\\n\\n          "],[10,0],[14,0,"input-group poll-date"],[12],[1,"\\n            "],[10,"label"],[14,0,"input-group-label"],[12],[1,[28,[32,1],["poll.ui_builder.automatic_close.label"],null]],[13],[1,"\\n            "],[8,[32,14],null,[["@date","@onChange","@clearable","@useGlobalPickerContainer"],[[30,0,["pollAutoClose"]],[28,[32,4],[[28,[31,1],[[30,0,["pollAutoClose"]]],null]],null],true,true]],null],[1,"\\n          "],[13],[1,"\\n\\n          "],[10,0],[14,0,"input-group poll-select"],[12],[1,"\\n            "],[10,"label"],[14,0,"input-group-label"],[12],[1,[28,[32,1],["poll.ui_builder.poll_result.label"],null]],[13],[1,"\\n            "],[8,[32,15],[[24,0,"poll-result"]],[["@content","@value","@valueProperty","@onChange"],[[30,0,["pollResults"]],[30,0,["pollResult"]],"value",[28,[32,4],[[28,[31,1],[[30,0,["pollResult"]]],null]],null]]],null],[1,"\\n          "],[13],[1,"\\n\\n"],[41,[51,[30,0,["rankedChoiceOrNumber"]]],[[[1,"            "],[10,0],[14,0,"input-group poll-select column"],[12],[1,"\\n              "],[10,"label"],[14,0,"input-group-label"],[12],[1,[28,[32,1],["poll.ui_builder.poll_chart_type.label"],null]],[13],[1,"\\n\\n              "],[10,0],[14,0,"radio-group"],[12],[1,"\\n                "],[8,[32,16],null,[["@id","@name","@value","@selection"],["poll-chart-type-bar","poll-chart-type","bar",[30,0,["chartType"]]]],null],[1,"\\n                "],[10,"label"],[14,"for","poll-chart-type-bar"],[12],[1,[28,[32,17],["chart-bar"],null]],[1,"\\n                  "],[1,[28,[32,1],["poll.ui_builder.poll_chart_type.bar"],null]],[13],[1,"\\n              "],[13],[1,"\\n\\n              "],[10,0],[14,0,"radio-group"],[12],[1,"\\n                "],[8,[32,16],null,[["@id","@name","@value","@selection"],["poll-chart-type-pie","poll-chart-type","pie",[30,0,["chartType"]]]],null],[1,"\\n                "],[10,"label"],[14,"for","poll-chart-type-pie"],[12],[1,[28,[32,17],["chart-pie"],null]],[1,"\\n                  "],[1,[28,[32,1],["poll.ui_builder.poll_chart_type.pie"],null]],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"      "]],[]],[[[1,"\\n        "],[8,[32,2],[[24,0,"btn-primary insert-poll"]],[["@action","@icon","@label","@disabled"],[[30,0,["insertPoll"]],"chart-bar","poll.ui_builder.insert",[30,0,["disableInsert"]]]],null],[1,"\\n\\n        "],[8,[32,2],[[24,0,"btn-flat"]],[["@label","@action"],["cancel",[30,1]]],null],[1,"\\n\\n        "],[8,[32,2],[[24,0,"btn-default show-advanced"]],[["@action","@icon","@title"],[[30,0,["toggleAdvanced"]],"gear",[52,[30,0,["showAdvanced"]],"poll.ui_builder.hide_advanced","poll.ui_builder.show_advanced"]]],null],[1,"\\n\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","@inline","option","index"],false,["if","mut","unless","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/modal/poll-ui-builder.js",scope:()=>[u.default,y.i18n,p.default,g.default,l.fn,o.on,b.default,t.Textarea,h.default,_.default,a.and,a.not,d.default,w.default,c.default,k.default,m.default,f.default],isStrictMode:!0}),this)}}e.default=j}),define("discourse/plugins/poll/discourse/components/poll-breakdown-chart",["exports","@ember/component","@ember/object/computed","@ember/runloop","@ember/template","@ember-decorators/component","discourse/lib/decorators","discourse-i18n","discourse/plugins/poll/lib/chart-colors","discourse/plugins/poll/discourse/components/modal/poll-ui-builder","@ember/template-factory"],function(e,t,l,o,s,n,i,r,a,p,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=dt7948.c(class extends t.default{group=null
options=null
displayMode=null
highlightedOption=null
setHighlightedOption=null
static{dt7948.g(this.prototype,"data",[(0,l.mapBy)("options","votes")])}#r=void dt7948.i(this,"data")
_optionToSlice=null
_previousHighlightedSliceIndex=null
_previousDisplayMode=null
init(){super.init(...arguments),this._optionToSlice={}}willDestroy(){super.willDestroy(...arguments),this._chart&&this._chart.destroy()}didInsertElement(){super.didInsertElement(...arguments)
const e=this.element.querySelector("canvas")
this._chart=new window.Chart(e.getContext("2d"),this.chartConfig)}didReceiveAttrs(){super.didReceiveAttrs(...arguments),this._chart&&(this._updateDisplayMode(),this._updateHighlight())}colorStyle(e,t){return(0,s.htmlSafe)(`background: ${e[t]};`)}static{dt7948.n(this.prototype,"colorStyle",[(0,i.default)("optionColors","index")])}chartConfig(e,t){const l=[]
let s=0
this._optionToSlice={},e.forEach((e,t)=>{e>0&&(l.push(e),this._optionToSlice[t]=s++)})
const n=l.reduce((e,t)=>e+t,0),i=(0,a.getColors)(e.length).filter((t,l)=>e[l]>0)
return{type:p.PIE_CHART_TYPE,plugins:[window.ChartDataLabels],data:{datasets:[{data:l,backgroundColor:i,hoverBorderColor:"#fff"}]},options:{plugins:{tooltip:!1,datalabels:{color:"#333",backgroundColor:"rgba(255, 255, 255, 0.5)",borderRadius:2,font:{family:getComputedStyle(document.body).fontFamily,size:16},padding:{top:2,right:6,bottom:2,left:6},formatter(e){if("percentage"!==t)return e
return`${r.default.toNumber(e/n*100,{precision:1})}%`}}},responsive:!0,aspectRatio:1.1,animation:{duration:0},onHover:(e,t)=>{if(!t.length)return void(0,o.next)(()=>{this.setHighlightedOption(null)})
const l=t[0].index,s=Object.keys(this._optionToSlice).find(e=>this._optionToSlice[e]===l);(0,o.next)(()=>{this.setHighlightedOption(Number(s))})}}}}static{dt7948.n(this.prototype,"chartConfig",[(0,i.default)("data","displayMode")])}_updateDisplayMode(){if(this.displayMode!==this._previousDisplayMode){const e=this.chartConfig
this._chart.data.datasets=e.data.datasets,this._chart.options=e.options,this._chart.update(),this._previousDisplayMode=this.displayMode}}_updateHighlight(){const e=[]
if(this.highlightedOption){const t=this._optionToSlice[this.highlightedOption]
void 0!==t&&e.push({datasetIndex:0,index:t})}this._chart.setActiveElements(e),this._chart.update()}static{(0,t.setComponentTemplate)((0,u.createTemplateFactory)({id:"7L2OXyes",block:'[[[1,"\\n    "],[10,"label"],[14,0,"poll-breakdown-chart-label"],[12],[1,[30,1]],[13],[1,"\\n    "],[10,"canvas"],[14,0,"poll-breakdown-chart-chart"],[12],[13],[1,"\\n  "]],["@group"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/poll-breakdown-chart.js",isStrictMode:!0}),this)}},[(0,n.classNames)("poll-breakdown-chart-container")])
e.default=d}),define("discourse/plugins/poll/discourse/components/poll-breakdown-option",["exports","@ember/component","@ember/modifier","@ember/object/computed","@ember/template","@ember-decorators/component","discourse/lib/computed","discourse/lib/decorators","discourse-i18n","discourse/plugins/poll/lib/chart-colors","@ember/template-factory"],function(e,t,l,o,s,n,i,r,a,p,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=dt7948.c(class extends t.default{option=null
index=null
totalVotes=null
optionsCount=null
displayMode=null
highlightedOption=null
onMouseOver=null
onMouseOut=null
static{dt7948.g(this.prototype,"highlighted",[(0,i.propertyEqual)("highlightedOption","index")])}#a=void dt7948.i(this,"highlighted")
static{dt7948.g(this.prototype,"showPercentage",[(0,o.equal)("displayMode","percentage")])}#p=void dt7948.i(this,"showPercentage")
percent(e,t){return a.default.toNumber(e/t*100,{precision:1})}static{dt7948.n(this.prototype,"percent",[(0,r.default)("option.votes","totalVotes")])}optionColors(e){return(0,p.getColors)(e)}static{dt7948.n(this.prototype,"optionColors",[(0,r.default)("optionsCount")])}colorBackgroundStyle(e){if(e)return(0,s.htmlSafe)("background: rgba(0, 0, 0, 0.1);")}static{dt7948.n(this.prototype,"colorBackgroundStyle",[(0,r.default)("highlighted")])}colorPreviewStyle(e,t,l){const o=e?window.Chart.helpers.getHoverColor(t[l]):t[l]
return(0,s.htmlSafe)(`background: ${o};`)}static{dt7948.n(this.prototype,"colorPreviewStyle",[(0,r.default)("highlighted","optionColors","index")])}static{(0,t.setComponentTemplate)((0,u.createTemplateFactory)({id:"eauZvEcj",block:'[[[1,"\\n    "],[11,"li"],[24,0,"poll-breakdown-option"],[16,5,[30,0,["colorBackgroundStyle"]]],[24,"role","button"],[4,[32,0],["mouseover",[30,1]],null],[4,[32,0],["mouseout",[30,2]],null],[12],[1,"\\n      "],[10,1],[14,0,"poll-breakdown-option-color"],[15,5,[30,0,["colorPreviewStyle"]]],[12],[13],[1,"\\n\\n      "],[10,1],[14,0,"poll-breakdown-option-count"],[12],[1,"\\n"],[41,[30,0,["showPercentage"]],[[[1,"          "],[1,[28,[32,1],["number.percent"],[["count"],[[30,0,["percent"]]]]]],[1,"\\n"]],[]],[[[1,"          "],[1,[30,3,["votes"]]],[1,"\\n"]],[]]],[1,"      "],[13],[1,"\\n      "],[10,1],[14,0,"poll-breakdown-option-text"],[12],[1,[28,[32,2],[[30,3,["html"]]],null]],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@onMouseOver","@onMouseOut","@option"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/poll-breakdown-option.js",scope:()=>[l.on,a.i18n,s.htmlSafe],isStrictMode:!0}),this)}},[(0,n.tagName)("")])
e.default=d}),define("discourse/plugins/poll/discourse/components/poll-buttons-dropdown",["exports","@glimmer/component","@ember/helper","@ember/object","@ember/service","discourse/components/d-button","discourse/components/dropdown-menu","discourse/helpers/d-icon","float-kit/components/d-menu","@ember/component","@ember/template-factory"],function(e,t,l,o,s,n,i,r,a,p,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d={exportResults:{className:"btn-default export-results",label:"poll.export-results.label",title:"poll.export-results.title",icon:"download",action:"exportResults"},showBreakdown:{className:"btn-default show-breakdown",label:"poll.breakdown.breakdown",icon:"chart-pie",action:"showBreakdown"},openPoll:{className:"btn-default toggle-status",label:"poll.open.label",title:"poll.open.title",icon:"unlock-keyhole",action:"toggleStatus"},closePoll:{className:"btn-default toggle-status",label:"poll.close.label",title:"poll.close.title",icon:"lock",action:"toggleStatus"},showTally:{className:"btn-default show-tally",label:"poll.show-tally.label",title:"poll.show-tally.title",icon:"info",action:"toggleDisplayMode"},showPercentage:{className:"btn-default show-percentage",label:"poll.show-percentage.label",title:"poll.show-percentage.title",icon:"info",action:"toggleDisplayMode"}}
class c extends t.default{static{dt7948.g(this.prototype,"currentUser",[s.service])}#u=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"siteSettings",[s.service])}#t=void dt7948.i(this,"siteSettings")
constructor(){super(...arguments),this.getDropdownButtonState=!1}dropDownClick(e){this.args.dropDownClick(e)}static{dt7948.n(this.prototype,"dropDownClick",[o.action])}get getDropdownContent(){const e=[],t=this.currentUser&&this.currentUser.admin,l=this.siteSettings.data_explorer_enabled,o=this.args.isRankedChoice?this.siteSettings.poll_export_ranked_choice_data_explorer_query_id:this.siteSettings.poll_export_data_explorer_query_id,{closed:s,voters:n,isStaff:i,isMe:r,topicArchived:a,groupableUserFields:p,isAutomaticallyClosed:u,availableDisplayMode:c}=this.args
if(c){const t={...d[c]}
t.id=t.action,e.push(t)}if(p.length&&n>0){const t={...d.showBreakdown}
t.id=t.action,e.push(t)}if(t&&l&&n>0&&o){const t={...d.exportResults}
t.id=t.action,e.push(t)}if(this.currentUser&&(r||i)&&!a)if(s){if(!u){const t={...d.openPoll}
t.id=t.action,e.push(t)}}else{const t={...d.closePoll}
t.id=t.action,e.push(t)}return e}get showDropdown(){return this.getDropdownContent.length>1}get showDropdownAsButton(){return 1===this.getDropdownContent.length}static{(0,p.setComponentTemplate)((0,u.createTemplateFactory)({id:"aY1spYIh",block:'[[[1,"\\n    "],[10,0],[14,0,"poll-buttons-dropdown"],[12],[1,"\\n"],[41,[30,0,["showDropdown"]],[[[1,"        "],[8,[32,0],[[24,0,"widget-dropdown-header"]],null,[["trigger","content"],[[[[1,"\\n            "],[1,[28,[32,1],["gear"],null]],[1,"\\n          "]],[]],[[[1,"\\n            "],[8,[32,2],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["getDropdownContent"]]],null]],null],null,[[[1,"                "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,3],[[16,0,[29,["widget-button ",[30,2,["className"]]]]]],[["@icon","@label","@action"],[[30,2,["icon"]],[30,2,["label"]],[28,[32,4],[[30,0,["dropDownClick"]],[30,2,["action"]]],null]]],null],[1,"\\n                "]],[]]]]],[1,"\\n                "],[8,[30,1,["divider"]],null,null,null],[1,"\\n"]],[2]],null],[1,"            "]],[1]]]]],[1,"\\n          "]],[]]]]],[1,"\\n"]],[]],[[[41,[30,0,["showDropdownAsButton"]],[[[1,"        "],[8,[32,3],[[16,0,[29,["widget-button ",[28,[32,5],[[30,0,["getDropdownContent"]],"0.className"],null]]]]],[["@icon","@label","@action"],[[28,[32,5],[[30,0,["getDropdownContent"]],"0.icon"],null],[28,[32,5],[[30,0,["getDropdownContent"]],"0.label"],null],[28,[32,4],[[30,0,["dropDownClick"]],[28,[32,5],[[30,0,["getDropdownContent"]],"0.action"],null]],null]]],null],[1,"\\n      "]],[]],null]],[]]],[1,"    "],[13],[1,"\\n  "]],["dropdown","content"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/poll-buttons-dropdown.js",scope:()=>[a.default,r.default,i.default,n.default,l.fn,o.get],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/poll/discourse/components/poll-info",["exports","@glimmer/component","@ember/service","@ember/template","discourse/helpers/d-icon","discourse/lib/formatter","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,l,o,s,n,i,r,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const p="staff_only"
class u extends t.default{static{dt7948.g(this.prototype,"currentUser",[l.service])}#u=void dt7948.i(this,"currentUser")
get multipleHelpText(){const{min:e,max:t,options:l}=this.args,s=l.length
if(t>0){if(e===t&&e>1)return(0,o.htmlSafe)((0,i.i18n)("poll.multiple.help.x_options",{count:e}))
if(e>1)return t<s?(0,o.htmlSafe)((0,i.i18n)("poll.multiple.help.between_min_and_max_options",{min:e,max:t})):(0,o.htmlSafe)((0,i.i18n)("poll.multiple.help.at_least_min_options",{count:e}))
if(t<=s)return(0,o.htmlSafe)((0,i.i18n)("poll.multiple.help.up_to_max_options",{count:t}))}}get votersLabel(){return(0,i.i18n)("poll.voters",{count:this.args.voters})}get showTotalVotes(){return this.args.isMultiple&&(this.args.showResults||this.args.closed)}get totalVotes(){return this.args.options.reduce((e,t)=>e+parseInt(t.votes,10),0)}get totalVotesLabel(){return(0,i.i18n)("poll.total_votes",{count:this.totalVotes})}get automaticCloseAgeLabel(){return(0,i.i18n)("poll.automatic_close.age",this.age)}get automaticCloseClosesInLabel(){return(0,i.i18n)("poll.automatic_close.closes_in",this.timeLeft)}get showMultipleHelpText(){return this.args.isMultiple&&!this.args.showResults&&!this.args.closed}get closeTitle(){const e=moment.utc(this.args.close,"YYYY-MM-DD HH:mm:ss Z")
return e.isValid()?e.format("LLL"):""}get age(){const e=moment.utc(this.args.close,"YYYY-MM-DD HH:mm:ss Z")
return e.isValid()?(0,n.relativeAge)(e.toDate(),{addAgo:!0}):0}get timeLeft(){const e=moment.utc(this.args.close,"YYYY-MM-DD HH:mm:ss Z")
return e.isValid()?moment().to(e,!0):0}get resultsOnVote(){return!("on_vote"!==this.args.results||this.args.hasVoted||this.currentUser&&this.args.postUserId===this.currentUser.id)}get resultsOnVoteTitle(){return(0,o.htmlSafe)((0,i.i18n)("poll.results.vote.title"))}get resultsOnClose(){return"on_close"===this.args.results&&!this.args.closed}get resultsOnCloseTitle(){return(0,o.htmlSafe)((0,i.i18n)("poll.results.closed.title"))}get resultsStaffOnly(){return this.args.results===p&&!(this.currentUser&&this.currentUser.staff)}get resultsStaffOnlyTitle(){return(0,o.htmlSafe)((0,i.i18n)("poll.results.staff.title"))}get publicTitle(){return!this.args.closed&&!this.args.showResults&&this.args.isPublic&&this.args.results!==p}get publicTitleLabel(){return(0,o.htmlSafe)((0,i.i18n)("poll.public.title"))}get showInstructionsSection(){return this.showMultipleHelpText||this.args.close||this.resultsOnVote||this.resultsOnClose||this.resultsStaffOnly||this.publicTitle||this.args.isDynamic}static{(0,r.setComponentTemplate)((0,a.createTemplateFactory)({id:"lHBeh2MK",block:'[[[1,"\\n    "],[10,0],[14,0,"poll-info"],[12],[1,"\\n      "],[10,0],[14,0,"poll-info_counts"],[12],[1,"\\n        "],[10,0],[14,0,"poll-info_counts-count"],[12],[1,"\\n          "],[10,1],[14,0,"info-number"],[12],[1,[30,1]],[13],[1,"\\n          "],[10,1],[14,0,"info-label"],[12],[1,[30,0,["votersLabel"]]],[13],[1,"\\n        "],[13],[1,"\\n"],[41,[30,0,["showTotalVotes"]],[[[1,"          "],[10,0],[14,0,"poll-info_counts-count"],[12],[1,"\\n            "],[10,1],[14,0,"info-number"],[12],[1,[30,0,["totalVotes"]]],[13],[1,"\\n            "],[10,1],[14,0,"info-label"],[12],[1,[30,0,["totalVotesLabel"]]],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"      "],[13],[1,"\\n"],[41,[30,0,["showInstructionsSection"]],[[[1,"        "],[10,"ul"],[14,0,"poll-info_instructions"],[12],[1,"\\n"],[41,[52,[30,2],true,[30,0,["poll","dynamic"]]],[[[1,"            "],[10,"li"],[14,0,"is-dynamic"],[12],[1,"\\n              "],[1,[28,[32,0],["shuffle"],null]],[1,"\\n              "],[10,1],[12],[1,[28,[32,1],["poll.dynamic.enabled_hint"],null]],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[41,[30,0,["showMultipleHelpText"]],[[[1,"            "],[10,"li"],[14,0,"multiple-help-text"],[12],[1,"\\n              "],[1,[28,[32,0],["list-ul"],null]],[1,"\\n              "],[10,1],[12],[1,[30,0,["multipleHelpText"]]],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[41,[30,0,["poll","close"]],[[[41,[30,0,["isAutomaticallyClosed"]],[[[1,"              "],[10,"li"],[15,"title",[30,0,["title"]]],[12],[1,"\\n                "],[1,[28,[32,0],["lock"],null]],[1,"\\n                "],[10,1],[12],[1,[30,0,["automaticCloseAgeLabel"]]],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[1,"              "],[10,"li"],[15,"title",[30,0,["title"]]],[12],[1,"\\n                "],[1,[28,[32,0],["far-clock"],null]],[1,"\\n                "],[10,1],[12],[1,[30,0,["automaticCloseClosesInLabel"]]],[13],[1,"\\n              "],[13],[1,"\\n"]],[]]]],[]],null],[41,[30,0,["resultsOnVote"]],[[[1,"            "],[10,"li"],[14,0,"results-on-vote"],[12],[1,"\\n              "],[1,[28,[32,0],["check"],null]],[1,"\\n              "],[10,1],[12],[1,[30,0,["resultsOnVoteTitle"]]],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[41,[30,0,["resultsOnClose"]],[[[1,"            "],[10,"li"],[14,0,"results-on-close"],[12],[1,"\\n              "],[1,[28,[32,0],["lock"],null]],[1,"\\n              "],[10,1],[12],[1,[30,0,["resultsOnCloseTitle"]]],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[41,[30,0,["resultsStaffOnly"]],[[[1,"            "],[10,"li"],[14,0,"results-staff-only"],[12],[1,"\\n              "],[1,[28,[32,0],["shield-halved"],null]],[1,"\\n              "],[10,1],[12],[1,[30,0,["resultsStaffOnlyTitle"]]],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[41,[30,0,["publicTitle"]],[[[1,"            "],[10,"li"],[14,0,"is-public"],[12],[1,"\\n              "],[1,[28,[32,0],["far-eye"],null]],[1,"\\n              "],[10,1],[12],[1,[30,0,["publicTitleLabel"]]],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],["@voters","@isDynamic"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/poll-info.js",scope:()=>[s.default,i.i18n],isStrictMode:!0}),this)}}e.default=u}),define("discourse/plugins/poll/discourse/components/poll-option-ranked-choice-dropdown",["exports","@glimmer/component","@ember/helper","@ember/object","discourse/components/d-button","discourse/components/dropdown-menu","discourse/helpers/d-icon","discourse-i18n","float-kit/components/d-menu","@ember/component","@ember/template-factory"],function(e,t,l,o,s,n,i,r,a,p,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{onRegisterApi(e){this.dMenu=e}static{dt7948.n(this.prototype,"onRegisterApi",[o.action])}selectRank(e,t){this.args.sendRank(e,t),this.dMenu.close()}static{dt7948.n(this.prototype,"selectRank",[o.action])}get rankLabel(){return 0===this.args.rank?(0,r.i18n)("poll.options.ranked_choice.abstain"):this.args.rank}static{(0,p.setComponentTemplate)((0,u.createTemplateFactory)({id:"SC3eLHA6",block:'[[[1,"\\n    "],[8,[32,0],null,[["@onRegisterApi"],[[30,0,["onRegisterApi"]]]],[["trigger","content"],[[[[1,"\\n        "],[10,1],[14,0,"d-button-label"],[12],[1,"\\n          "],[1,[30,0,["rankLabel"]]],[1,"\\n        "],[13],[1,"\\n        "],[1,[28,[32,1],["angle-down"],null]],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,2],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2]],null]],null],null,[[[1,"            "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n              "],[8,[32,3],[[24,0,"btn-transparent poll-option-dropdown"]],[["@translatedLabel","@action"],[[30,3,["name"]],[28,[32,4],[[30,0,["selectRank"]],[30,4,["id"]],[30,3,["id"]]],null]]],null],[1,"\\n            "]],[]]]]],[1,"\\n"]],[3]],null],[1,"        "]],[1]]]]],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["dropdown","@rankedChoiceDropdownContent","content","@option"],false,["each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/poll-option-ranked-choice-dropdown.js",scope:()=>[a.default,i.default,n.default,s.default,l.fn],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/poll/discourse/components/poll-option-ranked-choice",["exports","@glimmer/component","@ember/object","@ember/service","@ember/template","discourse/components/d-button","discourse/helpers/route-action","discourse/plugins/poll/discourse/components/poll-option-ranked-choice-dropdown","@ember/component","@ember/template-factory"],function(e,t,l,o,s,n,i,r,a,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static{dt7948.g(this.prototype,"currentUser",[o.service])}#u=void dt7948.i(this,"currentUser")
sendRank(e,t=0){this.args.sendRank(e,t)}static{dt7948.n(this.prototype,"sendRank",[l.action])}static{(0,a.setComponentTemplate)((0,p.createTemplateFactory)({id:"j4LhSUQA",block:'[[[1,"\\n    "],[10,0],[14,"tabindex","0"],[14,0,"ranked-choice-poll-option"],[15,"data-poll-option-id",[30,1,["id"]]],[15,"data-poll-option-rank",[30,1,["rank"]]],[12],[1,"\\n"],[41,[30,0,["currentUser"]],[[[1,"        "],[8,[32,0],null,[["@rank","@option","@rankedChoiceDropdownContent","@sendRank"],[[30,1,["rank"]],[30,1],[30,2],[30,0,["sendRank"]]]],null],[1,"\\n"]],[]],[[[1,"        "],[8,[32,1],[[24,0,"btn-default"]],[["@action","@label"],[[28,[32,2],["showLogin"],null],"poll.options.ranked_choice.login"]],null],[1,"\\n"]],[]]],[1,"      "],[10,1],[14,0,"option-text"],[12],[1,[28,[32,3],[[30,1,["html"]]],null]],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@option","@rankedChoiceDropdownContent"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/poll-option-ranked-choice.js",scope:()=>[r.default,n.default,i.default,s.htmlSafe],isStrictMode:!0}),this)}}e.default=u}),define("discourse/plugins/poll/discourse/components/poll-options",["exports","@glimmer/component","@ember/helper","@ember/modifier","@ember/object","@ember/service","@ember/template","discourse/helpers/concat-class","discourse/helpers/d-icon","discourse/helpers/route-action","discourse-i18n","discourse/plugins/poll/discourse/components/poll-option-ranked-choice","@ember/component","@ember/template-factory"],function(e,t,l,o,s,n,i,r,a,p,u,d,c,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends t.default{static{dt7948.g(this.prototype,"currentUser",[n.service])}#u=void dt7948.i(this,"currentUser")
isChosen=e=>this.args.votes.includes(e.id)
sendClick(e){this.args.sendOptionSelect(e)}static{dt7948.n(this.prototype,"sendClick",[s.action])}sendRank(e,t=0){this.args.sendOptionSelect(e,t)}static{dt7948.n(this.prototype,"sendRank",[s.action])}get rankedChoiceDropdownContent(){let e=[]
return e.push({id:0,name:(0,u.i18n)("poll.options.ranked_choice.abstain")}),this.args.options.forEach((t,l)=>{t.rank=0
let o=""
0===l&&(o=` ${(0,u.i18n)("poll.options.ranked_choice.highest_priority")}`),l===this.args.options.length-1&&(o=` ${(0,u.i18n)("poll.options.ranked_choice.lowest_priority")}`),e.push({id:l+1,name:(l+1).toString()+o})}),e}static{(0,c.setComponentTemplate)((0,h.createTemplateFactory)({id:"xSbBxYqW",block:'[[[1,"\\n    "],[10,"ul"],[15,0,[28,[32,0],[[52,[30,1],"ranked-choice-poll-options"],"options"],null]],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2]],null]],null],"rank",[[[41,[30,1],[[[1,"          "],[8,[32,1],null,[["@option","@rankedChoiceDropdownContent","@sendRank"],[[30,3],[30,0,["rankedChoiceDropdownContent"]],[30,0,["sendRank"]]]],null],[1,"\\n"]],[]],[[[1,"          "],[10,"li"],[15,"data-poll-option-id",[30,3,["id"]]],[12],[1,"\\n"],[41,[30,0,["currentUser"]],[[[1,"              "],[11,"button"],[4,[32,2],["click",[28,[32,3],[[30,0,["sendClick"]],[30,3]],null]],null],[12],[1,"\\n"],[41,[28,[30,0,["isChosen"]],[[30,3]],null],[[[41,[30,4],[[[1,"                    "],[1,[28,[32,4],["far-square-check"],null]],[1,"\\n"]],[]],[[[1,"                    "],[1,[28,[32,4],["circle"],null]],[1,"\\n"]],[]]]],[]],[[[41,[30,4],[[[1,"                    "],[1,[28,[32,4],["far-square"],null]],[1,"\\n"]],[]],[[[1,"                    "],[1,[28,[32,4],["far-circle"],null]],[1,"\\n"]],[]]]],[]]],[1,"                "],[10,1],[14,0,"option-text"],[12],[1,[28,[32,5],[[30,3,["html"]]],null]],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[1,"              "],[11,"button"],[4,[32,2],["click",[28,[32,6],["showLogin"],null]],null],[12],[1,"\\n"],[41,[28,[30,0,["isChosen"]],[[30,3]],null],[[[41,[30,4],[[[1,"                    "],[1,[28,[32,4],["far-square-check"],null]],[1,"\\n"]],[]],[[[1,"                    "],[1,[28,[32,4],["circle"],null]],[1,"\\n"]],[]]]],[]],[[[41,[30,4],[[[1,"                    "],[1,[28,[32,4],["far-square"],null]],[1,"\\n"]],[]],[[[1,"                    "],[1,[28,[32,4],["far-circle"],null]],[1,"\\n"]],[]]]],[]]],[1,"                "],[10,1],[14,0,"option-text"],[12],[1,[28,[32,5],[[30,3,["html"]]],null]],[13],[1,"\\n              "],[13],[1,"\\n"]],[]]],[1,"          "],[13],[1,"\\n"]],[]]]],[3]],null],[1,"    "],[13],[1,"\\n  "]],["@isRankedChoice","@options","option","@isCheckbox"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/poll-options.js",scope:()=>[r.default,d.default,o.on,l.fn,a.default,i.htmlSafe,p.default],isStrictMode:!0}),this)}}e.default=m}),define("discourse/plugins/poll/discourse/components/poll-results-pie",["exports","@glimmer/component","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/template","ember-modifier","discourse/lib/load-script","discourse/plugins/poll/lib/chart-colors","discourse/plugins/poll/discourse/components/modal/poll-ui-builder","@ember/component","@ember/template-factory"],function(e,t,l,o,s,n,i,r,a,p,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{htmlLegendPlugin={id:"htmlLegend",afterUpdate(e,t,l){const o=document.getElementById(l.containerID)
if(!o)return
o.innerHTML=""
e.options.plugins.legend.labels.generateLabels(e).forEach(t=>{const l=document.createElement("li")
l.classList.add("legend"),l.onclick=()=>{e.toggleDataVisibility(t.index),e.update()}
const s=document.createElement("span")
s.classList.add("swatch"),s.style.background=t.fillStyle
const n=document.createElement("span")
n.style.color=t.fontColor,n.innerHTML=t.text,e.getDataVisibility(t.index)?l.style.opacity=1:l.style.opacity=.2,l.appendChild(s),l.appendChild(n),o.appendChild(l)})}}
stripHtml=e=>(new DOMParser).parseFromString(e,"text/html").body.textContent||""
pieChartConfig=(e,t,l={})=>{const o="aspectRatio"in l?l.aspectRatio:2.2,s=t.map(e=>this.stripHtml(e))
return{type:a.PIE_CHART_TYPE,data:{datasets:[{data:e,backgroundColor:(0,r.getColors)(e.length)}],labels:s},plugins:[this.htmlLegendPlugin],options:{responsive:!0,aspectRatio:o,animation:{duration:0},plugins:{legend:{labels:{generateLabels:()=>t.map((t,l)=>({fillStyle:(0,r.getColors)(e.length)[l],text:t,index:l}))},display:!1},htmlLegend:{containerID:l?.legendContainerId}}}}}
registerLegendElement=(0,n.modifier)(e=>{this.legendElement=e})
registerCanvasElement=(0,n.modifier)(e=>{this.canvasElement=e})
get canvasId(){return(0,s.htmlSafe)(`poll-results-chart-${this.args.id}`)}get legendId(){return(0,s.htmlSafe)(`poll-results-legend-${this.args.id}`)}async drawPie(){await(0,i.default)("/javascripts/Chart.min.js")
const e=this.args.options.mapBy("votes"),t=this.args.options.mapBy("html"),l=this.pieChartConfig(e,t,{legendContainerId:this.legendElement.id}),o=this.canvasElement
this._chart=new Chart(o.getContext("2d"),l)}static{dt7948.n(this.prototype,"drawPie",[l.action])}static{(0,p.setComponentTemplate)((0,u.createTemplateFactory)({id:"BTeq5Fu6",block:'[[[1,"\\n    "],[10,0],[14,0,"poll-results-chart"],[12],[1,"\\n      "],[11,"canvas"],[16,1,[30,0,["canvasId"]]],[24,0,"poll-results-canvas"],[4,[32,0],[[30,0,["drawPie"]]],null],[4,[32,0],[[30,0,["registerCanvasElement"]]],null],[12],[13],[1,"\\n      "],[11,"ul"],[16,1,[30,0,["legendId"]]],[24,0,"pie-chart-legends"],[4,[32,0],[[30,0,["registerLegendElement"]]],null],[12],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/poll-results-pie.js",scope:()=>[o.default],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/poll/discourse/components/poll-results-ranked-choice",["exports","@glimmer/component","@ember/template","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,l,o,s,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends t.default{get rankedChoiceWinnerText(){return(0,l.htmlSafe)((0,o.i18n)("poll.ranked_choice.winner",{count:this.args.rankedChoiceOutcome?.round_activity?.length,winner:this.args.rankedChoiceOutcome?.winning_candidate?.html}))}get rankedChoiceTiedText(){return(0,o.i18n)("poll.ranked_choice.tied",{count:this.args.rankedChoiceOutcome?.round_activity?.length})}static{(0,s.setComponentTemplate)((0,n.createTemplateFactory)({id:"Ukq1ey4u",block:'[[[1,"\\n    "],[10,"h3"],[14,0,"poll-results-ranked-choice-subtitle-rounds"],[12],[1,"\\n      "],[1,[28,[32,0],["poll.ranked_choice.title.rounds"],null]],[1,"\\n    "],[13],[1,"\\n    "],[10,"table"],[14,0,"poll-results-ranked-choice"],[12],[1,"\\n      "],[10,"thead"],[12],[1,"\\n        "],[10,"tr"],[12],[1,"\\n          "],[10,"th"],[12],[1,[28,[32,0],["poll.ranked_choice.round"],null]],[13],[1,"\\n          "],[10,"th"],[12],[1,[28,[32,0],["poll.ranked_choice.majority"],null]],[13],[1,"\\n          "],[10,"th"],[12],[1,[28,[32,0],["poll.ranked_choice.eliminated"],null]],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n      "],[10,"tbody"],[12],[1,"\\n"],[41,[30,1],[[[42,[28,[31,2],[[28,[31,2],[[30,1,["round_activity"]]],null]],null],null,[[[41,[30,2,["majority"]],[[[1,"              "],[10,"tr"],[12],[1,"\\n                "],[10,"td"],[12],[1,[30,2,["round"]]],[13],[1,"\\n                "],[10,"td"],[12],[1,[28,[32,1],[[30,2,["majority","html"]]],null]],[13],[1,"\\n                "],[10,"td"],[12],[1,[28,[32,0],["poll.ranked_choice.none"],null]],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[1,"              "],[10,"tr"],[12],[1,"\\n                "],[10,"td"],[12],[1,[30,2,["round"]]],[13],[1,"\\n                "],[10,"td"],[12],[1,[28,[32,0],["poll.ranked_choice.none"],null]],[13],[1,"\\n                "],[10,"td"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2,["eliminated"]]],null]],null],null,[[[1,"                    "],[1,[28,[32,1],[[30,3,["html"]]],null]],[1,"\\n"]],[3]],null],[1,"                "],[13],[1,"\\n              "],[13],[1,"\\n"]],[]]]],[2]],null]],[]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n    "],[10,"h3"],[14,0,"poll-results-ranked-choice-subtitle-outcome"],[12],[1,"\\n      "],[1,[28,[32,0],["poll.ranked_choice.title.outcome"],null]],[1,"\\n    "],[13],[1,"\\n"],[41,[30,1],[[[41,[30,1,["tied"]],[[[1,"        "],[10,1],[14,0,"poll-results-ranked-choice-info"],[12],[1,[30,0,["rankedChoiceTiedText"]]],[13],[1,"\\n        "],[10,"ul"],[14,0,"poll-results-ranked-choice-tied-candidates"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,1,["tied_candidates"]]],null]],null],null,[[[1,"            "],[10,"li"],[14,0,"poll-results-ranked-choice-tied-candidate"],[12],[1,[28,[32,1],[[30,4,["html"]]],null]],[13],[1,"\\n"]],[4]],null],[1,"        "],[13],[1,"\\n"]],[]],[[[1,"        "],[10,1],[14,0,"poll-results-ranked-choice-info"],[12],[1,[30,0,["rankedChoiceWinnerText"]]],[13],[1,"\\n"]],[]]]],[]],null],[1,"  "]],["@rankedChoiceOutcome","round","eliminated","tied_candidate"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/poll-results-ranked-choice.js",scope:()=>[o.i18n,l.htmlSafe],isStrictMode:!0}),this)}}e.default=i}),define("discourse/plugins/poll/discourse/components/poll-results-standard",["exports","@glimmer/component","@ember/helper","@ember/template","discourse-i18n","discourse/plugins/poll/lib/even-round","discourse/plugins/poll/discourse/components/poll-voters","@ember/component","@ember/template-factory"],function(e,t,l,o,s,n,i,r,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class p extends t.default{orderOptions=e=>(e.forEach(e=>{e.votes=e.votes??0}),e.sort((e,t)=>e.votes<t.votes?1:e.votes===t.votes?e.html<t.html?-1:1:-1))
getPercentages=(e,t)=>0===t?Array(e.length).fill(0):e.map(e=>100*e.votes/t)
roundPercentages=e=>this.isMultiple?e.map(Math.floor):(0,n.default)(e)
enrichOptions=(e,t)=>(e.forEach((e,l)=>{const o=t[l].toString(),s=(this.args.vote||[]).includes(e.id)
e.percentage=o,e.chosen=s
let n=this.args.isPublic?this.args.voters?.[e.id]?.voters??[]:[]
e.voters=[...n],e.loading=!!this.args.isPublic&&(this.args.voters?.[e.id]?.loading??!1)}),e)
get votersCount(){return this.args.votersCount||0}get orderedOptions(){const e=this.orderOptions([...this.args.options]),t=this.getPercentages(e,this.votersCount),l=this.roundPercentages(t)
return this.enrichOptions(e,l)}get isMultiple(){return"multiple"===this.args.pollType}static{(0,r.setComponentTemplate)((0,a.createTemplateFactory)({id:"ENOttPkH",block:'[[[1,"\\n    "],[10,"ul"],[14,0,"results"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["orderedOptions"]]],null]],null],"voters",[[[1,"        "],[10,"li"],[15,0,[52,[30,1,["chosen"]],"chosen",""]],[12],[1,"\\n          "],[10,0],[14,0,"option"],[12],[1,"\\n            "],[10,2],[12],[1,"\\n"],[41,[51,[30,2]],[[[41,[30,3],[[[1,"                  "],[10,1],[14,0,"absolute"],[12],[1,[28,[32,0],["poll.votes"],[["count"],[[30,1,["votes"]]]]]],[13],[1,"\\n"]],[]],[[[1,"                  "],[10,1],[14,0,"percentage"],[12],[1,[28,[32,0],["number.percent"],[["count"],[[30,1,["percentage"]]]]]],[13],[1,"\\n"]],[]]]],[]],null],[1,"              "],[10,1],[14,0,"option-text"],[12],[1,[28,[32,1],[[30,1,["html"]]],null]],[13],[1,"\\n            "],[13],[1,"\\n"],[41,[51,[30,2]],[[[1,"              "],[10,0],[14,0,"bar-back"],[12],[1,"\\n                "],[10,0],[14,0,"bar"],[15,5,[28,[32,1],[[28,[32,2],["width:",[30,1,["percentage"]],"%"],null]],null]],[12],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],null],[41,[30,4],[[[1,"              "],[8,[32,3],null,[["@postId","@pollType","@optionId","@pollName","@isRankedChoice","@totalVotes","@voters","@fetchVoters","@loading"],[[30,5],[30,6],[30,1,["id"]],[30,7],[30,2],[30,1,["votes"]],[30,1,["voters"]],[30,8],[30,1,["loading"]]]],null],[1,"\\n"]],[]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n"]],[1]],null],[1,"    "],[13],[1,"\\n  "]],["option","@isRankedChoice","@showTally","@isPublic","@postId","@pollType","@pollName","@fetchVoters"],false,["each","-track-array","if","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/poll-results-standard.js",scope:()=>[s.i18n,o.htmlSafe,l.concat,i.default],isStrictMode:!0}),this)}}e.default=p}),define("discourse/plugins/poll/discourse/components/poll-results-tabs",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","truth-helpers","discourse/components/d-button","discourse-i18n","discourse/plugins/poll/discourse/components/poll-results-ranked-choice","discourse/plugins/poll/discourse/components/poll-results-standard","@ember/component","@ember/template-factory"],function(e,t,l,o,s,n,i,r,a,p,u,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static{dt7948.g(this.prototype,"activeTab",[l.tracked])}#d=void dt7948.i(this,"activeTab")
tabOne=(0,r.i18n)("poll.results.tabs.votes")
tabTwo=(0,r.i18n)("poll.results.tabs.outcome")
constructor(){super(...arguments),this.activeTab=this.args.isRankedChoice&&this.args.isPublic?this.tabs[1]:this.tabs[0]}get tabs(){let e=[]
return(!this.args.isRankedChoice||this.args.isRankedChoice&&this.args.isPublic)&&e.push(this.tabOne),this.args.isRankedChoice&&e.push(this.tabTwo),e}selectTab(e){this.activeTab=e}static{dt7948.n(this.prototype,"selectTab",[s.action])}static{(0,u.setComponentTemplate)((0,d.createTemplateFactory)({id:"y0Px/I7+",block:'[[[1,"\\n    "],[10,0],[14,0,"tab-container"],[12],[1,"\\n      "],[10,"ul"],[14,0,"tabs nav nav-items"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["tabs"]]],null]],null],null,[[[1,"          "],[10,"li"],[15,0,[29,["tab nav-item ",[52,[28,[32,0],[[30,1],[30,0,["activeTab"]]],null],"active"]]]],[12],[1,"\\n            "],[8,[32,1],[[24,0,"nav-btn"]],[["@action"],[[28,[32,2],[[30,0,["selectTab"]],[30,1]],null]]],[["default"],[[[[1,"\\n              "],[1,[30,1]],[1,"\\n            "]],[]]]]],[1,"\\n          "],[13],[1,"\\n"]],[1]],null],[1,"      "],[13],[1,"\\n      "],[10,0],[14,0,"tab-content"],[12],[1,"\\n"],[41,[28,[32,0],[[30,0,["activeTab"]],[30,0,["tabOne"]]],null],[[[1,"          "],[8,[32,3],null,[["@options","@pollName","@pollType","@isPublic","@isRankedChoice","@postId","@vote","@voters","@votersCount","@fetchVoters","@showTally"],[[30,2],[30,3],[30,4],[30,5],[30,6],[30,7],[30,8],[30,9],[30,10],[30,11],[30,12]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,0],[[30,0,["activeTab"]],[30,0,["tabTwo"]]],null],[[[1,"          "],[8,[32,4],null,[["@rankedChoiceOutcome"],[[30,13]]],null],[1,"\\n"]],[]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["tab","@options","@pollName","@pollType","@isPublic","@isRankedChoice","@postId","@vote","@voters","@votersCount","@fetchVoters","@showTally","@rankedChoiceOutcome"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/poll-results-tabs.js",scope:()=>[n.eq,i.default,o.fn,p.default,a.default],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/poll/discourse/components/poll-voters-ranked-choice",["exports","@glimmer/component","truth-helpers","discourse/helpers/bound-avatar-template","discourse/helpers/d-icon","@ember/component","@ember/template-factory"],function(e,t,l,o,s,n,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{groupVotersByRank=e=>e.reduce((e,t)=>{const l=t.rank
return e[l]??=[],e[l].push(t),e},{})
get rankedChoiceVoters(){const e=[...this.args.voters],t=this.groupVotersByRank(e)
return Object.keys(t).map(e=>({rank:e,voters:t[e]}))}static{(0,n.setComponentTemplate)((0,i.createTemplateFactory)({id:"+tq7blyY",block:'[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["rankedChoiceVoters"]]],null]],null],null,[[[1,"      "],[10,"ul"],[12],[1,"\\n"],[41,[28,[32,0],[[30,1,["rank"]],"Abstain"],null],[[[1,"          "],[10,1],[14,0,"rank"],[12],[1,[28,[32,1],["ban"],null]],[13],[1,"\\n"]],[]],[[[1,"          "],[10,1],[14,0,"rank"],[12],[1,[30,1,["rank"]]],[13],[1,"\\n"]],[]]],[42,[28,[31,1],[[28,[31,1],[[30,1,["voters"]]],null]],null],null,[[[1,"          "],[10,"li"],[12],[1,"\\n            "],[10,3],[15,"data-user-card",[30,2,["user","username"]]],[12],[1,[28,[32,2],[[30,2,["user","avatar_template"]],"tiny"],[["usernamePath","namePath","title"],[[30,2,["user","username"]],[30,2,["user","name"]],[30,2,["user","username"]]]]]],[13],[1,"\\n          "],[13],[1,"\\n"]],[2]],null],[1,"      "],[13],[1,"\\n"]],[1]],null],[1,"  "]],["rank","voter"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/poll-voters-ranked-choice.js",scope:()=>[l.eq,s.default,o.default],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/poll/discourse/components/poll-voters",["exports","@glimmer/component","@ember/helper","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/helpers/bound-avatar-template","discourse/plugins/poll/discourse/components/poll-voters-ranked-choice","@ember/component","@ember/template-factory"],function(e,t,l,o,s,n,i,r,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class p extends t.default{get showMore(){return this.args.voters.length<this.args.totalVotes}static{(0,r.setComponentTemplate)((0,a.createTemplateFactory)({id:"+C3LhZYa",block:'[[[1,"\\n    "],[10,0],[14,0,"poll-voters"],[12],[1,"\\n      "],[10,"ul"],[14,0,"poll-voters-list"],[12],[1,"\\n"],[41,[30,1],[[[1,"          "],[8,[32,0],null,[["@voters"],[[30,2]]],null],[1,"\\n"]],[]],[[[42,[28,[31,2],[[28,[31,2],[[30,2]],null]],null],null,[[[1,"            "],[10,"li"],[12],[1,"\\n              "],[10,3],[15,"data-user-card",[30,3,["username"]]],[12],[1,[28,[32,1],[[30,3,["avatar_template"]],"tiny"],[["usernamePath","namePath","title"],[[30,3,["username"]],[30,3,["name"]],[30,3,["username"]]]]]],[13],[1,"\\n            "],[13],[1,"\\n"]],[3]],null]],[]]],[1,"      "],[13],[1,"\\n"],[41,[30,0,["showMore"]],[[[1,"        "],[8,[32,2],null,[["@condition"],[[30,4]]],[["default"],[[[[1,"\\n          "],[8,[32,3],[[24,0,"poll-voters-toggle-expand"]],[["@action","@icon"],[[28,[32,4],[[30,5],[30,6]],null],"chevron-down"]],null],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],["@isRankedChoice","@voters","user","@loading","@fetchVoters","@optionId"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/poll-voters.js",scope:()=>[i.default,n.default,o.default,s.default,l.fn],isStrictMode:!0}),this)}}e.default=p}),define("discourse/plugins/poll/discourse/components/poll",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-update","@ember/service","@ember/template","discourse/helpers/d-icon","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/round","discourse-i18n","discourse/plugins/poll/discourse/components/modal/poll-breakdown","discourse/plugins/poll/discourse/components/modal/poll-ui-builder","discourse/plugins/poll/discourse/components/poll-buttons-dropdown","discourse/plugins/poll/discourse/components/poll-info","discourse/plugins/poll/discourse/components/poll-options","discourse/plugins/poll/discourse/components/poll-results-pie","discourse/plugins/poll/discourse/components/poll-results-tabs","@ember/component","@ember/template-factory"],function(e,t,l,o,s,n,i,r,a,p,u,d,c,h,m,g,f,b,v,_,y,k){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const w="staff_only",C="ranked_choice",O="on_close",x="closed"
class T extends t.default{static{dt7948.g(this.prototype,"currentUser",[i.service])}#u=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"siteSettings",[i.service])}#t=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"router",[i.service])}#c=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"appEvents",[i.service])}#h=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"dialog",[i.service])}#e=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"modal",[i.service])}#m=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"vote",[l.tracked],function(){return this.args.post.polls_votes?.[this.args.poll.name]||[]})}#g=void dt7948.i(this,"vote")
static{dt7948.g(this.prototype,"preloadedVoters",[l.tracked],function(){return this.defaultPreloadedVoters()})}#f=void dt7948.i(this,"preloadedVoters")
static{dt7948.g(this.prototype,"voterListExpanded",[l.tracked],function(){return!1})}#b=void dt7948.i(this,"voterListExpanded")
static{dt7948.g(this.prototype,"hasSavedVote",[l.tracked],function(){return this.vote.length>0})}#v=void dt7948.i(this,"hasSavedVote")
static{dt7948.g(this.prototype,"showResults",[l.tracked],function(){return!(this.poll.results===O&&!this.closed)&&(this.hasSavedVote||this.topicArchived&&!this.staffOnly||this.closed&&!this.staffOnly)})}#_=void dt7948.i(this,"showResults")
static{dt7948.g(this.prototype,"showTally",[l.tracked],function(){return!1})}#y=void dt7948.i(this,"showTally")
checkUserGroups=(e,t)=>{const l=t&&t.groups&&t.groups.split(",").map(e=>e.toLowerCase())
if(!l)return!0
const o=e&&e.groups&&e.groups.map(e=>e.name.toLowerCase())
return o&&l.some(e=>o.includes(e))}
areRanksValid=e=>{let t=new Set,l=!1,o=!0
return e.forEach(e=>{const s=e.rank
if(0!==s){if(o=!1,t.has(s))return void(l=!0)
t.add(s)}}),!l&&!o}
_toggleOption=(e,t=0)=>{if(this.isMultiple){const t=this.vote.indexOf(e.id);-1!==t?this.vote.splice(t,1):this.vote.push(e.id)}else this.isRankedChoice?this.options.forEach(l=>{const o=this.vote.findIndex(e=>e.digest===l.id);-1===o?this.vote.push({digest:l.id,rank:l.id===e?t:0}):l.id===e&&(this.vote[o].rank=t)}):this.vote=[e.id]
this.vote=[...this.vote]}
get poll(){return this.args.poll}defaultPreloadedVoters(){const e={}
return this.poll.public&&this.poll.preloaded_voters&&Object.keys(this.poll.preloaded_voters).forEach(t=>{e[t]={voters:this.poll.preloaded_voters[t],loading:!1}}),this.options.forEach(t=>{e[t.id]||(e[t.id]={voters:[],loading:!1})}),e}get id(){return`${this.args.poll.name}-${this.args.post.id}`}get post(){return this.args.post}get groupableUserFields(){return this.siteSettings.poll_groupable_user_fields.split("|").filter(Boolean)}get isStaff(){return this.currentUser?.staff}get titleHTML(){return(0,r.htmlSafe)(this.args.titleHTML)}get topicArchived(){return this.post.get("topic.archived")}get isRankedChoice(){return this.poll.type===C}get staffOnly(){return this.poll.results===w}get isMultiple(){return"multiple"===this.poll.type}get isNumber(){return"number"===this.poll.type}get isMe(){return this.currentUser&&this.post.user_id===this.currentUser.id}get status(){return this.poll.status}async castVotes(e){if(this.canCastVotes&&this.currentUser)try{const{poll:e}=await(0,p.ajax)("/polls/vote",{type:"PUT",data:{post_id:this.post.id,poll_name:this.poll.name,options:this.vote}})
this.hasSavedVote=!0,Object.assign(this.poll,e),this.appEvents.trigger("poll:voted",e,this.post,this.vote),this.poll.results!==O&&(this.showResults=!0),this.poll.results===w&&(this.currentUser&&this.currentUser.staff?this.showResults=!0:this.showResults=!1)}catch(t){t?(this.isMultiple||this.isRankedChoice||this._toggleOption(e),(0,u.popupAjaxError)(t)):this.dialog.alert((0,c.i18n)("poll.error_while_casting_votes"))}}static{dt7948.n(this.prototype,"castVotes",[s.action])}get options(){let e=this.poll.options
return this.isRankedChoice&&e.forEach(e=>{const t=this.vote.findIndex(t=>t.digest===e.id)
e.rank=-1===t?0:this.vote[t].rank}),e}get voters(){return this.poll.voters}get rankedChoiceOutcome(){return this.poll.ranked_choice_outcome||null}get min(){let e=parseInt(this.poll.min,10)
return(isNaN(e)||e<0)&&(e=1),e}get max(){let e=parseInt(this.poll.max,10)
const t=this.poll.options.length
return(isNaN(e)||e>t)&&(e=t),e}get closed(){return this.status===x||this.isAutomaticallyClosed}get isAutomaticallyClosed(){return(this.poll.close??!1)&&moment.utc(this.poll.close,"YYYY-MM-DD HH:mm:ss Z")<=moment()}get hasVoted(){return this.vote?.length>0}get hideResultsDisabled(){return!this.staffOnly&&(this.closed||this.topicArchived)}toggleOption(e,t=0){if(!this.closed&&this.currentUser&&this.checkUserGroups(this.currentUser,this.poll)){if(!this.isMultiple&&!this.isRankedChoice&&1===this.vote.length&&this.vote[0]===e.id)return this.removeVote()
this.isMultiple||this.isRankedChoice||(this.vote.length=0),this._toggleOption(e,t),this.isMultiple||this.isRankedChoice||this.castVotes(e)}}static{dt7948.n(this.prototype,"toggleOption",[s.action])}toggleResults(){this.showResults=!this.showResults}static{dt7948.n(this.prototype,"toggleResults",[s.action])}get canCastVotes(){if(this.closed||!this.currentUser)return!1
const e=this.vote?.length||0
return this.isMultiple?e>=this.min&&e<=this.max:this.isRankedChoice?this.options.length===this.vote?.length&&this.areRanksValid(this.vote):e>0}get notInVotingGroup(){return!this.checkUserGroups(this.currentUser,this.poll)}get pollGroups(){return(0,c.i18n)("poll.results.groups.title",{groups:this.poll.groups})}get showCastVotesButton(){return(this.isMultiple||this.isRankedChoice)&&!this.showResults}get castVotesButtonClass(){return"btn cast-votes "+(this.canCastVotes?"btn-primary":"btn-default")}get castVotesButtonIcon(){return this.castVotesDisabled?"far-square":"check"}get castVotesDisabled(){return!this.canCastVotes}get showHideResultsButton(){return this.showResults&&!this.hideResultsDisabled}get showShowResultsButton(){return!(this.showResults||this.hideResultsDisabled||"on_vote"===this.poll.results&&!this.hasSavedVote&&!this.isMe||this.poll.results===O&&!this.closed||this.poll.results===w&&!this.isStaff||!(this.voters>0))}get showRemoveVoteButton(){return!this.showResults&&!this.closed&&!this.hideResultsDisabled&&this.hasSavedVote}get isCheckbox(){return this.isMultiple}get resultsWidgetTypeClass(){const e=this.poll.type
return this.isNumber||this.poll.chart_type!==m.PIE_CHART_TYPE?`discourse-poll-${e}-results`:"discourse-poll-pie-chart"}get resultsPie(){return this.poll.chart_type===m.PIE_CHART_TYPE}get averageRating(){const e=this.options.reduce((e,t)=>e+parseInt(t.html,10)*parseInt(t.votes,10),0),t=0===this.voters?0:(0,d.default)(e/this.voters,-2)
return(0,r.htmlSafe)((0,c.i18n)("poll.average_rating",{average:t}))}get availableDisplayMode(){return this.showResults&&this.poll.chart_type!==m.PIE_CHART_TYPE&&[m.REGULAR_POLL_TYPE,m.MULTIPLE_POLL_TYPE].includes(this.poll.type)?this.showTally?"showPercentage":"showTally":null}updatedVoters(){this.voterListExpanded||(this.preloadedVoters=this.defaultPreloadedVoters())}static{dt7948.n(this.prototype,"updatedVoters",[s.action])}fetchVoters(e){let t,l=this.preloadedVoters
e?(l[e].loading=!0,t=l[e]?.voters):t=l,this.preloadedVoters={...l}
const o=t?.length
return(0,p.ajax)("/polls/voters.json",{data:{post_id:this.post.id,poll_name:this.poll.name,option_id:e,page:Math.floor(o/25)+1,limit:25}}).then(o=>{this.voterListExpanded=!0
const s=e?o.voters[e]:o.voters
let n=new Set([])
this.isRankedChoice?(n=new Set(t.map(e=>e.user.username)),s.forEach(e=>{n.has(e.user.username)||(n.add(e.user.username),t.push(e))})):(n=new Set(t.map(e=>e.username)),s.forEach(e=>{n.has(e.username)||(n.add(e.username),t.push(e))}),"regular"===this.poll.type&&Object.keys(l).forEach(t=>{e!==t&&(l[t].voters=l[t].voters.filter(e=>!n.has(e.username)))}))}).catch(e=>{e?(0,u.popupAjaxError)(e):this.dialog.alert((0,c.i18n)("poll.error_while_fetching_voters"))}).finally(()=>{e&&(l[e].loading=!1),this.preloadedVoters={...l}})}static{dt7948.n(this.prototype,"fetchVoters",[s.action])}dropDownClick(e){this[e]()}static{dt7948.n(this.prototype,"dropDownClick",[s.action])}removeVote(){return(0,p.ajax)("/polls/vote",{type:"DELETE",data:{post_id:this.post.id,poll_name:this.poll.name}}).then(({poll:e})=>{this.poll.type===C&&e.options.forEach(e=>{e.rank=0}),this.vote=Object.assign([]),this.hasSavedVote=!1,this.appEvents.trigger("poll:voted",e,this.post,this.vote),this.showResults=!1}).catch(e=>(0,u.popupAjaxError)(e))}static{dt7948.n(this.prototype,"removeVote",[s.action])}toggleStatus(){this.isAutomaticallyClosed||this.dialog.yesNoConfirm({message:(0,c.i18n)(this.closed?"poll.open.confirm":"poll.close.confirm"),didConfirm:()=>{const e=this.closed?"open":x;(0,p.ajax)("/polls/toggle_status",{type:"PUT",data:{post_id:this.post.id,poll_name:this.poll.name,status:e}}).then(()=>{this.poll.status=e,this.poll.results!==O&&"always"!==this.poll.results||(this.showResults=this.status===x),this.poll.results===O&&this.status===x&&this.router.refresh()}).catch(e=>{e?(0,u.popupAjaxError)(e):this.dialog.alert((0,c.i18n)("poll.error_while_toggling_status"))})}})}static{dt7948.n(this.prototype,"toggleStatus",[s.action])}showBreakdown(){this.modal.show(h.default,{model:{poll:this.poll,post:this.post}})}static{dt7948.n(this.prototype,"showBreakdown",[s.action])}exportResults(){const e=this.poll.type===C?this.siteSettings.poll_export_ranked_choice_data_explorer_query_id:this.siteSettings.poll_export_data_explorer_query_id;(0,p.ajax)(`/admin/plugins/explorer/queries/${e}/run.csv`,{type:"POST",data:{params:JSON.stringify({poll_name:this.poll.name,post_id:this.post.id.toString()}),explain:!1,limit:1e6,download:1}}).then(e=>{const t=document.createElement("a"),l=new Blob([e],{type:"text/csv;charset=utf-8;"})
t.href=URL.createObjectURL(l),t.setAttribute("download",`poll-export-${this.poll.name}-${this.post.id}.csv`),t.click(),t.remove()}).catch(e=>{e?(0,u.popupAjaxError)(e):this.dialog.alert((0,c.i18n)("poll.error_while_exporting_results"))})}static{dt7948.n(this.prototype,"exportResults",[s.action])}toggleDisplayMode(){this.showTally=!this.showTally}static{dt7948.n(this.prototype,"toggleDisplayMode",[s.action])}static{(0,y.setComponentTemplate)((0,k.createTemplateFactory)({id:"JuU75hhn",block:'[[[1,"\\n    "],[10,0],[14,0,"poll"],[12],[1,"\\n      "],[11,0],[24,0,"poll-container"],[4,[32,0],[[30,0,["updatedVoters"]],[30,0,["poll","preloaded_voters"]]],null],[12],[1,"\\n        "],[1,[30,0,["titleHTML"]]],[1,"\\n"],[41,[30,0,["notInVotingGroup"]],[[[1,"          "],[10,0],[14,0,"alert alert-danger"],[12],[1,[30,0,["pollGroups"]]],[13],[1,"\\n"]],[]],null],[41,[30,0,["showResults"]],[[[1,"          "],[10,0],[15,0,[30,0,["resultsWidgetTypeClass"]]],[12],[1,"\\n"],[41,[30,0,["isNumber"]],[[[1,"              "],[10,1],[12],[1,[30,0,["averageRating"]]],[13],[1,"\\n"]],[]],[[[41,[30,0,["resultsPie"]],[[[1,"                "],[8,[32,1],null,[["@id","@options"],[[30,0,["id"]],[30,0,["options"]]]],null],[1,"\\n"]],[]],[[[1,"                "],[8,[32,2],null,[["@options","@pollName","@pollType","@isRankedChoice","@isPublic","@postId","@vote","@voters","@votersCount","@fetchVoters","@rankedChoiceOutcome","@showTally"],[[30,0,["options"]],[30,0,["poll","name"]],[30,0,["poll","type"]],[30,0,["isRankedChoice"]],[30,0,["poll","public"]],[30,0,["post","id"]],[30,0,["vote"]],[30,0,["preloadedVoters"]],[30,0,["poll","voters"]],[30,0,["fetchVoters"]],[30,0,["rankedChoiceOutcome"]],[30,0,["showTally"]]]],null],[1,"\\n"]],[]]]],[]]],[1,"          "],[13],[1,"\\n"]],[]],[[[1,"          "],[8,[32,3],null,[["@isCheckbox","@isRankedChoice","@options","@votes","@sendOptionSelect"],[[30,0,["isCheckbox"]],[30,0,["isRankedChoice"]],[30,0,["options"]],[30,0,["vote"]],[30,0,["toggleOption"]]]],null],[1,"\\n"]],[]]],[1,"      "],[13],[1,"\\n      "],[8,[32,4],null,[["@options","@min","@max","@isMultiple","@close","@closed","@results","@showResults","@postUserId","@isPublic","@isDynamic","@hasVoted","@voters"],[[30,0,["options"]],[30,0,["min"]],[30,0,["max"]],[30,0,["isMultiple"]],[30,0,["close"]],[30,0,["closed"]],[30,0,["poll","results"]],[30,0,["showResults"]],[30,0,["poll","post","user_id"]],[30,0,["poll","public"]],[52,[30,1],true,[30,0,["poll","dynamic"]]],[30,0,["hasVoted"]],[30,0,["voters"]]]],null],[1,"\\n      "],[10,0],[14,0,"poll-buttons"],[12],[1,"\\n"],[41,[30,0,["showCastVotesButton"]],[[[1,"          "],[11,"button"],[16,0,[30,0,["castVotesButtonClass"]]],[16,"title",[28,[32,5],["poll.cast-votes.title"],null]],[16,"disabled",[30,0,["castVotesDisabled"]]],[4,[32,6],["click",[30,0,["castVotes"]]],null],[12],[1,"\\n            "],[1,[28,[32,7],[[30,0,["castVotesButtonIcon"]]],null]],[1,"\\n            "],[10,1],[14,0,"d-button-label"],[12],[1,[28,[32,5],["poll.cast-votes.label"],null]],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showHideResultsButton"]],[[[1,"          "],[11,"button"],[24,0,"btn btn-default toggle-results"],[16,"title",[28,[32,5],["poll.hide-results.title"],null]],[4,[32,6],["click",[30,0,["toggleResults"]]],null],[12],[1,"\\n            "],[1,[28,[32,7],["chevron-left"],null]],[1,"\\n            "],[10,1],[14,0,"d-button-label"],[12],[1,[28,[32,5],["poll.hide-results.label"],null]],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showShowResultsButton"]],[[[1,"          "],[11,"button"],[24,0,"btn btn-default toggle-results"],[16,"title",[28,[32,5],["poll.show-results.title"],null]],[4,[32,6],["click",[30,0,["toggleResults"]]],null],[12],[1,"\\n            "],[1,[28,[32,7],["chart-bar"],null]],[1,"\\n            "],[10,1],[14,0,"d-button-label"],[12],[1,[28,[32,5],["poll.show-results.label"],null]],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showRemoveVoteButton"]],[[[1,"          "],[11,"button"],[24,0,"btn btn-default remove-vote"],[16,"title",[28,[32,5],["poll.remove-vote.title"],null]],[4,[32,6],["click",[30,0,["removeVote"]]],null],[12],[1,"\\n            "],[1,[28,[32,7],["arrow-rotate-left"],null]],[1,"\\n            "],[10,1],[14,0,"d-button-label"],[12],[1,[28,[32,5],["poll.remove-vote.label"],null]],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[32,8],null,[["@closed","@voters","@isStaff","@isMe","@isRankedChoice","@topicArchived","@groupableUserFields","@isAutomaticallyClosed","@dropDownClick","@availableDisplayMode"],[[30,0,["closed"]],[30,0,["voters"]],[30,0,["isStaff"]],[30,0,["isMe"]],[30,0,["isRankedChoice"]],[30,0,["topicArchived"]],[30,0,["groupableUserFields"]],[30,0,["isAutomaticallyClosed"]],[30,0,["dropDownClick"]],[30,0,["availableDisplayMode"]]]],null],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@isDynamic"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/components/poll.js",scope:()=>[n.default,v.default,_.default,b.default,f.default,c.i18n,o.on,a.default,g.default],isStrictMode:!0}),this)}}e.default=T}),define("discourse/plugins/poll/discourse/initializers/add-poll-ui-builder",["exports","discourse/lib/plugin-api","discourse/plugins/poll/lib/rich-editor-extension","discourse/plugins/poll/discourse/components/modal/poll-ui-builder"],function(e,t,l,o){"use strict"
function s(e){e.addComposerToolbarPopupMenuOption({action:t=>{e.container.lookup("service:modal").show(o.default,{model:{toolbarEvent:t}})},icon:"chart-bar",label:"poll.ui_builder.title",condition:t=>{const l=e.container.lookup("service:site-settings"),o=e.getCurrentUser()
return l.poll_enabled&&(t.model.topic?.pm_with_non_human_user||o&&(o.staff||o.can_create_poll))}}),e.registerRichEditorExtension(l.default)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"add-poll-ui-builder",initialize(){(0,t.withPluginApi)(s)}}}),define("discourse/plugins/poll/discourse/initializers/extend-for-poll",["exports","@glimmer/tracking","@ember/object","@ember-compat/tracked-built-ins","discourse/lib/decorators","discourse/lib/plugin-api","discourse/plugins/poll/discourse/components/modal/poll-ui-builder","discourse/plugins/poll/discourse/components/poll","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,l,o,s,n,i,r,a,p,u){"use strict"
function d(e,t){let s=[...e.querySelectorAll(".poll")]
if(s=s.filter(e=>"BLOCKQUOTE"!==e.parentNode.tagName),!s.length||!t)return
const n=t.getModel(),d=n.pollsObject
s.forEach(e=>{const s=e.dataset.pollName
let c=d[s],h=n
const m=e.closest(".expanded-quote")?.dataset.postId
if(m&&n.quoted[m]&&(h=l.default.create(n.quoted[m]),c=new o.TrackedObject(h.polls.find(e=>e.name===s))),c){const l=e.querySelector(".poll-title")?.outerHTML,o="true"===e.dataset.pollDynamic,s=document.createElement("div")
Object.assign(s.dataset,{pollName:c.name,pollType:c.type}),s.classList.add("poll-outer"),c.chart_type===i.PIE_CHART_TYPE&&s.classList.add("pie"),e.replaceWith(s),t.renderGlimmer(s,(0,a.setComponentTemplate)((0,p.createTemplateFactory)({id:"i358h2HB",block:'[[[1,"\\n          "],[8,[32,0],null,[["@poll","@post","@titleHTML","@isDynamic"],[[32,1],[32,2],[32,3],[52,[32,4],true,[32,1,["dynamic"]]]]],null],[1,"\\n        "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/poll/discourse/initializers/extend-for-poll.js",scope:()=>[r.default,c,n,l,o],isStrictMode:!0}),(0,u.default)(void 0,void 0)))}})}function c(e){e.modifyClass("controller:topic",e=>class extends e{subscribe(){super.subscribe(...arguments),this.messageBus.subscribe(`/polls/${this.model.id}`,this._onPollMessage)}unsubscribe(){this.messageBus.unsubscribe("/polls/*",this._onPollMessage),super.unsubscribe(...arguments)}_onPollMessage(e){const t=this.get("model.postStream").findLoadedPost(e.post_id)
t&&(t.polls=e.polls)}static{dt7948.n(this.prototype,"_onPollMessage",[s.bind])}}),e.modifyClass("model:post",e=>class extends e{static{dt7948.g(this.prototype,"pollsObject",[t.tracked],function(){return new o.TrackedObject})}#k=void dt7948.i(this,"pollsObject")
static{dt7948.g(this.prototype,"_polls",[t.tracked])}#w=void dt7948.i(this,"_polls")
get polls(){return this._polls}set polls(e){this._polls=e,this._refreshPollsObject()}_refreshPollsObject(){for(const e of this.polls){const t=e.name
this.pollsObject[t]||=new o.TrackedObject,Object.assign(this.pollsObject[t],e)}}}),e.decorateCookedElement(d,{onlyStream:!0})
e.container.lookup("service:site-settings").poll_enabled&&e.addSearchSuggestion("in:polls")}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"extend-for-poll",initialize(){(0,n.withPluginApi)(c)}}}),define("discourse/plugins/poll/lib/chart-colors",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.getColors=function(e,t){let l
switch(t=t||"cool"){case"cool":l={0:[255,255,255],25:[220,237,200],50:[66,179,213],75:[26,39,62],100:[0,0,0]}
break
case"warm":l={0:[255,255,255],25:[254,235,101],50:[228,82,27],75:[77,52,47],100:[0,0,0]}}let o,s,n=Object.keys(l),i=[]
for(let r=0;r<e;r++){let t
o=(r+1)*(100/(e+1)),s=s||0
for(let e=s;e<n.length;e++){if(!n[e+1]){t=e-1
break}if(o>=n[e]&&o<n[e+1]){t=e
break}}let a=(o-n[t])/(n[t+1]-n[t]),p=[]
for(let e=0;e<3;e++)p.push(Math.round(l[n[t]][e]-(l[n[t]][e]-l[n[t+1]][e])*a))
i.push(`rgb(${p.toString()})`),s=t}return i}}),define("discourse/plugins/poll/lib/discourse-markdown/poll",["exports","discourse-i18n"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.setup=function(e){e.allowList(["a.button.cast-votes","a.button.toggle-results","div.poll-buttons","div.poll-container","div.poll-info_counts-count","div.poll-info_counts","div.poll-info","div.poll-title","div.poll","div[data-*]","li[data-*]","span.info-label","span.info-number","span.info-text"]),e.registerOptions((e,t)=>{e.features.poll=t.poll_enabled,e.pollMaximumOptions=t.poll_maximum_options}),e.registerPlugin(e=>e.block.bbcode.ruler.push("poll",n))}
/*!
   * Joseph Myer's md5() algorithm wrapped in a self-invoked function to prevent
   * global namespace pollution, modified to hash unicode characters as UTF-8.
   *
   * Copyright 1999-2010, Joseph Myers, Paul Johnston, Greg Holt, Will Bond <will@wbond.net>
   * http://www.myersdaily.org/joseph/javascript/md5-text.html
   * http://pajhome.org.uk/crypt/md5
   *
   * Released under the BSD license
   * http://www.opensource.org/licenses/bsd-license
   */
const l="data-poll-",o={name:"poll",status:"open"},s=["chartType","close","groups","max","min","name","order","public","results","status","step","type","dynamic"]
const n={tag:"poll",before(e,{attrs:t}){e.tokens.filter(e=>"poll_open"===e.type).length>e.tokens.filter(e=>"poll_close"===e.type).length||(e.push("poll_open","div",1).poll_attrs={...o,...t})},after(e,o){if("poll_open"!==o.type)return
let n=o.poll_attrs,i=e.tokens.indexOf(o),r=e.tokens.slice(i+1),a=[]
if(r.length>0&&"heading_open"===r[0].type){let t=r.findIndex(e=>"heading_close"===e.type);-1!==t&&(a=r.splice(0,t+1).slice(1,-1),e.tokens.splice(i+1,t+1))}if("number"===n.type){let t=parseInt(n.min,10),l=parseInt(n.max,10),o=parseInt(n.step,10)
if(isNaN(t)&&(t=1),isNaN(l)&&(l=e.md.options.discourse.pollMaximumOptions),(isNaN(o)||o<1)&&(o=1),r.length>0)return void e.tokens.splice(i,1)
t<=l&&function(e,t,l,o,s){t.push(new e.Token("bullet_list_open","ul",1))
for(let n=l;n<=o;n+=s){t.push(new e.Token("list_item_open","li",1))
let l=new e.Token("text","",0)
l.content=String(n),t.push(l),t.push(new e.Token("list_item_close","li",-1))}t.push(new e.Token("bullet_list_close","ul",-1))}(e,r,t,l,o)}e.tokens.splice(i+1),o.attrs||=[],o.attrs.push(["class","poll"])
for(let t of s)n[t]&&o.attrs.push([l+t,n[t]])
r.length>0&&!r[0].type.endsWith("_list_open")||(function(e,t,o){let s=e.push("poll_container_open","div",1)
s.attrs=[["class","poll-container"]],t.length>0&&(s=e.push("poll_title_open","div",1),s.attrs=[["class","poll-title"]],e.tokens.push(...t),e.push("poll_title_close","div",-1))
for(let n=0;n<o.length;n++)if("list_item_open"===o[n].type){let e=o.findIndex((e,t)=>t>n&&"list_item_close"===e.type)
if(-1===e)continue
let t=o.slice(n,e+1).filter(e=>"text"===e.type||"inline"===e.type).map(e=>e.content).join(" "),s=f(JSON.stringify([t]))
o[n].attrs||=[],o[n].attrs.push([l+"option-id",s])}e.tokens.push(...o),e.push("poll_container_close","div",-1)}(e,a,r),function(e){let l=e.push("poll_info_open","div",1)
l.attrs=[["class","poll-info"]],l=e.push("poll_info_counts_open","div",1),l.attrs=[["class","poll-info_counts"]],l=e.push("poll_info_counts_count_open","div",1),l.attrs=[["class","poll-info_counts-count"]],l=e.push("poll_info_number_open","span",1),l.attrs=[["class","info-number"]],l.block=!1,l=e.push("text","",0),l.content="0",e.push("poll_info_number_close","span",-1),l=e.push("poll_info_label_open","span",1),l.attrs=[["class","info-label"]],l.block=!1,l=e.push("text","",0),l.content=(0,t.i18n)("poll.voters",{count:0}),e.push("poll_info_label_close","span",-1),e.push("poll_info_counts_count_close","div",-1),e.push("poll_info_counts_close","div",-1),e.push("poll_info_close","div",-1)}(e),e.push("poll_close","div",-1))}}
function i(e,t){let l=e[0],o=e[1],s=e[2],n=e[3]
l=a(l,o,s,n,t[0],7,-680876936),n=a(n,l,o,s,t[1],12,-389564586),s=a(s,n,l,o,t[2],17,606105819),o=a(o,s,n,l,t[3],22,-1044525330),l=a(l,o,s,n,t[4],7,-176418897),n=a(n,l,o,s,t[5],12,1200080426),s=a(s,n,l,o,t[6],17,-1473231341),o=a(o,s,n,l,t[7],22,-45705983),l=a(l,o,s,n,t[8],7,1770035416),n=a(n,l,o,s,t[9],12,-1958414417),s=a(s,n,l,o,t[10],17,-42063),o=a(o,s,n,l,t[11],22,-1990404162),l=a(l,o,s,n,t[12],7,1804603682),n=a(n,l,o,s,t[13],12,-40341101),s=a(s,n,l,o,t[14],17,-1502002290),o=a(o,s,n,l,t[15],22,1236535329),l=p(l,o,s,n,t[1],5,-165796510),n=p(n,l,o,s,t[6],9,-1069501632),s=p(s,n,l,o,t[11],14,643717713),o=p(o,s,n,l,t[0],20,-373897302),l=p(l,o,s,n,t[5],5,-701558691),n=p(n,l,o,s,t[10],9,38016083),s=p(s,n,l,o,t[15],14,-660478335),o=p(o,s,n,l,t[4],20,-405537848),l=p(l,o,s,n,t[9],5,568446438),n=p(n,l,o,s,t[14],9,-1019803690),s=p(s,n,l,o,t[3],14,-187363961),o=p(o,s,n,l,t[8],20,1163531501),l=p(l,o,s,n,t[13],5,-1444681467),n=p(n,l,o,s,t[2],9,-51403784)
s=p(s,n,l,o,t[7],14,1735328473),o=p(o,s,n,l,t[12],20,-1926607734),l=u(l,o,s,n,t[5],4,-378558),n=u(n,l,o,s,t[8],11,-2022574463),s=u(s,n,l,o,t[11],16,1839030562),o=u(o,s,n,l,t[14],23,-35309556),l=u(l,o,s,n,t[1],4,-1530992060),n=u(n,l,o,s,t[4],11,1272893353),s=u(s,n,l,o,t[7],16,-155497632),o=u(o,s,n,l,t[10],23,-1094730640),l=u(l,o,s,n,t[13],4,681279174),n=u(n,l,o,s,t[0],11,-358537222),s=u(s,n,l,o,t[3],16,-722521979),o=u(o,s,n,l,t[6],23,76029189),l=u(l,o,s,n,t[9],4,-640364487),n=u(n,l,o,s,t[12],11,-421815835),s=u(s,n,l,o,t[15],16,530742520),o=u(o,s,n,l,t[2],23,-995338651),l=d(l,o,s,n,t[0],6,-198630844),n=d(n,l,o,s,t[7],10,1126891415),s=d(s,n,l,o,t[14],15,-1416354905),o=d(o,s,n,l,t[5],21,-57434055),l=d(l,o,s,n,t[12],6,1700485571),n=d(n,l,o,s,t[3],10,-1894986606),s=d(s,n,l,o,t[10],15,-1051523),o=d(o,s,n,l,t[1],21,-2054922799),l=d(l,o,s,n,t[8],6,1873313359),n=d(n,l,o,s,t[15],10,-30611744),s=d(s,n,l,o,t[6],15,-1560198380),o=d(o,s,n,l,t[13],21,1309151649)
l=d(l,o,s,n,t[4],6,-145523070),n=d(n,l,o,s,t[11],10,-1120210379),s=d(s,n,l,o,t[2],15,718787259),o=d(o,s,n,l,t[9],21,-343485551),e[0]=g(l,e[0]),e[1]=g(o,e[1]),e[2]=g(s,e[2]),e[3]=g(n,e[3])}function r(e,t,l,o,s,n){return t=g(g(t,e),g(o,n)),g(t<<s|t>>>32-s,l)}function a(e,t,l,o,s,n,i){return r(t&l|~t&o,e,t,s,n,i)}function p(e,t,l,o,s,n,i){return r(t&o|l&~o,e,t,s,n,i)}function u(e,t,l,o,s,n,i){return r(t^l^o,e,t,s,n,i)}function d(e,t,l,o,s,n,i){return r(l^(t|~o),e,t,s,n,i)}function c(e){let t,l=[]
for(t=0;t<64;t+=4)l[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24)
return l}let h="0123456789abcdef".split("")
function m(e){let t="",l=0
for(;l<4;l++)t+=h[e>>8*l+4&15]+h[e>>8*l&15]
return t}function g(e,t){return e+t&4294967295}function f(e){return function(e){for(let t=0;t<e.length;t++)e[t]=m(e[t])
return e.join("")}(function(e){let t,l=(e=unescape(encodeURI(e))).length,o=[1732584193,-271733879,-1732584194,271733878]
for(t=64;t<=e.length;t+=64)i(o,c(e.substring(t-64,t)))
e=e.substring(t-64)
let s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
for(t=0;t<e.length;t++)s[t>>2]|=e.charCodeAt(t)<<(t%4<<3)
if(s[t>>2]|=128<<(t%4<<3),t>55)for(i(o,s),t=0;t<16;t++)s[t]=0
return s[14]=8*l,i(o,s),o}(e))}}),define("discourse/plugins/poll/lib/even-round",["exports"],function(e){"use strict"
function t(e){return 100===e.map(e=>Math.floor(e)).reduce((e,t)=>e+t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){let l=e.map(e=>e%1)
const o=Math.ceil(l.reduce((e,t)=>e+t))
for(let s=0,n=l.length;s<o&&s<n;s++){let o=0,s=0
for(let e=0;e<l.length;e++)l[e]>o&&(s=e,o=l[e])
if(++e[s],l[s]=0,t(e))break}return e.map(e=>Math.floor(e))}}),define("discourse/plugins/poll/lib/rich-editor-extension",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const t={nodeSpec:{poll:{attrs:{type:{default:null},results:{default:null},public:{default:null},name:{default:null},chartType:{default:null},close:{default:null},groups:{default:null},max:{default:null},min:{default:null},dynamic:{default:null}},content:"heading? bullet_list poll_info?",group:"block",selectable:!0,isolating:!0,defining:!0,parseDOM:[{tag:"div.poll",getAttrs:e=>({type:e.getAttribute("data-poll-type"),results:e.getAttribute("data-poll-results"),public:e.getAttribute("data-poll-public"),name:e.getAttribute("data-poll-name"),chartType:e.getAttribute("data-poll-chart-type"),close:e.getAttribute("data-poll-close"),groups:e.getAttribute("data-poll-groups"),dynamic:e.getAttribute("data-poll-dynamic"),max:e.getAttribute("data-poll-max"),min:e.getAttribute("data-poll-min")})}],toDOM:e=>["div",{class:"poll","data-poll-type":e.attrs.type,"data-poll-results":e.attrs.results,"data-poll-public":e.attrs.public,"data-poll-name":e.attrs.name,"data-poll-chart-type":e.attrs.chartType,"data-poll-close":e.attrs.close,"data-poll-groups":e.attrs.groups,"data-poll-dynamic":e.attrs.dynamic,"data-poll-max":e.attrs.max,"data-poll-min":e.attrs.min},0]},poll_info:{content:"inline*",selectable:!1,isolating:!0,parseDOM:[{tag:"div.poll-info"}],toDOM:()=>["div",{class:"poll-info",contentEditable:!1},0]}},parse:{poll:{block:"poll",getAttrs:e=>({...e.poll_attrs,name:"poll"===e.poll_attrs.name?null:e.poll_attrs.name})},poll_container:{ignore:!0},poll_title:{block:"heading"},poll_info:{block:"poll_info"},poll_info_counts:{ignore:!0},poll_info_counts_count:{ignore:!0},poll_info_number:{ignore:!0},poll_info_label_open(e){e.addText(" ")},poll_info_label_close(){}},serializeNode:{poll(e,t){const l=Object.entries(t.attrs).map(([e,t])=>t?` ${e}="${t}"`:"").join("")
e.write(`[poll${l}]\n`),e.renderContent(t),e.write("[/poll]\n\n")},poll_info(){}}}
e.default=t})

//# sourceMappingURL=poll-24376529.map